!function(e){function t(a){if(i[a])return i[a].exports;var r=i[a]={exports:{},id:a,loaded:!1};return e[a].call(r.exports,r,r.exports,t),r.loaded=!0,r.exports}var i={};return t.m=e,t.c=i,t.p="",t(0)}([function(e,t,i){e.exports=i(13)},,,,,,,,,,,,,function(e,t,i){function a(e){return e.keys().map(e)}window.jsCommon,window.powerbi,window.powerbitests,window.InJs,window.debug,window.jasmine,window.Microsoft;window.jsCommon=window.jsCommon||{},window.powerbi=window.powerbi||{},window.debug=window.debug||{},window.InJs=window.InJs||{},a(i(14)),i(37)},function(e,t,i){function a(e){return i(r(e))}function r(e){return s[e]||function(){throw new Error("Cannot find module '"+e+"'.")}()}var s={"./styles/styles.less":15,"./visuals/asterPlot/visual/styles/asterPlot.less":17,"./visuals/bulletChart/visual/styles/bulletChart.less":18,"./visuals/chicletSlicer/visual/styles/chicletSlicer.less":19,"./visuals/chordChart/visual/styles/chordChart.less":20,"./visuals/dotPlot/visual/styles/dotPlot.less":21,"./visuals/enhancedScatterChart/visual/styles/enhancedScatterChart.less":22,"./visuals/forceGraph/visual/styles/forceGraph.less":23,"./visuals/gantt/visual/styles/gantt.less":24,"./visuals/globeMap/visual/styles/globeMap.less":25,"./visuals/histogram/visual/styles/histogram.less":26,"./visuals/lineDotChart/visual/styles/lineDotChart.less":27,"./visuals/mekkoChart/visual/styles/mekkoChart.less":28,"./visuals/pulseChart/visual/styles/pulseChart.less":29,"./visuals/radarChart/visual/styles/radarChart.less":30,"./visuals/sankeyDiagram/visual/styles/sankeyDiagram.less":31,"./visuals/streamGraph/visual/styles/streamGraph.less":32,"./visuals/sunburst/visual/styles/sunburst.less":33,"./visuals/timeline/visual/styles/timeline.less":34,"./visuals/tornadoChart/visual/styles/tornadoChart.less":35,"./visuals/wordCloud/visual/styles/wordCloud.less":36};a.keys=function(){return Object.keys(s)},a.resolve=r,e.exports=a,a.id=14},function(e,t){},,function(e,t){},function(e,t){},function(e,t){},function(e,t){},function(e,t){},function(e,t){},function(e,t){},function(e,t){},function(e,t){},function(e,t){},function(e,t){},function(e,t){},function(e,t){},function(e,t){},function(e,t){},function(e,t){},function(e,t){},function(e,t){},function(e,t){},function(e,t){},function(e,t,i){window.jsCommon,window.powerbi,window.powerbitests,window.InJs,window.debug,window.jasmine,window.Microsoft;i(38),i(39),i(40),i(41),i(42),i(43),i(44),i(45),i(46),i(47),i(48),i(49),i(50),i(51),i(52),i(53),i(54),i(55),i(56),i(57),i(58)},function(e,t){var i,a=window.jsCommon,i=window.powerbi;window.powerbitests,window.InJs,window.debug,window.jasmine,window.Microsoft;!function(e){var t;!function(t){var i;!function(t){var i=a.CssConstants.createClassAndSelector,r=a.PixelConverter,s=e.createEnumType,o=e.DataViewObjects,n=e.TextMeasurementService,l=e.DataLabelManager,c=e.VisualDataRoleKind,u=e.visuals.valueFormatter,h=e.visuals.LegendData,p=e.visuals.ObjectEnumerationBuilder,d=e.visuals.LegendPosition,g=e.visuals.dataLabelUtils,m=e.visuals.converterHelper,f=e.visuals.legendPosition,y=e.visuals.ColorHelper,v=e.visuals.valueFormatter,x=e.visuals.TooltipBuilder,b=e.visuals.SelectionId,S=e.visuals.LegendIcon,w=e.visuals.appendClearCatcher,C=e.visuals.createInteractivityService,P=e.visuals.createLegend,A=e.visuals.AnimatorCommon.MinervaAnimationDuration,T=e.visuals.SVGUtil,D=e.visuals.TooltipManager,V=e.visuals.Legend,N="asterPlot",L=.9,M=.9,k=function(){function e(){}return e.prototype.bindEvents=function(e,t){this.selection=e.selection,this.clearCatcher=e.clearCatcher,this.interactivityService=e.interactivityService,this.hasHighlights=e.hasHighlights,this.selection.on("click",function(e,i){t.handleSelection(e.data,d3.event.ctrlKey)}),this.clearCatcher.on("click",function(){t.handleClearSelection()}),this.renderSelection(this.interactivityService.hasSelection())},e.prototype.renderSelection=function(e){var t=this;this.selection.style("fill-opacity",function(i){return R.getFillOpacity(i.data.selected,i.data.highlight,e,t.hasHighlights)})},e}(),I=function(){function e(e){this.message=e}return Object.defineProperty(e.prototype,"code",{get:function(){return"AsterPlotWarning"},enumerable:!0,configurable:!0}),e.prototype.getMessages=function(e){return{message:this.message,title:e.get(""),detail:e.get("")}},e}();t.AsterPlotWarning=I;var O=function(){function e(e,t){this.defaultViewport=e||{width:0,height:0},this.defaultMargin=t||{top:0,bottom:0,right:0,left:0}}return Object.defineProperty(e.prototype,"viewport",{get:function(){return this.viewportValue||(this.viewportValue=this.defaultViewport)},set:function(t){var i=this;this.previousOriginalViewportValue=_.clone(this.originalViewportValue),this.originalViewportValue=_.clone(t),this.setUpdateObject(t,function(e){return i.viewportValue=e},function(t){return e.restrictToMinMax(t,i.minViewport)})},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"viewportCopy",{get:function(){return _.clone(this.viewport)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"viewportIn",{get:function(){return this.viewportInValue||this.viewport},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"minViewport",{get:function(){return this.minViewportValue||{width:0,height:0}},set:function(t){var i=this;this.setUpdateObject(t,function(e){return i.minViewportValue=e},e.restrictToMinMax)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"margin",{get:function(){return this.marginValue||(this.marginValue=this.defaultMargin)},set:function(t){var i=this;this.setUpdateObject(t,function(e){return i.marginValue=e},e.restrictToMinMax)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"viewportChanged",{get:function(){return!(!this.originalViewportValue||this.previousOriginalViewportValue&&this.previousOriginalViewportValue.height===this.originalViewportValue.height&&this.previousOriginalViewportValue.width===this.originalViewportValue.width)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"viewportInIsZero",{get:function(){return 0===this.viewportIn.width||0===this.viewportIn.height},enumerable:!0,configurable:!0}),e.prototype.resetMargin=function(){this.margin=this.defaultMargin},e.prototype.update=function(){this.viewportInValue=e.restrictToMinMax({width:this.viewport.width-(this.margin.left+this.margin.right),height:this.viewport.height-(this.margin.top+this.margin.bottom)},this.minViewportValue)},e.prototype.setUpdateObject=function(t,i,a){var r=this;t=_.clone(t),i(e.createNotifyChangedObject(t,function(e){a&&a(t),r.update()})),a&&a(t),this.update()},e.createNotifyChangedObject=function(e,t){var i={};return _.keys(e).forEach(function(a){return Object.defineProperty(i,a,{get:function(){return e[a]},set:function(i){e[a]=i,t(e,a)},enumerable:!0,configurable:!0})}),i},e.restrictToMinMax=function(e,t){return _.keys(e).forEach(function(i){return e[i]=Math.max(t&&t[i]||0,e[i])}),e},e}(),F=function(){function e(){}return e.setAttrThroughTransitionIfNotResized=function(e,t,i,a,r,s){s?e.attr(i,a):t(e.transition()).attrTween(i,r)},e.interpolateArc=function(e){return function(t){if(!this.oldData)return this.oldData=t,function(){return e(t)};var i=d3.interpolate(this.oldData,t);return this.oldData=i(0),function(t){return e(i(t))}}},e.addContext=function(e,t){return function(){return t.apply(e,[this].concat(_.toArray(arguments)))}},e}(),z=function(){function e(){this.legend={show:!1,position:d[d.Top],showTitle:!0,titleText:"",labelColor:h.DefaultLegendLabelFillColor,fontSize:8},this.labels={show:!1,color:g.defaultLabelColor,displayUnits:0,precision:g.defaultLabelPrecision,fontSize:g.DefaultFontSizeInPt},this.outerLine={show:!1,thickness:1}}return Object.defineProperty(e,"Default",{get:function(){return new this},enumerable:!0,configurable:!0}),e.parse=function(e,t){var i=new this;if(!e||!e.metadata||!e.metadata.objects)return i;var a=this.getProperties(t);for(var r in t.objects)for(var s in t.objects[r].properties)if(i[r]&&_.has(i[r],s)){var o=t.objects[r].properties[s].type,n=this.getValueFnByType(o);i[r][s]=n(e.metadata.objects,a[r][s],i[r][s])}return i},e.getProperties=function(e){var t=_.merge({general:{properties:{formatString:{}}}},e.objects),i={};for(var a in t){i[a]={};for(var r in t[a].properties)i[a][r]={objectName:a,propertyName:r}}return i},e.createEnumTypeFromEnum=function(e){var t=!1;return s(Object.keys(e).filter(function(i,a){return!!(a%2)===t&&e[i]===i&&!void(t=!t)||!!(a%2)!==t}).map(function(e){return{value:e,displayName:e}}))},e.getValueFnByType=function(e){switch(_.keys(e)[0]){case"fill":return o.getFillColor;default:return o.getValue}},e.enumerateObjectInstances=function(e,t,i){void 0===e&&(e=new this);var a=new p,r=e&&e[t.objectName];if(!r)return a;var s={objectName:t.objectName,selector:null,properties:{}};for(var o in r)_.has(r,o)&&(s.properties[o]=r[o]);return a.pushInstance(s),a},e.prototype.createOriginalSettings=function(){this.originalSettings=_.cloneDeep(this)},e}();t.AsterPlotSettings=z;var j=function(){function e(){this.Category=null,this.Y=null}return e.getColumnSources=function(e){return this.getColumnSourcesT(e)},e.getTableValues=function(e){var t=e&&e.table,i=this.getColumnSourcesT(e);return i&&t&&_.mapValues(i,function(e,i){return e&&t.rows.map(function(t){return t[e.index]})})},e.getTableRows=function(e){var t=e&&e.table,i=this.getColumnSourcesT(e);return i&&t&&t.rows.map(function(e){return _.mapValues(i,function(t,i){return t&&e[t.index]})})},e.getCategoricalValues=function(e){var t=e&&e.categorical,i=t&&t.categories||[],a=t&&t.values||[],r=t&&a.source&&this.getSeriesValues(e);return t&&_.mapValues(new this,function(e,t){return _.toArray(i).concat(_.toArray(a)).filter(function(e){return e.source.roles&&e.source.roles[t]}).map(function(e){return e.values})[0]||a.source&&a.source.roles&&a.source.roles[t]&&r})},e.getSeriesValues=function(e){return e&&e.categorical&&e.categorical.values&&e.categorical.values.map(function(e){return m.getSeriesName(e.source)})},e.getCategoricalColumns=function(e){var t=e&&e.categorical,i=t&&t.categories||[],a=t&&t.values||[];return t&&_.mapValues(new this,function(e,t){return i.filter(function(e){return e.source.roles&&e.source.roles[t]})[0]||a.source&&a.source.roles&&a.source.roles[t]||a.filter(function(e){return e.source.roles&&e.source.roles[t]})})},e.getColumnSourcesT=function(e){var t=e&&e.metadata&&e.metadata.columns;return t&&_.mapValues(new this,function(e,i){return t.filter(function(e){return e.roles&&e.roles[i]})[0]})},e.Roles=Object.freeze(_.mapValues(new e,function(e,t){return t})),e}();t.AsterPlotColumns=j;var G=function(){function e(){}return e.converter=function(t,i){var a=j.getCategoricalColumns(t),s=j.getCategoricalValues(t);if(a&&a.Category&&!_.isEmpty(a.Category.values)&&!_.isEmpty(a.Y)&&!_.isEmpty(a.Y[0].values)){for(var o=e.parseSettings(t,a.Category.source),n=z.getProperties(e.capabilities),l=[],c=[],p={dataPoints:[],title:null,fontSize:z.Default.legend.fontSize,labelColor:h.DefaultLegendLabelFillColor},d=new y(i),g=!!a.Y[0].highlights,m=Math.max(d3.min(a.Y[0].values)),f=Math.min(0,d3.min(a.Y[0].values)),w=u.create({format:u.getFormatString(a.Y[0].source,n.general.formatString),precision:o.labels.precision,value:0===o.labels.displayUnits&&null!=m?m:o.labels.displayUnits}),C=v.getFormatString(a.Category.source,n.general.formatString),P=r.fromPoint(o.labels.fontSize),A=0;A<s.Category.length;A++){var T=v.format(s.Category[A],C),D=a.Y[0].values[A],V=x.createTooltipInfo(n.general.formatString,t.categorical,T,D,null,null,0);if(a.Y.length>1){var N=x.createTooltipInfo(n.general.formatString,t.categorical,T,a.Y[1].values[A],null,null,1)[1];N&&V.push(N),D+=a.Y[1].values[A]}var L,M,k=a.Category.identity[A];L=d.getColorForMeasure(a.Category.objects&&a.Category.objects[A],k.key),M=Math.max(0,a.Y.length>1?a.Y[1].values[A]:1);var I=b.createWithIdAndMeasureAndCategory(k,k.key,a.Category.source.queryName);if(M>0&&l.push({sliceHeight:a.Y[0].values[A]-f,sliceWidth:M,label:w.format(D),color:L,identity:I,selected:!1,tooltipInfo:V,labelFontSize:P,highlight:!1}),o.legend.show&&p.dataPoints.push({label:T,color:L,icon:S.Box,selected:!1,identity:I}),g){var O=b.createWithHighlight(I),F=null!=a.Y[0].highlights[A];if(D=F?a.Y[0].highlights[A]:0,V=x.createTooltipInfo(n.general.formatString,t.categorical,T,D,null,null,0),a.Y.length>1){var N=x.createTooltipInfo(n.general.formatString,t.categorical,T,a.Y[1].highlights[A],null,null,1)[1];N&&V.push(N),D+=null!==a.Y[1].highlights[A]?a.Y[1].highlights[A]:0}c.push({sliceHeight:F?a.Y[0].highlights[A]-f:null,sliceWidth:Math.max(0,a.Y.length>1&&null!==a.Y[1].highlights[A]?a.Y[1].highlights[A]:M),label:w.format(D),color:L,identity:O,selected:!1,tooltipInfo:V,labelFontSize:P,highlight:!0})}}return l.length&&{dataPoints:l,settings:o,hasHighlights:g,legendData:p,highlightedDataPoints:c,labelFormatter:w,centerText:a.Category.source.displayName}}},e.parseSettings=function(t,i){var a=z.parse(t,e.capabilities);return a.labels.precision=Math.min(17,Math.max(0,a.labels.precision)),a.outerLine.thickness=Math.min(300,Math.max(1,a.outerLine.thickness)),a.createOriginalSettings(),_.isEmpty(a.legend.titleText)&&(a.legend.titleText=i.displayName),a},Object.defineProperty(e.prototype,"settings",{get:function(){return this.data&&this.data.settings},enumerable:!0,configurable:!0}),e.prototype.init=function(t){this.hostServices=t.host,this.layout=new O(t.viewport,{top:10,right:10,bottom:15,left:10});var i=t.element,a=this.svg=d3.select(i.get(0)).append("svg").classed(N,!0).style("position","absolute");this.colors=t.style.colorPalette.dataColors,this.mainGroupElement=a.append("g"),this.mainLabelsElement=a.append("g"),this.behavior=new k,this.clearCatcher=w(this.mainGroupElement),this.slicesElement=this.mainGroupElement.append("g").classed(e.AsterSlices.class,!0);var r=t.interactivity;this.interactivityService=C(this.hostServices),this.legend=P(i,r&&r.isInteractiveLegend,this.interactivityService,!0)},e.prototype.update=function(t){if(t&&t.dataViews&&t.dataViews[0]){this.layout.viewport=t.viewport;var i=t.suppressAnimations?0:A,a=e.converter(t.dataViews[0],this.colors);if(!a)return void this.clear();this.data=a,this.interactivityService&&(this.interactivityService.applySelectionStateToData(this.data.dataPoints),this.interactivityService.applySelectionStateToData(this.data.highlightedDataPoints)),this.renderLegend(),this.updateViewPortAccordingToLegend(),this.svg.attr(this.layout.viewport);var r=(this.layout.viewportIn.width+this.layout.margin.right)/2,s=(this.layout.viewportIn.height+this.layout.margin.bottom)/2;if(this.mainGroupElement.attr("transform",T.translate(r,s)),this.mainLabelsElement.attr("transform",T.translate(r,s)),this.clearCatcher.attr("transform",T.translate(-r,-s)),g.cleanDataLabels(this.mainLabelsElement,!0),this.renderArcsAndLabels(i),this.data.hasHighlights?this.renderArcsAndLabels(i,!0):this.slicesElement.selectAll(e.AsterHighlightedSlice.selector).remove(),this.interactivityService){var o={selection:this.slicesElement.selectAll(e.AsterSlice.selector+", "+e.AsterHighlightedSlice.selector),clearCatcher:this.clearCatcher,interactivityService:this.interactivityService,hasHighlights:this.data.hasHighlights};this.interactivityService.bind(this.data.dataPoints.concat(this.data.highlightedDataPoints),this.behavior,o)}}},e.prototype.renderArcsAndLabels=function(t,i){var a=this;void 0===i&&(i=!1);var r=Math.min(this.layout.viewportIn.width,this.layout.viewportIn.height)/2,s=.3*(this.settings.labels.show?r*L:r),o=d3.max(this.data.dataPoints,function(e){return e.sliceHeight}),n=d3.sum(this.data.dataPoints,function(e){return e.sliceWidth}),l=d3.layout.pie().sort(null).value(function(e){return n&&e&&!isNaN(e.sliceWidth)?e.sliceWidth/n:0}),c=d3.svg.arc().innerRadius(s).outerRadius(function(e){var t=0;if(o){var i=r-s,n=1;n=e&&e.data&&!isNaN(e.data.sliceHeight)?e.data.sliceHeight:n,t=i*n/o}var l=s+(a.settings.labels.show?t*L:t);return Math.max(l,s)}),u=l(i?this.data.highlightedDataPoints:this.data.dataPoints),h=i?e.AsterHighlightedSlice:e.AsterSlice,p=this.slicesElement.selectAll(h.selector).data(u,function(e,t){return e.data?e.data.identity.getKey():t});if(p.enter().append("path").classed(h.class,!0).attr("stroke","#333"),p.attr("fill",function(e){return e.data.color}).call(function(e){return F.setAttrThroughTransitionIfNotResized(e,function(e){return e.duration(t)},"d",c,F.interpolateArc(c),a.layout.viewportChanged)}),p.exit().remove(),D.addTooltip(p,function(e){return e.data.data.tooltipInfo}),this.settings.labels.show&&(!this.data.hasHighlights||this.data.hasHighlights&&i)){var d=function(e){var t=r*(e&&!isNaN(e.sliceHeight)?e.sliceHeight:1)/o+s;return Math.max(t,s)},m=d3.svg.arc().innerRadius(function(e){return d(e.data)}).outerRadius(function(e){return d(e.data)}),f=function(e){var t=(r-s)*(e&&!isNaN(e.sliceHeight)?e.sliceHeight:1)/o;return t=s+t*L,Math.max(t,s)},y=d3.svg.arc().innerRadius(function(e){return f(e.data)}).outerRadius(function(e){return f(e.data)}),v=this.getLabelLayout(m,this.layout.viewport);this.drawLabels(u.filter(function(e){return!i||null!==e.data.sliceHeight}),this.mainLabelsElement,v,this.layout.viewport,y,m)}else g.cleanDataLabels(this.mainLabelsElement,!0);return i||(this.drawCenterText(s),this.drawOuterLine(s,_.max(u.map(function(e){return c.outerRadius()(e)})),u)),p},e.prototype.getLabelLayout=function(e,t){var i=function(e){return e.startAngle+(e.endAngle-e.startAngle)/2},a={fontFamily:g.StandardFontFamily,fontSize:r.fromPoint(this.settings.labels.fontSize),text:""},s=function(i){var r=e.centroid(i);a.text=i.data.label;var s=n.measureSvgTextWidth(a),o=t.width/2-Math.abs(r[0]),l=n.estimateSvgTextHeight(a),c=t.height/2-Math.abs(r[1]);return i.isLabelHasConflict=s>o||l>c,i.isLabelHasConflict};return{labelText:function(i){a.text=i.data.label;var r=e.centroid(i),o=s(i)?r[0]*M:r[0],l=t.width/2-Math.abs(o);return n.getTailoredTextOrDefault(a,l)},labelLayout:{x:function(t){var i=e.centroid(t);a.text=t.data.label;var r=t.isLabelHasConflict?i[0]*M:i[0];return r},y:function(t){var i=e.centroid(t),a=t.isLabelHasConflict?i[1]*M:i[1];return a}},filter:function(e){return null!=e&&!_.isEmpty(e.data.label)},style:{fill:this.settings.labels.color,"font-size":a.fontSize,"text-anchor":function(e){return i(e)<Math.PI?"start":"end"}}}},e.prototype.drawLabels=function(t,i,a,r,s,o){var n=this,c=new l,u=c.hideCollidedLabels(r,t,a,!0);if(0===u.length)return void g.cleanDataLabels(i,!0);i.select(e.labelGraphicsContextClass.selector).empty()&&i.append("g").classed(e.labelGraphicsContextClass.class,!0);var h=i.select(e.labelGraphicsContextClass.selector).selectAll(".data-labels").data(u,function(e){return e.data.identity.getKey()});if(h.enter().append("text").classed("data-labels",!0),h){h.attr({x:function(e){return e.labelX},y:function(e){return e.labelY},dy:".35em"}).text(function(e){return e.labeltext}).style(a.style),h.exit().remove(),i.select(e.linesGraphicsContextClass.selector).empty()&&i.append("g").classed(e.linesGraphicsContextClass.class,!0),u=_.filter(u,function(e){return null!==e.data.sliceHeight&&0!==e.data.sliceHeight});var p=i.select(e.linesGraphicsContextClass.selector).selectAll("polyline").data(u,function(e){return e.data.identity.getKey()}),d=4,m=1.02,f=function(e){return e.startAngle+(e.endAngle-e.startAngle)/2};p.enter().append("polyline").classed("line-label",!0),p.attr("points",function(e){var t=[e.labelX,e.labelY];t[0]=t[0]+(f(e)<Math.PI?-1:1)*d;var i=s.centroid(e);return i[0]*=m,i[1]*=m,[i,t]}).style({opacity:.5,"fill-opacity":0,stroke:function(e){return n.settings.labels.color}}),p.exit().remove()}},e.prototype.renderLegend=function(){if(this.settings.legend.show){var e=_.clone(this.settings.legend);e.labelColor={solid:{color:e.labelColor}},h.update(this.data.legendData,e),this.legend.changeOrientation(d[this.settings.legend.position])}this.legend.drawLegend(this.data.legendData,this.layout.viewportCopy),V.positionChartArea(this.svg,this.legend)},e.prototype.updateViewPortAccordingToLegend=function(){if(this.settings.legend.show){var e=this.legend.getMargins(),t=d[this.settings.legend.position];switch(t){case d.Top:case d.TopCenter:case d.Bottom:case d.BottomCenter:this.layout.viewport.height-=e.height;break;case d.Left:case d.LeftCenter:case d.Right:case d.RightCenter:this.layout.viewport.width-=e.width}}},e.prototype.drawOuterLine=function(t,i,a){var r=this.mainGroupElement,s=d3.svg.arc().innerRadius(t).outerRadius(i);if(this.settings.outerLine.show){var o=this.settings.outerLine.thickness+"px",n=r.selectAll(e.OuterLine.selector).data(a);n.enter().append("path"),n.attr("fill","none").attr({stroke:"#333","stroke-width":o,d:s}).style("opacity",1).classed(e.OuterLine.class,!0),n.exit().remove()}else r.selectAll(e.OuterLine.selector).remove()},e.prototype.drawCenterText=function(t){if(_.isEmpty(this.data.centerText))return void this.mainGroupElement.select(e.CenterLabelClass.selector).remove();var i={fontFamily:g.StandardFontFamily,fontWeight:"bold",fontSize:r.toString(t*e.CenterTextFontHeightCoefficient),text:this.data.centerText};this.mainGroupElement.select(e.CenterLabelClass.selector).empty()&&(this.centerText=this.mainGroupElement.append("text").classed(e.CenterLabelClass.class,!0)),this.centerText.style({"line-height":1,"font-weight":i.fontWeight,"font-size":i.fontSize,fill:this.settings.labels.color}).attr({dy:"0.35em","text-anchor":"middle"}).text(n.getTailoredTextOrDefault(i,t*e.CenterTextFontWidthCoefficient))},e.prototype.clear=function(){this.mainGroupElement.selectAll("path").remove(),this.mainGroupElement.select(e.CenterLabelClass.selector).remove(),g.cleanDataLabels(this.mainLabelsElement,!0),this.legend.drawLegend({dataPoints:[]},this.layout.viewportCopy)},e.prototype.onClearSelection=function(){this.interactivityService&&this.interactivityService.clearSelection()},e.prototype.enumerateObjectInstances=function(t){var i=z.enumerateObjectInstances(this.settings&&this.settings.originalSettings,t,e.capabilities);return i.complete()},e.capabilities={dataRoles:[{displayName:"Category",name:j.Roles.Category,kind:c.Grouping},{displayName:"Y Axis",name:j.Roles.Y,kind:c.Measure}],dataViewMappings:[{conditions:[{Category:{max:1},Y:{max:2}}],categorical:{categories:{for:{in:"Category"},dataReductionAlgorithm:{top:{}}},values:{select:[{bind:{to:"Y"}}]}}}],objects:{general:{displayName:"General",properties:{formatString:{type:{formatting:{formatString:!0}}}}},legend:{displayName:"Legend",description:"Display legend options",properties:{show:{displayName:"Show",type:{bool:!0}},position:{displayName:"Position",description:"Select the location for the legend",type:{enumeration:f.type}},showTitle:{displayName:"Title",description:"Display a title for legend symbols",type:{bool:!0}},titleText:{displayName:"Legend Name",description:"Title text",type:{text:!0},suppressFormatPainterCopy:!0},labelColor:{displayName:"Color",type:{fill:{solid:{color:!0}}}},fontSize:{displayName:"Text Size",type:{formatting:{fontSize:!0}}}}},label:{displayName:"Center Label",properties:{fill:{displayName:"Fill",type:{fill:{solid:{color:!0}}}}}},labels:{displayName:"Detail Labels",properties:{show:{type:{bool:!0}},color:{displayName:"Color",type:{fill:{solid:{color:!0}}}},displayUnits:{displayName:"Display Units",type:{formatting:{displayUnits:!0}}},precision:{displayName:"Decimal Places",placeHolderText:"Auto",type:{numeric:!0}},fontSize:{displayName:"Text Size",type:{formatting:{fontSize:!0}}}}},outerLine:{displayName:"Outer line",properties:{show:{displayName:"Show",type:{bool:!0}},thickness:{displayName:"Thickness",type:{numeric:!0}}}}},supportsHighlight:!0},e.AsterSlices=i("asterSlices"),e.AsterSlice=i("asterSlice"),e.AsterHighlightedSlice=i("asterHighlightedSlice"),e.OuterLine=i("outerLine"),e.labelGraphicsContextClass=i("labels"),e.linesGraphicsContextClass=i("lines"),e.CenterLabelClass=i("centerLabel"),e.CenterTextFontHeightCoefficient=.4,e.CenterTextFontWidthCoefficient=1.9,e}();t.AsterPlot=G;var R;!function(e){function t(t,i,a,r){return r&&!i||a&&!t?e.DimmedOpacity:e.DefaultOpacity}e.DimmedOpacity=.4,e.DefaultOpacity=1,e.getFillOpacity=t}(R=t.asterPlotUtils||(t.asterPlotUtils={}))}(i=t.samples||(t.samples={}))}(t=e.visuals||(e.visuals={}))}(i||(i={}))},function(e,t){var i,a=window.jsCommon,i=window.powerbi;window.powerbitests,window.InJs,window.debug,window.jasmine,window.Microsoft;!function(e){var t;!function(t){var i;!function(t){function i(){return new M}var r=a.PixelConverter,s=e.visuals.SelectionId,o=e.visuals.LegendData,n=e.DataViewObject,l=e.visuals.SVGUtil,c=e.VisualDataRoleKind,u=e.data.createDisplayNameGetter,h=e.visuals.legendPosition,p=e.visuals.dataLabelUtils,d=e.TextMeasurementService,g=e.visuals.valueFormatter,m=e.visuals.SelectionIdBuilder,f=e.visuals.TooltipBuilder,y=e.DataViewObjects,v=e.visuals.ColorHelper,x=e.visuals.createInteractivityService,b=e.visuals.appendClearCatcher,S=e.visuals.createLegend,w=e.visuals.AnimatorCommon.GetAnimationDuration,C=e.visuals.LegendIcon,P=e.visuals.LegendPosition,A=e.visuals.legendProps,T=e.visuals.TooltipManager,D=e.visuals.Legend,V=e.visuals.ObjectEnumerationBuilder,N=function(){function e(){}return e.prototype.bindEvents=function(e,t){this.columns=e.columns,this.clearCatcher=e.clearCatcher,this.interactivityService=e.interactivityService,this.columns.on("click",function(e,i){t.handleSelection(e,d3.event.ctrlKey)}),this.clearCatcher.on("click",function(){t.handleClearSelection()})},e.prototype.renderSelection=function(e){var t=this.interactivityService.hasSelection();this.columns.style("fill-opacity",function(i){return I.getFillOpacity(i.selected,i.highlight,!i.highlight&&e,!i.selected&&t)})},e}(),L=function(){function e(e,t,i,a,r){this.scrollYBrush=d3.svg.brush(),this.getRoot=e,this.getViewport=t,this.isScrollable=r,this.getPrefferedHeight=a}return Object.defineProperty(e.prototype,"scrollViewport",{get:function(){return{height:this.viewport.height,width:this.viewport.width-(this.isYScrollBarVisible&&this.isScrollable?k.ScrollBarWidth:0)}},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"root",{get:function(){return this.getRoot()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"viewport",{get:function(){return this.getViewport()},enumerable:!0,configurable:!0}),e.prototype.renderY=function(e,t){var i=this;if(this.isYScrollBarVisible=this.isScrollable&&this.getPrefferedHeight()>this.viewport.height&&this.viewport.height>0&&this.viewport.width>0,this.brushGraphicsContextY=this.createOrRemoveScrollbar(this.isYScrollBarVisible,this.brushGraphicsContextY,"y brush"),!this.isYScrollBarVisible)return void t.call(this,jQuery.extend(!0,{},e),0,1);var a=this.viewport.height,r=this.getExtentData(this.getPrefferedHeight(),a),s=function(s){void 0===s&&(s=0);var o=i.scrollYBrush.extent();if(0!==s){var n=(o[1]-o[0])/2;if(o[0]+=s>0?n:-n,o[1]+=s>0?n:-n,o[0]<0){var l=0-o[0];o[0]+=l,o[1]+=l}if(o[1]>a){var l=o[1]-a;o[0]-=l,o[1]-=l}i.scrollYBrush.extent(o),i.brushGraphicsContextY.select(".extent").attr("y",o[0])}var c=r.toScrollPosition(o,a);t.call(i,jQuery.extend(!0,{},e),c[0],c[1]),i.setScrollBarSize(i.brushGraphicsContextY,r.value[1],!0)},o=d3.scale.ordinal().rangeBands([0,a]);this.scrollYBrush.y(o).extent(r.value),this.renderScrollbar(this.scrollYBrush,this.brushGraphicsContextY,this.viewport.width,s),s()},e.prototype.createOrRemoveScrollbar=function(e,t,i){return e&&this.isScrollable?t||this.root.append("g").classed(i,!0):t?void t.remove():void 0},e.prototype.renderScrollbar=function(e,t,i,a){var r=this;e.on("brush",function(){return window.requestAnimationFrame(function(){return a(0)})}),this.root.on("wheel",function(){if(r.isYScrollBarVisible){var e=d3.event;a(e.deltaY)}}),t.attr({transform:l.translate(i,0),"drag-resize-disabled":"true"}),t.call(e),t.selectAll(".resize").remove(),t.select(".background").remove(),t.selectAll(".extent").style({"fill-opacity":.125,cursor:"default"})},e.prototype.setScrollBarSize=function(e,t,i){e.selectAll("rect").attr(i?"width":"height",k.ScrollBarWidth),e.selectAll("rect").attr(i?"height":"width",t)},e.prototype.getExtentData=function(t,i){var a=i*i/t,r=e.ScrollBarMinLength<=a?1:a/e.ScrollBarMinLength;a=Math.max(a,e.ScrollBarMinLength);var s=function(e,t){var i=e[1]-e[0],a=e[0]/(t-i);i*=r;var s=a*(t-i),o=s+i;return[s/t,o/t]};return{value:[0,a],toScrollPosition:s}},e.prototype.clearData=function(){this.brushGraphicsContextY&&this.brushGraphicsContextY.selectAll("*").remove()},e.ScrollBarMinLength=15,e}(),M=function(){function e(){}return Object.defineProperty(e.prototype,"code",{get:function(){return"TornadoChartWarning"},enumerable:!0,configurable:!0}),e.prototype.getMessages=function(e){var t,i="This visual requires two distinct values to be returned for the Legend field.",a="",r="";return t={message:i,title:e.get(a),detail:e.get(r)}},e}();t.TornadoChartWarning=M,t.getTornadoChartWarning=i;var k=function(){function e(e){this.textOptions={},this.columnPadding=5,this.leftLabelMargin=4,this.InnerTextHeightDelta=2,this.margin={top:10,right:5,bottom:10,left:10},this.heightColumn=0,e&&(this.svg=e.svg||this.svg,this.margin=e.margin||this.margin,this.columnPadding=e.columnPadding||this.columnPadding,this.animator=e.animator)}return e.getProperties=function(e){var t={};for(var i in e.objects){t[i]={};for(var a in e.objects[i].properties)t[i][a]={objectName:i,propertyName:a}}return t},e.converter=function(t,i,a){if(!(t&&t.categorical&&t.categorical.categories&&t.categorical.categories[0]&&t.categorical.categories[0].source&&t.categorical.values&&t.categorical.values[0]))return null;var o=t.categorical,n=o.categories||[],l=o.values,c=n[0],u=e.Properties.general.formatString,h=d3.max(l[0].values),v=e.parseSettings(t.metadata.objects,h,a),x=!!l.source,b=!!(l.length>0&&l[0].highlights),S=d.estimateSvgTextHeight({fontFamily:p.StandardFontFamily,fontSize:r.fromPoint(v.labelSettings.fontSize)}),w=[],C=[],P=[],A=g.getFormatString(c.source,u),T=c.values.map(function(t){var a=g.format(t,A);return e.getTextData(a,i,!0)}),D=l.grouped?l.grouped():null,V=Math.min(d3.min(l[0].values),0);l.length===e.MaxSeries&&(V=d3.min([V,d3.min(l[1].values)]),h=d3.max([h,d3.max(l[1].values)]));for(var N=0;N<l.length;N++){var L=D&&D.length>N&&D[N].values?D[N]:null,M=e.parseSeries(l,N,x,L,a);w.push(M);for(var k=l[N],I=k.source.queryName,O=0;O<c.values.length;O++){var F,z=null==k.values[O]||isNaN(k.values[O])?0:k.values[O],j=m.builder().withCategory(c,O).withSeries(l,L).withMeasure(I).createSelectionId(),G=T[O].text;F=f.createTooltipInfo(u,o,G,z,null,null,N,O,null);var R=M.categoryAxisEnd?M.categoryAxisEnd:h,B=t.categorical.values[N].source.format;if(C.push({value:z,minValue:V,maxValue:R,formatString:B,color:M.fill,selected:!1,identity:j,tooltipData:F,categoryIndex:O}),b){var H=s.createWithHighlight(j),E=k.highlights[O],W=null!=E?E:0;F=f.createTooltipInfo(u,o,G,z,null,null,N,O,W),P.push({value:W,minValue:V,maxValue:R,formatString:B,color:M.fill,selected:!1,identity:H,tooltipData:F,categoryIndex:O,highlight:!0})}}}return{categories:T,series:w,settings:v,legend:e.getLegendData(w,x),dataPoints:C,highlightedDataPoints:P,maxLabelsWidth:_.max(T.map(function(e){return e.width})),hasDynamicSeries:x,hasHighlights:b,labelHeight:S,legendObjectProperties:y.getObject(t.metadata.objects,"legend",{})}},e.parseSeries=function(t,i,a,r,o){var n,l,c=t?t[i]:null,u=c?c.source:null,h=r?r.identity:null,p=u?u.queryName:null,d=h?s.createWithId(h):m.builder().withSeries(t,r).withMeasure(p).createSelectionId(),g=u?u.groupName?u.groupName:u.displayName:null;a&&r?(l=r.objects?r.objects.categoryAxis:null,n=r.objects):u&&(n=u.objects,l=n?n.categoryAxis:null);var f=e.getColor(e.Properties.dataPoint.fill,["purple","teal"][i],n,o),y=l?l.end:null;return{fill:f,name:g,selectionId:d,categoryAxisEnd:y}},e.getColor=function(e,t,i,a){var r=new v(a,e,t);return r.getColorForMeasure(i,"")},e.getTextData=function(e,t,i,a,s){void 0===i&&(i=!1),void 0===a&&(a=!1);var o,n,l=0,c=0;return e=e||"",o=s?r.fromPoint(s):""+t.fontSize+t.sizeUnit,n={text:e,
fontFamily:t.fontFamily,fontSize:o},i&&(l=d.measureSvgTextWidth(n)),a&&(c=d.estimateSvgTextHeight(n)),{text:e,width:l,height:c,textProperties:n}},Object.defineProperty(e.prototype,"allLabelsWidth",{get:function(){return(this.dataView.settings.showCategories?Math.min(this.dataView.maxLabelsWidth,this.scrolling.scrollViewport.width/2):3)+e.CategoryLabelMargin},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"allColumnsWidth",{get:function(){return this.scrolling.scrollViewport.width-this.allLabelsWidth},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"columnWidth",{get:function(){return this.dataView.series.length===e.MaxSeries?this.allColumnsWidth/2:this.allColumnsWidth},enumerable:!0,configurable:!0}),e.prototype.init=function(t){var i,a=this,r=t.style;this.hostService=t.host;var s=t.element;this.colors=r.colorPalette.dataColors;var o=t.interactivity;this.interactivityService=x(this.hostService);var n;this.svg?this.root=n=this.svg:this.root=n=d3.select(s.get(0)).append("svg"),n.classed(e.ClassName,!0).style("position","absolute"),i=n.style("font-size"),this.textOptions.sizeUnit=i.slice(i.length-2),this.textOptions.fontSize=Number(i.slice(0,i.length-2)),this.textOptions.fontFamily=n.style("font-family"),this.viewport=t.viewport,this.scrolling=new L(function(){return n},function(){return a.viewport},function(){return a.margin},function(){return a.dataView.categories.length*e.CategoryMinHeight},(!0));var l=this.main=n.append("g");this.clearCatcher=b(l),this.columns=l.append("g").classed(e.Columns.class,!0),this.axes=l.append("g").classed(e.Axes.class,!0),this.labels=l.append("g").classed(e.Labels.class,!0),this.categories=l.append("g").classed(e.Categories.class,!0),this.behavior=new N,this.legend=S(s,o&&o.isInteractiveLegend,this.interactivityService,!0)},e.prototype.update=function(t){if(t&&t.dataViews&&t.dataViews[0]){if(this.viewport={height:Math.max(0,t.viewport.height-this.margin.top-this.margin.bottom),width:Math.max(0,t.viewport.width-this.margin.left-this.margin.right)},this.animator?this.durationAnimations=w(this.animator,t.suppressAnimations):this.durationAnimations=t.suppressAnimations?0:250,this.dataView=e.converter(this.validateDataView(t.dataViews[0]),this.textOptions,this.colors),!this.dataView||this.scrolling.scrollViewport.height<e.CategoryMinHeight)return void this.clearData();this.dataView&&this.interactivityService&&(this.interactivityService.applySelectionStateToData(this.dataView.dataPoints),this.interactivityService.applySelectionStateToData(this.dataView.highlightedDataPoints)),this.render()}},e.prototype.validateDataView=function(t){return t&&t.categorical&&t.categorical.values?t.categorical.values.length>e.MaxSeries?(this.hostService.setWarnings([i()]),null):t:null},e.prototype.updateElements=function(){var e=l.translate(this.allLabelsWidth,0);this.root.attr({height:this.viewport.height+this.margin.top+this.margin.bottom,width:this.viewport.width+this.margin.left+this.margin.right}),this.columns.attr("transform",e),this.labels.attr("transform",e),this.axes.attr("transform",e)},e.parseSettings=function(t,i,a){var r=e.getPrecision(t),s=y.getValue(t,e.Properties.labels.labelDisplayUnits,e.DefaultTornadoChartSettings.labelSettings.displayUnits),o=e.DefaultTornadoChartSettings.labelSettings,n=function(e){return g.create({format:e,precision:r,value:0===s&&null!=i?i:s})};return{labelOutsideFillColor:e.getColor(e.Properties.labels.outsideFill,e.DefaultTornadoChartSettings.labelOutsideFillColor,t,a),labelSettings:{show:y.getValue(t,e.Properties.labels.show,o.show),precision:r,fontSize:y.getValue(t,e.Properties.labels.fontSize,o.fontSize),displayUnits:s,labelColor:e.getColor(e.Properties.labels.insideFill,o.labelColor,t,a)},showCategories:y.getValue(t,e.Properties.categories.show,e.DefaultTornadoChartSettings.showCategories),showLegend:y.getValue(t,e.Properties.legend.show,e.DefaultTornadoChartSettings.showLegend),legendFontSize:y.getValue(t,e.Properties.legend.fontSize,e.DefaultTornadoChartSettings.legendFontSize),legendColor:e.getColor(e.Properties.legend.labelColor,e.DefaultTornadoChartSettings.legendColor,t,a),categoriesFillColor:e.getColor(e.Properties.categories.fill,e.DefaultTornadoChartSettings.categoriesFillColor,t,a),getLabelValueFormatter:n}},e.getPrecision=function(t){var i=y.getValue(t,e.Properties.labels.labelPrecision,e.DefaultTornadoChartSettings.labelSettings.precision);return Math.min(Math.max(0,i),e.MaxPrecision)},e.getLegendData=function(e,t){var i=[];return t&&(i=e.map(function(e){return{label:e.name,color:e.fill,icon:C.Box,selected:!1,identity:e.selectionId}})),{dataPoints:i}},e.prototype.render=function(){this.updateElements(),this.renderLegend(),this.scrolling.renderY(this.dataView,this.renderWithScrolling.bind(this))},e.prototype.clearData=function(){this.columns.selectAll("*").remove(),this.axes.selectAll("*").remove(),this.labels.selectAll("*").remove(),this.categories.selectAll("*").remove(),this.legend.drawLegend({dataPoints:[]},this.viewport),this.scrolling.clearData()},e.prototype.onClearSelection=function(){this.interactivityService&&this.interactivityService.clearSelection()},e.prototype.renderWithScrolling=function(t,i,a){if(this.dataView&&this.dataView.settings){var r=t.categories.length,s=i*r,o=a*r,n=Math.floor(s),l=Math.floor(o),c=Math.floor(this.scrolling.scrollViewport.height/e.CategoryMinHeight);a-i<1&&c<l-n&&(s-n>o-l?n++:o--),this.interactivityService&&(this.interactivityService.applySelectionStateToData(t.dataPoints),this.interactivityService.applySelectionStateToData(t.highlightedDataPoints)),t.categories=t.categories.slice(n,l),t.dataPoints=_.filter(t.dataPoints,function(e){return e.categoryIndex>=n&&e.categoryIndex<l}),t.highlightedDataPoints=_.filter(t.highlightedDataPoints,function(e){return e.categoryIndex>=n&&e.categoryIndex<l}),this.dataView=t,this.computeHeightColumn(),this.renderMiddleSection(),this.renderAxes(),this.renderCategories()}},e.prototype.updateViewport=function(){var e,t=this.legend.getMargins();switch(e=P[this.dataView.legendObjectProperties[A.position]]){case P.Top:case P.TopCenter:case P.Bottom:case P.BottomCenter:this.viewport.height-=t.height;break;case P.Left:case P.LeftCenter:case P.Right:case P.RightCenter:this.viewport.width-=t.width}},e.prototype.computeHeightColumn=function(){var e=this.dataView.categories.length;this.heightColumn=(this.scrolling.scrollViewport.height-(e-1)*this.columnPadding)/e},e.prototype.renderMiddleSection=function(){var e=this.dataView;this.calculateDataPoints(e.dataPoints),this.calculateDataPoints(e.highlightedDataPoints);var t=e.dataPoints.concat(e.highlightedDataPoints);this.renderColumns(t,2===e.series.length),this.renderLabels(this.dataView.hasHighlights?e.highlightedDataPoints:e.dataPoints,e.settings.labelSettings)},e.prototype.calculateDataPoints=function(t){for(var i=this.dataView.categories.length,a=this.dataView.settings,r=Math.max(this.heightColumn,0),s=r/2,o=r*e.HighlightedShapeFactor/2,n=this.dataView.series.length===e.MaxSeries,l=0;l<t.length;l++){var c=t[l],u=l<i&&n,h=l>i-1,p=this.getColumnWidth(c.value,c.minValue,c.maxValue,this.columnWidth),d=(this.columnWidth-p)*Number(u)+this.columnWidth*Number(h);d=Math.max(d,0);var g=this.dataView.hasHighlights&&c.highlight,m=g?r*(1-e.HighlightedShapeFactor)/2:0,f=(r+this.columnPadding)*(l%i)+m,y=this.getLabelData(c.value,d,p,u,c.formatString,a);c.dx=d,c.dy=f,c.px=p/2,c.py=g?o:s,c.angle=u?180:0,c.width=p,c.height=g?r*e.HighlightedShapeFactor:r,c.label=y}},e.prototype.renderColumns=function(t,i){var a=this;void 0===i&&(i=!1);var r=this.interactivityService&&this.interactivityService.hasSelection(),s=this.columns.selectAll(e.Column.selector).data(t);s.enter().append("svg:rect").classed(e.Column.class,!0),s.style("fill",function(e){return e.color}).style("fill-opacity",function(e){return I.getFillOpacity(e.selected,e.highlight,r,a.dataView.hasHighlights)}).attr("transform",function(e){return l.translateAndRotate(e.dx,e.dy,e.px,e.py,e.angle)}).attr("height",function(e){return e.height}).attr("width",function(e){return e.width}),s.exit().remove();var o=this.interactivityService;if(o){o.applySelectionStateToData(t);var n={columns:s,clearCatcher:this.clearCatcher,interactivityService:this.interactivityService};o.bind(t,this.behavior,n)}this.renderTooltip(s)},e.prototype.renderTooltip=function(e){T.addTooltip(e,function(e){return e.data.tooltipData})},e.prototype.getColumnWidth=function(e,t,i,a){if(t===i)return a;var r=a*(e-t)/(i-t);return Math.max(0,Math.min(a,r))},e.prototype.getLabelData=function(t,i,a,s,o,n){var l,c=n?n:this.dataView.settings,u=c.labelSettings,h=u.fontSize,g=u.labelColor,m=s?i-this.leftLabelMargin:this.allColumnsWidth-(i+a+this.leftLabelMargin),f=Math.max(m,a-this.leftLabelMargin),y={fontFamily:p.StandardFontFamily,fontSize:r.fromPoint(h),text:c.getLabelValueFormatter(o).format(t)},v=d.getTailoredTextOrDefault(y,f),x=e.getTextData(v,this.textOptions,!0,!1,h);return a>x.width+e.LabelPadding?l=i+a/2-x.width/2:(l=s?i-this.leftLabelMargin-x.width:i+a+this.leftLabelMargin,g=c.labelOutsideFillColor),{dx:l,source:t,value:v,color:g}},e.prototype.renderAxes=function(){var t,i,a=this.main.select(e.Axes.selector).selectAll(e.Axis.selector);return this.dataView.series.length!==e.MaxSeries?void a.remove():(t=this.generateAxesData(),i=a.data(t),i.enter().append("svg:line").classed(e.Axis.class,!0),i.attr("x1",function(e){return e.x1}).attr("y1",function(e){return e.y1}).attr("x2",function(e){return e.x2}).attr("y2",function(e){return e.y2}),void i.exit().remove())},e.prototype.generateAxesData=function(){var e,t,i;return e=this.allColumnsWidth/2,t=0,i=this.scrolling.scrollViewport.height,[{x1:e,y1:t,x2:e,y2:i}]},e.prototype.renderLabels=function(t,i){var a,s=this,o=this.main.select(e.Labels.selector).selectAll(e.Label.selector).data(_.filter(t,function(e){return e.label.dx>=0}));if(!i.show||this.dataView.labelHeight>=this.heightColumn)return void this.labels.selectAll("*").remove();var n=r.fromPoint(i.fontSize),c=this.heightColumn/2+this.dataView.labelHeight/2-this.InnerTextHeightDelta,u=this.dataView.categories.length;a=o.enter().append("g"),a.append("svg:title").classed(e.LabelTitle.class,!0),a.append("svg:text").attr("dy",p.DefaultDy).classed(e.LabelText.class,!0),o.attr("pointer-events","none").classed(e.Label.class,!0),o.select(e.LabelTitle.selector).text(function(e){return e.label.source}),o.attr("transform",function(e,t){var i=(s.heightColumn+s.columnPadding)*(t%u);return l.translate(e.label.dx,i+c)}),o.select(e.LabelText.selector).attr("fill",function(e){return e.label.color}).attr("font-size",function(e){return n}).text(function(e){return e.label.value}),o.exit().remove()},e.prototype.renderCategories=function(){var t,i,a=this,r=this.dataView.settings,s=r.categoriesFillColor,o=this.main.select(e.Categories.selector).selectAll(e.Category.selector);return r.showCategories?(i=o.data(this.dataView.categories),t=i.enter().append("g"),t.append("svg:title").classed(e.CategoryTitle.class,!0),t.append("svg:text").classed(e.CategoryText.class,!0),i.attr("transform",function(t,i){var r=(a.heightColumn+a.columnPadding)*i+a.heightColumn/2,s=e.getTextData(t,a.textOptions,!1,!0);return r=r+s.height/2-a.InnerTextHeightDelta,l.translate(0,r)}).classed(e.Category.class,!0),i.select(e.CategoryTitle.selector).text(function(e){return e.text}),i.select(e.CategoryText.selector).attr("fill",s).text(function(t){return a.dataView.settings.showCategories?d.getTailoredTextOrDefault(e.getTextData(t.text,a.textOptions).textProperties,a.allLabelsWidth):""}),void i.exit().remove()):void o.remove()},e.prototype.renderLegend=function(){var e=this.dataView.legend;if(e){var t=this.dataView.settings,i={title:e.title,dataPoints:e.dataPoints,fontSize:t.legendFontSize,labelColor:t.legendColor};if(this.dataView.legendObjectProperties){var a;o.update(i,this.dataView.legendObjectProperties),a=this.dataView.legendObjectProperties[A.position],a&&this.legend.changeOrientation(P[a])}var r={height:this.viewport.height+this.margin.top+this.margin.bottom,width:this.viewport.width+this.margin.left+this.margin.right};this.legend.drawLegend(i,r),D.positionChartArea(this.root,this.legend),i.dataPoints.length>0&&t.showLegend&&this.updateViewport()}},e.prototype.enumerateObjectInstances=function(e){var t,i=new V;if(!this.dataView||!this.dataView.settings)return[];switch(t=this.dataView.settings,e.objectName){case"dataPoint":this.enumerateDataPoint(i);break;case"categoryAxis":this.enumerateCategoryAxis(i);break;case"labels":this.enumerateLabels(i,t);break;case"legend":if(!this.dataView.hasDynamicSeries)return;this.enumerateLegend(i,t);break;case"categories":this.enumerateCategories(i,t)}return i.complete()},e.prototype.enumerateDataPoint=function(e){if(this.dataView&&this.dataView.series)for(var t=this.dataView.series,i=0,a=t.length;i<a;i++)e.pushInstance({objectName:"dataPoint",displayName:t[i].name,selector:v.normalizeSelector(t[i].selectionId.getSelector(),!1),properties:{fill:{solid:{color:t[i].fill}}}})},e.prototype.enumerateCategoryAxis=function(e){if(this.dataView&&this.dataView.series)for(var t=this.dataView.series,i=0,a=t.length;i<a;i++)e.pushInstance({objectName:"categoryAxis",displayName:t[i].name,selector:t[i].selectionId?t[i].selectionId.getSelector():null,properties:{end:t[i].categoryAxisEnd}})},e.prototype.enumerateLabels=function(e,t){var i=t.labelSettings,a={objectName:"labels",displayName:"Labels",selector:null,properties:{show:i.show,fontSize:i.fontSize,labelPrecision:i.precision,labelDisplayUnits:i.displayUnits,insideFill:i.labelColor,outsideFill:t.labelOutsideFillColor}};e.pushInstance(a)},e.prototype.enumerateCategories=function(e,t){var i={objectName:"categories",displayName:"Categories",selector:null,properties:{show:t.showCategories,fill:t.categoriesFillColor}};e.pushInstance(i)},e.prototype.enumerateLegend=function(e,t){var i,a,r=!0,s="";r=n.getValue(this.dataView.legendObjectProperties,A.showTitle,r),s=n.getValue(this.dataView.legendObjectProperties,A.titleText,s),a=n.getValue(this.dataView.legendObjectProperties,A.position,h.top),i={objectName:"legend",displayName:"Legend",selector:null,properties:{show:t.showLegend,position:a,showTitle:r,titleText:s,fontSize:t.legendFontSize,labelColor:t.legendColor}},e.pushInstance(i)},e.prototype.destroy=function(){this.root=null},e.ClassName="tornado-chart",e.capabilities={dataRoles:[{name:"Category",kind:c.Grouping,displayName:"Group"},{name:"Series",kind:c.Grouping,displayName:"Legend"},{name:"Values",kind:c.Measure,displayName:"Values"}],dataViewMappings:[{conditions:[{Category:{max:1},Values:{min:0,max:1},Series:{min:0,max:1}},{Category:{max:1},Values:{min:2,max:2},Series:{max:0}}],categorical:{categories:{for:{in:"Category"}},values:{group:{by:"Series",select:[{for:{in:"Values"}}],dataReductionAlgorithm:{top:{}}}}}}],objects:{general:{displayName:"General",properties:{formatString:{type:{formatting:{formatString:!0}}}}},dataPoint:{displayName:"Data Colors",properties:{fill:{displayName:u("Visual_Fill"),type:{fill:{solid:{color:!0}}}}}},categoryAxis:{displayName:"X-Axis",properties:{end:{displayName:"End",type:{numeric:!0},suppressFormatPainterCopy:!0}}},labels:{displayName:"Data Labels",properties:{show:{displayName:"Show",type:{bool:!0}},labelPrecision:{displayName:"Decimal Places",placeHolderText:"Auto",type:{numeric:!0}},fontSize:{displayName:u("Visual_TextSize"),type:{formatting:{fontSize:!0}}},labelDisplayUnits:{displayName:"Display Units",type:{formatting:{labelDisplayUnits:!0}}},insideFill:{displayName:"Inside fill",type:{fill:{solid:{color:!0}}}},outsideFill:{displayName:"Outside fill",type:{fill:{solid:{color:!0}}}}}},legend:{displayName:"Legend",properties:{show:{displayName:"Show",type:{bool:!0}},position:{displayName:"Position",description:u("Visual_LegendPositionDescription"),type:{enumeration:h.type}},showTitle:{displayName:"Title",description:u("Visual_LegendShowTitleDescription"),type:{bool:!0}},titleText:{displayName:"Legend Name",description:u("Visual_LegendNameDescription"),type:{text:!0}},labelColor:{displayName:"Color",type:{fill:{solid:{color:!0}}}},fontSize:{displayName:"TextSize",type:{formatting:{fontSize:!0}}}}},categories:{displayName:"Group",properties:{show:{displayName:"Show",type:{bool:!0}},fill:{displayName:"Color",type:{fill:{solid:{color:!0}}}}}}},supportsHighlight:!0},e.Properties=e.getProperties(e.capabilities),e.Columns={class:"columns",selector:".columns"},e.Column={class:"column",selector:".column"},e.Axes={class:"axes",selector:".axes"},e.Axis={class:"axis",selector:".axis"},e.Labels={class:"labels",selector:".labels"},e.Label={class:"label",selector:".label"},e.LabelTitle={class:"label-title",selector:".label-title"},e.LabelText={class:"label-text",selector:".label-text"},e.Categories={class:"categories",selector:".categories"},e.Category={class:"category",selector:".category"},e.CategoryTitle={class:"category-title",selector:".category-title"},e.CategoryText={class:"category-text",selector:".category-text"},e.MaxSeries=2,e.MaxPrecision=17,e.LabelPadding=2.5,e.CategoryMinHeight=25,e.DefaultFontSize=9,e.DefaultLegendFontSize=8,e.HighlightedShapeFactor=.5,e.CategoryLabelMargin=10,e.ScrollBarWidth=22,e.DefaultTornadoChartSettings={labelOutsideFillColor:p.defaultLabelColor,labelSettings:{show:!0,precision:null,fontSize:e.DefaultFontSize,displayUnits:0,labelColor:p.defaultInsideLabelColor},showCategories:!0,showLegend:!0,legendFontSize:e.DefaultLegendFontSize,legendColor:o.DefaultLegendLabelFillColor,categoriesFillColor:"#777"},e}();t.TornadoChart=k;var I;!function(e){function t(t,i,a,r){return r&&!i||a&&!t?e.DimmedOpacity:e.DefaultOpacity}e.DimmedOpacity=.4,e.DefaultOpacity=1,e.getFillOpacity=t}(I=t.tornadoChartUtils||(t.tornadoChartUtils={}))}(i=t.samples||(t.samples={}))}(t=e.visuals||(e.visuals={}))}(i||(i={}))},function(e,t){var i,a=window.jsCommon,i=window.powerbi;window.powerbitests,window.InJs,window.debug,window.jasmine,window.Microsoft;!function(e){var t;!function(t){var i;!function(i){function r(e,t,i,a,r,s,o,n,l,c,u,h,p,g,m){var y=35,v=r.x,x=r.y1,b=r.y2,S=v.values,w=x.values,C=0,P=0,A=0,T=0,D=0,V=v.categoryThickness?v.categoryThickness/2:0,N=f.isOrdinalScale(v.scale),L=0;if(void 0!==v.outerPadding?L=v.outerPadding:void 0!==v.xLabelMaxWidth&&(L=Math.max(0,(e.width-v.xLabelMaxWidth*S.length)/2)),0!==f.getRecommendedNumberOfTicksForXAxis(e.width)||0!==f.getRecommendedNumberOfTicksForYAxis(e.height)){var M;if(M=u?f.LabelLayoutStrategy.DefaultRotationWithScrollbar:f.LabelLayoutStrategy.DefaultRotation,g)for(var k=0,I=w.length;k<I;k++)n.text=w[k],A=Math.max(A,i(n));if(b&&m)for(var O=b.values,k=0,I=O.length;k<I;k++)l.text=O[k],T=Math.max(T,i(l));var F=a(o),z=Math.floor(s/F),j=v.scale,G=j.domain();if(p&&S.length>0){for(var k=0,I=S.length;k<I;k++){var R;o.text=S[k];var B=i(o);if(v.willLabelsWordBreak){var H=d.splitByWidth(o.text,o,i,v.xLabelMaxWidth,z);R=H.length*F,B=v.xLabelMaxWidth}else!v.willLabelsFit&&N?(R=B*M.sine,B*=M.cosine):R=F;if(0===k){if(N)C=v.willLabelsFit?B/2-V-L:B-V-L,C=Math.max(C,0);else if(G.length>1){var E=j(G[0]);C=B/2-E,C=Math.max(C,0)}}else if(k===I-1)if(N)(v.willLabelsFit||v.willLabelsWordBreak)&&(P=B/2-V-L,P=Math.max(P,0));else if(G.length>1){var E=j(G[1]);P=B/2-(e.width-E),P=Math.max(P,0)}D=Math.max(D,1.4*R-15)}C=c?Math.min(C,y):0,P=c?Math.min(P,y):0}}var W=0,U=0,_=Math.min(Math.ceil(D),s);return h?(U=Math.min(Math.max(C,T),t),W=Math.min(Math.max(P,A),t)):(U=Math.min(Math.max(C,A),t),W=Math.min(Math.max(P,T),t)),{xMax:Math.ceil(_),yLeft:Math.ceil(U),yRight:Math.ceil(W)}}function s(e,t,i){return i>1?e&&e.length>t?[e[t]]:[]:e}function o(e,t,i){return 0===e&&!!t&&!!t.showAxisTitle||1===e&&!i&&!!t&&!!t.secShowAxisTitle}function n(e,t,i,a,r,s,n){var l={viewport:t,margin:i,forcedXDomain:[a?a.start:null,a?a.end:null],forceMerge:r&&r.secShow===!1,showCategoryAxisLabel:!1,showValueAxisLabel:!1,categoryAxisScaleType:a&&null!=a.axisScale?a.axisScale:z.linear,valueAxisScaleType:r&&null!=r.axisScale?r.axisScale:z.linear,trimOrdinalDataOnOverflow:!1},c=!1;r&&(l.forcedYDomain=f.applyCustomizedDomain([r.start,r.end],l.forcedYDomain));for(var u,h=0,p=e.length;h<p;h++){var d=e[h];l.showCategoryAxisLabel=!!a&&!!a.showAxisTitle,l.showValueAxisLabel=o(h,r,c);var g=d.calculateAxesProperties(l);0===h&&(u={x:g[0],y1:g[1]}),u.x.willLabelsFit=!1,u.x.willLabelsWordBreak=!1}return u}function l(e,t,i,a,r){void 0===r&&(r=!0);var s=[],o={isScrollable:r,animator:a,interactivityService:i};return s.push(c(te.hundredPercentStackedColumn,o)),s}function c(e,t){var i={animator:t.animator,interactivityService:t.interactivityService,isScrollable:t.isScrollable,chartType:e};return new oe(i)}var u=a.EnumExtensions,h=a.PixelConverter,p=a.ArrayExtensions,d=a.WordBreaker,g=a.CssConstants.createClassAndSelector,m=e.visuals.NewDataLabelUtils,f=e.visuals.AxisHelper,y=e.visuals.valueFormatter,v=e.Double,x=e.TextMeasurementService,b=e.VisualDataRoleKind,S=e.visuals.LegendData,w=e.DataViewObject,C=e.visuals.InteractivityUtils,P=e.visuals.yAxisPosition,A=e.visuals.appendClearCatcher,T=e.visuals.createInteractivityService,D=e.visuals.createLegend,V=e.visuals.SVGUtil,N=e.DataViewObjects,L=e.visuals.axisType,M=e.visuals.getInvalidValueWarnings,k=e.visuals.dataLabelUtils,I=e.visuals.ObjectEnumerationBuilder,O=e.visuals.legendProps,F=e.visuals.LegendPosition,z=e.visuals.axisScale,j=e.visuals.axisStyle,G=e.Prototype,R=e.visuals.AnimatorCommon.GetAnimationDuration,B=e.LabelLayout,H=e.visuals.converterHelper,E=e.visuals.SelectionIdBuilder,W=e.visuals.TooltipBuilder,U=e.visuals.SelectionId,Y=e.visuals.GradientUtils,X=e.visuals.ColorHelper,q=e.visuals.LegendIcon,K=e.visuals.TooltipManager,Z=2,J=4,$=8,Q=16,ee=32|Q;!function(e){e[e.clusteredBar=Z|$]="clusteredBar",e[e.clusteredColumn=J|$]="clusteredColumn",e[e.hundredPercentStackedBar=Z|ee]="hundredPercentStackedBar",e[e.hundredPercentStackedColumn=J|ee]="hundredPercentStackedColumn",e[e.stackedBar=Z|Q]="stackedBar",e[e.stackedColumn=J|Q]="stackedColumn"}(i.MekkoVisualChartType||(i.MekkoVisualChartType={}));var te=i.MekkoVisualChartType;!function(e){e[e.HundredPercentStackedColumn=0]="HundredPercentStackedColumn"}(i.MekkoChartType||(i.MekkoChartType={}));var ie=(i.MekkoChartType,function(){function e(e,t){this.data=e,this.isScalar=t}return e.prototype.lookupXValue=function(e,t){var i=f.isDateTime(t);if(i&&this.isScalar)return new Date(e);var a=this.data;if(t.text)return a.categories[e];var r=a.series[0];if(r){var s=r.data;if(s){this.data.hasHighlights&&(e=2*e);var o=s[e];if(o)return i?new Date(o.categoryValue):o.categoryValue}}return e},e}());i.MekkoDataWrapper=ie;var ae=function(){function e(){}return e.prototype.setupVisualProps=function(e){this.graphicsContext=e,this.margin=e.margin,this.width=this.graphicsContext.width,this.height=this.graphicsContext.height,this.categoryLayout=e.layout,this.animator=e.animator,this.interactivityService=e.interactivityService,this.viewportHeight=e.viewportHeight,this.viewportWidth=e.viewportWidth},e.prototype.setData=function(e){this.data=e},e.createFormatter=function(e,t,i,a,r,s,o,n,l){void 0===l&&(l=!1);var c;if(i.dateTime)if(a){var u=new Date(e[0]),h=new Date(e[1]);1===s&&(u=h=new Date(t[0])),c=y.create({format:r,value:u,value2:h,tickCount:s})}else{var p=n(0,i),d=n(e.length-1,i);c=y.create({format:r,value:p,value2:d,tickCount:s})}else if(l&&a&&o.length>1){var g=o[1]-o[0],m=0;c=y.create({format:r,value:g,value2:m,allowFormatBeautification:!0})}else c=y.createDefaultFormatter(r,!0);return c},e.formatAxisTickValues=function(e,t,i,a,r,s){var o=[];return i?!s||a.numeric&&r?(e.tickFormat(function(e){return i.format(e)}),o=t.map(function(e){return i.format(e)})):(e.tickFormat(function(e){return i.format(s(e,a))}),o=t.map(function(e){return i.format(s(e,a))})):o=t.map(function(e){return s(e,a)}),o},e.prototype.createAxis=function(t){var i=t.pixelSpan,a=t.dataDomain,r=t.metaDataColumn,s=t.formatStringProp,o=t.outerPadding||0,n=!!t.isCategoryAxis,l=!!t.isScalar,c=!!t.isVertical,u=!!t.useTickIntervalForDisplayUnits,h=t.getValueFn,p=t.categoryThickness,d=y.getFormatString(r,s),g=f.getCategoryValueType(r,l),m=f.isLogScalePossible(a,g),v=d3.scale.linear(),x=[0,1],b=a.length||1,S=oe.getBorderWidth(t.borderSettings),w=i-S*(b-1);w<re.MinOrdinalRectThickness&&(w=re.MinOrdinalRectThickness),v.domain(x).range([0,w]);var C=a,P=e.createFormatter(x,a,g,l,d,b,C,h,u),A=d3.svg.axis().scale(v).tickSize(6,0).orient(c?"left":"bottom").ticks(b).tickValues(a),T=[];r&&(T=e.formatAxisTickValues(A,C,P,g,l,h));var D;if(!l&&p)D=Math.max(1,p-2*re.TickLabelPadding);else{var V=C.length>1?C.length+1:C.length;D=V>1?i/V:i,D=Math.max(1,D-2*re.TickLabelPadding)}return{scale:v,axis:A,formatter:P,values:T,axisType:g,axisLabel:null,isCategoryAxis:n,xLabelMaxWidth:D,categoryThickness:p,outerPadding:o,usingDefaultDomain:!1,isLogScaleAllowed:m}},e.prototype.getCategoryAxis=function(e,t,i,a,r,s,o){var n=i.categoryThickness,l=i.isScalar,c=i.outerPaddingRatio,u=new ie(e,l),h=[];if(e.series&&e.series.length>0&&e.series[0].data&&e.series[0].data.length>0){var p=e.series[0].data.map(function(e){return e.originalPosition+e.value/2});h=p.filter(function(e,t){return p.indexOf(e)===t})}var d=this.createAxis({pixelSpan:t,dataDomain:h,metaDataColumn:e.categoryMetadata,formatStringProp:re.Properties.general.formatString,outerPadding:n*c,isCategoryAxis:!0,isScalar:l,isVertical:a,categoryThickness:n,useTickIntervalForDisplayUnits:!0,getValueFn:function(e,t){var i=h.indexOf(e),a=u.lookupXValue(i,t);return a},scaleType:o,borderSettings:e.borderSettings});return i.categoryThickness=d.categoryThickness,d},e.prototype.setXScale=function(e,t,i,a){var r,s,o=this.width;i&&2===i.length&&(r=i[0],s=i[1]);var n=this.xProps=this.getCategoryAxis(this.data,o,this.categoryLayout,!1,r,s,a);return n},e.prototype.setYScale=function(e,t,i,a){var r=this.viewportHeight,s=ue.calcValueDomain(this.data.series,e),o=[s.min,s.max],n=f.combineDomain(i,o),l=f.scaleShouldClamp(n,o),c=this.data.valuesMetadata[0],u=e?this.graphicsContext.hostService.getLocalizedString("Percentage"):y.getFormatString(c,re.Properties.general.formatString),h={pixelSpan:r,dataDomain:n,metaDataColumn:c,formatString:u,outerPadding:0,isScalar:!0,isVertical:!0,forcedTickCount:t,useTickIntervalForDisplayUnits:!0,isCategoryAxis:!1,scaleType:a,axisDisplayUnits:0,axisPrecision:0,is100Pct:e,shouldClamp:l,formatStringProp:void 0};return this.yProps=f.createAxis(h),this.yProps},e.prototype.drawColumns=function(t){var i=this.data;this.columnsCenters=null;var a,r,s={columnWidth:0,xScale:this.xProps.scale,yScale:this.yProps.scale,isScalar:this.categoryLayout.isScalar,margin:this.margin},o=this.layout=e.getLayout(i,s),n=this.createMekkoLabelDataPoints(),l=ue.drawSeries(i,this.graphicsContext.mainGraphicsContext,s);return this.animator&&t&&(a=this.animator.animate({viewModel:i,series:l,layout:o,itemCS:e.Classes.item,interactivityService:this.interactivityService,mainGraphicsContext:this.graphicsContext.mainGraphicsContext,viewPort:{height:this.height,width:this.width}}),r=a.shapes),this.animator&&t&&!a.failed||(r=e.drawDefaultShapes(i,l,o,e.Classes.item,!this.animator,this.interactivityService&&this.interactivityService.hasSelection())),ue.applyInteractivity(r,this.graphicsContext.onDragStart),{shapesSelection:r,viewport:{height:this.height,width:this.width},axisOptions:s,labelDataPoints:n}},e.drawDefaultShapes=function(e,t,i,a,r,s){var o="rect";r=!1;var n;n=r?function(e){var t=_.filter(e.data,function(e){return!!e.value});return t}:function(e){return e.data};var l=t.selectAll(a.selector),c=l.data(n,function(e){return e.key});c.enter().append(o).attr("class",function(e){return a.class.concat(e.highlight?" highlight":"")}),c.style("fill",function(t){return e.showAllDataPoints?t.color:e.defaultDataPointColor}).style("fill-opacity",function(t){return ue.getFillOpacity(t.selected,t.highlight,s,e.hasHighlights)}).attr(i.shapeLayout),c.exit().remove();var u=t.selectAll(oe.BorderClass.selector),h=u.data(n,function(e){return e.key}),p=oe.getBorderColor(e.borderSettings);return h.enter().append(o).classed(oe.BorderClass.class,!0),h.style("fill",function(e){return p}).style("fill-opacity",function(t){return e.hasHighlights?ue.DimmedOpacity:ue.DefaultOpacity}).attr(i.shapeBorder),h.exit().remove(),c},e.prototype.selectColumn=function(t,i){ue.setChosenColumnOpacity(this.graphicsContext.mainGraphicsContext,e.Classes.item.selector,t,i),this.moveHandle(t)},e.prototype.getClosestColumnIndex=function(e,t){return ue.getClosestColumnIndex(e,this.getColumnsCenters())},e.prototype.getColumnsCenters=function(){var e=this;if(!this.columnsCenters){var t=this.categoryLayout.categoryThickness*(1-re.InnerPaddingRatio);if(this.data.series.length>0){var i=0;this.categoryLayout.isScalar||(i=t/2);var a=this.data.series[0];a&&a.data&&(this.columnsCenters=a.data.map(function(t){return e.xProps.scale(e.categoryLayout.isScalar?t.categoryValue:t.categoryIndex)+i}))}}return this.columnsCenters},e.prototype.moveHandle=function(e){var t=this.getColumnsCenters(),i=t[e];if(this.columnSelectionLineHandle){var a=this.columnSelectionLineHandle;a.select("line").attr({x1:i,x2:i}),a.select("circle").attr({cx:i})}else{var a=this.columnSelectionLineHandle=this.graphicsContext.mainGraphicsContext.append("g");a.append("line").classed("interactive-hover-line",!0).attr({x1:i,x2:i,y1:0,y2:this.height}),a.append("circle").attr({cx:i,cy:this.height,r:"6px"}).classed("drag-handle",!0)}},e.getLayout=function(e,t){var i=t.xScale,a=t.yScale,r=a(0),s=i(0),o=oe.getBorderWidth(e.borderSettings),n=function(e){var t=f.diffScaled(i,e.value,0);return t},l=function(e){var t=s+f.diffScaled(i,e.originalPosition,0)+o*e.categoryIndex;return t},c=function(e){var t=s+f.diffScaled(i,e.originalPosition,0)+f.diffScaled(i,e.value,0)+o*e.categoryIndex;return t};return{shapeLayout:{width:n,x:l,y:function(e){return r+f.diffScaled(a,e.position,0)},height:function(e){return ue.getSize(a,e.valueAbsolute)}},shapeBorder:{width:function(e){return o},x:c,y:function(e){return r+f.diffScaled(a,e.position,0)},height:function(e){return ue.getSize(a,e.valueAbsolute)}},shapeLayoutWithoutHighlights:{width:n,x:l,y:function(e){return r+f.diffScaled(a,e.position,0)},height:function(e){return ue.getSize(a,e.originalValueAbsolute)}},zeroShapeLayout:{width:n,x:l,y:function(e){return r+f.diffScaled(a,e.position,0)+ue.getSize(a,e.valueAbsolute)},height:function(e){return 0}},shapeXAxis:{width:n,x:l,y:function(e){return r+f.diffScaled(a,e.position,0)},height:function(e){return ue.getSize(a,e.valueAbsolute)}}}},e.prototype.createMekkoLabelDataPoints=function(){for(var t=[],i=this.data,a=i.series,r=m.createColumnFormatterCacheManager(),s=this.layout.shapeLayout,o=0,n=a.length;o<n;o++){var l=a[o],c=l.labelSettings?l.labelSettings:i.labelSettings;if(c.show&&l.data)for(var u=m.getDisplayUnitValueFromAxisFormatter(this.yProps.formatter,c),h=0;h<l.data.length;h++){var p=l.data[h];if((!i.hasHighlights||p.highlight)&&null!=p.value){var d={left:s.x(p),top:s.y(p),width:s.width(p),height:s.height(p)},g=null,f=p.valueOriginal;c.displayUnits||(g=m.hundredPercentFormat,f=p.valueAbsolute);var y=r.getOrCreate(g,c,u),v=m.getLabelFormattedText(y.format(f)),b={text:v,fontFamily:m.LabelTextProperties.fontFamily,fontSize:m.LabelTextProperties.fontSize,fontWeight:m.LabelTextProperties.fontWeight},S=x.measureSvgTextWidth(b),w=x.estimateSvgTextHeight(b);t.push({isPreferred:!0,text:v,textSize:{width:S,height:w},outsideFill:c.labelColor?c.labelColor:m.defaultLabelColor,insideFill:c.labelColor?c.labelColor:m.defaultInsideLabelColor,isParentRect:!0,parentShape:{rect:d,orientation:1,validPositions:e.validLabelPositions},identity:p.identity,parentType:1})}}}return t},e.Classes={item:g("column"),highlightItem:g("highlightColumn")},e.validLabelPositions=[1],e}();i.MekkoChartStrategy=ae;var re=function(){function e(e){this.isScrollable=!1,e?(this.type=e.chartType,e.isScrollable&&(this.isScrollable=e.isScrollable),this.animator=e.animator,e.cartesianSmallViewPortProperties&&(this.cartesianSmallViewPortProperties=e.cartesianSmallViewPortProperties),
e.behavior&&(this.behavior=e.behavior)):this.behavior=new le([new ce])}return e.getTextProperties=function(t){return void 0===t&&(t=e.FontSize),{fontFamily:"wf_segoe-ui_normal",fontSize:h.toString(t)}},e.prototype.init=function(t){this.visualInitOptions=t,this.layers=[];var i=this.element=t.element,a=this.currentViewport=t.viewport;this.hostServices=t.host,this.brush=d3.svg.brush(),i.addClass(e.ClassName),this.margin={top:1,right:1,bottom:1,left:1},this.yAxisOrientation=P.left,this.adjustMargins(a),this.sharedColorPalette=new he(t.style.colorPalette.dataColors);var r=!0,s=!0,o=this.svg=d3.select(i.get(0)).append("svg");o.style("position","absolute");var n=this.axisGraphicsContext=o.append("g").classed(e.AxisGraphicsContextClassName,!0);this.svgScrollable=o.append("svg").classed("svgScrollable",!0).style("overflow","hidden");var l=this.axisGraphicsContextScrollable=this.svgScrollable.append("g").classed(e.AxisGraphicsContextClassName,!0);this.labelGraphicsContextScrollable=this.svgScrollable.append("g").classed(m.labelGraphicsContextClass.class,!0),this.behavior&&(this.clearCatcher=A(this.axisGraphicsContextScrollable));var c=r?l:n;this.xAxisGraphicsContext=r?n.append("g").attr("class","x axis"):l.append("g").attr("class","x axis"),this.y1AxisGraphicsContext=c.append("g").attr("class","y axis"),this.y2AxisGraphicsContext=c.append("g").attr("class","y axis"),this.xAxisGraphicsContext.classed("showLinesOnAxis",r),this.y1AxisGraphicsContext.classed("showLinesOnAxis",s),this.y2AxisGraphicsContext.classed("showLinesOnAxis",s),this.xAxisGraphicsContext.classed("hideLinesOnAxis",!r),this.y1AxisGraphicsContext.classed("hideLinesOnAxis",!s),this.y2AxisGraphicsContext.classed("hideLinesOnAxis",!s),this.behavior&&(this.interactivityService=T(this.hostServices)),this.legend=D(i,t.interactivity&&t.interactivity.isInteractiveLegend,this.interactivityService,!0)},e.prototype.renderAxesLabels=function(t,i){this.axisGraphicsContext.selectAll(".xAxisLabel").remove(),this.axisGraphicsContext.selectAll(".yAxisLabel").remove();var a=this.margin,r=t.viewport.width-(a.left+a.right),s=t.viewport.height,o=e.FontSize,n=this.yAxisOrientation===P.right;if(!t.hideXAxisTitle){var l=d3.transform(this.xAxisGraphicsContext.attr("transform")).translate[1]-o+i+33,c=this.axisGraphicsContext.append("text").style("text-anchor","middle").text(t.axisLabels.x).call(function(e){e.each(function(){var e=d3.select(this);e.attr({class:"xAxisLabel",x:r/2,y:l})})});c.style("fill",t.xLabelColor?t.xLabelColor.solid.color:null),c.call(f.LabelLayoutStrategy.clip,r,x.svgEllipsis)}if(!t.hideYAxisTitle){var u=this.axisGraphicsContext.append("text").style("text-anchor","middle").text(t.axisLabels.y).call(function(e){e.each(function(){var e=d3.select(this);e.attr({class:"yAxisLabel",transform:"rotate(-90)",y:n?r+a.right-o:-a.left,x:-((s-a.top-t.legendMargin)/2),dy:"1em"})})});u.style("fill",t.yLabelColor?t.yLabelColor.solid.color:null),u.call(f.LabelLayoutStrategy.clip,s-(a.bottom+a.top),x.svgEllipsis)}if(!t.hideY2AxisTitle&&t.axisLabels.y2){var h=this.axisGraphicsContext.append("text").style("text-anchor","middle").text(t.axisLabels.y2).call(function(e){e.each(function(){var e=d3.select(this);e.attr({class:"yAxisLabel",transform:"rotate(-90)",y:n?-a.left:r+a.right-o,x:-((s-a.top-t.legendMargin)/2),dy:"1em"})})});h.style("fill",t.y2LabelColor?t.y2LabelColor.solid.color:null),h.call(f.LabelLayoutStrategy.clip,s-(a.bottom+a.top),x.svgEllipsis)}},e.prototype.adjustMargins=function(e){var t=this.margin,i=e.width-(t.left+t.right),a=e.height-(t.top+t.bottom),r=this.element.find(".x.axis");0===f.getRecommendedNumberOfTicksForXAxis(i)&&0===f.getRecommendedNumberOfTicksForYAxis(a)?(this.margin={top:0,right:0,bottom:0,left:0},r.hide()):r.show()},e.prototype.translateAxes=function(t){this.adjustMargins(t);var i=this.margin,a=t.width-(i.left+i.right),r=t.height-(i.top+i.bottom),s=this.yAxisOrientation===P.right;this.xAxisGraphicsContext.attr("transform",V.translate(0,r)),this.y1AxisGraphicsContext.attr("transform",V.translate(s?a:0,0)),this.y2AxisGraphicsContext.attr("transform",V.translate(s?0:a,0)),this.svg.attr({width:t.width,height:t.height}),this.svg.style("top",this.legend.isVisible()?this.legend.getMargins().height+"px":0),this.svgScrollable.attr({width:t.width,height:t.height}),this.svgScrollable.attr({x:0}),this.axisGraphicsContext.attr("transform",V.translate(i.left,i.top)),this.axisGraphicsContextScrollable.attr("transform",V.translate(i.left,i.top)),this.labelGraphicsContextScrollable.attr("transform",V.translate(i.left,i.top)),this.isXScrollBarVisible?(this.svgScrollable.attr({x:this.margin.left}),this.axisGraphicsContextScrollable.attr("transform",V.translate(0,i.top)),this.labelGraphicsContextScrollable.attr("transform",V.translate(0,i.top)),this.svgScrollable.attr("width",a),this.svg.attr("width",t.width).attr("height",t.height+e.ScrollBarWidth)):this.isYScrollBarVisible&&(this.svgScrollable.attr("height",r+i.top),this.svg.attr("width",t.width+e.ScrollBarWidth).attr("height",t.height))},e.getPreferredCategorySpan=function(t,i,a){var r=i*t;return a?r:r+i*e.OuterPaddingRatio*2},e.getIsScalar=function(e,t,i){var a=N.getValue(e,t);return e&&void 0!==a?a===L.scalar&&!f.isOrdinal(i):!f.isOrdinal(i)},e.prototype.populateObjectProperties=function(e){if(e&&e.length>0){var t=e[0].metadata;if(t?(this.legendObjectProperties=N.getObject(t.objects,"legend",{}),this.borderObjectProperties=N.getObject(t.objects,"columnBorder",{})):(this.legendObjectProperties={},this.borderObjectProperties={}),this.categoryAxisProperties=pe.getCategoryAxisProperties(t),this.valueAxisProperties=pe.getValueAxisProperties(t),t&&t.objects){var i=t.objects.categoryAxis,a=t.objects.valueAxis;i&&(this.categoryAxisProperties.showBorder=i.showBorder,this.categoryAxisProperties.fontSize=i.fontSize),a&&(this.valueAxisProperties.fontSize=a.fontSize)}var r=this.valueAxisProperties.position;this.yAxisOrientation=r?r.toString():P.left}},e.prototype.update=function(t){var i=this.dataViews=t.dataViews;if(this.currentViewport=t.viewport,!i)return void this.clearViewport();if(this.currentViewport.width<e.MinWidth||this.currentViewport.height<e.MinHeight)return void this.clearViewport();0===this.layers.length&&(this.layers=this.createAndInitLayers(i));var a=this.layers;if(i&&i.length>0){var r=M(i,!1,!1,!1);r&&r.length>0&&this.hostServices.setWarnings(r),this.populateObjectProperties(i)}this.sharedColorPalette.clearPreferredScale();for(var o=0,n=a.length;o<n;o++)a[o].setData(s(i,o,n)),n>1&&this.sharedColorPalette.rotateScale();this.visualInitOptions.interactivity&&this.visualInitOptions.interactivity.isInteractiveLegend||this.renderLegend(),this.render(!this.hasSetData||t.suppressAnimations),this.hasSetData=this.hasSetData||i&&i.length>0},e.prototype.clearViewport=function(){this.legend.reset(),this.setVisibility(!1)},e.prototype.setVisibility=function(e){void 0===e&&(e=!0),this.svg.style("display",e?"block":"none"),this.element.find(".legend").toggle(e)},e.getLayout=function(t,i){var a=i.categoryCount,r=i.availableWidth,s=i.domain,o=i.trimOrdinalDataOnOverflow,n=!!i.isScalar,l=!!i.isScrollable,c=e.getCategoryThickness(t?t.series:null,a,r,s,n,o),u=c*e.OuterPaddingRatio*2,h=v.floorWithPrecision((r-u)/c),p=Math.min(h,a),d=p<a&&l,g=e.OuterPaddingRatio;if(!n&&!d){var m=(r-c*p)/2;g=m/c}return!n&&l&&(p=a),{categoryCount:p,categoryThickness:c,outerPaddingRatio:g,isScalar:n}},e.getCategoryThickness=function(t,i,a,r,s,o){var n;if(i<2)n=a*(1-e.OuterPaddingRatio);else if(s&&r&&r.length>1){var l=e.getMinInterval(t),c=r[r.length-1]-r[0],u=l/(c+l*e.OuterPaddingRatio*2);n=a*u,n=Math.max(n,e.MinScalarRectThickness)}else n=a/(i+2*e.OuterPaddingRatio),o&&(n=Math.max(n,e.MinOrdinalRectThickness));var h=a/(3+2*e.OuterPaddingRatio);return n=Math.min(n,h),!s&&i>=3&&o?Math.max(n,e.MinOrdinalRectThickness):n},e.getMinInterval=function(e){var t=Number.MAX_VALUE;if(e.length>0)for(var i=e[0].data.filter(function(e){return!e.highlight}),a=0,r=i.length-1;a<r;a++)t=Math.min(t,Math.abs(i[a+1].categoryValue-i[a].categoryValue));return t},e.parseLabelSettings=function(t){var i=k.getDefaultColumnLabelSettings(!0),a=t.labels,r=e.DefaultSettings.labelSettings.minPrecision,s=e.DefaultSettings.labelSettings.maxPrecision;return k.updateLabelSettingsFromLabelsObject(a,i),i.precision<r&&(i.precision=r),i.precision>s&&(i.precision=s),i},e.parseBorderSettings=function(t){var i=N.getValue(t,e.Properties.columnBorder.show,e.DefaultSettings.columnBorder.show),a=N.getFillColor(t,e.Properties.columnBorder.color,e.DefaultSettings.columnBorder.color),r=N.getValue(t,e.Properties.columnBorder.width,e.DefaultSettings.columnBorder.width),s=e.DefaultSettings.columnBorder.maxWidth;return r>s?r=s:r<0&&(r=0),i||(r=0),{show:i,color:a,width:r}},e.prototype.enumerateBorder=function(t){var i={columnBorder:this.borderObjectProperties},a=N.getValue(i,e.Properties.columnBorder.show,e.DefaultSettings.columnBorder.show),r=N.getFillColor(i,e.Properties.columnBorder.color,e.DefaultSettings.columnBorder.color),s=N.getValue(i,e.Properties.columnBorder.width,e.DefaultSettings.columnBorder.width),o=e.DefaultSettings.columnBorder.maxWidth;s>o?s=o:s<0&&(s=0);var n={objectName:"columnBorder",selector:null,properties:{show:a,color:r,width:s}};t.pushInstance(n)},e.prototype.enumerateObjectInstances=function(e){var t=new I,i=this.layers?this.layers.length:0;if("columnBorder"===e.objectName)this.enumerateBorder(t);else if("legend"===e.objectName){if(!this.shouldShowLegendCard())return;this.enumerateLegend(e,t)}else"categoryAxis"===e.objectName&&this.hasCategoryAxis?this.getCategoryAxisValues(t):"valueAxis"===e.objectName&&this.getValueAxisValues(t);for(var a=0,r=i;a<r;a++){var s=this.layers[a];s.enumerateObjectInstances&&s.enumerateObjectInstances(t,e)}return t.complete()},e.prototype.enumerateLegend=function(e,i){var a,r,s,o,n;a=w.getValue(this.legendObjectProperties,O.show,this.legend.isVisible()),r=w.getValue(this.legendObjectProperties,O.showTitle,!0),s=w.getValue(this.legendObjectProperties,O.titleText,this.layerLegendData&&this.layerLegendData.title?this.layerLegendData.title:""),o=w.getValue(this.legendObjectProperties,O.fontSize,this.layerLegendData&&this.layerLegendData.fontSize?this.layerLegendData.fontSize:m.DefaultLabelFontSizeInPt),n=w.getValue(this.legendObjectProperties,O.position,t.legendPosition.top),i.pushInstance({selector:null,properties:{show:a,position:n,showTitle:r,titleText:s,fontSize:o},objectName:e.objectName})},e.prototype.shouldShowLegendCard=function(){var e=this.layers,t=this.dataViews;if(e&&t)for(var i=e.length,a=0,r=0;r<i;r++){if(e[r].hasLegend())return!0;var s=t[r];if(s&&s.categorical&&s.categorical.values&&s.categorical.values.length>0&&(a++,a>1))return!0}return!1},e.prototype.getCategoryAxisValues=function(e){var t=L.both,i=!1,a=!!this.axes.x.isLogScaleAllowed,r=[z.log,z.linear];this.layers&&this.layers[0].getSupportedCategoryAxisType&&(t=this.layers[0].getSupportedCategoryAxisType(),i=t===L.scalar||pe.isScalar(t===L.both,this.categoryAxisProperties)),i||this.categoryAxisProperties&&(this.categoryAxisProperties.start=null,this.categoryAxisProperties.end=null);var s={selector:null,properties:{},objectName:"categoryAxis",validValues:{axisScale:r}};s.properties.show=!this.categoryAxisProperties||null==this.categoryAxisProperties.show||this.categoryAxisProperties.show,this.yAxisIsCategorical&&(s.properties.position=this.valueAxisProperties&&null!=this.valueAxisProperties.position?this.valueAxisProperties.position:P.left),t===L.both&&(s.properties.axisType=i?L.scalar:L.categorical),i&&(s.properties.axisScale=this.categoryAxisProperties&&null!=this.categoryAxisProperties.axisScale&&a?this.categoryAxisProperties.axisScale:z.linear,s.properties.start=this.categoryAxisProperties?this.categoryAxisProperties.start:null,s.properties.end=this.categoryAxisProperties?this.categoryAxisProperties.end:null),s.properties.showAxisTitle=!(!this.categoryAxisProperties||null==this.categoryAxisProperties.showAxisTitle)&&this.categoryAxisProperties.showAxisTitle,s.properties.showBorder=!(!this.categoryAxisProperties||null==this.categoryAxisProperties.showBorder)&&this.categoryAxisProperties.showAxisTitle,s.properties.fontSize=this.categoryAxisProperties&&null!=this.categoryAxisProperties.fontSize?this.categoryAxisProperties.fontSize:m.DefaultLabelFontSizeInPt,e.pushInstance(s).pushInstance({selector:null,properties:{axisStyle:this.categoryAxisProperties&&this.categoryAxisProperties.axisStyle?this.categoryAxisProperties.axisStyle:j.showTitleOnly,labelColor:this.categoryAxisProperties?this.categoryAxisProperties.labelColor:null,fontSize:this.categoryAxisProperties&&null!=this.categoryAxisProperties.fontSize?this.categoryAxisProperties.fontSize:m.DefaultLabelFontSizeInPt},objectName:"categoryAxis",validValues:{axisStyle:this.categoryAxisHasUnitType?[j.showTitleOnly,j.showUnitOnly,j.showBoth]:[j.showTitleOnly]}})},e.prototype.getValueAxisValues=function(e){var t=[z.log,z.linear],i=!!this.axes.y1.isLogScaleAllowed,a={selector:null,properties:{},objectName:"valueAxis",validValues:{axisScale:t,secAxisScale:t}};a.properties.show=!this.valueAxisProperties||null==this.valueAxisProperties.show||this.valueAxisProperties.show,this.yAxisIsCategorical||(a.properties.position=this.valueAxisProperties&&null!=this.valueAxisProperties.position?this.valueAxisProperties.position:P.left),a.properties.axisScale=this.valueAxisProperties&&null!=this.valueAxisProperties.axisScale&&i?this.valueAxisProperties.axisScale:z.linear,a.properties.start=this.valueAxisProperties?this.valueAxisProperties.start:null,a.properties.end=this.valueAxisProperties?this.valueAxisProperties.end:null,a.properties.showAxisTitle=!(!this.valueAxisProperties||null==this.valueAxisProperties.showAxisTitle)&&this.valueAxisProperties.showAxisTitle,a.properties.fontSize=this.valueAxisProperties&&null!=this.valueAxisProperties.fontSize?this.valueAxisProperties.fontSize:m.DefaultLabelFontSizeInPt,e.pushInstance(a).pushInstance({selector:null,properties:{axisStyle:this.valueAxisProperties&&null!=this.valueAxisProperties.axisStyle?this.valueAxisProperties.axisStyle:j.showTitleOnly,labelColor:this.valueAxisProperties?this.valueAxisProperties.labelColor:null,fontSize:this.valueAxisProperties&&null!=this.valueAxisProperties.fontSize?this.valueAxisProperties.fontSize:m.DefaultLabelFontSizeInPt},objectName:"valueAxis",validValues:{axisStyle:this.valueAxisHasUnitType?[j.showTitleOnly,j.showUnitOnly,j.showBoth]:[j.showTitleOnly]}}),2===this.layers.length&&(a.properties.secShow=this.valueAxisProperties&&null!=this.valueAxisProperties.secShow?this.valueAxisProperties.secShow:this.y2AxisExists,a.properties.secShow&&(a.properties.axisLabel=""))},e.prototype.onClearSelection=function(){if(this.hasSetData)for(var e=0,t=this.layers.length;e<t;e++){var i=this.layers[e];i.onClearSelection(),i.render(!0)}},e.prototype.createAndInitLayers=function(e){var t,i=this;if(e&&e.length>0){var a=e[0].metadata;a&&(t=a.objects)}var r=l(this.type,t,this.interactivityService,this.animator,this.isScrollable),s=G.inherit(this.visualInitOptions);s.svg=this.axisGraphicsContextScrollable,s.cartesianHost={updateLegend:function(e){return i.legend.drawLegend(e,i.currentViewport)},getSharedColors:function(){return i.sharedColorPalette},triggerRender:void 0};for(var o=0,n=r.length;o<n;o++)r[o].init(s);return r},e.prototype.renderLegend=function(){for(var e=this.layers,t={title:"",dataPoints:[]},i=0,a=e.length;i<a;i++)this.layerLegendData=e[i].calculateLegend(),this.layerLegendData&&(t.title=0===i?this.layerLegendData.title||"":t.title,t.dataPoints=t.dataPoints.concat(this.layerLegendData.dataPoints||[]),this.layerLegendData.grouped&&(t.grouped=!0));var r=this.legendObjectProperties;if(r){r.fontSize||(r.fontSize=m.DefaultLabelFontSizeInPt),S.update(t,r);var s=r[O.position];s&&this.legend.changeOrientation(F[s])}else this.legend.changeOrientation(F.Top);(1===t.dataPoints.length&&!t.grouped||this.hideLegends())&&(t.dataPoints=[]),this.legend.drawLegend(t,this.currentViewport)},e.prototype.hideLegends=function(){return!!(this.cartesianSmallViewPortProperties&&this.cartesianSmallViewPortProperties.hideLegendOnSmallViewPort&&this.currentViewport.height<this.cartesianSmallViewPortProperties.MinHeightLegendVisible)},e.prototype.addUnitTypeToAxisLabel=function(t){var i=e.getUnitType(t,function(e){return e.x});if(t.x.isCategoryAxis?this.categoryAxisHasUnitType=null!==i:this.valueAxisHasUnitType=null!==i,t.x.axisLabel&&i&&(t.x.isCategoryAxis?t.x.axisLabel=f.createAxisLabel(this.categoryAxisProperties,t.x.axisLabel,i):t.x.axisLabel=f.createAxisLabel(this.valueAxisProperties,t.x.axisLabel,i)),i=e.getUnitType(t,function(e){return e.y1}),t.y1.isCategoryAxis?this.categoryAxisHasUnitType=null!==i:this.valueAxisHasUnitType=null!==i,t.y1.axisLabel&&i&&(t.y1.isCategoryAxis?t.y1.axisLabel=f.createAxisLabel(this.categoryAxisProperties,t.y1.axisLabel,i):t.y1.axisLabel=f.createAxisLabel(this.valueAxisProperties,t.y1.axisLabel,i)),t.y2){var i=e.getUnitType(t,function(e){return e.y2});this.secValueAxisHasUnitType=null!==i,t.y2.axisLabel&&i&&this.valueAxisProperties&&this.valueAxisProperties.secAxisStyle&&(this.valueAxisProperties.secAxisStyle===j.showBoth?t.y2.axisLabel=t.y2.axisLabel+" ("+i+")":this.valueAxisProperties.secAxisStyle===j.showUnitOnly&&(t.y2.axisLabel=i))}},e.prototype.shouldRenderSecondaryAxis=function(e){return!!e&&(!(this.valueAxisProperties&&null!=this.valueAxisProperties.secShow&&!this.valueAxisProperties.secShow)&&(e.values&&e.values.length>0))},e.prototype.shouldRenderAxis=function(e,t){return void 0===t&&(t="show"),!!e&&(!e.isCategoryAxis||this.categoryAxisProperties&&null!=this.categoryAxisProperties[t]&&!this.categoryAxisProperties[t]?!(e.isCategoryAxis||this.valueAxisProperties&&null!=this.valueAxisProperties[t]&&!this.valueAxisProperties[t])&&(e.values&&e.values.length>0):e.values&&e.values.length>0)},e.prototype.render=function(t){this.setVisibility(!0);var i=this.legendMargins=this.legend.getMargins(),s={height:this.currentViewport.height-i.height,width:this.currentViewport.width-i.width},o=this.getMaxMarginFactor(),l=this.leftRightMarginLimit=s.width*o;this.bottomMarginLimit=Math.max(e.MinBottomMargin,Math.ceil(s.height*o));var c=e.getTextProperties(this.categoryAxisProperties&&a.PixelConverter.fromPointToPixel(parseFloat(this.categoryAxisProperties.fontSize))||void 0),u=e.getTextProperties(this.valueAxisProperties&&a.PixelConverter.fromPointToPixel(parseFloat(this.valueAxisProperties.fontSize))||void 0),h=this.margin;h.top=parseFloat(u.fontSize)/2,h.bottom=e.MinBottomMargin,h.right=0;var p=this.axes=n(this.layers,s,h,this.categoryAxisProperties,this.valueAxisProperties,this.isXScrollBarVisible||this.isYScrollBarVisible,null);this.yAxisIsCategorical=p.y1.isCategoryAxis,this.hasCategoryAxis=this.yAxisIsCategorical?p.y1&&p.y1.values.length>0:p.x&&p.x.values.length>0;var d,g,m=this.shouldRenderAxis(p.x),f=this.shouldRenderAxis(p.y1),y=this.shouldRenderSecondaryAxis(p.y2),v=s.width-(h.left+h.right),b=!1;this.isXScrollBarVisible=!1,this.isYScrollBarVisible=!1;var S=this.yAxisOrientation,w=S===P.right;if(this.layers&&(this.layers[0].getVisualCategoryAxisIsScalar&&(b=this.layers[0].getVisualCategoryAxisIsScalar()),!b&&this.isScrollable&&this.layers[0].getPreferredPlotArea)){var C=this.scrollX?p.x.categoryThickness:p.y1.categoryThickness,A=this.scrollX?p.x.values.length:p.y1.values.length;g=this.layers[0].getPreferredPlotArea(b,A,C),this.scrollX&&g&&g.width>s.width&&(this.isXScrollBarVisible=!0,s.height-=e.ScrollBarWidth),this.scrollY&&g&&g.height>s.height&&(this.isYScrollBarVisible=!0,s.width-=e.ScrollBarWidth,v=s.width-(h.left+h.right))}this.isXScrollBarVisible||this.isYScrollBarVisible?this.brushGraphicsContext||(this.brushGraphicsContext=this.svg.append("g").classed("x brush",!0)):(this.svg.selectAll(".brush").remove(),this.brushGraphicsContext=void 0),p=n(this.layers,s,h,this.categoryAxisProperties,this.valueAxisProperties,this.isXScrollBarVisible||this.isYScrollBarVisible,null);for(var T=!1,D=2,V=0,N=void 0,L=void 0,M=void 0;!T&&V<D;){V++,N=r({width:v,height:s.height},l,x.measureSvgTextWidth,x.estimateSvgTextHeight,p,this.bottomMarginLimit,c,u,null,!1,this.isXScrollBarVisible||this.isYScrollBarVisible,w,m,f,y);var k=w?N.yRight:N.yLeft,I=w?N.yLeft:N.yRight,O=m?N.xMax/1.8:0;k+=e.LeftPadding,I+=e.RightPadding,O+=e.BottomPadding,this.hideAxisLabels(i)&&(p.x.axisLabel=null,p.y1.axisLabel=null,p.y2&&(p.y2.axisLabel=null)),this.addUnitTypeToAxisLabel(p),M={x:p.x.axisLabel,y:p.y1.axisLabel,y2:p.y2?p.y2.axisLabel:null},L=null!=M.x||null!=M.y||null!=M.y2,null!=M.x&&(O+=e.XAxisLabelPadding),null!=M.y&&(k+=e.YAxisLabelPadding),null!=M.y2&&(I+=e.YAxisLabelPadding),h.left=w?I:k,h.right=w?k:I,h.bottom=O,this.margin=h,v=s.width-(h.left+h.right);var F=p.y1.values.length,z=p.y2&&p.y2.values.length;p=n(this.layers,s,h,this.categoryAxisProperties,this.valueAxisProperties,this.isXScrollBarVisible||this.isYScrollBarVisible,p),p.y1.values.length!==F||p.y2&&p.y2.values.length!==z||(T=!0)}this.renderChart(d,p,v,N,L,M,s,t)},e.prototype.hideAxisLabels=function(e){return!(!(this.cartesianSmallViewPortProperties&&this.cartesianSmallViewPortProperties.hideAxesOnSmallViewPort&&this.currentViewport.height+e.height<this.cartesianSmallViewPortProperties.MinHeightAxesVisible)||this.visualInitOptions.interactivity.isInteractiveLegend)},e.getUnitType=function(e,t){return t(e).formatter&&t(e).formatter.displayUnit&&t(e).formatter.displayUnit.value>1?t(e).formatter.displayUnit.title:null},e.prototype.getMaxMarginFactor=function(){return this.visualInitOptions.style.maxMarginFactor||e.MaxMarginFactor},e.getChartViewport=function(e,t){return{width:e.width-t.left-t.right,height:e.height-t.top-t.bottom}},e.wordBreak=function(e,t,i,a,r){e.each(function(e,r){var s,o,n=d3.select(this);i.length>=r?(s=i[r],o=t.scale(s)):o=t.xLabelMaxWidth,n.style("text-anchor","middle").attr({dx:"0em",dy:"1em",transform:"rotate(0)"}),x.wordBreak(this,o,t.willLabelsWordBreak?a:0)})},e.prototype.renderChart=function(t,i,r,s,o,n,l,c,u,h){var p,d,g,y,v,b=this.bottomMarginLimit,S=this.leftRightMarginLimit,w=this.layers,C=R(this.animator,c),A=e.getChartViewport(l,this.margin);if(this.shouldRenderAxis(i.x)){i.x.isCategoryAxis?(p=this.categoryAxisProperties&&this.categoryAxisProperties.labelColor?this.categoryAxisProperties.labelColor:null,y=this.categoryAxisProperties&&null!=this.categoryAxisProperties.fontSize?this.categoryAxisProperties.fontSize:m.DefaultLabelFontSizeInPt):(p=this.valueAxisProperties&&this.valueAxisProperties.labelColor?this.valueAxisProperties.labelColor:null,y=this.valueAxisProperties&&this.valueAxisProperties.fontSize?this.valueAxisProperties.fontSize:m.DefaultLabelFontSizeInPt),y=a.PixelConverter.fromPointToPixel(y),i.x.axis.orient("bottom"),i.x.willLabelsFit||i.x.axis.tickPadding(e.TickPaddingRotatedX);var T=this.xAxisGraphicsContext;C?T.transition().duration(C).call(i.x.axis):T.call(i.x.axis),T.call(e.darkenZeroLine).call(e.setAxisLabelColor,p).call(e.setAxisLabelFontSize,y);var D=T.selectAll("text"),V=[],N=0;this.layers&&this.layers.length&&(V=this.layers[0].getColumnsWidth(),N=this.layers[0].getBorderWidth()),T.call(e.moveBorder,i.x.scale,N,y/1.5-12),D.call(e.wordBreak,i.x,V,b,N)}else this.xAxisGraphicsContext.selectAll("*").remove();if(this.shouldRenderAxis(i.y1)){i.y1.isCategoryAxis?(d=this.categoryAxisProperties&&this.categoryAxisProperties.labelColor?this.categoryAxisProperties.labelColor:null,v=this.categoryAxisProperties&&null!=this.categoryAxisProperties.fontSize?this.categoryAxisProperties.fontSize:m.DefaultLabelFontSizeInPt):(d=this.valueAxisProperties&&this.valueAxisProperties.labelColor?this.valueAxisProperties.labelColor:null,v=this.valueAxisProperties&&null!=this.valueAxisProperties.fontSize?this.valueAxisProperties.fontSize:m.DefaultLabelFontSizeInPt),v=a.PixelConverter.fromPointToPixel(v);var L=this.yAxisOrientation,M=L===P.right;i.y1.axis.tickSize(-r).tickPadding(e.TickPaddingY).orient(L.toLowerCase());var k=this.y1AxisGraphicsContext;C?k.transition().duration(C).call(i.y1.axis):k.call(i.y1.axis),k.call(e.darkenZeroLine).call(e.setAxisLabelColor,d).call(e.setAxisLabelFontSize,v),s.yLeft>=S&&k.selectAll("text").call(f.LabelLayoutStrategy.clip,S-e.LeftPadding,x.svgEllipsis),!i.y2||this.valueAxisProperties&&null!=this.valueAxisProperties.secShow&&!this.valueAxisProperties.secShow?this.y2AxisGraphicsContext.selectAll("*").remove():(g=this.valueAxisProperties&&this.valueAxisProperties.secLabelColor?this.valueAxisProperties.secLabelColor:null,i.y2.axis.tickPadding(e.TickPaddingY).orient(M?P.left.toLowerCase():P.right.toLowerCase()),C?this.y2AxisGraphicsContext.transition().duration(C).call(i.y2.axis):this.y2AxisGraphicsContext.call(i.y2.axis),this.y2AxisGraphicsContext.call(e.darkenZeroLine).call(e.setAxisLabelColor,g),s.yRight>=S&&this.y2AxisGraphicsContext.selectAll("text").call(f.LabelLayoutStrategy.clip,S-e.RightPadding,x.svgEllipsis))}else this.y1AxisGraphicsContext.selectAll("*").remove(),this.y2AxisGraphicsContext.selectAll("*").remove();if(this.translateAxes(l),o){var I=!this.shouldRenderAxis(i.x,"showAxisTitle"),O=!this.shouldRenderAxis(i.y1,"showAxisTitle"),F=this.valueAxisProperties&&null!=this.valueAxisProperties.secShowAxisTitle&&this.valueAxisProperties.secShowAxisTitle===!1,z={axisLabels:n,legendMargin:this.legendMargins.height,viewport:l,hideXAxisTitle:I,hideYAxisTitle:O,hideY2AxisTitle:F,xLabelColor:p,yLabelColor:d,y2LabelColor:g,margin:void 0};this.renderAxesLabels(z,y)}else this.axisGraphicsContext.selectAll(".xAxisLabel").remove(),this.axisGraphicsContext.selectAll(".yAxisLabel").remove();var j=[],G=[],H=[];if(this.behavior){for(var E=0,W=w.length;E<W;E++){var U=w[E].render(c);if(U)if(j=j.concat(U.dataPoints),G.push(U.behaviorOptions),U.labelDataPointGroups)for(var _=U.labelDataPointGroups,Y=0,X=_.length;Y<X;Y++){var q=_[Y];H.push({labelDataPoints:q.labelDataPoints,maxNumberOfLabels:q.maxNumberOfLabels})}else{var K=U.labelDataPoints,Z=K;H.push({labelDataPoints:Z,maxNumberOfLabels:Z.length})}}var J={maximumOffset:m.maxLabelOffset,startingOffset:m.startingLabelOffset},$=new B(J),Q=$.layout(H,A);if(w.length>1&&m.drawLabelBackground(this.labelGraphicsContextScrollable,Q,"#FFFFFF",.7),this.animator&&!c?m.animateDefaultLabels(this.labelGraphicsContextScrollable,Q,this.animator.getDuration()):m.drawDefaultLabels(this.labelGraphicsContextScrollable,Q),this.labelGraphicsContextScrollable.selectAll("text.label").style("pointer-events","none"),this.interactivityService){var ee={layerOptions:G,clearCatcher:this.clearCatcher};this.interactivityService.bind(j,this.behavior,ee)}}},e.darkenZeroLine=function(e){var t=e.selectAll("g.tick").filter(function(e){return 0===e}).node();t&&d3.select(t).select("line").classed("zero-line",!0)},e.setAxisLabelColor=function(e,t){e.selectAll("g.tick text").style("fill",t?t.solid.color:null)},e.setAxisLabelFontSize=function(e,t){var i=h.toString(t);e.selectAll("g.tick text").attr("font-size",i)},e.moveBorder=function(e,t,i,a){void 0===a&&(a=0),e.selectAll("g.tick").attr("transform",function(e,r){return V.translate(t(e)+i*r,a)})},e.Classes={series:g("series")},e.capabilities={dataRoles:[{name:"Category",kind:b.Grouping,displayName:"Category"},{name:"Series",kind:b.Grouping,displayName:"Series"},{name:"Y",kind:b.Measure,displayName:"Y Axis"},{name:"Width",kind:b.Measure,displayName:"Axis width"}],objects:{columnBorder:{displayName:"Column Border",properties:{show:{displayName:"Show",type:{bool:!0}},color:{displayName:"Color",description:"Select color for data labels",type:{fill:{solid:{color:!0}}}},width:{displayName:"Width",type:{numeric:!0}}}},labels:{displayName:"Data labels",description:"Display data label options",properties:{show:{displayName:"Show",type:{bool:!0}},color:{displayName:"Color",description:"Select color for data labels",type:{fill:{solid:{color:!0}}}},labelDisplayUnits:{displayName:"Display units",description:"Select the units (millions, billions, etc.)",type:{formatting:{labelDisplayUnits:!0}},suppressFormatPainterCopy:!0},labelPrecision:{displayName:"Decimal Places",description:"Select the number of decimal places to display",placeHolderText:"Auto",type:{numeric:!0},suppressFormatPainterCopy:!0},showAll:{displayName:"Show All",type:{bool:!0}},fontSize:{displayName:"Text Size",type:{formatting:{fontSize:!0}}}}},legend:{displayName:"Legend",properties:{show:{displayName:"Show",type:{bool:!0}},position:{displayName:"Position",type:{formatting:{legendPosition:!0}}},showTitle:{displayName:"Title",type:{bool:!0}},titleText:{displayName:"Title text",type:{text:!0}},fontSize:{displayName:"Text size",type:{formatting:{fontSize:!0}}}}},categoryAxis:{displayName:"X-Axis",properties:{show:{displayName:"Show",type:{bool:!0}},position:{displayName:"Position",type:{formatting:{yAxisPosition:!0}}},axisScale:{displayName:"Scale type",type:{formatting:{axisScale:!0}}},axisType:{displayName:"Type",type:{formatting:{axisType:!0}}},showAxisTitle:{displayName:"Title",type:{bool:!0}},axisStyle:{displayName:"Style",type:{formatting:{axisStyle:!0}}},labelColor:{displayName:"Color",type:{fill:{solid:{color:!0}}}},fontSize:{displayName:"Text Size",type:{formatting:{fontSize:!0}}}}},valueAxis:{displayName:"Y-Axis",properties:{show:{displayName:"Show",type:{bool:!0}},position:{displayName:"Position",type:{formatting:{yAxisPosition:!0}}},axisScale:{displayName:"Scale type",type:{formatting:{axisScale:!0}}},intersection:{displayName:"Intersection",type:{numeric:!0}},showAxisTitle:{displayName:"Title",type:{bool:!0}},axisStyle:{displayName:"Style",type:{formatting:{axisStyle:!0}}},labelColor:{displayName:"Color",type:{fill:{solid:{color:!0}}}},fontSize:{displayName:"Text Size",type:{formatting:{fontSize:!0}}}}},dataPoint:{displayName:"Data colors",properties:{defaultColor:{displayName:"Default color",type:{fill:{solid:{color:!0}}}},showAllDataPoints:{displayName:"Show all",type:{bool:!0}},fill:{displayName:"Fill",type:{fill:{solid:{color:!0}}}},fillRule:{displayName:"Color saturation",type:{fillRule:{}},rule:{inputRole:"Gradient",output:{property:"fill",selector:["Category"]}}}}}},dataViewMappings:[{conditions:[{Category:{min:0,max:1},Series:{min:0,max:1},Y:{min:0,max:1},Width:{min:0,max:1}}],categorical:{categories:{for:{in:"Category"},dataReductionAlgorithm:{top:{}}},values:{group:{by:"Series",select:[{for:{in:"Y"}},{for:{in:"Width"}}],dataReductionAlgorithm:{top:{}}}},rowCount:{preferred:{min:1,max:1},supported:{min:0}}}}],supportsHighlight:!0,sorting:{default:{}},drilldown:{roles:["Category"]}},e.Properties={dataPoint:{defaultColor:{objectName:"dataPoint",propertyName:"defaultColor"},fill:{objectName:"dataPoint",propertyName:"fill"},showAllDataPoints:{objectName:"dataPoint",propertyName:"showAllDataPoints"}},general:{formatString:{objectName:"general",propertyName:"formatString"}},columnBorder:{show:{objectName:"columnBorder",propertyName:"show"},color:{objectName:"columnBorder",propertyName:"color"},width:{objectName:"columnBorder",propertyName:"width"}}},e.DefaultSettings={columnBorder:{show:!0,color:"#fff",width:2,maxWidth:5},labelSettings:{maxPrecision:4,minPrecision:0}},e.MinOrdinalRectThickness=20,e.MinScalarRectThickness=2,e.OuterPaddingRatio=.4,e.InnerPaddingRatio=.2,e.TickLabelPadding=2,e.ClassName="cartesianChart",e.AxisGraphicsContextClassName="axisGraphicsContext",e.MaxMarginFactor=.25,e.MinBottomMargin=50,e.LeftPadding=10,e.RightPadding=10,e.BottomPadding=16,e.YAxisLabelPadding=20,e.XAxisLabelPadding=20,e.TickPaddingY=10,e.TickPaddingRotatedX=5,e.FontSize=11,e.MaxNumberOfLabels=100,e.MinWidth=100,e.MinHeight=100,e.ScrollBarWidth=10,e}();i.MekkoChart=re,i.createLayers=l;var se={category:"Category",series:"Series",y:"Y",width:"Width"},oe=function(){function e(e){var t=e.chartType;this.chartType=t,this.categoryAxisType=null,this.animator=e.animator,this.isScrollable=e.isScrollable,this.interactivityService=e.interactivityService}return e.prototype.init=function(t){this.svg=t.svg,this.unclippedGraphicsContext=this.svg.append("g").classed("columnChartUnclippedGraphicsContext",!0),
this.mainGraphicsContext=this.unclippedGraphicsContext.append("svg").classed("columnChartMainGraphicsContext",!0),this.labelGraphicsContext=this.svg.append("g").classed(m.labelGraphicsContextClass.class,!0),this.style=t.style,this.currentViewport=t.viewport,this.hostService=t.host,this.interactivity=t.interactivity,this.colors=this.style.colorPalette.dataColors,this.cartesianVisualHost=t.cartesianHost,this.options=t,this.supportsOverflow=!u.hasFlag(this.chartType,Q);var i=this.element=t.element;i.addClass(e.ColumnChartClassName),this.columnChart=new ae},e.prototype.getCategoryLayout=function(e,t){var i=this.currentViewport.width-(this.margin.left+this.margin.right),a=this.data?this.data.categoryMetadata:void 0,r=f.getCategoryValueType(a),s=!!this.data&&this.data.scalarCategoryAxis,o=f.createDomain(this.data.series,r,s,t.forcedXDomain);return re.getLayout(this.data,{availableWidth:i,categoryCount:e,domain:o,isScalar:s,isScrollable:this.isScrollable,trimOrdinalDataOnOverflow:!1})},e.getBorderWidth=function(e){if(!e||!e.show||!e.width)return 0;var t=e.width;return t<0?0:t>e.maxWidth?e.maxWidth:t},e.getBorderColor=function(e){return e?e.color:re.DefaultSettings.columnBorder.color},e.converter=function(t,i,a,r,s,o,n){void 0===a&&(a=!1),void 0===r&&(r=!1),void 0===s&&(s=!1),void 0===o&&(o=null);var l=pe.getCategoryAxisProperties(o),c=pe.getValueAxisProperties(o);r=pe.isScalar(r,l),t=ue.applyUserMinMax(r,t,l);var u=new ne(t),h=H.getPivotedCategories(t,re.Properties.general.formatString),p=h.categories,d=h.categoryFormatter,g=h.categoryIdentities,m=t.categories&&t.categories.length>0?t.categories[0].source:void 0,f=re.DefaultSettings.columnBorder,y=k.getDefaultColumnLabelSettings(!0),v=void 0,x=void 0;if(o&&o.objects){var b=o.objects;v=N.getFillColor(b,re.Properties.dataPoint.defaultColor),x=N.getValue(b,re.Properties.dataPoint.showAllDataPoints),y=re.parseLabelSettings(b),f=re.parseBorderSettings(b)}for(var S=u.getLegend(i,v),w=S.legend.dataPoints,C=S.seriesSources,P=e.createDataPoints(t,p,g,w,S.seriesObjects,u,y,a,r,s,H.categoryIsAlsoSeriesRole(t,se.series,se.category),h.categoryObjects,v,n,m),A=P.series,T=[],D=0,V=w.length;D<V;D++)T.push(C[D]);var L=H.createAxesLabels(l,c,m,T);return{categories:p,categoriesWidth:P.categoriesWidth,categoryFormatter:d,series:A,valuesMetadata:T,legendData:S.legend,hasHighlights:P.hasHighlights,categoryMetadata:m,scalarCategoryAxis:r,borderSettings:f,labelSettings:y,axesLabels:{x:L.xAxisLabel,y:L.yAxisLabel},hasDynamicSeries:P.hasDynamicSeries,defaultDataPointColor:v,showAllDataPoints:x,isMultiMeasure:!1}},e.getStackedMultiplier=function(e,t,i,a){for(var r=0,s=0,o=0;o<i;o++){var n=e[o][t];n=f.normalizeNonFiniteNumber(n),n>0?r+=n:n<0&&(s-=n)}var l=r+s;return{pos:r?r/l/r:1,neg:s?s/l/s:1}},e.createDataPoints=function(t,i,a,r,s,o,n,l,c,h,p,d,g,m,y){void 0===l&&(l=!1),void 0===c&&(c=!1),void 0===h&&(h=!1);var v=t&&t.values?t.values.grouped():void 0,x=i.length,b=r.length,S=[];if(b<1||x<1||null===i[0])return{series:S,hasHighlights:!1,hasDynamicSeries:!1,categoriesWidth:[]};var w=t.categories;y=w&&w.length>0?w[0].source:null;var C=f.getCategoryValueType(y),P=f.isDateTime(C),A=[],T=[],D=[],V=[],N=!(!t.values||!t.values.source),L=[],M=-1,I=0,O=!1,F=o.hasHighlightValues(0);for(I=0;I<t.values.length;I++)if(t.values[I].source.roles&&t.values[I].source.roles[se.width]&&!t.values[I].source.roles[se.y]){M=I;for(var z=t.values[I].values,j=0,R=z.length;j<R;j++)L[j]=d3.sum([0,L[j],z[j]])}else{for(var B=[],H=[],_=0;_<x;_++){var Y=o.getValueBySeriesAndCategory(I,_);if(B[_]=Y,F){var X=o.getHighlightBySeriesAndCategory(I,_);H[_]=X,Y>=0&&X>=0&&Y>=X||Y<=0&&X<=0&&Y<=X||(O=!0)}}D.push(B),F&&V.push(H)}if(O&&!h&&(O=!1,F=!1,D=V),L.length<1)for(I=0;I<t.values.length;I++)if(t.values[I].source.roles&&t.values[I].source.roles[se.width]){M=I;for(var z=t.values[I].values,j=0,R=z.length;j<R;j++)L[j]=d3.sum([0,L[j],z[j]])}else;if(L.length<1)for(I=0;I<x;I++)L.push(1);var q=d3.sum(L),K=d3.scale.linear().domain([0,q]).range([0,1]),Z=[0],J=[];for(I=0;I<x-1;I++){var $=Z[Z.length-1]+(L[I]||0);Z.push($)}for(I=0;I<x;I++)Z[I]=K(Z[I]),J[I]=K(L[I]);var ee=d,te=re.Properties.general.formatString;for(I=0;I<b;I++){var ie,ae=[],oe=r[I];if(!N){var ne=v&&v.length>0&&v[0].values?v[0].values[I]:null,le=ne&&ne.source&&ne.source.objects?ne.source.objects.labels:null;le&&(ie=G.inherit(n),k.updateLabelSettingsFromLabelsObject(le,ie))}var ce={displayName:oe.label,key:"series"+I,index:I,data:ae,identity:oe.identity,color:oe.color,labelSettings:ie};b>1&&(ee=s[I]);for(var ue=t.values[I].source,_=0;_<x;_++){0===I&&(A.push(0),T.push(0));var Y=f.normalizeNonFiniteNumber(D[I][_]);if(!(null==Y&&I>0)){var he=Y,pe=i[_];if(P&&pe&&(pe=pe.getTime()),!c||null!=pe&&!isNaN(pe)){var de;l&&(de=e.getStackedMultiplier(D,_,b,x));var ge=Y,me=Y<0;de&&(Y*=me?de.neg:de.pos);var fe,ye=Math.abs(Y);me?(fe=T[_],isNaN(ye)||(T[_]-=ye)):(isNaN(ye)||(A[_]+=ye),fe=A[_]);var ve=v&&v.length>I&&v[I].values?v[I]:null,xe=t.categories&&t.categories.length>0?t.categories[0]:null,be=E.builder().withCategory(xe,_).withSeries(t.values,ve).withMeasure(o.getMeasureNameByIndex(I)).createSelectionId(),Se=i[_],we=e.getDataPointColor(oe,_,ee),Ce=[];if(ve){var Pe={values:[],source:t.values.source};Ce.push({value:ve.name,metadata:Pe});for(var Ae=0;Ae<ve.values.length;Ae++){var Te=ve.values[Ae];Ce.push({value:Te.values[_],metadata:Te})}}var De=W.createTooltipInfo(te,null,Se,he,[xe],Ce,null,_),Ve=ce&&ce.labelSettings?ce.labelSettings:n,Ne=Ve.labelColor,Le=void 0;u.hasFlag(m,Q)&&(Le=this.getStackedLabelColor(me,I,b,_,D),Ne=Le||I===b-1&&!me?Ne:k.defaultInsideLabelColor),Y=J[_];var Me=Z[_],ke={categoryValue:pe,value:Y,position:fe,valueAbsolute:ye,valueOriginal:ge,seriesIndex:I,labelSettings:Ve,categoryIndex:_,color:we,selected:!1,originalValue:Y,originalPosition:Me,originalValueAbsolute:ye,identity:be,key:be.getKey(),tooltipInfo:De,labelFill:Ne,labelFormatString:ue.format,lastSeries:Le,chartType:m};if(ae.push(ke),F){var Ie=V[I][_],Oe=Ie,Fe=!0;null===Ie&&(Ie=0,Fe=!1),l&&(Ie*=de.pos);var ze=Math.abs(Ie),je=fe;Ie>0?je-=ye-ze:0===Ie&&Y>0&&(je-=ye);var Ge=U.createWithHighlight(be),Se=i[_];Fe&&(ke.tooltipInfo=De);var Re={categoryValue:pe,value:Y,position:je,valueAbsolute:ze,valueOriginal:Oe,seriesIndex:I,labelSettings:Ve,categoryIndex:_,color:we,selected:!1,highlight:!0,originalValue:Y,originalPosition:Me,originalValueAbsolute:ye,drawThinner:O,identity:Ge,key:Ge.getKey(),tooltipInfo:De,labelFormatString:ue.format,labelFill:Ne,lastSeries:Le,chartType:m};ae.push(Re)}}}}S.push(ce)}return{series:S,categoriesWidth:J,hasHighlights:F,hasDynamicSeries:N}},e.getDataPointColor=function(e,t,i){if(i){var a=N.getFillColor(i[t],re.Properties.dataPoint.fill);if(a)return a}return e.color},e.getStackedLabelColor=function(e,t,i,a,r){for(var s=!(e&&t===i-1&&1!==i),o=t+1;o<i;o++){var n=f.normalizeNonFiniteNumber(r[o][a]);if(null!==n&&((!e||e&&0===t)&&n>0||e&&0!==t)){s=!1;break}}return s},e.sliceSeries=function(e,t,i){void 0===i&&(i=0);var a=[];if(e&&e.length>0)for(var r=0,s=e.length;r<s;r++){var o=a[r]=G.inherit(e[r]);o.data=e[r].data.filter(function(e){return e.categoryIndex>=i&&e.categoryIndex<t})}return a},e.getInteractiveColumnChartDomElement=function(e){return e.children("svg").get(0)},e.prototype.getColumnsWidth=function(){var e=this.data;return e&&e.series&&e.series[0]&&e.series[0].data?e.categoriesWidth:[]},e.prototype.getBorderWidth=function(){return e.getBorderWidth(this.data.borderSettings)},e.prototype.setData=function(t){var i=!0;if(this.data={categories:[],categoriesWidth:[],categoryFormatter:null,series:[],valuesMetadata:[],legendData:null,hasHighlights:!1,categoryMetadata:null,scalarCategoryAxis:!1,borderSettings:null,labelSettings:k.getDefaultColumnLabelSettings(i),axesLabels:{x:null,y:null},hasDynamicSeries:!1,defaultDataPointColor:null,isMultiMeasure:!1},t.length>0){var a=t[0];if(a&&a.categorical){var r=this.dataViewCat=a.categorical;this.data=e.converter(r,this.cartesianVisualHost.getSharedColors(),!0,!1,this.supportsOverflow,a.metadata,this.chartType);for(var s=this.data.series,o=0,n=s.length;o<n;o++){var l=s[o];this.interactivityService&&this.interactivityService.applySelectionStateToData(l.data)}}}},e.prototype.calculateLegend=function(){if(this.interactivity&&this.interactivity.isInteractiveLegend)return this.createInteractiveMekkoLegendDataPoints(0);var e=this.data?this.data.legendData:null,t=e?e.dataPoints:[];return p.isUndefinedOrEmpty(t)?null:e},e.prototype.hasLegend=function(){return this.data&&(this.data.hasDynamicSeries||this.data.series&&this.data.series.length>1)},e.prototype.enumerateObjectInstances=function(e,t){switch(t.objectName){case"dataPoint":Y.hasGradientRole(this.dataViewCat)||this.enumerateDataPoints(e);break;case"labels":this.enumerateDataLabels(e)}},e.prototype.enumerateDataLabels=function(e){var t=this.data,i=this.data.labelSettings,a=t.series.length;if(k.enumerateDataLabels(this.getLabelSettingsOptions(e,i,!1)),0!==a&&!t.hasDynamicSeries&&(a>1||!t.categoryMetadata))for(var r=0;r<a;r++){var s=t.series[r],i=s.labelSettings?s.labelSettings:this.data.labelSettings;k.enumerateDataLabels(this.getLabelSettingsOptions(e,i,!0,s))}},e.prototype.getLabelSettingsOptions=function(e,t,i,a){var r=!0;return{enumeration:e,dataLabelsSettings:t,show:!i,displayUnits:r,precision:!0,selector:a&&a.identity?a.identity.getSelector():null}},e.prototype.enumerateDataPoints=function(e){var t=this.data;if(t&&t.series){var i=t.series.length;if(0!==i)if(t.hasDynamicSeries||i>1||!t.categoryMetadata)for(var a=0;a<i;a++){var r=t.series[a];e.pushInstance({objectName:"dataPoint",displayName:r.displayName,selector:X.normalizeSelector(r.identity.getSelector()),properties:{fill:{solid:{color:r.color}}}})}else{var s=t.series[0].data,o=t.categoryFormatter;e.pushInstance({objectName:"dataPoint",selector:null,properties:{defaultColor:{solid:{color:t.defaultDataPointColor||this.colors.getColorByIndex(0).value}}}}).pushInstance({objectName:"dataPoint",selector:null,properties:{showAllDataPoints:!!t.showAllDataPoints}});for(var a=0;a<s.length&&t.showAllDataPoints;a++){var n=s[a],l=t.categories[a];e.pushInstance({objectName:"dataPoint",displayName:o?o.format(l):l,selector:X.normalizeSelector(n.identity.getSelector(),!0),properties:{fill:{solid:{color:n.color}}}})}}}},e.prototype.calculateAxesProperties=function(e){var t=this.data;this.currentViewport=e.viewport;var i=this.margin=e.margin,a=t&&t.categories?t.categories.length:0,r=t?this.getCategoryLayout(a,e):{categoryCount:0,categoryThickness:re.MinOrdinalRectThickness,outerPaddingRatio:re.OuterPaddingRatio,isScalar:!1};this.categoryAxisType=r.isScalar?L.scalar:null,this.columnChart.setData(t);var s=this.getPreferredPlotArea(r.isScalar,r.categoryCount,r.categoryThickness);s.width===this.currentViewport.width&&(s.width-=i.left+i.right),s.height-=i.top+i.bottom;var o=!0,n={height:s.height,width:s.width,duration:0,hostService:this.hostService,unclippedGraphicsContext:this.unclippedGraphicsContext,mainGraphicsContext:this.mainGraphicsContext,labelGraphicsContext:this.labelGraphicsContext,margin:this.margin,layout:r,animator:this.animator,interactivityService:this.interactivityService,viewportHeight:this.currentViewport.height-(i.top+i.bottom),viewportWidth:this.currentViewport.width-(i.left+i.right),is100Pct:o,isComboChart:!0};this.ApplyInteractivity(n),this.columnChart.setupVisualProps(n);var l=u.hasFlag(this.chartType,Z);if(l){var c=e.forcedXDomain;e.forcedXDomain=e.forcedYDomain,e.forcedYDomain=c}return this.xAxisProperties=this.columnChart.setXScale(o,e.forcedTickCount,e.forcedXDomain,l?e.valueAxisScaleType:e.categoryAxisScaleType),this.yAxisProperties=this.columnChart.setYScale(o,e.forcedTickCount,e.forcedYDomain,l?e.categoryAxisScaleType:e.valueAxisScaleType),e.showCategoryAxisLabel&&this.xAxisProperties.isCategoryAxis||e.showValueAxisLabel&&!this.xAxisProperties.isCategoryAxis?this.xAxisProperties.axisLabel=t.axesLabels.x:this.xAxisProperties.axisLabel=null,e.showValueAxisLabel&&!this.yAxisProperties.isCategoryAxis||e.showCategoryAxisLabel&&this.yAxisProperties.isCategoryAxis?this.yAxisProperties.axisLabel=t.axesLabels.y:this.yAxisProperties.axisLabel=null,[this.xAxisProperties,this.yAxisProperties]},e.prototype.getPreferredPlotArea=function(e,t,i){var a={height:this.currentViewport.height,width:this.currentViewport.width};if(this.isScrollable&&!e){var r=re.getPreferredCategorySpan(t,i);u.hasFlag(this.chartType,Z)?a.height=Math.max(r,a.height):a.width=Math.max(r,a.width)}return a},e.prototype.ApplyInteractivity=function(t){var i=this,a=this.interactivity;if(a&&(a.dragDataPoint&&(t.onDragStart=function(e){e.identity&&i.hostService.onDragStart({event:d3.event,data:{data:e.identity.getSelector()}})}),a.isInteractiveLegend)){var r=function(){var e=d3.mouse(i.mainGraphicsContext[0][0]),t=e[0],a=e[1],r=i.columnChart.getClosestColumnIndex(t,a);i.selectColumn(r)},s=e.getInteractiveColumnChartDomElement(this.element);this.svg.on("click",r),d3.select(s).on("click",r);var o=d3.behavior.drag().origin(Object).on("drag",r);this.svg.call(o),d3.select(s).call(o)}},e.prototype.selectColumn=function(e,t){if(void 0===t&&(t=!1),t||this.lastInteractiveSelectedColumnIndex!==e){var i=this.createInteractiveMekkoLegendDataPoints(e),a=i.dataPoints;this.cartesianVisualHost.updateLegend(i),a.length>0&&this.columnChart.selectColumn(e,this.lastInteractiveSelectedColumnIndex),this.lastInteractiveSelectedColumnIndex=e}},e.prototype.createInteractiveMekkoLegendDataPoints=function(e){var t=this.data;if(!t||p.isUndefinedOrEmpty(t.series))return{dataPoints:[]};for(var i=re.Properties.general.formatString,a=[],r=t.categories&&t.categories[e],s=t.series,o=t.legendData&&t.legendData.dataPoints,n=new ne(this.dataViewCat),l=0,c=s.length;l<c;l++){var u,h=n.getValueBySeriesAndCategory(l,e),d=t.valuesMetadata[l],g=H.getFormattedLegendLabel(d,this.dataViewCat.values,i);if(1===s.length){var m=s[0];u=m.data.length>e&&m.data[e].color}else u=o.length>l&&o[l].color;a.push({color:u,icon:q.Box,label:g,category:t.categoryFormatter?t.categoryFormatter.format(r):r,measure:y.format(h,y.getFormatString(d,i)),identity:U.createNull(),selected:!1})}return{dataPoints:a}},e.prototype.overrideXScale=function(e){this.xAxisProperties=e},e.prototype.render=function(e){var t=this.columnChart.drawColumns(!e),i=this.data,a=this.margin,r=this.currentViewport,s=r.height-(a.top+a.bottom),o=r.width-(a.left+a.right);this.mainGraphicsContext.attr("height",s).attr("width",o),K.addTooltip(t.shapesSelection,function(e){return e.data.tooltipInfo});var n=[],l=void 0;if(this.interactivityService){for(var c=0,u=i.series.length;c<u;c++)n=n.concat(i.series[c].data);l={datapoints:n,bars:t.shapesSelection,hasHighlights:i.hasHighlights,eventGroup:this.mainGraphicsContext,mainGraphicsContext:this.mainGraphicsContext,viewport:t.viewport,axisOptions:t.axisOptions,showLabel:i.labelSettings.show}}return this.interactivity&&this.interactivity.isInteractiveLegend&&this.data.series.length>0&&this.selectColumn(0,!0),V.flushAllD3TransitionsIfNeeded(this.options),{dataPoints:n,behaviorOptions:l,labelDataPoints:t.labelDataPoints,labelsAreNumeric:!0}},e.prototype.onClearSelection=function(){this.interactivityService&&this.interactivityService.clearSelection()},e.prototype.getVisualCategoryAxisIsScalar=function(){return!!this.data&&this.data.scalarCategoryAxis},e.prototype.getSupportedCategoryAxisType=function(){var e=this.data?this.data.categoryMetadata:void 0,t=f.getCategoryValueType(e),i=f.isOrdinal(t);return i?L.categorical:L.both},e.prototype.setFilteredData=function(t,i){var a=G.inherit(this.data);return a.series=e.sliceSeries(a.series,i,t),a.categories=a.categories.slice(t,i),this.columnChart.setData(a),a},e.ColumnChartClassName="columnChart",e.SeriesClasses=g("series"),e.BorderClass=g("mekkoborder"),e}();i.MekkoColumnChart=oe;var ne=function(){function e(e){this.dataView=e}return e.hasRole=function(e,t){var i=e.roles;return i&&i[t]},e.prototype.getLegend=function(t,i){var a=[],r=[],s=[],o=!1,n=new X(t,re.Properties.dataPoint.fill,i),l=void 0;if(this.dataView&&this.dataView.values){for(var c=this.dataView.values,u=c.grouped(),h=!(!c||!c.source),p=re.Properties.general.formatString,d=0,g=u.length;d<g;d++)for(var m=u[d],f=m.objects,y=m.values,v=0,x=y.length;v<x;v++){var b=y[v],S=b.source;if(!e.hasRole(S,"Width")||e.hasRole(S,"Y")){r.push(S),s.push(b.objects);var w=b.identity?U.createWithIdAndMeasure(b.identity,S.queryName):U.createWithMeasure(this.getMeasureNameByIndex(v)),C=H.getFormattedLegendLabel(S,c,p),P=h?n.getColorForSeriesValue(f||S.objects,c.identityFields,S.groupName):n.getColorForMeasure(f||S.objects,S.queryName);a.push({icon:q.Box,color:P,label:C,identity:w,selected:!1}),b.identity&&void 0!==S.groupName&&(o=!0)}}var A=this.dataView.values;l=A&&A.source?A.source.displayName:""}var T={title:l,dataPoints:a,grouped:o};return{legend:T,seriesSources:r,seriesObjects:s}},e.prototype.getValueBySeriesAndCategory=function(e,t){return this.dataView.values[e].values[t]},e.prototype.getMeasureNameByIndex=function(e){return this.dataView.values[e].source.queryName},e.prototype.hasHighlightValues=function(e){var t=this.dataView&&this.dataView.values?this.dataView.values[e]:void 0;return t&&!!t.highlights},e.prototype.getHighlightBySeriesAndCategory=function(e,t){return this.dataView.values[e].highlights[t]},e}(),le=function(){function e(e){this.behaviors=e||[]}return e.prototype.bindEvents=function(e,t){for(var i=this.behaviors,a=0,r=i.length;a<r;a++)i[a].bindEvents(e.layerOptions[a],t);e.clearCatcher.on("click",function(){t.handleClearSelection()})},e.prototype.renderSelection=function(e){for(var t in this.behaviors)this.behaviors[t].renderSelection(e)},e}(),ce=function(){function e(){}return e.prototype.bindEvents=function(t,i){this.options=t;var a=t.eventGroup;a.on("click",function(){var t=e.getDatumForLastInputEvent();i.handleSelection(t,d3.event.ctrlKey)}),a.on("contextmenu",function(){if(!d3.event.ctrlKey){d3.event.preventDefault();var t=e.getDatumForLastInputEvent(),a=C.getPositionOfLastInputEvent();i.handleContextMenu(t,a)}})},e.prototype.renderSelection=function(e){var t=this.options;t.bars.style("fill-opacity",function(i){return ue.getFillOpacity(i.selected,i.highlight,!i.highlight&&e,!i.selected&&t.hasHighlights)})},e.getDatumForLastInputEvent=function(){var e=d3.event.target;return d3.select(e).datum()},e}();i.MekkoChartWebBehavior=ce;var ue;!function(e){function t(e,t,i){return void 0===i&&(i=0),f.diffScaled(e,i,t)}function i(e,t){var i={min:0,max:10};if(0===e.length)return i;var a=d3.min(e,function(e){return d3.min(e.data,function(e){return e.position-e.valueAbsolute})}),r=d3.max(e,function(e){return d3.max(e.data,function(e){return e.position})});return t&&(a=v.roundToPrecision(a,u),r=v.roundToPrecision(r,u)),{min:a,max:r}}function a(e,t,i){var a=t.selectAll(re.Classes.series.selector),r=a.data(e.series,function(e){return e.key});return r.enter().append("g").classed(re.Classes.series.class,!0),r.style({fill:function(e){return e.color}}),r.exit().remove(),r}function r(e,t){t&&e.attr("draggable","true").on("dragstart",t)}function s(t,i,a,r){return r&&!i||a&&!t?e.DimmedOpacity:e.DefaultOpacity}function o(t,i,a,r){var s=t.selectAll(re.Classes.series.selector),o="undefined"==typeof r;s.selectAll(h+i).filter(function(e){return e.categoryIndex!==a&&(o||e.categoryIndex===r)}).transition().style("fill-opacity",e.DimmedOpacity),s.selectAll(h+i).filter(function(e){return e.categoryIndex===a}).style("fill-opacity",e.DefaultOpacity)}function n(e,t){for(var i=0,a=Number.MAX_VALUE,r=0,s=t.length;r<s;r++){var o=Math.abs(e-t[r]);o<a&&(a=o,i=r)}return i}function l(t,i,a){if(t){var r=a.start,s=a.end;return e.transformDomain(i,r,s)}return i}function c(e,t,i){if(!e.categories||!e.values||0===e.categories.length||0===e.values.length)return e;if("number"!=typeof t&&"number"!=typeof i)return e;var a=e.categories[0],r=a?a.source.type:null;if(!f.isOrdinal(r)){var s=a.values,o=a.objects;if(!s||!o)return e;var n=[],l=[],c=[];if("number"!=typeof t&&(t=s[0]),"number"!=typeof i&&(i=s[s.length-1]),t>i)return e;for(var u=0,h=e.values.length;u<h;u++)l.push([]);for(var p=0,h=s.length;p<h;p++)if(s[p]>=t&&s[p]<=i&&(n.push(s[p]),o&&c.push(o[p]),e.values))for(var d=0;d<e.values.length;d++)l[d].push(e.values[d].values[p]);var g=G.inherit(e),m=g.values=G.inherit(g.values),y=g.categories=G.inherit(e.categories),v=g.categories[0]=G.inherit(y[0]);v.values=n,v.objects&&(v.objects=c);for(var p=0,h=e.values.length;p<h;p++){var x=m[p]=G.inherit(m[p]);x.values=l[p]}return g}}var u=1e-4,h="rect";e.DimmedOpacity=.4,e.DefaultOpacity=1,e.getSize=t,e.calcValueDomain=i,e.drawSeries=a,e.applyInteractivity=r,e.getFillOpacity=s,e.setChosenColumnOpacity=o,e.getClosestColumnIndex=n,e.applyUserMinMax=l,e.transformDomain=c}(ue=i.MekkoChartUtils||(i.MekkoChartUtils={}));var he=function(){function e(e){this.palette=e,this.clearPreferredScale()}return e.prototype.getColorScaleByKey=function(e){return this.setPreferredScale(e),this.preferredScale},e.prototype.getNewColorScale=function(){return this.preferredScale},e.prototype.getColorByIndex=function(e){return this.palette.getColorByIndex(e)},e.prototype.getSentimentColors=function(){return this.palette.getSentimentColors()},e.prototype.getBasePickerColors=function(){return this.palette.getBasePickerColors()},e.prototype.clearPreferredScale=function(){this.preferredScale=this.palette.getNewColorScale(),this.rotated=!1},e.prototype.rotateScale=function(){this.preferredScale=this.preferredScale.clone(),this.preferredScale.clearAndRotateScale(),this.rotated=!0},e.prototype.setPreferredScale=function(e){this.rotated||(this.preferredScale=this.palette.getColorScaleByKey(e))},e}();i.MekkoChartSharedColorPalette=he;var pe;!function(e){function t(e,t){var i={};if(!e)return i;var a=e.objects;if(a){var r=a.categoryAxis;r&&(i={show:r.show,axisType:r.axisType,axisScale:r.axisScale,start:r.start,end:r.end,showAxisTitle:null==r.showAxisTitle?t:r.showAxisTitle,axisStyle:r.axisStyle,labelColor:r.labelColor,labelDisplayUnits:r.labelDisplayUnits,labelPrecision:r.labelPrecision,duration:r.duration})}return i}function i(e,t){var i={};if(!e)return i;var a=e.objects;if(a){var r=a.valueAxis;r&&(i={show:r.show,position:r.position,axisScale:r.axisScale,start:r.start,end:r.end,showAxisTitle:null==r.showAxisTitle?t:r.showAxisTitle,axisStyle:r.axisStyle,labelColor:r.labelColor,labelDisplayUnits:r.labelDisplayUnits,labelPrecision:r.labelPrecision,secShow:r.secShow,secPosition:r.secPosition,secAxisScale:r.secAxisScale,secStart:r.secStart,secEnd:r.secEnd,secShowAxisTitle:r.secShowAxisTitle,secAxisStyle:r.secAxisStyle,secLabelColor:r.secLabelColor,secLabelDisplayUnits:r.secLabelDisplayUnits,secLabelPrecision:r.secLabelPrecision})}return i}function a(e,t){return e&&(e=!t||!t.axisType||t.axisType===L.scalar),e}e.getCategoryAxisProperties=t,e.getValueAxisProperties=i,e.isScalar=a}(pe=i.MekkochartHelper||(i.MekkochartHelper={}))}(i=t.samples||(t.samples={}))}(t=e.visuals||(e.visuals={}))}(i||(i={}))},function(e,t){var i,a=window.jsCommon,i=window.powerbi;window.powerbitests,window.InJs,window.debug,window.jasmine,window.Microsoft;!function(e){var t;!function(t){var i;!function(i){var r=t.utility.SelectionManager,s=e.visuals.valueFormatter,o=a.PixelConverter.fromPoint,n=function(){function i(e){this.margin={top:10,right:10,bottom:10,left:10},this.nodeWidth=21.5,this.curvatureOfLinks=.5,e&&(this.svg=e.svg,this.margin=e.margin||this.margin,this.curvatureOfLinks=e.curvatureOfLinks||this.curvatureOfLinks)}return i.getProperties=function(e){var t={};for(var i in e.objects){t[i]={};for(var a in e.objects[i].properties)t[i][a]={objectName:i,propertyName:a}}return t},Object.defineProperty(i.prototype,"textProperties",{get:function(){return{fontFamily:this.root.style("font-family"),fontSize:o(this.dataView?this.dataView.settings.fontSize:i.DefaultSettings.fontSize)}},enumerable:!0,configurable:!0}),i.prototype.init=function(e){this.svg?this.root=this.svg:this.root=d3.select(e.element.get(0)).append("svg"),this.selectionManager=new r({hostServices:e.host});var a=e.style;this.colours=a&&a.colorPalette?a.colorPalette.dataColors:new t.DataColorPalette,this.root.classed(i.ClassName,!0),this.main=this.root.append("g"),this.links=this.main.append("g").classed(i.Links.class,!0),this.nodes=this.main.append("g").classed(i.Nodes.class,!0)},i.prototype.update=function(e){if(e&&e.dataViews){var t,i=e.dataViews[0];this.updateViewport(e.viewport),t=this.converter(i),this.computePositions(t),this.dataView=t,this.render(t)}},i.prototype.updateViewport=function(e){var t,i;t=this.getPositiveNumber(e.height),i=this.getPositiveNumber(e.width),this.viewport={height:this.getPositiveNumber(t-this.margin.top-this.margin.bottom),width:this.getPositiveNumber(i-this.margin.left-this.margin.right)},this.updateElements(t,i)},i.prototype.getPositiveNumber=function(e){return e<0||isNaN(e)||null===e||e===1/0||e===-(1/0)?0:e},i.prototype.updateElements=function(e,i){this.root.attr({height:e,width:i}),this.main.attr("transform",t.SVGUtil.translate(this.margin.left,this.margin.top))},i.prototype.converter=function(a){var r=this;if(!(a&&a.categorical&&a.categorical.categories&&a.categorical.categories[0]&&a.categorical.categories[1]&&a.categorical.categories[0].values&&a.categorical.categories[1].values))return{nodes:[],links:[],columns:[],settings:{scale:{x:1,y:1},colourOfLabels:i.DefaultSettings.colourOfLabels,fontSize:i.DefaultSettings.fontSize}};var o,n,l,c,u,h,p,d=[],g=[],m=[],f=a.categorical.categories[0].values,y=a.categorical.categories[1].values,v=a.categorical.values&&a.categorical.values[0],x=[],b="g",S=a.categorical.categories[0].objects||[],w=[];return v&&v.values&&v.values.map&&(x=v.values.map(function(e){return e?e:0})),a.categorical.categories[0].identity&&(w=w.concat(a.categorical.categories[0].identity)),a.categorical.categories[1].identity&&(w=w.concat(a.categorical.categories[1].identity)),c=this.getObjectsFromDataView(a),u=this.getColour(i.Properties.labels.fill,i.DefaultSettings.colourOfLabels,c),v&&v.source&&(b=s.getFormatString(v.source,i.Properties.general.formatString)),m=f.map(function(e,t){return{source:e,destination:y[t],weigth:v?Math.max(x[t]||0,0):1}}),o=f.concat(y),n=s.create({format:s.getFormatString(a.categorical.categories[0].source,i.Properties.general.formatString),value:o[0],value2:o[o.length-1]}),l=s.create({format:b,value:Math.max(d3.max(x)||1,1)}),o.forEach(function(a,s){if(!d.some(function(e){return a===e.label.name&&(e.selectionIds.push(t.SelectionId.createWithId(w[s])),!0)})){var o,l,c=n.format(a),h={text:c,fontFamily:r.textProperties.fontFamily,fontSize:r.textProperties.fontSize};o={name:a,formattedName:n.format(a),width:e.TextMeasurementService.measureSvgTextWidth(h),height:e.TextMeasurementService.estimateSvgTextHeight(h),colour:u},l=t.SelectionId.createWithId(w[s]),d.push({label:o,links:[],inputWeight:0,outputWeight:0,width:r.nodeWidth,height:0,colour:i.DefaultColourOfNode,tooltipData:[],selectionIds:[l]})}}),p=this.colours.getAllColors().length/d.length,d.forEach(function(e,t){e.colour=r.colours.getColorByIndex(Math.floor(t*p)).value}),m.forEach(function(e,a){var s,o,n,c;e.source!==e.destination&&(d.forEach(function(t){t.label.name===e.source&&(s=t),t.label.name===e.destination&&(o=t)}),c=r.getColour(i.Properties.links.fill,i.DefaultColourOfLink,S[a]),n={source:s,destination:o,weigth:e.weigth,height:e.weigth,colour:c,tooltipData:r.getTooltipDataForLink(l,s.label.formattedName,o.label.formattedName,e.weigth),selectionId:t.SelectionId.createWithId(w[a])},g.push(n),s.links.push(n),o.links.push(n),r.updateValueOfNode(s),r.updateValueOfNode(o),s.tooltipData=r.getTooltipForNode(l,s.label.formattedName,s.inputWeight?s.inputWeight:s.outputWeight),o.tooltipData=r.getTooltipForNode(l,o.label.formattedName,o.inputWeight?o.inputWeight:o.outputWeight))}),h=this.parseSettings(c),h.colourOfLabels=u,{nodes:d,links:g,settings:h,columns:[]}},i.prototype.getObjectsFromDataView=function(e){return e&&e.metadata&&e.metadata.columns&&e.metadata.objects?e.metadata.objects:null},i.prototype.getColour=function(e,i,a){var r;return r=new t.ColorHelper(this.colours,e,i),r.getColorForMeasure(a,"")},i.prototype.getTooltipDataForLink=function(e,t,a,r){var s;return s=e&&e.format?e.format(r):r.toString(),[{displayName:i.RoleNames.rows,value:t},{displayName:i.RoleNames.columns,value:a},{displayName:i.RoleNames.values,value:s}]},i.prototype.updateValueOfNode=function(e){e.inputWeight=e.links.reduce(function(t,i){return t+(i.destination===e?i.weigth:0)},0),e.outputWeight=e.links.reduce(function(t,i){return t+(i.source===e?i.weigth:0)},0)},i.prototype.getTooltipForNode=function(e,t,a){var r;return r=e&&e.format?e.format(a):a.toString(),[{displayName:"Name",value:t},{displayName:i.RoleNames.values,value:r}]},i.prototype.parseSettings=function(t){var a=!1;return a=e.DataViewObjects.getValue(t,i.Properties.labels.show,i.DefaultSettings.isVisibleLabels),{isVisibleLabels:a,scale:{x:i.DefaultSettings.scale.x,y:i.DefaultSettings.scale.y},colourOfLabels:i.DefaultSettings.colourOfLabels,fontSize:e.DataViewObjects.getValue(t,i.Properties.labels.fontSize,i.DefaultSettings.fontSize)}},i.prototype.computePositions=function(e){var t,i,a;t=this.computeXPositions(e),this.sortNodesByX(e.nodes),a=this.getColumns(e.nodes),i=this.getMaxColumn(a),e.settings.scale.x=this.getScaleByAxisX(t),e.settings.scale.y=this.getScaleByAxisY(i.sumValueOfNodes),this.scalePositionsByAxes(e.nodes,a,e.settings.scale,this.viewport.height),this.computeYPosition(e.nodes,e.settings.scale.y)},i.prototype.computeXPositions=function(e){for(var t=e.nodes,i=[],a=[],r=0,s=!1;t.length>0;)i=[],t.forEach(function(e){e.x=r,e.links.forEach(function(t){e===t.source&&e!==t.destination&&i.every(function(e){return e!==t.destination})&&i.push(t.destination)})}),s=i.length===a.length&&a.every(function(e){return i.some(function(t){return t===e})}),s?(a.forEach(function(e){e.x=r,r++}),t=[]):(t=i,a=t,r++);return r-1},i.prototype.getScaleByAxisX=function(e){return void 0===e&&(e=1),this.getPositiveNumber((this.viewport.width-this.nodeWidth)/e)},i.prototype.sortNodesByX=function(e){return e.sort(function(e,t){return e.x-t.x})},i.prototype.getColumns=function(e){var t=[],i=-Number.MAX_VALUE;return e.forEach(function(e,a){i!==e.x&&(t.push({countOfNodes:0,sumValueOfNodes:0}),i=e.x),t[e.x]&&(t[e.x].sumValueOfNodes+=Math.max(e.inputWeight,e.outputWeight),t[e.x].countOfNodes++)}),t},i.prototype.getMaxColumn=function(e){void 0===e&&(e=[]);var t={sumValueOfNodes:0,countOfNodes:0};return e.forEach(function(e){e&&e.sumValueOfNodes>t.sumValueOfNodes&&(t=e)}),t},i.prototype.getScaleByAxisY=function(e){return this.getPositiveNumber((this.viewport.height-this.getAvailableSumNodeMarginByY())/e)},i.prototype.getAvailableSumNodeMarginByY=function(){return this.viewport?this.viewport.height*i.NodeBottomMargin/100:0},i.prototype.scalePositionsByAxes=function(e,t,i,a){var r=0,s=0,o=0;e.forEach(function(e){var n=0,l=0;s!==e.x&&(s=e.x,r=0,o=0),t[s]&&(l=a-t[s].sumValueOfNodes*i.y,n=l/t[s].countOfNodes),e.x*=i.x,e.height=Math.max(e.inputWeight,e.outputWeight)*i.y,e.y=r+n*o,r+=e.height,o++})},i.prototype.computeYPosition=function(e,t){e.forEach(function(e){e.links=e.links.sort(function(t,i){var a,r;return a=t.source===e?t.destination.y:t.source.y,r=i.source===e?i.destination.y:i.source.y,a-r});var i=0,a=0;e.links.forEach(function(r){var s=0;r.height=r.weigth*t,r.source.x<e.x||r.destination.x<e.x?(s=i,i+=r.height):(r.source.x>e.x||r.destination.x>e.x)&&(s=a,a+=r.height),r.source===e?r.dySource=s:r.destination===e&&(r.dyDestination=s)})})},i.prototype.render=function(e){var t,i;i=this.renderLinks(e),this.renderTooltip(i),t=this.renderNodes(e),this.renderTooltip(t),this.bindSelectionHandler(e,t,i)},i.prototype.renderNodes=function(a){var r,s,o,n=this;return o=this.main.select(i.Nodes.selector).selectAll(i.Node.selector),s=o.data(a.nodes.filter(function(e){return e.height>0})),r=s.enter().append("g"),s.attr("transform",function(e){return t.SVGUtil.translate(e.x,e.y)}).classed(i.Node.class,!0),r.append("rect").classed(i.NodeRect.class,!0),
r.append("text").classed(i.NodeLabel.class,!0),s.select(i.NodeRect.selector).style({fill:function(e){return e.colour},stroke:function(e){return d3.rgb(e.colour).darker(1.5)}}).attr({x:0,y:0,height:function(e){return e.height},width:function(e){return e.width}}),s.select(i.NodeLabel.selector).attr({x:function(e){return n.getLabelPositionByAxisX(e)},y:function(e){return e.height/2},dy:"0.35em"}).style("fill",function(e){return e.label.colour}).style("font-size",this.textProperties.fontSize).style("display",function(e){var t=!1,r=n.getCurrentPositionOfLabelByAxisX(e);return t=r>=n.viewport.width||r<=0||e.height+i.NodeMargin<e.label.height,t||!a.settings.isVisibleLabels||a.settings.scale.x/2<i.MinWidthOfLabel?"none":null}).style("text-anchor",function(e){return n.isLabelLargerThanWidth(e)?"end":null}).text(function(t){var r=a.settings.scale.x/2-t.width-i.NodeMargin;return n.getCurrentPositionOfLabelByAxisX(t)>r?e.TextMeasurementService.getTailoredTextOrDefault({text:t.label.formattedName,fontFamily:n.textProperties.fontFamily,fontSize:n.textProperties.fontSize},r):t.label.formattedName}),s.exit().remove(),s},i.prototype.getLabelPositionByAxisX=function(e){return this.isLabelLargerThanWidth(e)?-i.LabelMargin:e.width+i.LabelMargin},i.prototype.isLabelLargerThanWidth=function(e){var t=e.x+e.width+i.LabelMargin;return t+e.label.width>this.viewport.width},i.prototype.getCurrentPositionOfLabelByAxisX=function(e){var t=this.getLabelPositionByAxisX(e);return t=t>0?t+e.x+e.label.width+e.width:e.x+t-e.label.width-e.width},i.prototype.renderLinks=function(e){var t,a,r=this;return a=this.main.select(i.Links.selector).selectAll(i.Link.selector),t=a.data(e.links.filter(function(e){return e.height>0})),t.enter().append("path").classed(i.Link.class,!0),t.attr("d",function(e){return r.getSvgPath(e)}).style({"stroke-width":function(e){return e.height},stroke:function(e){return e.colour}}),t.exit().remove(),t},i.prototype.getSvgPath=function(e){var t,i,a,r,s,o,n;return e.destination.x<e.source.x?(t=e.source.x,i=e.destination.x+e.destination.width):(t=e.source.x+e.source.width,i=e.destination.x),a=d3.interpolateNumber(t,i),r=a(this.curvatureOfLinks),s=a(1-this.curvatureOfLinks),o=e.source.y+e.dySource+e.height/2,n=e.destination.y+e.dyDestination+e.height/2,"M "+t+" "+o+" C "+r+" "+o+", "+s+" "+n+", "+i+" "+n},i.prototype.renderTooltip=function(e){t.TooltipManager.addTooltip(e,function(e){return e.data.tooltipData})},i.prototype.bindSelectionHandler=function(e,t,i){var a=this;t.on("click",function(e){var r=_.isEqual(e.selectionIds.map(function(e){return e.getKey()}),a.selectionManager.getSelectionIds().map(function(e){return e.getKey()}))?[]:e.selectionIds;a.selectMany(r,!0).then(function(){return a.setSelection(t,i)}),d3.event.stopPropagation()}),i.on("click",function(e){a.selectionManager.select(e.selectionId,d3.event.ctrlKey).then(function(){return a.setSelection(t,i)}),d3.event.stopPropagation()}),this.root.on("click",function(){a.selectionManager.clear().then(function(){return a.setSelection(t,i)})}),this.setSelection(t,i)},i.prototype.selectMany=function(e,t){var i=this;if(void 0===t&&(t=!1),t)return this.selectionManager.clear().then(function(){return i.selectMany(e,!1)});var a=e.map(function(e){return i.selectionManager.select(e,!0)});return $.when.apply(null,a)},i.prototype.setSelection=function(e,t){var i=this.selectionManager.getSelectionIds();if(e.classed("selected",i.length>0),t.classed("selected",!1),0!==i.length){var a=e.filter(function(e){return i.some(function(t){return e.selectionIds.some(function(e){return e.getKey()===t.getKey()})})}),r=t.filter(function(e){return i.some(function(t){return t.getKey()===e.selectionId.getKey()})});a.classed("selected",!1),r.classed("selected",!0)}},i.prototype.enumerateObjectInstances=function(e){var i=new t.ObjectEnumerationBuilder;if(!this.dataView)return[];switch(e.objectName){case"labels":this.enumerateLabels(i);break;case"links":this.enumerateLinks(i)}return i.complete()},i.prototype.enumerateLabels=function(e){var t,i=this.dataView.settings;i&&(t={objectName:"labels",displayName:"labels",selector:null,properties:{show:i.isVisibleLabels,fill:i.colourOfLabels,fontSize:i.fontSize}},e.pushInstance(t))},i.prototype.enumerateLinks=function(e){var i=this.dataView.links;i&&i.length>0&&i.forEach(function(i){e.pushInstance({objectName:"links",displayName:i.source.label.formattedName+" - "+i.destination.label.formattedName,selector:t.ColorHelper.normalizeSelector(i.selectionId.getSelector(),!1),properties:{fill:{solid:{color:i.colour}}}})})},i.ClassName="sankeyDiagram",i.Nodes={class:"nodes",selector:".nodes"},i.Node={class:"node",selector:".node"},i.NodeRect={class:"nodeRect",selector:".nodeRect"},i.NodeLabel={class:"nodeLabel",selector:".nodeLabel"},i.Links={class:"links",selector:".links"},i.Link={class:"link",selector:".link"},i.DefaultColourOfNode="rgb(62, 187, 162)",i.DefaultColourOfLink="black",i.DefaultSettings={isVisibleLabels:!0,scale:{x:1,y:1},colourOfLabels:"black",fontSize:12},i.MinWidthOfLabel=35,i.NodeBottomMargin=5,i.NodeMargin=5,i.LabelMargin=4,i.RoleNames={rows:"Source",columns:"Destination",values:"Weight"},i.capabilities={dataRoles:[{name:i.RoleNames.rows,kind:e.VisualDataRoleKind.Grouping,displayName:i.RoleNames.rows},{name:i.RoleNames.columns,kind:e.VisualDataRoleKind.Grouping,displayName:i.RoleNames.columns},{name:i.RoleNames.values,kind:e.VisualDataRoleKind.Measure,displayName:i.RoleNames.values}],dataViewMappings:[{conditions:[{Source:{min:0,max:1},Destination:{min:0,max:1},Weight:{min:0,max:0}},{Source:{min:0,max:1},Destination:{min:0,max:1},Weight:{min:1,max:1}}],categorical:{categories:{select:[{for:{in:i.RoleNames.rows}},{for:{in:i.RoleNames.columns}}],dataReductionAlgorithm:{top:{}}},values:{for:{in:i.RoleNames.values}}}}],objects:{general:{displayName:e.data.createDisplayNameGetter("Visual_General"),properties:{formatString:{type:{formatting:{formatString:!0}}}}},labels:{displayName:e.data.createDisplayNameGetter("Visual_DataPointsLabels"),properties:{show:{displayName:e.data.createDisplayNameGetter("Visual_Show"),type:{bool:!0}},fill:{displayName:e.data.createDisplayNameGetter("Visual_Fill"),type:{fill:{solid:{color:!0}}}},fontSize:{displayName:e.data.createDisplayNameGetter("Visual_TextSize"),type:{formatting:{fontSize:!0}}}}},links:{displayName:"Links",properties:{fill:{displayName:e.data.createDisplayNameGetter("Visual_Fill"),type:{fill:{solid:{color:!0}}}}}}}},i.Properties=i.getProperties(i.capabilities),i}();i.SankeyDiagram=n}(i=t.samples||(t.samples={}))}(t=e.visuals||(e.visuals={}))}(i||(i={}))},function(e,t){var i,a=window.jsCommon,i=window.powerbi;window.powerbitests,window.InJs,window.debug,window.jasmine,window.Microsoft;!function(e){var t;!function(t){var i;!function(t){var i=a.PixelConverter,r=e.createEnumType,s=e.VisualDataRoleKind,o=e.DataViewObjects,n=e.TextMeasurementService,l=e.visuals.TooltipManager,c=e.visuals.appendClearCatcher,u=e.visuals.createInteractivityService,h=e.visuals.valueFormatter,p=e.visuals.TooltipBuilder,d=e.visuals.ObjectEnumerationBuilder,g=e.visuals.converterHelper,m=e.visuals.SelectionIdBuilder,f=e.visuals.AxisHelper,y=e.visuals.axisScale;!function(e){e[e.HorizontalLeft="Horizontal Left"]="HorizontalLeft",e[e.HorizontalRight="Horizontal Right"]="HorizontalRight",e[e.VerticalTop="Vertical Top"]="VerticalTop",e[e.VerticalBottom="Vertical Bottom"]="VerticalBottom"}(t.BulletChartOrientation||(t.BulletChartOrientation={}));var v=t.BulletChartOrientation,x=function(){function e(e,t){this.defaultViewport=e||{width:0,height:0},this.defaultMargin=t||{top:0,bottom:0,right:0,left:0}}return Object.defineProperty(e.prototype,"viewport",{get:function(){return this.viewportValue||(this.viewportValue=this.defaultViewport)},set:function(t){var i=this;this.previousOriginalViewportValue=_.clone(this.originalViewportValue),this.originalViewportValue=_.clone(t),this.setUpdateObject(t,function(e){return i.viewportValue=e},function(t){return e.restrictToMinMax(t,i.minViewport)})},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"viewportCopy",{get:function(){return _.clone(this.viewport)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"viewportIn",{get:function(){return this.viewportInValue||this.viewport},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"minViewport",{get:function(){return this.minViewportValue||{width:0,height:0}},set:function(t){var i=this;this.setUpdateObject(t,function(e){return i.minViewportValue=e},e.restrictToMinMax)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"margin",{get:function(){return this.marginValue||(this.marginValue=this.defaultMargin)},set:function(t){var i=this;this.setUpdateObject(t,function(e){return i.marginValue=e},e.restrictToMinMax)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"viewportChanged",{get:function(){return!(!this.originalViewportValue||this.previousOriginalViewportValue&&this.previousOriginalViewportValue.height===this.originalViewportValue.height&&this.previousOriginalViewportValue.width===this.originalViewportValue.width)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"viewportInIsZero",{get:function(){return 0===this.viewportIn.width||0===this.viewportIn.height},enumerable:!0,configurable:!0}),e.prototype.resetMargin=function(){this.margin=this.defaultMargin},e.prototype.update=function(){this.viewportInValue=e.restrictToMinMax({width:this.viewport.width-(this.margin.left+this.margin.right),height:this.viewport.height-(this.margin.top+this.margin.bottom)},this.minViewportValue)},e.prototype.setUpdateObject=function(t,i,a){var r=this;t=_.clone(t),i(e.createNotifyChangedObject(t,function(e){a&&a(t),r.update()})),a&&a(t),this.update()},e.createNotifyChangedObject=function(e,t){var i={};return _.keys(e).forEach(function(a){return Object.defineProperty(i,a,{get:function(){return e[a]},set:function(i){e[a]=i,t(e,a)},enumerable:!0,configurable:!0})}),i},e.restrictToMinMax=function(e,t){return _.keys(e).forEach(function(i){return e[i]=Math.max(t&&t[i]||0,e[i])}),e},e}(),b=function(){function e(){this.values={targetValue:null,targetValue2:null,minimumPercent:0,needsImprovementPercent:null,satisfactoryPercent:null,goodPercent:null,veryGoodPercent:null,maximumPercent:null},this.labels={show:!0,labelColor:"Black",fontSize:11},this.orientation={orientation:v.HorizontalLeft},this.colors={minColor:"Darkred",needsImprovementColor:"Red",satisfactoryColor:"Yellow",goodColor:"Green",veryGoodColor:"Darkgreen",bulletColor:"Black"},this.axis={axis:!0,axisColor:"Grey",measureUnits:"",unitsColor:"Grey"}}return Object.defineProperty(e,"Default",{get:function(){return new this},enumerable:!0,configurable:!0}),e.parse=function(e,t){var i=new this;if(!e||!e.metadata||!e.metadata.objects)return i;var a=this.getProperties(t);for(var r in t.objects)for(var s in t.objects[r].properties)if(i[r]&&_.has(i[r],s)){var o=t.objects[r].properties[s].type,n=this.getValueFnByType(o);i[r][s]=n(e.metadata.objects,a[r][s],i[r][s])}return i},e.getProperties=function(e){var t=_.merge({general:{properties:{formatString:{}}}},e.objects),i={};for(var a in t){i[a]={};for(var r in t[a].properties)i[a][r]={objectName:a,propertyName:r}}return i},e.createEnumTypeFromEnum=function(e){var t=!1;return r(Object.keys(e).filter(function(i,a){return!!(a%2)===t&&e[i]===i&&!void(t=!t)||!!(a%2)!==t}).map(function(e){return{value:e,displayName:e}}))},e.getValueFnByType=function(e){switch(_.keys(e)[0]){case"fill":return o.getFillColor;default:return o.getValue}},e.enumerateObjectInstances=function(e,t,i){void 0===e&&(e=new this);var a=new d,r=e&&e[t.objectName];if(!r)return a;var s={objectName:t.objectName,selector:null,properties:{}};for(var o in r)_.has(r,o)&&(s.properties[o]=r[o]);return a.pushInstance(s),a},e.prototype.createOriginalSettings=function(){this.originalSettings=_.cloneDeep(this)},e}();t.BulletChartSettings=b;var S=function(){function e(){this.Category=null,this.Value=null,this.TargetValue=null,this.Minimum=null,this.NeedsImprovement=null,this.Satisfactory=null,this.Good=null,this.VeryGood=null,this.Maximum=null,this.TargetValue2=null}return e.getColumnSources=function(e){return this.getColumnSourcesT(e)},e.getTableValues=function(e){var t=e&&e.table,i=this.getColumnSourcesT(e);return i&&t&&_.mapValues(i,function(e,i){return e&&t.rows.map(function(t){return t[e.index]})})},e.getTableRows=function(e){var t=e&&e.table,i=this.getColumnSourcesT(e);return i&&t&&t.rows.map(function(e){return _.mapValues(i,function(t,i){return t&&e[t.index]})})},e.getCategoricalValues=function(e){var t=e&&e.categorical,i=t&&t.categories||[],a=t&&t.values||[],r=t&&a.source&&this.getSeriesValues(e);return t&&_.mapValues(new this,function(e,t){return _.toArray(i).concat(_.toArray(a)).filter(function(e){return e.source.roles&&e.source.roles[t]}).map(function(e){return e.values})[0]||a.source&&a.source.roles&&a.source.roles[t]&&r})},e.getSeriesValues=function(e){return e&&e.categorical&&e.categorical.values&&e.categorical.values.map(function(e){return g.getSeriesName(e.source)})},e.getCategoricalColumns=function(e){var t=e&&e.categorical,i=t&&t.categories||[],a=t&&t.values||[];return t&&_.mapValues(new this,function(e,t){return i.filter(function(e){return e.source.roles&&e.source.roles[t]})[0]||a.source&&a.source.roles&&a.source.roles[t]&&a||a.filter(function(e){return e.source.roles&&e.source.roles[t]})})},e.getGroupedValueColumns=function(e){var t=this,i=e&&e.categorical,a=i&&i.values,r=a&&a.grouped();return r&&r.map(function(e){return _.mapValues(new t,function(t,i){return e.values.filter(function(e){return e.source.roles[i]})[0]})})},e.getColumnSourcesT=function(e){var t=e&&e.metadata&&e.metadata.columns;return t&&_.mapValues(new this,function(e,i){return t.filter(function(e){return e.roles&&e.roles[i]})[0]})},e.Roles=Object.freeze(_.mapValues(new e,function(e,t){return t})),e}();t.BulletChartColumns=S;var w=function(){function e(){this.baselineDelta=0}return Object.defineProperty(e.prototype,"settings",{get:function(){return this.data&&this.data.settings},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"reverse",{get:function(){switch(this.settings&&this.settings.orientation.orientation){case v.HorizontalRight:case v.VerticalBottom:return!0;default:return!1}},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"vertical",{get:function(){switch(this.settings&&this.settings.orientation.orientation){case v.VerticalTop:case v.VerticalBottom:return!0;default:return!1}},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"viewportScroll",{get:function(){return{width:Math.max(0,this.layout.viewportIn.width-e.ScrollBarSize),height:Math.max(0,this.layout.viewportIn.height-e.ScrollBarSize)}},enumerable:!0,configurable:!0}),e.getTextProperties=function(t,a){return{fontFamily:e.FontFamily,fontSize:i.fromPoint(a),text:t}},e.converter=function(t,a){var r=S.getCategoricalColumns(t);if(!r||!r.Category||_.isEmpty(r.Category.values)||!r.Value||!r.Value[0])return null;var s=S.getCategoricalValues(t),o=e.parseSettings(t),l=b.getProperties(e.capabilities),c={settings:o,bars:[],barRects:[],valueRects:[],targetValues:[],viewportLength:0},u=o.orientation.orientation===v.VerticalBottom||o.orientation.orientation===v.VerticalTop,p=o.orientation.orientation===v.HorizontalRight||o.orientation.orientation===v.VerticalBottom;c.labelHeight=(o.labels.show||0)&&parseFloat(i.fromPoint(o.labels.fontSize)),c.labelHeightTop=(o.labels.show||0)&&parseFloat(i.fromPoint(o.labels.fontSize))/1.4,c.spaceRequiredForBarHorizontally=Math.max(60,c.labelHeight+20),c.viewportLength=Math.max(0,(u?a.viewport.height-c.labelHeightTop-e.SubtitleMargin-20-2*e.YMarginVertical:a.viewport.width-e.MaxLabelWidth-e.XMarginHorizontalLeft-e.XMarginHorizontalRight)-e.ScrollBarSize),c.hasHighlights=!!(t.categorical.values.length>0&&t.categorical.values[0].highlights);for(var d=h.getFormatString(r.Value[0].source,l.general.formatString),g=h.getFormatString(r.Category.source,l.general.formatString),x=function(t,i){var a=h.format(s.Category[t],g);a=n.getTailoredTextOrDefault(e.getTextProperties(a,o.labels.fontSize),e.MaxLabelWidth);var v=[],x=s.Value[t]||0;v.push({value:x,metadata:r.Value[0]});var b=s.TargetValue?s.TargetValue[t]:o.values.targetValue;_.isNumber(b)&&v.push({value:b,metadata:r.TargetValue[0]});var S=s.TargetValue2?s.TargetValue2[t]:o.values.targetValue2;_.isNumber(S)&&v.push({value:S,metadata:r.TargetValue2[0]});var w=function(e,i){return e?e[t]:_.isNumber(b)&&_.isNumber(i)?i*b/100:null},C=w(s.Minimum,o.values.minimumPercent),P=w(s.NeedsImprovement,o.values.needsImprovementPercent),A=w(s.Satisfactory,o.values.satisfactoryPercent),T=w(s.Good,o.values.goodPercent),D=w(s.VeryGood,o.values.veryGoodPercent),V=w(s.Maximum,o.values.maximumPercent),N=[P,A,T,D].some(_.isNumber);C=_.isNumber(C)?Math.max(C,0):0,P=_.isNumber(P)?Math.max(C,P):P,A=_.isNumber(A)?Math.max(A,P):A,T=_.isNumber(T)?Math.max(T,A):T,D=_.isNumber(D)?Math.max(D,T):D;var L=_.max([C,P,A,T,D,x,b,S].filter(_.isNumber));V=_.isNumber(V)?Math.max(V,L):L,D=_.isNumber(D)?D:V,T=_.isNumber(T)?T:D,A=_.isNumber(A)?A:T,P=_.isNumber(P)?P:A;var M=d3.scale.linear().clamp(!0).domain([C,V]).range(u?[c.viewportLength,0]:[0,c.viewportLength]),k=M(C),I=M(P),O=M(A),F=M(T),z=M(D),j=M(V),G=M(x),R=o.colors.minColor,B=o.colors.needsImprovementColor,H=o.colors.satisfactoryColor,E=o.colors.goodColor,W=o.colors.veryGoodColor,U=r.Value[0].highlights&&null!==r.Value[0].highlights[t];N&&(e.addItemToBarArray(c.barRects,t,k,I,R,l.general.formatString,v,r.Category,t,U),e.addItemToBarArray(c.barRects,t,I,O,B,l.general.formatString,v,r.Category,t,U),e.addItemToBarArray(c.barRects,t,O,F,H,l.general.formatString,v,r.Category,t,U),e.addItemToBarArray(c.barRects,t,F,z,E,l.general.formatString,v,r.Category,t,U),e.addItemToBarArray(c.barRects,t,z,j,W,l.general.formatString,v,r.Category,t,U)),e.addItemToBarArray(c.valueRects,t,k,G,o.colors.bulletColor,l.general.formatString,v,r.Category,t,U),c.targetValues.push({barIndex:t,value:b&&M(b),fill:o.colors.bulletColor,key:m.builder().withCategory(r.Category,t).withMeasure(M(b||0).toString()).createSelectionId().getKey(),value2:S&&M(S)});var Y=null;o.axis.axis&&(Y=f.createAxis({pixelSpan:c.viewportLength,dataDomain:M.domain(),metaDataColumn:r.Value[0].source,formatString:d,outerPadding:0,isScalar:!0,isVertical:u,isCategoryAxis:!1,scaleType:y.linear}));var X={scale:M,barIndex:t,categoryLabel:a,x:u?e.XMarginVertical+e.SpaceRequiredForBarVertically*t:p?e.XMarginHorizontalRight:e.XMarginHorizontalLeft,y:u?e.YMarginVertical:e.YMarginHorizontal+c.spaceRequiredForBarHorizontally*t,xAxisProperties:Y,key:m.builder().withCategory(r.Category,t).createSelectionId().getKey()};c.bars.push(X)},w=0,C=s.Category.length;w<C;w++)x(w,C);return c},e.parseSettings=function(t){var i=b.parse(t,e.capabilities);i.values.minimumPercent=Math.max(i.values.minimumPercent,0);var a=i.values.minimumPercent;return i.values.needsImprovementPercent=_.isNumber(i.values.needsImprovementPercent)?a=Math.max(a,i.values.needsImprovementPercent):i.values.needsImprovementPercent,i.values.satisfactoryPercent=_.isNumber(i.values.satisfactoryPercent)?a=Math.max(a,i.values.satisfactoryPercent):i.values.satisfactoryPercent,i.values.goodPercent=_.isNumber(i.values.goodPercent)?a=Math.max(a,i.values.goodPercent):i.values.goodPercent,i.values.veryGoodPercent=_.isNumber(i.values.veryGoodPercent)?a=Math.max(a,i.values.veryGoodPercent):i.values.veryGoodPercent,i.values.maximumPercent=_.isNumber(i.values.maximumPercent)?a=Math.max(a,i.values.maximumPercent,100):i.values.maximumPercent,i.createOriginalSettings(),i.axis.measureUnits=n.getTailoredTextOrDefault(e.getTextProperties(i.axis.measureUnits,e.DefaultSubtitleFontSizeInPt),e.MaxLabelWidth),i},e.addItemToBarArray=function(e,t,i,a,r,s,o,n,l,c){isNaN(i)||isNaN(a)||e.push({barIndex:t,start:i,end:a,fill:r,tooltipInfo:p.createTooltipInfo(s,null,null,null,null,o),selected:!1,identity:m.builder().withCategory(n,l).createSelectionId(),key:m.builder().withCategory(n,l).withMeasure(i+" "+a).createSelectionId().getKey(),highlight:c})},e.prototype.init=function(e){var t=d3.select(e.element.get(0));this.layout=new x(e.viewport),this.hostService=e.host,this.bulletBody=t.append("div").classed("bulletChart",!0).attr("drag-resize-disabled",!0),this.scrollContainer=this.bulletBody.append("svg").classed("bullet-scroll-region",!0),this.clearCatcher=c(this.scrollContainer),this.labelGraphicsContext=this.scrollContainer.append("g"),this.bulletGraphicsContext=this.scrollContainer.append("g"),this.behavior=new P,this.interactivityService=u(e.host)},e.prototype.update=function(t){if(t.dataViews&&t.dataViews[0]){var i=t.dataViews[0];this.layout.viewport=t.viewport;var a=e.converter(i,t);this.ClearViewport(),a&&(this.data=a,this.baselineDelta=C.estimateSvgTextBaselineDelta(e.getTextProperties("1",this.data.settings.labels.fontSize)),this.interactivityService&&this.interactivityService.applySelectionStateToData(this.data.barRects),this.bulletBody.style({height:this.layout.viewportIn.height+"px",width:this.layout.viewportIn.width+"px"}),this.vertical?this.scrollContainer.attr({width:this.data.bars.length*e.SpaceRequiredForBarVertically+e.XMarginVertical+"px",height:this.viewportScroll.height+"px"}):this.scrollContainer.attr({height:this.data.bars.length*(this.data.spaceRequiredForBarHorizontally||0)+"px",width:this.viewportScroll.width+"px"}),this.vertical?this.setUpBulletsVertically(this.bulletBody,this.data,this.reverse):this.setUpBulletsHorizontally(this.bulletBody,this.data,this.reverse),this.behavior.renderSelection(this.interactivityService.hasSelection()))}},e.prototype.ClearViewport=function(){this.labelGraphicsContext.selectAll("text").remove(),this.bulletGraphicsContext.selectAll("rect").remove(),this.bulletGraphicsContext.selectAll("text").remove(),this.bulletGraphicsContext.selectAll("axis").remove(),this.bulletGraphicsContext.selectAll("path").remove(),this.bulletGraphicsContext.selectAll("line").remove(),this.bulletGraphicsContext.selectAll("tick").remove(),this.bulletGraphicsContext.selectAll("g").remove()},e.prototype.onClearSelection=function(){this.interactivityService&&this.interactivityService.clearSelection()},e.prototype.calculateLabelWidth=function(t,i,a){return(a?e.XMarginHorizontalRight:t.x+e.MaxLabelWidth+e.XMarginHorizontalLeft)+(i?i.start:0)},e.prototype.calculateLabelHeight=function(t,i,a){return e.YMarginVertical+(a?5:t.y+this.data.labelHeightTop+e.BarMargin+e.SubtitleMargin)+(i?i.end:0)},e.prototype.setUpBulletsHorizontally=function(t,a,r){var s=this,o=a.bars,c=a.barRects,u=a.valueRects,h=a.targetValues,p=this.labelGraphicsContext.selectAll("text").data(o,function(e){return e.key}),d=this.bulletGraphicsContext.selectAll("rect.range").data(c,function(e){return e.key}),g=d.enter().append("rect").attr({x:function(e){return Math.max(0,s.calculateLabelWidth(o[e.barIndex],e,r))},y:function(t){return Math.max(0,o[t.barIndex].y-e.BulletSize/2)},width:function(e){return Math.max(0,e.end-e.start)},height:e.BulletSize}).classed("range",!0).style({fill:function(e){return e.fill}});d.exit();var m=this.bulletGraphicsContext.selectAll("rect.value").data(u,function(e){return e.key});if(m.enter().append("rect").attr({x:function(e){return Math.max(0,s.calculateLabelWidth(o[e.barIndex],e,r))},y:function(t){return Math.max(0,o[t.barIndex].y-e.BulletSize/8)},width:function(e){return Math.max(0,e.end-e.start)},height:1*e.BulletSize/4}).classed("value",!0).style({fill:function(e){return e.fill}}),m.exit(),this.drawFirstTargets(h,function(e){return s.calculateLabelWidth(o[e.barIndex],null,r)+e.value},function(e){return s.calculateLabelWidth(o[e.barIndex],null,r)+e.value},function(t){return o[t.barIndex].y-e.MarkerMarginHorizontal},function(t){return o[t.barIndex].y+e.MarkerMarginHorizontal}),this.drawSecondTargets(h,function(e){return s.calculateLabelWidth(o[e.barIndex],null,r)+e.value2},function(e){return o[e.barIndex].y}),a.settings.axis.axis)for(var y=function(){var t=o[x],l=v.bulletGraphicsContext.append("g");l.append("g").attr({transform:function(){var i=s.calculateLabelWidth(t,null,r),a=t.y+e.BulletSize/2;return"translate("+i+","+a+")"}}).classed("axis",!0).call(t.xAxisProperties.axis).style({fill:a.settings.axis.axisColor,"font-size":i.fromPoint(e.AxisFontSizeInPt)}).selectAll("line").style({stroke:a.settings.axis.axisColor}),l.selectAll(".tick text").call(f.LabelLayoutStrategy.clip,t.xAxisProperties.xLabelMaxWidth,n.svgEllipsis)},v=this,x=0;x<o.length;x++)y();a.settings.labels.show&&p.enter().append("text").classed("title",!0).attr({x:function(t){return r?e.XMarginHorizontalLeft+e.XMarginHorizontalRight+a.viewportLength:t.x},y:function(e){return e.y+s.baselineDelta},fill:a.settings.labels.labelColor,"font-size":i.fromPoint(a.settings.labels.fontSize)}).text(function(e){return e.categoryLabel});var b=n.getTailoredTextOrDefault(e.getTextProperties(a.settings.axis.measureUnits,e.DefaultSubtitleFontSizeInPt),e.MaxMeasureUnitWidth);if(a.settings.axis.measureUnits&&p.enter().append("text").attr({x:function(t){return r?e.XMarginHorizontalLeft+e.XMarginHorizontalRight+a.viewportLength+e.SubtitleMargin:t.x-e.SubtitleMargin},y:function(e){return e.y+s.data.labelHeight/2+12},fill:a.settings.axis.unitsColor,"font-size":i.fromPoint(e.DefaultSubtitleFontSizeInPt)}).text(b),this.interactivityService){var S={rects:g,valueRects:m,clearCatcher:this.clearCatcher,interactivityService:this.interactivityService,bulletChartSettings:this.data.settings,hasHighlights:this.data.hasHighlights},w=this.data.barRects.concat(this.data.valueRects);this.interactivityService.bind(w,this.behavior,S)}p.exit(),l.addTooltip(m,function(e){return e.data.tooltipInfo},!0),l.addTooltip(d,function(e){return e.data.tooltipInfo},!0)},e.prototype.setUpBulletsVertically=function(t,a,r){var s=this,o=a.bars,c=a.barRects,u=a.valueRects,h=a.targetValues,p=this.labelGraphicsContext.selectAll("text").data(o,function(e){return e.key}),d=this.bulletGraphicsContext.selectAll("rect.range").data(c,function(e){return e.key}),g=d.enter().append("rect").attr({x:function(e){return Math.max(0,o[e.barIndex].x)},y:function(e){return Math.max(0,s.calculateLabelHeight(o[e.barIndex],e,r))},height:function(e){return Math.max(0,e.start-e.end)},width:e.BulletSize}).classed("range",!0).style({fill:function(e){return e.fill}});d.exit();var m=this.bulletGraphicsContext.selectAll("rect.value").data(u,function(e){return e.key});if(m.enter().append("rect").attr({x:function(t){return Math.max(0,o[t.barIndex].x+e.BulletSize/3)},y:function(e){return Math.max(0,s.calculateLabelHeight(o[e.barIndex],e,r))},height:function(e){return Math.max(0,e.start-e.end)},width:1*e.BulletSize/4}).classed("value",!0).style({fill:function(e){return e.fill}}),m.exit(),this.drawFirstTargets(h,function(t){return o[t.barIndex].x+e.MarkerMarginVertical},function(t){return o[t.barIndex].x+3*e.MarkerMarginVertical},function(e){return s.calculateLabelHeight(o[e.barIndex],null,r)+e.value},function(e){return s.calculateLabelHeight(o[e.barIndex],null,r)+e.value}),this.drawSecondTargets(h,function(t){return o[t.barIndex].x+e.BulletSize/3+e.BulletSize/8},function(e){return s.calculateLabelHeight(o[e.barIndex],null,r)+e.value2}),a.settings.axis.axis){for(var y=0;y<o.length;y++){var v=o[y];this.bulletGraphicsContext.append("g").attr({transform:function(){var e=v.x,t=s.calculateLabelHeight(v,null,r);return"translate("+e+","+t+")"}}).classed("axis",!0).call(v.xAxisProperties.axis).style({fill:a.settings.axis.axisColor,"font-size":i.fromPoint(e.AxisFontSizeInPt)}).selectAll("line").style({stroke:a.settings.axis.axisColor})}this.bulletGraphicsContext.selectAll("g.axis > .tick text").call(f.LabelLayoutStrategy.clip,e.XMarginVertical-10,n.svgEllipsis)}var x=e.YMarginVertical+(r?a.viewportLength+15:0)+this.data.labelHeightTop;a.settings.labels.show&&p.enter().append("text").classed("title",!0).attr({x:function(e){return e.x},y:function(e){return x},fill:a.settings.labels.labelColor,"font-size":i.fromPoint(a.settings.labels.fontSize)}).text(function(e){return e.categoryLabel});var b=n.getTailoredTextOrDefault(e.getTextProperties(a.settings.axis.measureUnits,e.DefaultSubtitleFontSizeInPt),e.MaxMeasureUnitWidth);if(a.settings.axis.measureUnits&&p.enter().append("text").attr({x:function(t){return t.x+e.BulletSize},y:function(t){return x+e.SubtitleMargin+12},fill:a.settings.axis.unitsColor,"font-size":i.fromPoint(e.DefaultSubtitleFontSizeInPt)}).text(b),this.interactivityService){var S={rects:g,valueRects:m,clearCatcher:this.clearCatcher,interactivityService:this.interactivityService,bulletChartSettings:this.data.settings,hasHighlights:!1},w=this.data.barRects.concat(this.data.valueRects);this.interactivityService.bind(w,this.behavior,S)}p.exit(),l.addTooltip(m,function(e){return e.data.tooltipInfo},!0),l.addTooltip(d,function(e){return e.data.tooltipInfo},!0)},e.prototype.drawFirstTargets=function(e,t,i,a,r){var s=this.bulletGraphicsContext.selectAll("line.target").data(e.filter(function(e){return _.isNumber(e.value)}));s.enter().append("line").attr({x1:t,x2:i,y1:a,y2:r}).style({stroke:function(e){return e.fill},"stroke-width":2}).classed("target",!0),s.exit().remove()},e.prototype.drawSecondTargets=function(t,i,a){var r=this.bulletGraphicsContext.selectAll("line.target2").data(t.filter(function(e){return _.isNumber(e.value2)})),s=r.enter(),o={stroke:function(e){return e.fill},"stroke-width":2};s.append("line").attr({x1:function(t){return i(t)-e.SecondTargetLineSize},y1:function(t){return a(t)-e.SecondTargetLineSize},x2:function(t){return i(t)+e.SecondTargetLineSize},y2:function(t){return a(t)+e.SecondTargetLineSize}}).style(o).classed("target2",!0),s.append("line").attr({x1:function(t){return i(t)+e.SecondTargetLineSize},y1:function(t){return a(t)-e.SecondTargetLineSize},x2:function(t){return i(t)-e.SecondTargetLineSize},y2:function(t){return a(t)+e.SecondTargetLineSize}}).style(o).classed("target2",!0),r.exit().remove()},e.prototype.destroy=function(){},e.prototype.enumerateObjectInstances=function(t){if(this.settings){var i=b.enumerateObjectInstances(this.settings.originalSettings,t,e.capabilities);return i.complete()}},e.ScrollBarSize=22,e.SpaceRequiredForBarVertically=100,e.XMarginHorizontalLeft=20,e.XMarginHorizontalRight=55,e.YMarginHorizontal=30,e.XMarginVertical=70,e.YMarginVertical=10,e.BulletSize=25,e.DefaultSubtitleFontSizeInPt=9,e.BarMargin=10,e.MaxLabelWidth=80,e.MaxMeasureUnitWidth=e.MaxLabelWidth-20,e.SubtitleMargin=10,e.AxisFontSizeInPt=8,e.SecondTargetLineSize=7,e.MarkerMarginHorizontal=e.BulletSize/3,e.MarkerMarginVertical=e.BulletSize/4,e.FontFamily="Segoe UI",e.capabilities={dataRoles:[{name:"Category",kind:s.Grouping,displayName:"Category"},{name:"Value",kind:s.Measure,displayName:"Value"},{name:"TargetValue",kind:s.Measure,displayName:"Target Value"},{name:"Minimum",kind:s.Measure,displayName:"Minimum"},{name:"NeedsImprovement",kind:s.Measure,displayName:"Needs Improvement"},{name:"Satisfactory",kind:s.Measure,displayName:"Satisfactory"},{name:"Good",kind:s.Measure,displayName:"Good"},{name:"VeryGood",kind:s.Measure,displayName:"Very Good"},{name:"Maximum",kind:s.Measure,displayName:"Maximum"},{name:"TargetValue2",kind:s.Measure,displayName:"Target Value 2"}],objects:{general:{displayName:"General",properties:{formatString:{type:{formatting:{formatString:!0}}}}},values:{displayName:"Data values",properties:{targetValue:{displayName:"Target Value",type:{numeric:!0}},targetValue2:{displayName:"Target Value 2",type:{numeric:!0}},minimumPercent:{displayName:"Minimum %",type:{numeric:!0}},needsImprovementPercent:{displayName:"Needs Improvement %",type:{numeric:!0}},satisfactoryPercent:{displayName:"Satisfactory %",type:{numeric:!0}},goodPercent:{displayName:"Good %",type:{numeric:!0}},veryGoodPercent:{displayName:"Very Good %",type:{numeric:!0}},maximumPercent:{displayName:"Maximum %",type:{numeric:!0}}}},labels:{displayName:"Category labels",properties:{show:{displayName:"Show",type:{
bool:!0}},labelColor:{displayName:"Color",description:"Select color for data labels",type:{fill:{solid:{color:!0}}}},fontSize:{displayName:"Text Size",type:{formatting:{fontSize:!0}}}}},orientation:{displayName:"Orientation",properties:{orientation:{displayName:"Orientation",type:{enumeration:b.createEnumTypeFromEnum(v)}}}},colors:{displayName:"Colors",properties:{minColor:{type:{fill:{solid:{color:!0}}},displayName:"Minimum Color"},needsImprovementColor:{type:{fill:{solid:{color:!0}}},displayName:"Needs Improvement Color"},satisfactoryColor:{type:{fill:{solid:{color:!0}}},displayName:"Satisfactory Color"},goodColor:{type:{fill:{solid:{color:!0}}},displayName:"Good Color"},veryGoodColor:{type:{fill:{solid:{color:!0}}},displayName:"Very Good Color"},bulletColor:{type:{fill:{solid:{color:!0}}},displayName:"Bullet Color"}}},axis:{displayName:"Axis",properties:{axis:{displayName:"Axis",type:{bool:!0}},axisColor:{type:{fill:{solid:{color:!0}}},displayName:"Axis Color"},measureUnits:{type:{text:!0},displayName:"Measure Units "},unitsColor:{type:{fill:{solid:{color:!0}}},displayName:"Units Color"}}}},dataViewMappings:[{conditions:[{Category:{max:1},Value:{max:1},TargetValue:{max:1},Minimum:{max:1},NeedsImprovement:{max:1},Satisfactory:{max:1},Good:{max:1},VeryGood:{max:1},Maximum:{max:1},TargetValue2:{max:1}}],categorical:{categories:{for:{in:"Category"},dataReductionAlgorithm:{top:{}}},values:{select:[{bind:{to:"Value"}},{bind:{to:"TargetValue"}},{bind:{to:"TargetValue2"}},{bind:{to:"Minimum"}},{bind:{to:"NeedsImprovement"}},{bind:{to:"Satisfactory"}},{bind:{to:"Good"}},{bind:{to:"VeryGood"}},{bind:{to:"Maximum"}}]}}}],supportsHighlight:!0,sorting:{default:{}},drilldown:{roles:["Category"]}},e}();t.BulletChart=w;var C;!function(e){function t(e){var t=r(e);return t.y+t.height}function i(){s||(s=$("<span/>"),$("body").append(s),o=d3.select($("body").get(0)).append("svg").style({height:"0px",width:"0px",position:"absolute"}).append("text"),n=$("<canvas/>").get(0).getContext("2d"))}function a(e){return i(),o.style(null),o.text(e.text).attr({visibility:"hidden","font-family":e.fontFamily,"font-size":e.fontSize,"font-weight":e.fontWeight,"font-style":e.fontStyle,"white-space":e.whiteSpace||"nowrap"}),o.node().getBBox()}function r(e){var t={fontFamily:e.fontFamily,fontSize:e.fontSize,text:"M"},i=a(t);return i}var s,o,n;e.estimateSvgTextBaselineDelta=t}(C=t.TextMeasurementHelper||(t.TextMeasurementHelper={}));var P=function(){function e(){}return e.getFillOpacity=function(t,i,a,r){return r&&!i||a&&!t?e.DimmedOpacity:e.DefaultOpacity},e.prototype.bindEvents=function(e,t){this.options=e;var i=e.clearCatcher;e.valueRects.on("click",function(e){t.handleSelection(e,d3.event.ctrlKey)}),e.rects.on("click",function(e){t.handleSelection(e,d3.event.ctrlKey)}),i.on("click",function(){t.handleClearSelection()})},e.prototype.renderSelection=function(t){var i=this.options,a=i.hasHighlights;i.valueRects.style("opacity",function(i){return e.getFillOpacity(i.selected,i.highlight,!i.highlight&&t,!i.selected&&a)}),i.rects.style("opacity",function(i){return e.getFillOpacity(i.selected,i.highlight,!i.highlight&&t,!i.selected&&a)})},e.DimmedOpacity=.4,e.DefaultOpacity=1,e}();t.BulletWebBehavior=P}(i=t.samples||(t.samples={}))}(t=e.visuals||(e.visuals={}))}(i||(i={}))},function(e,t){var i,i=(window.jsCommon,window.powerbi);window.powerbitests,window.InJs,window.debug,window.jasmine,window.Microsoft;!function(e){var t;!function(t){var i;!function(i){var a=e.visuals.valueFormatter,r=t.AnimatorCommon.GetAnimationDuration;!function(e){e[e.logn=0]="logn",e[e.sqrt=1]="sqrt",e[e.value=2]="value"}(i.WordCloudScaleType||(i.WordCloudScaleType={}));var s=i.WordCloudScaleType,o=function(){function e(e,i){this.selectedValuesValue=[],this.hostServices=e,this.selectionManager=new t.utility.SelectionManager({hostServices:e}),this.getSelectionIds=function(e){return _.isArray(e)?_.flatten(e.map(function(e){return i(e)})):i(e)}}return Object.defineProperty(e.prototype,"selectedValues",{get:function(){return this.selectedValuesValue},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"selectionIds",{get:function(){return this.getSelectionIds(this.selectedValues)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"hasSelection",{get:function(){return this.selectedValues.length>0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"getSelectionIdValues",{get:function(){var e=this;return this.selectedValues.map(function(t){return{value:t,selectionId:e.getSelectionIds(t)}})},enumerable:!0,configurable:!0}),e.prototype.selectAndSendSelection=function(e,t){void 0===t&&(t=!1);var i=_.isArray(e)?e:[e];return this.hostServices.shouldRetainSelection()?this.sendSelectionToHost(this.getSelectionIds(i)):(this.selectInternal(i,t),this.sendSelection())},e.prototype.select=function(e,t){void 0===t&&(t=!1);var i=_.isArray(e)?e:[e];this.selectInternal(i,t)},e.prototype.isSelected=function(e){var t=this,i=_.isArray(e)?e:[e];return i.every(function(e){return t.selectedValues.some(function(t){return t===e})})},e.prototype.sendSelection=function(){return this.sendSelectionToHost(this.selectionIds)},e.prototype.clear=function(e){return this.selectedValues.length=0,e?this.sendSelection():$.Deferred().resolve()},e.prototype.selectInternal=function(e,t){var i=this,a=[];a=this.isSelected(e)?t?this.selectedValues.filter(function(t){return!e.some(function(e){return e===t})}):this.selectedValues.length===e.length?[]:e:t?e.filter(function(e){return!i.isSelected(e)}).concat(this.selectedValues):e,this.selectedValues.length=0,a.forEach(function(e){return i.selectedValues.push(e)})},e.prototype.sendSelectionToHost=function(e){var t=$.Deferred();return this.selectionManager.sendSelectionToHost(e),t.resolve(this.selectionIds),t},e}(),n=function(){function e(e,t){this.defaultViewport=e||{width:0,height:0},this.defaultMargin=t||{top:0,bottom:0,right:0,left:0}}return Object.defineProperty(e.prototype,"viewport",{get:function(){return this.viewportValue||(this.viewportValue=this.defaultViewport)},set:function(t){var i=this;this.previousOriginalViewportValue=_.clone(this.originalViewportValue),this.originalViewportValue=_.clone(t),this.setUpdateObject(t,function(e){return i.viewportValue=e},function(t){return e.restrictToMinMax(t,i.minViewport)})},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"viewportCopy",{get:function(){return _.clone(this.viewport)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"viewportIn",{get:function(){return this.viewportInValue||this.viewport},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"minViewport",{get:function(){return this.minViewportValue||{width:0,height:0}},set:function(t){var i=this;this.setUpdateObject(t,function(e){return i.minViewportValue=e},e.restrictToMinMax)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"margin",{get:function(){return this.marginValue||(this.marginValue=this.defaultMargin)},set:function(t){var i=this;this.setUpdateObject(t,function(e){return i.marginValue=e},e.restrictToMinMax)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"viewportChanged",{get:function(){return!(!this.originalViewportValue||this.previousOriginalViewportValue&&this.previousOriginalViewportValue.height===this.originalViewportValue.height&&this.previousOriginalViewportValue.width===this.originalViewportValue.width)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"viewportInIsZero",{get:function(){return 0===this.viewportIn.width||0===this.viewportIn.height},enumerable:!0,configurable:!0}),e.prototype.resetMargin=function(){this.margin=this.defaultMargin},e.prototype.update=function(){this.viewportInValue=e.restrictToMinMax({width:this.viewport.width-(this.margin.left+this.margin.right),height:this.viewport.height-(this.margin.top+this.margin.bottom)},this.minViewportValue)},e.prototype.setUpdateObject=function(t,i,a){var r=this;t=_.clone(t),i(e.createNotifyChangedObject(t,function(e){a&&a(t),r.update()})),a&&a(t),this.update()},e.createNotifyChangedObject=function(e,t){var i={};return _.keys(e).forEach(function(a){return Object.defineProperty(i,a,{get:function(){return e[a]},set:function(i){e[a]=i,t(e,a)},enumerable:!0,configurable:!0})}),i},e.restrictToMinMax=function(e,t){return _.keys(e).forEach(function(i){return e[i]=Math.max(t&&t[i]||0,e[i])}),e},e}(),l=function(){function i(){this.general={maxNumberOfWords:200,minFontSize:20/u.FontSizePercentageCoefficent,maxFontSize:100/u.FontSizePercentageCoefficent,isBrokenText:!0},this.stopWords={show:!0,isDefaultStopWords:!1,words:null},this.rotateText={show:!0,minAngle:-60,maxAngle:90,maxNumberOfOrientations:2}}return Object.defineProperty(i,"Default",{get:function(){return new this},enumerable:!0,configurable:!0}),i.parse=function(e,t){var i=new this;if(!e||!e.metadata||!e.metadata.objects)return i;var a=this.getProperties(t);for(var r in t.objects)for(var s in t.objects[r].properties)if(i[r]&&_.has(i[r],s)){var o=t.objects[r].properties[s].type,n=this.getValueFnByType(o);i[r][s]=n(e.metadata.objects,a[r][s],i[r][s])}return i},i.getProperties=function(e){var t=_.merge({general:{properties:{formatString:{}}}},e.objects),i={};for(var a in t){i[a]={};for(var r in t[a].properties)i[a][r]={objectName:a,propertyName:r}}return i},i.createEnumTypeFromEnum=function(t){var i=!1;return e.createEnumType(Object.keys(t).filter(function(e,a){return!!(a%2)===i&&t[e]===e&&!void(i=!i)||!!(a%2)!==i}).map(function(e){return{value:e,displayName:e}}))},i.getValueFnByType=function(t){switch(_.keys(t)[0]){case"fill":return e.DataViewObjects.getFillColor;default:return e.DataViewObjects.getValue}},i.enumerateObjectInstances=function(e,i,a){void 0===e&&(e=new this);var r=new t.ObjectEnumerationBuilder,s=e&&e[i.objectName];if(!s)return r;var o={objectName:i.objectName,selector:null,properties:{}};for(var n in s)_.has(s,n)&&(o.properties[n]=s[n]);return r.pushInstance(o),r},i.prototype.createOriginalSettings=function(){this.originalSettings=_.cloneDeep(this)},i}();i.WordCloudSettings=l;var c=function(){function e(){this.Category=null,this.Values=null}return e.getColumnSources=function(e){return this.getColumnSourcesT(e)},e.getTableValues=function(e){var t=e&&e.table,i=this.getColumnSourcesT(e);return i&&t&&_.mapValues(i,function(e,i){return e&&t.rows.map(function(t){return t[e.index]})})},e.getTableRows=function(e){var t=e&&e.table,i=this.getColumnSourcesT(e);return i&&t&&t.rows.map(function(e){return _.mapValues(i,function(t,i){return t&&e[t.index]})})},e.getCategoricalValues=function(e){var t=e&&e.categorical,i=t&&t.categories||[],a=t&&t.values||[],r=t&&a.source&&this.getSeriesValues(e);return t&&_.mapValues(new this,function(e,t){return _.toArray(i).concat(_.toArray(a)).filter(function(e){return e.source.roles&&e.source.roles[t]}).map(function(e){return e.values})[0]||a.source&&a.source.roles&&a.source.roles[t]&&r})},e.getSeriesValues=function(e){return e&&e.categorical&&e.categorical.values&&e.categorical.values.map(function(e){return t.converterHelper.getSeriesName(e.source)})},e.getCategoricalColumns=function(e){var t=e&&e.categorical,i=t&&t.categories||[],a=t&&t.values||[];return t&&_.mapValues(new this,function(e,t){return i.filter(function(e){return e.source.roles&&e.source.roles[t]})[0]||a.source&&a.source.roles&&a.source.roles[t]&&a||a.filter(function(e){return e.source.roles&&e.source.roles[t]})})},e.getColumnSourcesT=function(e){var t=e&&e.metadata&&e.metadata.columns;return t&&_.mapValues(new this,function(e,i){return t.filter(function(e){return e.roles&&e.roles[i]})[0]})},e.Roles=Object.freeze(_.mapValues(new e,function(e,t){return t})),e}();i.WordCloudColumns=c;var u=function(){function i(e){this.durationAnimations=500,this.fakeViewport={width:1500,height:1e3},this.canvasViewport={width:128,height:2048},e&&(this.svg=e.svg||this.svg,this.layout=new n(null,e.margin||i.DefaultMargin),e.animator&&(this.animator=e.animator)),this.isUpdating=!1}return i.converter=function(e,r,s){var o=c.getCategoricalColumns(e);if(!o||!o.Category||_.isEmpty(o.Category.values))return null;var n=c.getCategoricalValues(e),u=l.getProperties(i.capabilities),p=i.parseSettings(e,s&&s.settings),d=a.create({format:a.getFormatString(o.Category.source,u.general.formatString)}),g=_.isString(p.stopWords.words)?p.stopWords.words.split(i.StopWordsDelemiter):[];g=p.stopWords.isDefaultStopWords?g.concat(i.StopWords):g;var m=new t.ColorHelper(r,u.dataPoint.fill,h.util.getRandomColor()),f=n.Category.filter(function(e){return null!==e&&void 0!==e&&e.toString().length>0}).map(function(i,a){var r;r=o.Category.objects&&o.Category.objects[a]?h.util.hexToRgb(m.getColorForMeasure(o.Category.objects[a],"")):s&&s.texts&&s.texts[a]?s.texts[a].color:h.util.getRandomColor();var l=(new t.SelectionIdBuilder).withCategory(e.categorical.categories[0],a).createSelectionId();return i=d.format(i),{text:i,count:n.Values&&n.Values[a]&&!isNaN(n.Values[a])?n.Values[a]:1,index:a,selectionId:l,color:r,textGroup:i}}),y=i.getReducedText(f,g,p),v=i.getDataPoints(y,p);return{dataView:e,settings:p,texts:f,dataPoints:v}},i.parseSettings=function(e,t){var a=l.parse(e,i.capabilities);return a.general.minFontSize=Math.max(a.general.minFontSize,1),a.general.maxFontSize=Math.max(a.general.maxFontSize,1),a.general.maxFontSize=Math.max(a.general.maxFontSize,a.general.minFontSize),a.rotateText.minAngle=Math.max(Math.min(a.rotateText.minAngle,i.MaxAngle),i.MinAngle),a.rotateText.maxAngle=Math.max(Math.min(a.rotateText.maxAngle,i.MaxAngle),i.MinAngle),a.rotateText.maxAngle=Math.max(a.rotateText.maxAngle,a.rotateText.minAngle),a.general.maxNumberOfWords=Math.max(Math.min(a.general.maxNumberOfWords,i.MaxNumberOfWords),1),a.rotateText.maxNumberOfOrientations=Math.max(Math.min(a.rotateText.maxNumberOfOrientations,i.MaxNumberOfWords),1),a.createOriginalSettings(),a},i.getReducedText=function(e,t,a){var r=i.getBrokenWords(e,t,a),s=_.values(_.groupBy(r,function(e){return e.text}));return s=s.map(function(e){return _.sortBy(e,function(e){return e.textGroup.length})})},i.getBrokenWords=function(e,t,a){var r=[],s=/\s/,o=new RegExp("["+i.Punctuation.join("\\")+"]","gim");return a.general.isBrokenText?(e.forEach(function(i){if("string"==typeof i.text){var n=i.text.replace(o," ").split(s);a.stopWords.show&&(n=n.filter(function(e){return e.length>0&&!t.some(function(t){return e.toLocaleLowerCase()===t.toLocaleLowerCase()})})),n.forEach(function(t){if(0!==t.length&&!s.test(t)){var a=_.find(e,function(e){return e.text.toString().toLocaleLowerCase()===t.toLocaleLowerCase()});a&&a!==i&&(t=a.text),r.push({text:t,textGroup:i.textGroup,count:i.count,index:i.index,selectionId:i.selectionId,color:i.color})}})}else r.push(i)}),r):e},i.getDataPoints=function(e,t){if(_.isEmpty(e))return[];var a=e.map(function(e){return{text:e[0].text,x:0,y:0,rotate:i.getAngle(t),padding:1,width:0,height:0,xOff:0,yOff:0,x0:0,y0:0,x1:0,y1:0,color:e[0].color,selectionIds:e.map(function(e){return e.selectionId}),wordIndex:e[0].index,count:_.sum(e,function(e){return e.count})}}),r=_.min(a,function(e){return e.count}).count,s=_.max(a,function(e){return e.count}).count,o=e.map(function(e){return e[0]});return a.forEach(function(e){return e.size=i.getWordFontSize(o,t,e.count,r,s)}),a.sort(function(e,t){return t.count-e.count})},i.getWordFontSize=function(e,t,a,r,o,n){void 0===n&&(n=s.value);var l,c,u=t.general.minFontSize*i.FontSizePercentageCoefficent,h=t.general.maxFontSize*i.FontSizePercentageCoefficent;if(e.length<2)return h;switch(n){case s.logn:l=Math.log(a);case s.sqrt:l=Math.sqrt(a);case s.value:l=a}return c=l>r&&o-r!==0?h*(l-r)/(o-r):0,c=100*c/h,c=c*(h-u)/100+u},i.getAngle=function(e){if(!e.rotateText.show)return 0;var t=(e.rotateText.maxAngle-e.rotateText.minAngle)/e.rotateText.maxNumberOfOrientations*Math.floor(Math.random()*e.rotateText.maxNumberOfOrientations);return e.rotateText.minAngle+t},Object.defineProperty(i.prototype,"settings",{get:function(){return this.data&&this.data.settings},enumerable:!0,configurable:!0}),i.prototype.init=function(e){var t=this;this.svg?this.root=this.svg:this.root=d3.select(e.element.get(0)).append("svg"),this.colors=e.style.colorPalette.dataColors,this.hostService=e.host,this.selectionManager=new o(this.hostService,function(e){var i=t.data&&t.data.dataPoints&&t.data.dataPoints.filter(function(t){return t.text===e});return i&&i[0]&&i[0].selectionIds}),this.layout=new n(null,i.DefaultMargin),this.root.classed(i.ClassName,!0),this.root.on("click",function(){t.setSelection(null)}),this.fontFamily=this.root.style("font-family"),this.main=this.root.append("g"),this.wordsContainerSelection=this.main.append("g").classed(i.Words.class,!0),this.canvas=document.createElement("canvas")},i.prototype.update=function(e){var t=this;if(e&&e.viewport&&e.dataViews&&e.dataViews[0]&&e.viewport&&e.viewport.height>=0&&e.viewport.width>=0&&(e!==this.visualUpdateOptions&&(this.incomingUpdateOptions=e),!this.isUpdating&&this.incomingUpdateOptions!==this.visualUpdateOptions)){this.visualUpdateOptions=this.incomingUpdateOptions,this.layout.viewport=this.visualUpdateOptions.viewport;var a=e.dataViews[0];if(this.layout.viewportInIsZero)return;this.durationAnimations=r(this.animator,e.suppressAnimations),this.UpdateSize();var s=i.converter(a,this.colors,this.data);if(!s)return void this.clear();this.data=s,this.computePositions(function(e){return t.render(e)})}},i.prototype.clear=function(){this.main.select(i.Words.selector).selectAll(i.WordGroup.selector).remove()},i.prototype.computePositions=function(t){var a=this,r=this.data.dataPoints;return _.isEmpty(r)?void this.clear():void requestAnimationFrame(function(){var s=_.range(0,(a.specialViewport.width>>5)*a.specialViewport.height,0);r.forEach(function(t){t.getWidthOfWord=function(){return t.widthOfWord||(t.widthOfWord=e.TextMeasurementService.measureSvgTextWidth({fontFamily:a.fontFamily,fontSize:t.size+1+i.Size,text:t.text})+2)}}),a.computeCycle(r,a.getCanvasContext(),s,null,t,[],0)})},i.prototype.computeCycle=function(e,t,i,a,r,s,o){void 0===s&&(s=[]),void 0===o&&(o=0);var n=e[o],l=1;e.length<=10?l=5:e.length<=25?l=3:e.length<=75?l=1.5:e.length<=100&&(l=1.25),n.x=this.specialViewport.width/l*(Math.random()+.5)>>1,n.y=this.specialViewport.height/l*(Math.random()+.5)>>1,n.sprite||this.generateSprites(t,e,o),n.sprite&&this.findPosition(i,n,a)&&(s.push(n),a=this.updateBorders(n,a),n.x-=this.specialViewport.width>>1,n.y-=this.specialViewport.height>>1,s.length>=this.settings.general.maxNumberOfWords&&(o=e.length-1)),++o<e.length&&this.root?this.computeCycle(e,t,i,a,r,s,o):r({data:s,leftBorder:a&&a[0],rightBorder:a&&a[1]})},i.prototype.updateBorders=function(e,t){if(t&&2===t.length){var i=t[0],a=t[1];e.x+e.x0<i.x&&(i.x=e.x+e.x0),e.y+e.y0<i.y&&(i.y=e.y+e.y0),e.x+e.x1>a.x&&(a.x=e.x+e.x1),e.y+e.y1>a.y&&(a.y=e.y+e.y1)}else t=[{x:e.x+e.x0,y:e.y+e.y0},{x:e.x+e.x1,y:e.y+e.y1}];return t},i.prototype.generateSprites=function(e,t,a){e.clearRect(0,0,this.canvasViewport.width<<5,this.canvasViewport.height);for(var r=0,s=0,o=0,n=a,l=t.length;n<l;n++){var c=t[n],u=c.getWidthOfWord(),h=c.size<<1;if(c.rotate){var p=Math.sin(c.rotate*i.Radians),d=Math.cos(c.rotate*i.Radians),g=u*d,m=u*p,f=h*d,y=h*p;u=Math.max(Math.abs(g+y),Math.abs(g-y))+31>>5<<5,h=Math.floor(Math.max(Math.abs(m+f),Math.abs(m-f)))}else u=u+31>>5<<5;h>o&&(o=h),r+u>=this.canvasViewport.width<<5&&(r=0,s+=o,o=0),e.save(),e.font="normal normal "+(c.size+1)+i.Size+" "+this.fontFamily,e.translate(r+(u>>1),s+(h>>1)),c.rotate&&e.rotate(c.rotate*i.Radians),e.fillText(c.text,0,0),c.padding&&(e.lineWidth=2*c.padding,e.strokeText(c.text,0,0)),e.restore(),c.width=u,c.height=h,c.xOff=r,c.yOff=s,c.x1=u>>1,c.y1=h>>1,c.x0=-c.x1,c.y0=-c.y1,r+=u}this.setSprites(e,t)},i.prototype.setSprites=function(e,t){for(var i=e.getImageData(0,0,this.canvasViewport.width<<5,this.canvasViewport.height).data,a=[],r=t.length-1;r>=0;r--){var s=t[r],o=s.width,n=o>>5,l=s.y1-s.y0,c=0,u=0,h=0,p=0;if(s.xOff+o>=this.canvasViewport.width<<5||s.yOff+l>=this.canvasViewport.height)s.sprite=null;else{for(var d=0;d<l*n;d++)a[d]=0;if(null===s.xOff)return;c=s.xOff,u=s.yOff,h=0,p=-1;for(var d=0;d<l;d++){for(var g=0;g<o;g++){var m=n*d+(g>>5),f=(u+d)*(this.canvasViewport.width<<5)+(c+g)<<2,y=i[f]?1<<31-g%32:0;a[m]|=y,h|=y}h?p=d:(s.y0++,l--,d--,u++)}s.y1=s.y0+p,s.sprite=a.slice(0,(s.y1-s.y0)*n)}}},i.prototype.findPosition=function(e,t,i){for(var a,r,s,o={x:t.x,y:t.y},n=Math.sqrt(this.specialViewport.width*this.specialViewport.width+this.specialViewport.height*this.specialViewport.height),l=Math.random()<.5?1:-1,c=-l;;){if(c+=l,a=this.archimedeanSpiral(c),r=Math.floor(a.x),s=Math.floor(a.y),Math.min(Math.abs(r),Math.abs(s))>=n)break;if(t.x=o.x+r,t.y=o.y+s,!(t.x+t.x0<0||t.y+t.y0<0||t.x+t.x1>this.specialViewport.width||t.y+t.y1>this.specialViewport.height)&&(!i||!this.checkIntersect(t,e))&&(!i||this.checkIntersectOfRectangles(t,i[0],i[1]))){for(var u=t.sprite,h=t.width>>5,p=this.specialViewport.width>>5,d=t.x-(h<<4),g=127&d,m=32-g,f=t.y1-t.y0,y=(t.y+t.y0)*p+(d>>5),v=0;v<f;v++){for(var x=0,b=0;b<=h;b++){var S,w=x<<m;b<h&&(x=u[v*h+b]),S=b<h?x>>>g:0,e[y+b]|=w|S}y+=p}return t.sprite=null,!0}}return!1},i.prototype.archimedeanSpiral=function(e){var t=this.specialViewport.width/this.specialViewport.height;return e=.1*e,{x:t*e*Math.cos(e),y:e*Math.sin(e)}},i.prototype.checkIntersect=function(e,t){for(var i=this.specialViewport.width>>5,a=e.sprite,r=e.width>>5,s=e.x-(r<<4),o=127&s,n=32-o,l=e.y1-e.y0,c=(e.y+e.y0)*i+(s>>5),u=0;u<l;u++){for(var h=0,p=0;p<=r;p++){var d,g=0,m=0;if(d=h<<n,p<r&&(h=a[u*r+p]),g=p<r?h>>>o:0,m=(d|g)&t[c+p])return!0}c+=i}return!1},i.prototype.checkIntersectOfRectangles=function(e,t,i){return e.x+e.x1>t.x&&e.x+e.x0<i.x&&e.y+e.y1>t.y&&e.y+e.y0<i.y},i.prototype.getCanvasContext=function(){if(!this.canvasViewport)return null;this.canvas.width=1,this.canvas.height=1;var e=this.canvas.getContext("2d");return this.canvas.width=this.canvasViewport.width<<5,this.canvas.height=this.canvasViewport.height,e=this.canvas.getContext("2d"),e.fillStyle=e.strokeStyle="red",e.textAlign="center",e},i.prototype.UpdateSize=function(){var e,t,i;i=Math.sqrt(this.fakeViewport.width*this.fakeViewport.height/(this.layout.viewportIn.width*this.layout.viewportIn.height)),isNaN(i)?t=e=1:(t=this.layout.viewportIn.height*i,e=this.layout.viewportIn.width*i),this.specialViewport={height:t,width:e},this.root.attr({height:this.layout.viewport.height,width:this.layout.viewport.width})},i.prototype.render=function(e){var a=this;if(e&&e.data){this.scaleMainView(e),this.wordsGroupUpdateSelection=this.main.select(i.Words.selector).selectAll("g").data(e.data);var r=this.wordsGroupUpdateSelection.enter().append("svg:g").classed(i.WordGroup.class,!0);r.append("svg:text").style("font-size","1px").attr("pointer-events","none"),r.append("svg:rect"),this.wordsGroupUpdateSelection.exit().remove(),this.wordsGroupUpdateSelection.attr("transform",function(e){return t.SVGUtil.translate(e.x,e.y)+" rotate("+e.rotate+")"}).sort(function(e,t){return t.height*t.width-e.height*e.width}),this.wordsTextUpdateSelection=this.wordsGroupUpdateSelection.selectAll("text").data(function(e){return[e]}),this.wordsTextUpdateSelection.text(function(e){return e.text}),this.animation(this.wordsTextUpdateSelection,this.durationAnimations).style({"font-size":function(e){return""+e.size+i.Size},fill:function(e){return e.color}}),this.wordsGroupUpdateSelection.selectAll("rect").data(function(e){return[e]}).attr({x:function(e){return.5*-e.getWidthOfWord()},width:function(e){return e.getWidthOfWord()},y:function(e){return.75*-e.size},height:function(e){return.85*e.size},fill:function(e){return"rgba(63, 191, 191, 0.0)"}}).on("click",function(e){a.setSelection(e),d3.event.stopPropagation()}),this.clearIntorrectSelection(this.data.dataView),this.renderSelection(),this.isUpdating=!1,this.incomingUpdateOptions!==this.visualUpdateOptions&&this.update(this.incomingUpdateOptions)}},i.prototype.clearIntorrectSelection=function(e){var t=this,i=e&&e.categorical&&e.categorical.categories,a=i&&i[0]&&i[0].identity&&i[0].identity.map(function(e){return e.key}),r=this.oldIdentityKeys;if(this.oldIdentityKeys=a,r&&r.length>a.length)return void this.selectionManager.clear(!1);if(!_.isEmpty(a)){var s=this.selectionManager.getSelectionIdValues.filter(function(e){return e.selectionId.some(function(e){return _.contains(a,e.getKey())})});s.forEach(function(e){return t.selectionManager.selectedValues.splice(t.selectionManager.selectedValues.indexOf(e.value),1)})}},i.prototype.setSelection=function(e){var t=this;return e?void this.selectionManager.selectAndSendSelection(e.text,d3.event.ctrlKey).then(function(){return t.renderSelection()}):void this.selectionManager.clear(!0).then(function(){return t.renderSelection()})},i.prototype.scaleMainView=function(e){var i=e.data.map(function(e){var t=e.width/2,i=e.height/2;return{left:e.x-t,top:e.y-i,right:e.x+t,bottom:e.y+i}});if(!_.isEmpty(i)){var a={left:_.min(i,function(e){return e.left}).left,top:_.min(i,function(e){return e.top}).top,right:_.max(i,function(e){return e.right}).right,bottom:_.max(i,function(e){return e.bottom}).bottom};a.width=a.right-a.left,a.height=a.bottom-a.top;var r=this.layout.viewportIn.width/a.width,s=this.layout.viewportIn.height/a.height,o=Math.min(r,s),n=-a.left*o+5,l=-a.top*o+5;this.main.style("line-height","5px"),this.main.attr("transform",t.SVGUtil.translate(n,l)+" scale("+o+")").style("line-height","10px")}},i.prototype.renderSelection=function(){var e=this;if(this.wordsTextUpdateSelection){if(!this.selectionManager.hasSelection)return void this.setOpacity(this.wordsTextUpdateSelection,i.MaxOpacity);var t=this.wordsTextUpdateSelection.filter(function(t){return e.selectionManager.isSelected(t.text)});this.setOpacity(this.wordsTextUpdateSelection,i.MinOpacity),this.setOpacity(t,i.MaxOpacity)}},i.prototype.setOpacity=function(e,t){e.style("fill-opacity",t),this.main&&(this.main.style("line-height","14px"),this.animation(this.main,0,this.durationAnimations).style("line-height","15px"))},i.prototype.enumerateObjectInstances=function(e){var a=this,r=l.enumerateObjectInstances(this.settings&&this.settings.originalSettings,e,i.capabilities);switch(e.objectName){case"dataPoint":if(this.data&&this.data.dataPoints){var s=[];_.unique(this.data.dataPoints,function(e){return e.wordIndex}).forEach(function(i){s.indexOf(i.wordIndex)===-1&&(s.push(i.wordIndex),r.pushInstance({objectName:e.objectName,displayName:a.data.texts[i.wordIndex].text,selector:t.ColorHelper.normalizeSelector(i.selectionIds[0].getSelector(),!1),properties:{fill:{solid:{color:i.color}}}}))})}}return r.complete()},i.prototype.animation=function(e,t,i,a){return void 0===t&&(t=0),void 0===i&&(i=0),e.transition().delay(i).duration(t).each("end",a)},i.prototype.destroy=function(){this.root=null,this.canvas=null},i.ClassName="wordCloud",i.Words={class:"words",selector:".words"},i.WordGroup={class:"word",selector:".word"},i.Size="px",i.StopWordsDelemiter=" ",i.Radians=Math.PI/180,i.MinAngle=-180,i.MaxAngle=180,i.MaxNumberOfWords=2500,i.MinOpacity=.2,i.MaxOpacity=1,i.FontSizePercentageCoefficent=1,i.capabilities={dataRoles:[{name:c.Roles.Category,kind:e.VisualDataRoleKind.Grouping,displayName:"Category"},{name:c.Roles.Values,kind:e.VisualDataRoleKind.Measure,displayName:"Values"}],dataViewMappings:[{conditions:[{Category:{min:1,max:1},Values:{min:0,max:1}}],categorical:{categories:{for:{in:"Category"},dataReductionAlgorithm:{top:{count:i.MaxNumberOfWords}}},values:{for:{in:"Values"}}}}],sorting:{implicit:{clauses:[{role:"Values",direction:2}]}},objects:{general:{displayName:"General",properties:{formatString:{type:{formatting:{formatString:!0}}},maxNumberOfWords:{displayName:"Max number of words",type:{numeric:!0}},minFontSize:{displayName:"Min Font",type:{formatting:{fontSize:!0}}},maxFontSize:{displayName:"Max Font",type:{formatting:{fontSize:!0}}},isBrokenText:{displayName:"Word-breaking",type:{bool:!0}}}},dataPoint:{displayName:"Data colors",properties:{fill:{displayName:"Fill",type:{fill:{solid:{color:!0}}}}}},stopWords:{displayName:"Stop Words",properties:{show:{displayName:"Show",type:{bool:!0}},isDefaultStopWords:{displayName:"Default Stop Words",type:{bool:!0}},words:{displayName:"Words",type:{text:!0}}}},rotateText:{displayName:"Rotate Text",properties:{show:{displayName:"Show",type:{bool:!0}},minAngle:{displayName:"Min Angle",type:{numeric:!0}},maxAngle:{displayName:"Max Angle",type:{numeric:!0}},maxNumberOfOrientations:{displayName:"Max number of orientations",type:{numeric:!0}}}}}},i.Punctuation=["!",".",":","'",";",",","!","@","#","$","%","^","&","*","(",")","[","]",'"',"\\","/","-","_","+","="],i.StopWords=["a","able","about","across","after","all","almost","also","am","among","an","and","any","are","as","at","be","because","been","but","by","can","cannot","could","did","do","does","either","else","ever","every","for","from","get","got","had","has","have","he","her","hers","him","his","how","however","i","if","in","into","is","it","its","just","least","let","like","likely","may","me","might","most","must","my","neither","no","nor","not","of","off","often","on","only","or","other","our","own","rather","said","say","says","she","should","since","so","some","than","that","the","their","them","then","there","these","they","this","tis","to","too","twas","us","wants","was","we","were","what","when","where","which","while","who","whom","why","will","with","would","yet","you","your"],i.DefaultMargin={top:10,right:10,bottom:10,left:10},i}();i.WordCloud=u;var h;!function(e){var t;!function(e){function t(e){var t=/^#?([a-f\d])([a-f\d])([a-f\d])$/i;e=e.replace(t,function(e,t,i,a){return t+t+i+i+a+a});var i=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);return i?"rgb("+parseInt(i[1],16)+","+parseInt(i[2],16)+","+parseInt(i[3],16)+")":null}function i(){var e=Math.floor(255*Math.random()),t=Math.floor(255*Math.random()),i=Math.floor(255*Math.random());return"rgb("+e+","+t+","+i+")"}e.hexToRgb=t,e.getRandomColor=i}(t=e.util||(e.util={}))}(h||(h={}))}(i=t.samples||(t.samples={}))}(t=e.visuals||(e.visuals={}))}(i||(i={}))},function(e,t){var i,a=window.jsCommon,i=window.powerbi;window.powerbitests,window.InJs,window.debug,window.jasmine,window.Microsoft;!function(e){var t;!function(t){var i;!function(t){var i,r=a.CssConstants.createClassAndSelector,s=a.PixelConverter,o=e.createEnumType,n=e.DataViewObjects,l=e.VisualDataRoleKind,c=e.DataViewAnalysis,u=e.TextMeasurementService,h=e.data.SQExprConverter,p=e.data.Selector,d=e.visuals.valueFormatter,g=e.visuals.createInteractivityService,m=e.visuals.isCategoryColumnSelected,f=e.visuals.converterHelper,y=e.visuals.SelectionIdBuilder;!function(e){function t(e){return new v(e)}e.createTableView=t}(i=t.TableViewFactory||(t.TableViewFactory={}));var v=function(){function e(t){this.options=$.extend(!0,{},t),this.options.baseContainer.style("overflow-y","auto").attr("drag-resize-disabled",!0),this.scrollContainer=t.baseContainer.append("div").attr("class","scrollRegion"),this.visibleGroupContainer=this.scrollContainer.append("div").attr("class","visibleGroup"),e.SetDefaultOptions(t)}return e.SetDefaultOptions=function(t){t.rowHeight=t.rowHeight||e.defaultRowHeight},Object.defineProperty(e.prototype,"computedColumns",{get:function(){return this.computedOptions?this.computedOptions.columns:0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"computedRows",{get:function(){return this.computedOptions?this.computedOptions.rows:0},enumerable:!0,configurable:!0}),e.prototype.rowHeight=function(e){return this.options.rowHeight=Math.ceil(e),this},e.prototype.columnWidth=function(e){return this.options.columnWidth=Math.ceil(e),this},e.prototype.orientation=function(e){return this.options.orientation=e,this},e.prototype.rows=function(e){return this.options.rows=Math.ceil(e),this},e.prototype.columns=function(e){return this.options.columns=Math.ceil(e),this},e.prototype.data=function(e,t,i){return void 0===i&&(i=!1),this._data=e,this.getDatumIndex=t,
this.setTotalRows(),i&&$(this.options.baseContainer.node()).scrollTop(0),this},e.prototype.viewport=function(e){return this.options.viewport=e,this},e.prototype.empty=function(){return this._data=[],this.render(),this},e.prototype.setTotalRows=function(){var t=this._data.length,i=Math.min(this.options.rows,t),a=Math.min(this.options.columns,t);a>0&&i>0?(this._totalColumns=a,this._totalRows=i):i>0?(this._totalRows=i,this._totalColumns=Math.ceil(t/i)):a>0?(this._totalColumns=a,this._totalRows=Math.ceil(t/a)):(this._totalColumns=e.defaultColumns,this._totalRows=Math.ceil(t/e.defaultColumns))},e.prototype.getGroupedData=function(){var e=this.options,t=[],i=e.rows,a=e.columns,r=this._data.length,i=e.rows>r?r:e.rows,a=e.columns>r?r:e.columns;if(0===a&&0===i?e.orientation===S.HORIZONTAL?(a=r,i=1):(a=1,i=r):0===a&&i>0?a=Math.ceil(r/i):a>0&&0===i&&(i=Math.ceil(r/a)),this.options.orientation===S.VERTICAL){var s=i;i=a,a=s}else this.options.orientation===S.HORIZONTAL&&(0===i&&(i=this._totalRows),0===a&&(a=this._totalColumns));for(var o=0,n=0,l=0;l<i;l++)if(this.options.orientation===S.VERTICAL&&0===e.rows&&r%e.columns>0&&e.columns<=r)r%e.columns>l?(o=l*Math.ceil(r/e.columns),n=o+Math.ceil(r/e.columns),this.addDataToArray(t,this._data,o,n)):(this.addDataToArray(t,this._data,n,n+Math.floor(r/e.columns)),n+=Math.floor(r/e.columns));else if(this.options.orientation===S.HORIZONTAL&&0===e.columns&&r%e.rows>0&&e.rows<=r)r%e.rows>l?(o=l*Math.ceil(r/e.rows),n=o+Math.ceil(r/e.rows),this.addDataToArray(t,this._data,o,n)):(this.addDataToArray(t,this._data,n,n+Math.floor(r/e.rows)),n+=Math.floor(r/e.rows));else{var n=l*a;this.addDataToArray(t,this._data,n,n+a)}return this.computedOptions=this.getComputedOptions(t,this.options.orientation),{data:t,totalColumns:a,totalRows:i}},e.prototype.addDataToArray=function(e,t,i,a){if(e&&t){var r=t.slice(i,a);r&&r.length>0&&e.push(r)}},e.prototype.getComputedOptions=function(e,t){var i,a=0;i=e?e.length:0;for(var r=0;r<i;r++){var s=e[r];s&&s.length>a&&(a=s.length)}return t===S.HORIZONTAL?{columns:a,rows:i}:{columns:i,rows:a}},e.prototype.render=function(){var t,i,a=this.options,r=this.visibleGroupContainer,s=a.rowHeight||e.defaultRowHeight,o=this.getGroupedData();if(t=r.selectAll(e.RowSelector.selector).data(o.data),t.enter().append("div").classed(e.RowSelector.class,!0),i=t.selectAll(e.CellSelector.selector).data(function(e){return e}),i.enter().append("div").classed(e.CellSelector.class,!0),i.call(function(e){a.enter(e)}),i.call(function(e){a.update(e)}),i.style({height:s>0?s+"px":"auto"}),this.options.orientation===S.VERTICAL){for(var n=0,l=0;l<o.data.length;l++)0!==o.data[l].length&&(n=l+1);i.style({width:"100%"}),t.style({width:a.columnWidth>0?a.columnWidth+"px":100/n+"%"})}else i.style({width:a.columnWidth>0?a.columnWidth+"px":100/o.totalColumns+"%"}),t.style({width:null});i.exit().remove(),t.exit().call(function(e){return a.exit(e)}).remove()},e.RowSelector=r("row"),e.CellSelector=r("cell"),e.defaultRowHeight=0,e.defaultColumns=1,e}();t.TableView=v,t.chicletSlicerProps={general:{orientation:{objectName:"general",propertyName:"orientation"},columns:{objectName:"general",propertyName:"columns"},rows:{objectName:"general",propertyName:"rows"},showDisabled:{objectName:"general",propertyName:"showDisabled"},multiselect:{objectName:"general",propertyName:"multiselect"},selection:{objectName:"general",propertyName:"selection"},selfFilterEnabled:{objectName:"general",propertyName:"selfFilterEnabled"}},header:{show:{objectName:"header",propertyName:"show"},title:{objectName:"header",propertyName:"title"},fontColor:{objectName:"header",propertyName:"fontColor"},background:{objectName:"header",propertyName:"background"},outline:{objectName:"header",propertyName:"outline"},textSize:{objectName:"header",propertyName:"textSize"},outlineColor:{objectName:"header",propertyName:"outlineColor"},outlineWeight:{objectName:"header",propertyName:"outlineWeight"}},rows:{fontColor:{objectName:"rows",propertyName:"fontColor"},textSize:{objectName:"rows",propertyName:"textSize"},height:{objectName:"rows",propertyName:"height"},width:{objectName:"rows",propertyName:"width"},background:{objectName:"rows",propertyName:"background"},transparency:{objectName:"rows",propertyName:"transparency"},selectedColor:{objectName:"rows",propertyName:"selectedColor"},hoverColor:{objectName:"rows",propertyName:"hoverColor"},unselectedColor:{objectName:"rows",propertyName:"unselectedColor"},disabledColor:{objectName:"rows",propertyName:"disabledColor"},outline:{objectName:"rows",propertyName:"outline"},outlineColor:{objectName:"rows",propertyName:"outlineColor"},outlineWeight:{objectName:"rows",propertyName:"outlineWeight"},borderStyle:{objectName:"rows",propertyName:"borderStyle"}},images:{imageSplit:{objectName:"images",propertyName:"imageSplit"},stretchImage:{objectName:"images",propertyName:"stretchImage"},bottomImage:{objectName:"images",propertyName:"bottomImage"}},selectedPropertyIdentifier:{objectName:"general",propertyName:"selected"},filterPropertyIdentifier:{objectName:"general",propertyName:"filter"},formatString:{objectName:"general",propertyName:"formatString"},hasSavedSelection:!0};var x;!function(e){e.ROUNDED="Rounded",e.CUT="Cut",e.SQUARE="Square",e.type=o([{value:e.ROUNDED,displayName:e.ROUNDED},{value:e.CUT,displayName:e.CUT},{value:e.SQUARE,displayName:e.SQUARE}])}(x||(x={}));var b;!function(e){e.INPLACE="Inplace",e.BOTTOM="Bottom",e.HIDE="Hide",e.type=o([{value:e.INPLACE,displayName:e.INPLACE},{value:e.BOTTOM,displayName:e.BOTTOM},{value:e.HIDE,displayName:e.HIDE}])}(b||(b={}));var S;!function(e){e.HORIZONTAL="Horizontal",e.VERTICAL="Vertical",e.type=o([{value:e.HORIZONTAL,displayName:e.HORIZONTAL},{value:e.VERTICAL,displayName:e.VERTICAL}])}(S||(S={}));var w=function(){function e(e){e&&e.behavior&&(this.behavior=e.behavior),this.behavior||(this.behavior=new A)}return e.DefaultStyleProperties=function(){return{general:{orientation:S.VERTICAL,columns:3,rows:0,multiselect:!0,showDisabled:b.INPLACE,selection:null,selfFilterEnabled:!1},margin:{top:50,bottom:50,right:50,left:50},header:{borderBottomWidth:1,show:!0,outline:"BottomOnly",fontColor:"#a6a6a6",background:null,textSize:10,outlineColor:"#a6a6a6",outlineWeight:1,title:""},headerText:{marginLeft:8,marginTop:0},slicerText:{textSize:10,height:0,width:0,fontColor:"#666666",hoverColor:"#212121",selectedColor:"#BDD7EE",unselectedColor:"#ffffff",disabledColor:"grey",marginLeft:8,outline:"Frame",background:null,transparency:0,outlineColor:"#000000",outlineWeight:1,borderStyle:"Cut"},slicerItemContainer:{marginTop:5,marginLeft:0},images:{imageSplit:50,stretchImage:!1,bottomImage:!1}}},e.getValidImageSplit=function(t){return t<e.MinImageSplit?e.MinImageSplit:t>e.MaxImageSplit?e.MaxImageSplit:t},e.converter=function(e,i,a){if(e&&e.categorical&&e.categorical.categories&&e.categorical.categories[0]&&e.categorical.categories[0].values&&e.categorical.categories[0].values.length>0){var r=new C.ChicletSlicerConverter(e,a);r.convert();var s,o=this.DefaultStyleProperties(),l=e.metadata.objects;l&&(o.general.orientation=n.getValue(l,t.chicletSlicerProps.general.orientation,o.general.orientation),o.general.columns=n.getValue(l,t.chicletSlicerProps.general.columns,o.general.columns),o.general.rows=n.getValue(l,t.chicletSlicerProps.general.rows,o.general.rows),o.general.multiselect=n.getValue(l,t.chicletSlicerProps.general.multiselect,o.general.multiselect),o.general.showDisabled=n.getValue(l,t.chicletSlicerProps.general.showDisabled,o.general.showDisabled),o.general.selection=n.getValue(e.metadata.objects,t.chicletSlicerProps.general.selection,o.general.selection),o.general.selfFilterEnabled=n.getValue(l,t.chicletSlicerProps.general.selfFilterEnabled,o.general.selfFilterEnabled),o.header.show=n.getValue(l,t.chicletSlicerProps.header.show,o.header.show),o.header.title=n.getValue(l,t.chicletSlicerProps.header.title,o.header.title),o.header.fontColor=n.getFillColor(l,t.chicletSlicerProps.header.fontColor,o.header.fontColor),o.header.background=n.getFillColor(l,t.chicletSlicerProps.header.background,o.header.background),o.header.textSize=n.getValue(l,t.chicletSlicerProps.header.textSize,o.header.textSize),o.header.outline=n.getValue(l,t.chicletSlicerProps.header.outline,o.header.outline),o.header.outlineColor=n.getFillColor(l,t.chicletSlicerProps.header.outlineColor,o.header.outlineColor),o.header.outlineWeight=n.getValue(l,t.chicletSlicerProps.header.outlineWeight,o.header.outlineWeight),o.slicerText.textSize=n.getValue(l,t.chicletSlicerProps.rows.textSize,o.slicerText.textSize),o.slicerText.height=n.getValue(l,t.chicletSlicerProps.rows.height,o.slicerText.height),o.slicerText.width=n.getValue(l,t.chicletSlicerProps.rows.width,o.slicerText.width),o.slicerText.selectedColor=n.getFillColor(l,t.chicletSlicerProps.rows.selectedColor,o.slicerText.selectedColor),o.slicerText.hoverColor=n.getFillColor(l,t.chicletSlicerProps.rows.hoverColor,o.slicerText.hoverColor),o.slicerText.unselectedColor=n.getFillColor(l,t.chicletSlicerProps.rows.unselectedColor,o.slicerText.unselectedColor),o.slicerText.disabledColor=n.getFillColor(l,t.chicletSlicerProps.rows.disabledColor,o.slicerText.disabledColor),o.slicerText.background=n.getFillColor(l,t.chicletSlicerProps.rows.background,o.slicerText.background),o.slicerText.transparency=n.getValue(l,t.chicletSlicerProps.rows.transparency,o.slicerText.transparency),o.slicerText.fontColor=n.getFillColor(l,t.chicletSlicerProps.rows.fontColor,o.slicerText.fontColor),o.slicerText.outline=n.getValue(l,t.chicletSlicerProps.rows.outline,o.slicerText.outline),o.slicerText.outlineColor=n.getFillColor(l,t.chicletSlicerProps.rows.outlineColor,o.slicerText.outlineColor),o.slicerText.outlineWeight=n.getValue(l,t.chicletSlicerProps.rows.outlineWeight,o.slicerText.outlineWeight),o.slicerText.borderStyle=n.getValue(l,t.chicletSlicerProps.rows.borderStyle,o.slicerText.borderStyle),o.images.imageSplit=n.getValue(l,t.chicletSlicerProps.images.imageSplit,o.images.imageSplit),o.images.stretchImage=n.getValue(l,t.chicletSlicerProps.images.stretchImage,o.images.stretchImage),o.images.bottomImage=n.getValue(l,t.chicletSlicerProps.images.bottomImage,o.images.bottomImage)),o.general.selfFilterEnabled&&i&&(i=i.toLowerCase(),r.dataPoints.forEach(function(e){return e.filtered=e.category.toLowerCase().indexOf(i)<0}));var c=e.categorical.categories[0];return s={categorySourceName:c.source.displayName,formatString:d.getFormatString(c.source,t.chicletSlicerProps.formatString),slicerSettings:o,slicerDataPoints:r.dataPoints},s.hasSelectionOverride=r.hasSelectionOverride,s}},e.prototype.init=function(t){this.element=t.element,this.currentViewport=t.viewport,this.behavior&&(this.interactivityService=g(t.host)),this.hostServices=t.host,this.hostServices.canSelect=e.canSelect,this.settings=e.DefaultStyleProperties(),this.initContainer()},e.canSelect=function(e){var t=_.map(e.visualObjects,function(e){return p.convertSelectorsByColumnToSelector(e.selectorsByColumn)});return!(t&&t.length>1&&t.some(function(e){return e&&e.data&&e.data.length>1}))},e.prototype.update=function(e){if(e&&e.dataViews&&e.dataViews[0]&&e.viewport){var t=this.dataView;this.dataView=e.dataViews[0];var i=!0;t&&(i=!c.hasSameCategoryIdentity(t,this.dataView)),e.viewport.height===this.currentViewport.height&&e.viewport.width===this.currentViewport.width?this.waitingForData=!1:this.currentViewport=e.viewport,this.updateInternal(i)}},e.prototype.onResizing=function(e){this.currentViewport=e,this.updateInternal(!1)},e.prototype.enumerateObjectInstances=function(e){var t=this.slicerData;if(t)switch(e.objectName){case"rows":return this.enumerateRows(t);case"header":return this.enumerateHeader(t);case"general":return this.enumerateGeneral(t);case"images":return this.enumerateImages(t)}},e.prototype.enumerateHeader=function(e){var t=this.settings;return[{selector:null,objectName:"header",properties:{show:t.header.show,title:t.header.title,fontColor:t.header.fontColor,background:t.header.background,textSize:t.header.textSize,outline:t.header.outline,outlineColor:t.header.outlineColor,outlineWeight:t.header.outlineWeight}}]},e.prototype.enumerateRows=function(e){var t=this.settings;return[{selector:null,objectName:"rows",properties:{textSize:t.slicerText.textSize,height:t.slicerText.height,width:t.slicerText.width,background:t.slicerText.background,transparency:t.slicerText.transparency,selectedColor:t.slicerText.selectedColor,hoverColor:t.slicerText.hoverColor,unselectedColor:t.slicerText.unselectedColor,disabledColor:t.slicerText.disabledColor,outline:t.slicerText.outline,outlineColor:t.slicerText.outlineColor,outlineWeight:t.slicerText.outlineWeight,fontColor:t.slicerText.fontColor,borderStyle:t.slicerText.borderStyle}}]},e.prototype.enumerateGeneral=function(e){var t=this.settings;return[{selector:null,objectName:"general",properties:{orientation:t.general.orientation,columns:t.general.columns,rows:t.general.rows,showDisabled:t.general.showDisabled,multiselect:t.general.multiselect,selfFilterEnabled:t.general.selfFilterEnabled}}]},e.prototype.enumerateImages=function(e){var t=this.settings;return[{selector:null,objectName:"images",properties:{imageSplit:t.images.imageSplit,stretchImage:t.images.stretchImage,bottomImage:t.images.bottomImage}}]},e.prototype.updateInternal=function(t){var i=this,a=e.converter(this.dataView,this.searchInput.val(),this.interactivityService);if(!a)return void this.tableView.empty();this.interactivityService&&this.interactivityService.applySelectionStateToData(a.slicerDataPoints),a.slicerSettings.header.outlineWeight=a.slicerSettings.header.outlineWeight<0?0:a.slicerSettings.header.outlineWeight,a.slicerSettings.slicerText.outlineWeight=a.slicerSettings.slicerText.outlineWeight<0?0:a.slicerSettings.slicerText.outlineWeight,a.slicerSettings.slicerText.height=a.slicerSettings.slicerText.height<0?0:a.slicerSettings.slicerText.height,a.slicerSettings.slicerText.width=a.slicerSettings.slicerText.width<0?0:a.slicerSettings.slicerText.width,a.slicerSettings.images.imageSplit=e.getValidImageSplit(a.slicerSettings.images.imageSplit),a.slicerSettings.general.columns=a.slicerSettings.general.columns<0?0:a.slicerSettings.general.columns,a.slicerSettings.general.rows=a.slicerSettings.general.rows<0?0:a.slicerSettings.general.rows,a.slicerSettings.general.getSavedSelection=function(){try{return JSON.parse(i.slicerData.slicerSettings.general.selection)||[]}catch(e){return[]}},a.slicerSettings.general.setSavedSelection=function(e,t){i.isSelectionSaved=!0,i.hostServices.persistProperties({merge:[{objectName:"general",selector:null,properties:{filter:e,selection:t&&JSON.stringify(t)||""}}]})},this.slicerData?this.isSelectionSaved?this.isSelectionLoaded=!0:this.isSelectionLoaded=this.slicerData.slicerSettings.general.selection===a.slicerSettings.general.selection:this.isSelectionLoaded=!1,this.slicerData=a,this.settings=this.slicerData.slicerSettings,this.updateSlicerBodyDimensions(),this.settings.general.showDisabled===b.BOTTOM?a.slicerDataPoints.sort(function(e,t){return e.selectable===t.selectable?0:e.selectable&&!t.selectable?-1:1}):this.settings.general.showDisabled===b.HIDE&&(a.slicerDataPoints=a.slicerDataPoints.filter(function(e){return e.selectable}));var r=this.settings.slicerText.height;if(0===r){var s=e.cellTotalInnerPaddings+e.cellTotalInnerBorders,o=e.getChicletTextProperties(this.settings.slicerText.textSize);r=u.estimateSvgTextHeight(o)+u.estimateSvgTextBaselineDelta(o)+s;var n=_.any(a.slicerDataPoints,function(e){return""!==e.imageURL&&"undefined"!=typeof e.imageURL});n&&(r+=100)}this.tableView.rowHeight(r).columnWidth(this.settings.slicerText.width).orientation(this.settings.general.orientation).rows(this.settings.general.rows).columns(this.settings.general.columns).data(a.slicerDataPoints.filter(function(e){return!e.filtered}),function(e){return $.inArray(e,a.slicerDataPoints)},t).viewport(this.getSlicerBodyViewport(this.currentViewport)).render(),this.updateSearchHeader()},e.prototype.initContainer=function(){var t=this,a=this.settings,r=this.getSlicerBodyViewport(this.currentViewport),o=d3.select(this.element.get(0)).append("div").classed(e.ContainerSelector.class,!0);this.slicerHeader=o.append("div").classed(e.HeaderSelector.class,!0),this.slicerHeader.append("span").classed(e.ClearSelector.class,!0).attr("title","Clear"),this.slicerHeader.append("div").classed(e.HeaderTextSelector.class,!0).style({"margin-left":s.toString(a.headerText.marginLeft),"margin-top":s.toString(a.headerText.marginTop),"border-style":this.getBorderStyle(a.header.outline),"border-color":a.header.outlineColor,"border-width":this.getBorderWidth(a.header.outline,a.header.outlineWeight),"font-size":s.fromPoint(a.header.textSize)}),this.createSearchHeader($(o.node())),this.slicerBody=o.append("div").classed(e.BodySelector.class,!0).classed(e.SlicerBodyHorizontalSelector.class,a.general.orientation===S.HORIZONTAL).classed(e.SlicerBodyVerticalSelector.class,a.general.orientation===S.VERTICAL).style({height:s.toString(r.height),width:"100%"});var n=function(e){t.enterSelection(e)},l=function(e){t.updateSelection(e)},c=function(e){e.remove()},u={rowHeight:this.getRowHeight(),columnWidth:this.settings.slicerText.width,orientation:this.settings.general.orientation,rows:this.settings.general.rows,columns:this.settings.general.columns,enter:n,exit:c,update:l,loadMoreData:function(){return t.onLoadMoreData()},scrollEnabled:!0,viewport:this.getSlicerBodyViewport(this.currentViewport),baseContainer:this.slicerBody};this.tableView=i.createTableView(u)},e.prototype.enterSelection=function(t){var i=this.settings,a=t.selectAll("ul").data(function(e){return[e]});a.enter().append("ul"),a.exit().remove();var r=a.selectAll(e.ItemContainerSelector.selector).data(function(e){return[e]});r.enter().append("li").classed(e.ItemContainerSelector.class,!0),r.style({"margin-left":s.toString(i.slicerItemContainer.marginLeft)});var o=r.selectAll(e.SlicerImgWrapperSelector.selector).data(function(e){return[e]});o.enter().append("img").classed(e.SlicerImgWrapperSelector.class,!0),o.exit().remove();var n=r.selectAll(e.SlicerTextWrapperSelector.selector).data(function(e){return[e]});n.enter().append("div").classed(e.SlicerTextWrapperSelector.class,!0);var l=n.selectAll(e.LabelTextSelector.selector).data(function(e){return[e]});l.enter().append("span").classed(e.LabelTextSelector.class,!0),l.style({"font-size":s.fromPoint(i.slicerText.textSize)}),l.exit().remove(),n.exit().remove(),r.exit().remove()},e.prototype.updateSelection=function(t){var i=this,a=this.settings,r=this.slicerData;if(r&&a){this.slicerHeader.classed("hidden",!a.header.show),this.slicerHeader.select(e.HeaderTextSelector.selector).text(""!==a.header.title.trim()?a.header.title.trim():this.slicerData.categorySourceName).style({"border-style":this.getBorderStyle(a.header.outline),"border-color":a.header.outlineColor,"border-width":this.getBorderWidth(a.header.outline,a.header.outlineWeight),color:a.header.fontColor,"background-color":a.header.background,"font-size":s.fromPoint(a.header.textSize)}),this.slicerBody.classed(e.SlicerBodyHorizontalSelector.class,a.general.orientation===S.HORIZONTAL).classed(e.SlicerBodyVerticalSelector.class,a.general.orientation===S.VERTICAL);var o=t.selectAll(e.LabelTextSelector.selector),n=e.getChicletTextProperties(a.slicerText.textSize),l=r.formatString;if(o.text(function(t){var r=0;if(n.text=d.format(t.category,l),0===i.settings.slicerText.width){var s=i.getSlicerBodyViewport(i.currentViewport);return r=s.width/(i.tableView.computedColumns||1)-e.chicletTotalInnerRightLeftPaddings-e.cellTotalInnerBorders-a.slicerText.outlineWeight,u.getTailoredTextOrDefault(n,r)}return r=i.settings.slicerText.width-e.chicletTotalInnerRightLeftPaddings-e.cellTotalInnerBorders-a.slicerText.outlineWeight,u.getTailoredTextOrDefault(n,r)}),t.selectAll(e.SlicerImgWrapperSelector.selector).style({"max-height":a.images.imageSplit+"%",display:function(e){return e.imageURL?"flex":"none"}}).classed({hidden:function(e){return!e.imageURL||(a.images.imageSplit<10||void 0)},stretchImage:a.images.stretchImage,bottomImage:a.images.bottomImage}).attr("src",function(e){return e.imageURL?e.imageURL:""}),t.selectAll(".slicer-text-wrapper").style("height",function(e){return e.imageURL?100-a.images.imageSplit+"%":"100%"}).classed("hidden",function(e){if(a.images.imageSplit>90)return!0}),t.selectAll(".slicerItemContainer").style({color:a.slicerText.fontColor,"border-style":this.getBorderStyle(a.slicerText.outline),"border-color":a.slicerText.outlineColor,"border-width":this.getBorderWidth(a.slicerText.outline,a.slicerText.outlineWeight),"font-size":s.fromPoint(a.slicerText.textSize),"border-radius":this.getBorderRadius(a.slicerText.borderStyle)}),a.slicerText.background){var c=T.util.hexToRGBString(a.slicerText.background,(100-a.slicerText.transparency)/100);this.slicerBody.style("background-color",c)}else this.slicerBody.style("background-color",null);if(this.interactivityService&&this.slicerBody){this.interactivityService.applySelectionStateToData(r.slicerDataPoints);var h=this.slicerBody.attr("width",this.currentViewport.width),p=h.selectAll(e.ItemContainerSelector.selector),g=h.selectAll(e.LabelTextSelector.selector),m=h.selectAll(e.InputSelector.selector),f=this.slicerHeader.select(e.ClearSelector.selector),y={dataPoints:r.slicerDataPoints,slicerItemContainers:p,slicerItemLabels:g,slicerItemInputs:m,slicerClear:f,interactivityService:this.interactivityService,slicerSettings:r.slicerSettings,isSelectionLoaded:this.isSelectionLoaded};this.interactivityService.bind(r.slicerDataPoints,this.behavior,y,{overrideSelectionFromData:!0,hasSelectionOverride:r.hasSelectionOverride}),this.behavior.styleSlicerInputs(t.select(e.ItemContainerSelector.selector),this.interactivityService.hasSelection())}else this.behavior.styleSlicerInputs(t.select(e.ItemContainerSelector.selector),!1)}},e.prototype.createSearchHeader=function(e){var t=this;this.searchHeader=$("<div>").appendTo(e).addClass("searchHeader").addClass("collapsed"),$("<div>").appendTo(this.searchHeader).attr("title","Search").addClass("search");var i=0;this.searchInput=$("<input>").appendTo(this.searchHeader).attr("type","text").attr("drag-resize-disabled","true").addClass("searchInput").on("input",function(){return t.hostServices.persistProperties({merge:[{objectName:"general",selector:null,properties:{counter:i++}}]})})},e.prototype.updateSearchHeader=function(){this.searchHeader.toggleClass("show",this.slicerData.slicerSettings.general.selfFilterEnabled),this.searchHeader.toggleClass("collapsed",!this.slicerData.slicerSettings.general.selfFilterEnabled)},e.prototype.onLoadMoreData=function(){!this.waitingForData&&this.dataView.metadata&&this.dataView.metadata.segment&&(this.hostServices.loadMoreData(),this.waitingForData=!0)},e.prototype.getSlicerBodyViewport=function(t){var i=this.settings,a=i.header.show?this.getHeaderHeight():0,r=i.header.outlineWeight,s=t.height-(a+r+i.header.borderBottomWidth),o=t.width-e.WidthOfScrollbar;return{height:Math.max(s,e.MinSizeOfViewport),width:Math.max(o,e.MinSizeOfViewport)}},e.prototype.updateSlicerBodyDimensions=function(){var e=this.getSlicerBodyViewport(this.currentViewport);this.slicerBody.style({height:s.toString(e.height),width:"100%"})},e.getChicletTextProperties=function(t){return{fontFamily:e.DefaultFontFamily,fontSize:s.fromPoint(t||e.DefaultFontSizeInPt)}},e.prototype.getHeaderHeight=function(){return u.estimateSvgTextHeight(e.getChicletTextProperties(this.settings.header.textSize))},e.prototype.getRowHeight=function(){var t=this.settings.slicerText;return 0!==t.height?t.height:u.estimateSvgTextHeight(e.getChicletTextProperties(t.textSize))},e.prototype.getBorderStyle=function(e){return"0px"===e?"none":"solid"},e.prototype.getBorderWidth=function(e,t){switch(e){case"None":return"0px";case"BottomOnly":return"0px 0px "+t+"px 0px";case"TopOnly":return t+"px 0px 0px 0px";case"TopBottom":return t+"px 0px "+t+"px 0px";case"LeftRight":return"0px "+t+"px 0px "+t+"px";case"Frame":return t+"px";default:return e.replace("1",t.toString())}},e.prototype.getBorderRadius=function(e){switch(e){case x.ROUNDED:return"10px";case x.SQUARE:return"0px";default:return"5px"}},e.capabilities={dataRoles:[{name:"Category",kind:l.Grouping,displayName:"Category"},{name:"Values",kind:l.Measure,displayName:"Values"},{name:"Image",kind:l.Grouping,displayName:"Image"}],objects:{general:{displayName:"General",properties:{selection:{displayName:"Selection",type:{text:!0}},orientation:{displayName:"Orientation",type:{enumeration:S.type}},columns:{displayName:"Columns",type:{numeric:!0}},rows:{displayName:"Rows",type:{numeric:!0}},showDisabled:{displayName:"Show Disabled",type:{enumeration:b.type}},multiselect:{displayName:"Multiple selection",type:{bool:!0}},selected:{type:{bool:!0}},filter:{type:{filter:{}}},selfFilter:{type:{filter:{selfFilter:!0}}},selfFilterEnabled:{type:{operations:{searchEnabled:!0}}},formatString:{type:{formatting:{formatString:!0}}}}},header:{displayName:"Header",properties:{show:{displayName:"Show",type:{bool:!0}},title:{displayName:"Title",type:{text:!0}},fontColor:{displayName:"Font color",type:{fill:{solid:{color:!0}}}},background:{displayName:"Background",type:{fill:{solid:{color:!0}}}},outline:{displayName:"Outline",type:{formatting:{outline:!0}}},textSize:{displayName:"Text Size",type:{numeric:!0}},outlineColor:{displayName:"Outline Color",type:{fill:{solid:{color:!0}}}},outlineWeight:{displayName:"Outline Weight",type:{numeric:!0}}}},rows:{displayName:"Chiclets",properties:{fontColor:{displayName:"Text color",type:{fill:{solid:{color:!0}}}},textSize:{displayName:"Text Size",type:{numeric:!0}},height:{displayName:"Height",type:{numeric:!0}},width:{displayName:"Width",type:{numeric:!0}},selectedColor:{displayName:"Selected Color",type:{fill:{solid:{color:!0}}}},hoverColor:{displayName:"Hover Color",type:{fill:{solid:{color:!0}}}},unselectedColor:{displayName:"Unselected Color",type:{fill:{solid:{color:!0}}}},disabledColor:{displayName:"Disabled Color",type:{fill:{solid:{color:!0}}}},background:{displayName:"Background",type:{fill:{solid:{color:!0}}}},transparency:{displayName:"Transparency",description:"Set transparency for background color",type:{numeric:!0}},outline:{displayName:"Outline",type:{formatting:{outline:!0}}},outlineColor:{displayName:"Outline Color",type:{fill:{solid:{color:!0}}}},outlineWeight:{displayName:"Outline Weight",type:{numeric:!0}},borderStyle:{displayName:"Outline Style",type:{enumeration:x.type}}}},images:{displayName:"Images",properties:{imageSplit:{displayName:"Image Split",type:{numeric:!0}},stretchImage:{displayName:"Stretch image",type:{bool:!0}},bottomImage:{displayName:"Bottom image",type:{bool:!0}}}}},dataViewMappings:[{conditions:[{Category:{max:1},Image:{min:0,max:1},Values:{min:0,max:1}}],categorical:{categories:{for:{in:"Category"},dataReductionAlgorithm:{top:{count:1e4}}},values:{group:{by:"Image",select:[{bind:{to:"Values"}}],dataReductionAlgorithm:{top:{count:1e4}}}},includeEmptyGroups:!0}}],supportsHighlight:!0,sorting:{default:{}},suppressDefaultTitle:!0},e.DefaultFontFamily="'Segoe UI', 'wf_segoe-ui_normal', helvetica, arial, sans-serif",e.DefaultFontSizeInPt=11,e.cellTotalInnerPaddings=8,e.cellTotalInnerBorders=2,e.chicletTotalInnerRightLeftPaddings=14,e.MinImageSplit=0,e.MaxImageSplit=100,e.MinSizeOfViewport=0,e.WidthOfScrollbar=17,e.ItemContainerSelector=r("slicerItemContainer"),e.SlicerImgWrapperSelector=r("slicer-img-wrapper"),e.SlicerTextWrapperSelector=r("slicer-text-wrapper"),e.SlicerBodyHorizontalSelector=r("slicerBody-horizontal"),e.SlicerBodyVerticalSelector=r("slicerBody-vertical"),e.HeaderTextSelector=r("headerText"),e.ContainerSelector=r("chicletSlicer"),e.LabelTextSelector=r("slicerText"),e.HeaderSelector=r("slicerHeader"),e.InputSelector=r("slicerCheckbox"),e.ClearSelector=r("clear"),e.BodySelector=r("slicerBody"),e}();t.ChicletSlicer=w;var C;!function(e){var i=function(){function e(e,i){var a=e.categorical;this.dataViewCategorical=a,this.dataViewMetadata=e.metadata,a.categories&&a.categories.length>0&&(this.category=a.categories[0],this.categoryIdentities=this.category.identity,this.categoryValues=this.category.values,this.categoryColumnRef=this.category.identityFields,this.categoryFormatString=d.getFormatString(this.category.source,t.chicletSlicerProps.formatString)),this.dataPoints=[],this.interactivityService=i,this.hasSelectionOverride=!1}return e.prototype.convert=function(){if(this.dataPoints=[],this.numberOfCategoriesSelectedInData=0,this.categoryValues){var e,i=this.dataViewMetadata?this.dataViewMetadata.objects:void 0,a=void 0;if(i&&i.general&&i.general.filter){if(!this.categoryColumnRef)return;var r=i.general.filter,s=h.asScopeIdsContainer(r,this.categoryColumnRef);s?(a=s.isNot,e=s.scopeIds?s.scopeIds.length:0):a=!1}this.interactivityService&&(void 0===a?a=this.interactivityService.isSelectionModeInverted():this.interactivityService.setSelectionModeInverted(a));for(var o=void 0,n=0;n<this.categoryValues.length;n++){var l=m(t.chicletSlicerProps.selectedPropertyIdentifier,this.category,n);if(null!=l){o=l;break}}for(var c=this.dataViewCategorical,u=t.chicletSlicerProps.formatString,p=-(1/0),g="",v=0,x=this.categoryValues.length;v<x;v++){var b=m(t.chicletSlicerProps.selectedPropertyIdentifier,this.category,v),S=!0;null!=o&&(a?(null==this.category.objects&&(b=void 0),null!=b?b=o:null==b&&(b=!o)):null==b&&(b=!o)),b&&this.numberOfCategoriesSelectedInData++;var w=this.categoryValues[v],C=d.format(w,this.categoryFormatString);if(this.dataViewCategorical.values)for(var P=0;P<this.dataViewCategorical.values.length;P++){var A=c.values[P];null!=A.values[v]&&(p=A.values[v],A.highlights&&(S=!(null===A.highlights[v])),A.source.groupName&&""!==A.source.groupName&&(g=f.getFormattedLegendLabel(A.source,c.values,u),/^(ftp|http|https):\/\/[^ "]+$/.test(g)||(g=void 0)))}var T=y.builder().withCategory(this.category,v).createSelectionId();this.dataPoints.push({identity:T,category:C,imageURL:g,value:p,selected:b,selectable:S})}null!=e&&e>this.numberOfCategoriesSelectedInData&&(this.hasSelectionOverride=!0)}},e}();e.ChicletSlicerConverter=i}(C||(C={}));var P;!function(e){function t(e){var t=r(e);return t.y+t.height}function i(){s||(s=$("<span/>"),$("body").append(s),o=d3.select($("body").get(0)).append("svg").style({height:"0px",width:"0px",position:"absolute"}).append("text"),n=$("<canvas/>").get(0).getContext("2d"))}function a(e){return i(),o.style(null),o.text(e.text).attr({visibility:"hidden","font-family":e.fontFamily,"font-size":e.fontSize,"font-weight":e.fontWeight,"font-style":e.fontStyle,"white-space":e.whiteSpace||"nowrap"}),o.node().getBBox()}function r(e){var t={fontFamily:e.fontFamily,fontSize:e.fontSize,text:"M"},i=a(t);return i}var s,o,n;e.estimateSvgTextBaselineDelta=t}(P=t.ChicletSlicerTextMeasurementHelper||(t.ChicletSlicerTextMeasurementHelper={}));var A=function(){function e(){}return e.prototype.bindEvents=function(e,t){var i=this,a=this.slicers=e.slicerItemContainers;this.slicerItemLabels=e.slicerItemLabels,this.slicerItemInputs=e.slicerItemInputs;var r=e.slicerClear;this.dataPoints=e.dataPoints,this.interactivityService=e.interactivityService,this.slicerSettings=e.slicerSettings,this.options=e,this.options.isSelectionLoaded||this.loadSelection(t),a.on("mouseover",function(e){e.selectable&&(e.mouseOver=!0,e.mouseOut=!1,i.renderMouseover())}),a.on("mouseout",function(e){e.selectable&&(e.mouseOver=!1,e.mouseOut=!0,i.renderMouseover())}),a.on("click",function(e,a){if(e.selectable){d3.event.preventDefault();var r=i.slicerSettings;if(d3.event.altKey&&r.general.multiselect){var s=jQuery.map(i.dataPoints,function(e,t){if(e.selected)return t}),o=s.length>0?s[s.length-1]:0;if(o>a){var n=a;a=o,o=n}t.handleClearSelection();for(var l=o;l<=a;l++)t.handleSelection(i.dataPoints[l],!0)}else(d3.event.ctrlKey||d3.event.metaKey)&&r.general.multiselect?t.handleSelection(e,!0):t.handleSelection(e,!1);i.saveSelection(t)}}),r.on("click",function(e){
t.handleClearSelection(),i.saveSelection(t)})},e.prototype.loadSelection=function(e){e.handleClearSelection();var i=this.slicerSettings.general.getSavedSelection();if(i.length){var a=this.dataPoints.filter(function(e){return i.some(function(t){return e.identity.getKey()===t})});a.forEach(function(t){return e.handleSelection(t,!0)}),e.persistSelectionFilter(t.chicletSlicerProps.filterPropertyIdentifier)}},e.getFilterFromSelectors=function(e,t){var i=[],a=e.selectedIds;a.length>0&&(i=_.chain(a).filter(function(e){return e.hasIdentity()}).map(function(e){return e.getSelector()}).value());var r=p.filterFromSelector(i,t);return r},e.prototype.saveSelection=function(t){var i=e.getFilterFromSelectors(t,this.interactivityService.isSelectionModeInverted()),a=t.selectedIds.map(function(e){return e.getKey()});this.slicerSettings.general.setSavedSelection(i,a)},e.prototype.renderSelection=function(e){e||this.interactivityService.isSelectionModeInverted()?this.styleSlicerInputs(this.slicers,e):this.slicers.style("background",this.slicerSettings.slicerText.unselectedColor)},e.prototype.renderMouseover=function(){var e=this;this.slicerItemLabels.style({color:function(t){return t.mouseOver?e.slicerSettings.slicerText.hoverColor:t.mouseOut?t.selected?e.slicerSettings.slicerText.fontColor:e.slicerSettings.slicerText.fontColor:void 0}})},e.prototype.styleSlicerInputs=function(e,t){var i=this.slicerSettings,a=[];e.each(function(e){e.selectable&&e.selected&&a.push(e),d3.select(this).style({background:e.selectable?e.selected?i.slicerText.selectedColor:i.slicerText.unselectedColor:i.slicerText.disabledColor}),d3.select(this).classed("slicerItem-disabled",!e.selectable)})},e}();t.ChicletSlicerWebBehavior=A;var T;!function(e){var t;!function(e){function t(e,t){var i=/^#?([a-f\d])([a-f\d])([a-f\d])$/i;e=e.replace(i,function(e,t,i,a){return t+t+i+i+a+a});var a=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e),r=a?{r:parseInt(a[1],16),g:parseInt(a[2],16),b:parseInt(a[3],16)}:null;return null===r?"":t||0===t?"rgba("+r.r+","+r.g+","+r.b+","+t+")":"rgb("+r.r+","+r.g+","+r.b+")"}e.hexToRGBString=t}(t=e.util||(e.util={}))}(T||(T={}))}(i=t.samples||(t.samples={}))}(t=e.visuals||(e.visuals={}))}(i||(i={}))},function(e,t){var i,a=window.jsCommon,i=window.powerbi;window.powerbitests,window.InJs,window.debug,window.jasmine,window.Microsoft;!function(e){var t;!function(t){var i;!function(t){var i=a.PixelConverter,r=e.createEnumType,s=e.DataViewObjects,o=e.visuals.ObjectEnumerationBuilder,n=e.visuals.dataLabelUtils,l=e.visuals.converterHelper,c=e.VisualDataRoleKind,u=e.data.createDisplayNameGetter,h=e.visuals.utility.SelectionManager,p=e.visuals.ColorHelper,d=e.visuals.valueFormatter,g=e.visuals.SelectionId,m=e.visuals.SelectionIdBuilder,f=e.visuals.TooltipBuilder,y=e.visuals.AnimatorCommon,v=e.DataLabelManager,x=e.visuals.shapes,b=e.visuals.SVGUtil,S=e.visuals.TooltipManager,w=e.Double.lessWithPrecision,C=function(){function e(e,t){this.defaultViewport=e||{width:0,height:0},this.defaultMargin=t||{top:0,bottom:0,right:0,left:0}}return Object.defineProperty(e.prototype,"margin",{get:function(){return this.marginValue||(this.margin=this.defaultMargin)},set:function(t){this.marginValue=e.restrictToMinMax(t),this.update()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"viewport",{get:function(){return this.viewportValue||(this.viewportValue=this.defaultViewport)},set:function(t){this.viewportValue=e.restrictToMinMax(t,this.minViewport),this.update()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"viewportIn",{get:function(){return this.viewportInValue||this.viewport},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"minViewport",{get:function(){return this.minViewportValue},set:function(e){this.minViewportValue=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"viewportInIsZero",{get:function(){return 0===this.viewportIn.width||0===this.viewportIn.height},enumerable:!0,configurable:!0}),e.prototype.resetMargin=function(){this.margin=this.defaultMargin},e.prototype.update=function(){this.viewportInValue=e.restrictToMinMax({width:this.viewport.width-(this.margin.left+this.margin.right),height:this.viewport.height-(this.margin.top+this.margin.bottom)},this.minViewportValue)},e.restrictToMinMax=function(e,t){var i=$.extend({},e);return _.keys(e).forEach(function(a){return i[a]=Math.max(t&&t[a]||0,e[a])}),i},e}(),P=function(){function e(){}return e.interpolateArc=function(e){return function(t){if(!this.oldData)return this.oldData=t,function(){return e(t)};var i=d3.interpolate(this.oldData,t);return this.oldData=i(0),function(t){return e(i(t))}}},e.addContext=function(e,t){return function(){return t.apply(e,[this].concat(_.toArray(arguments)))}},e}(),A=function(){function e(){this.dataPoint={defaultColor:null,showAllDataPoints:!1},this.axis={show:!0},this.labels={show:!0,color:n.defaultLabelColor,fontSize:n.DefaultFontSizeInPt}}return Object.defineProperty(e,"Default",{get:function(){return new this},enumerable:!0,configurable:!0}),e.parse=function(e,t){var i=new this;if(!e||!e.metadata||!e.metadata.objects)return i;var a=this.getProperties(t);for(var r in t.objects)for(var s in t.objects[r].properties)if(i[r]&&_.has(i[r],s)){var o=t.objects[r].properties[s].type,n=this.getValueFnByType(o);i[r][s]=n(e.metadata.objects,a[r][s],i[r][s])}return i},e.getProperties=function(e){var t=_.merge({general:{properties:{formatString:{}}}},e.objects),i={};for(var a in t){i[a]={};for(var r in t[a].properties)i[a][r]={objectName:a,propertyName:r}}return i},e.createEnumTypeFromEnum=function(e){var t=!1;return r(Object.keys(e).filter(function(i,a){return!!(a%2)===t&&e[i]===i&&!void(t=!t)||!!(a%2)!==t}).map(function(e){return{value:e,displayName:e}}))},e.getValueFnByType=function(e){switch(_.keys(e)[0]){case"fill":return s.getFillColor;default:return s.getValue}},e.enumerateObjectInstances=function(e,t,i){var a=new o,r=e&&e[t.objectName];if(!r)return a;var s={objectName:t.objectName,selector:null,properties:{}};for(var n in r)_.has(r,n)&&(s.properties[n]=r[n]);return a.pushInstance(s),a},e}();t.ChordChartSettings=A;var T=function(){function e(){this.Category=null,this.Series=null,this.Y=null}return e.getColumnSources=function(e){return this.getColumnSourcesT(e)},e.getTableValues=function(e){var t=e&&e.table,i=this.getColumnSourcesT(e);return i&&t&&_.mapValues(i,function(e,i){return e&&t.rows.map(function(t){return t[e.index]})})},e.getTableRows=function(e){var t=e&&e.table,i=this.getColumnSourcesT(e);return i&&t&&t.rows.map(function(e){return _.mapValues(i,function(t,i){return t&&e[t.index]})})},e.getCategoricalValues=function(e){var t=e&&e.categorical,i=t&&t.categories||[],a=t&&t.values||[],r=t&&a.source&&this.getSeriesValues(e);return t&&_.mapValues(new this,function(e,t){return _.toArray(i).concat(_.toArray(a)).filter(function(e){return e.source.roles&&e.source.roles[t]}).map(function(e){return e.values})[0]||a.source&&a.source.roles&&a.source.roles[t]&&r})},e.getSeriesValues=function(e){return e&&e.categorical&&e.categorical.values&&e.categorical.values.map(function(e){return l.getSeriesName(e.source)})},e.getCategoricalColumns=function(e){var t=e&&e.categorical,i=t&&t.categories||[],a=t&&t.values||[];return t&&_.mapValues(new this,function(e,t){return i.filter(function(e){return e.source.roles&&e.source.roles[t]})[0]||a.source&&a.source.roles&&a.source.roles[t]||a.filter(function(e){return e.source.roles&&e.source.roles[t]})})},e.getColumnSourcesT=function(e){var t=e&&e.metadata&&e.metadata.columns;return t&&_.mapValues(new this,function(e,i){return t.filter(function(e){return e.roles&&e.roles[i]})[0]})},e.Roles=Object.freeze(_.mapValues(new e,function(e,t){return t})),e}();t.ChordChartColumns=T;var D=function(){function e(){}return Object.defineProperty(e.prototype,"settings",{get:function(){return this.data&&this.data.settings},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"innerRadius",{get:function(){return this.radius*e.InnerArcRadiusRatio},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"outerRadius",{get:function(){return this.radius*e.OuterArcRadiusRatio},enumerable:!0,configurable:!0}),e.converter=function(t,a,r){var s=A.getProperties(e.capabilities),o=e.parseSettings(t),n=T.getCategoricalColumns(t),c=T.getColumnSources(t),u=T.getCategoricalValues(t);if(!u||_.isEmpty(u.Category)||_.isEmpty(u.Y))return null;u.Series=u.Series||T.getSeriesValues(t);var h=[],y={dataPoints:[],title:c.Y.displayName||""},v=[],x=[],b=1e3,S=_.mapValues(_.invert(u.Series),parseFloat),w=_.mapValues(_.invert(u.Category),parseFloat),C=!1,P=[],D=new p(a,s.dataPoint.fill,o.dataPoint.defaultColor),V=this.union_arrays(u.Category,u.Series).reverse();e.getValidArrayLength(V)===e.getValidArrayLength(u.Category)+e.getValidArrayLength(u.Series)&&(C=!0);for(var N=d.create({format:d.getFormatString(c.Category,s.general.formatString,!0)||c.Category.format}),L=d.create({format:d.getFormatString(c.Y,s.general.formatString,!0)||c.Y.format}),M=0,k=V.length;M<k;M++){var I=null,O="",F=!1;if(void 0!==w[V[M]]){var z=w[V[M]];I=m.builder().withCategory(n.Category,w[V[M]]).createSelectionId(),F=!0;var j=n.Category.objects?n.Category.objects[z]:void 0;O=D.getColorForSeriesValue(j,void 0,u.Category[z])}else if(void 0!==S[V[M]]){var z=S[V[M]],G=n.Y[z],R=G&&G.objects&&G.objects[0],B=l.getSeriesName(G.source);I=g.createWithId(G.identity),F=!1,O=D.getColorForSeriesValue(R,void 0,B)}P.push({label:V[M],labelColor:o.labels.color,barColor:O,isCategory:F,identity:I,selected:!1,labelFontSize:i.fromPointToPixel(o.labels.fontSize)}),h.push([]),v.push([]);for(var H=0,E=V.length;H<E;H++){var W=0,U=[];if(void 0!==w[V[M]]&&void 0!==S[V[H]]){var Y=w[V[M]],X=S[V[H]];null!==n.Y[X].values[Y]&&(W=n.Y[X].values[Y],W>b&&(b=W),U=f.createTooltipInfo(s.general.formatString,t.categorical,N.format(u.Category[M]),L.format(W),null,null,X,Y))}else if(C&&void 0!==w[V[H]]&&void 0!==S[V[M]]){var Y=w[V[H]],X=S[V[M]];null!==n.Y[X].values[Y]&&(W=n.Y[X].values[Y])}h[M].push(W||0),v[M].push({tooltipInfo:U})}var q=d3.sum(h[M]);x.push({tooltipInfo:[{displayName:V[M],value:L.format(q)}]})}var K,Z=d3.layout.chord().padding(e.ChordLayoutPadding).matrix(h),J=Z.groups(),$=e.copyArcDescriptorsWithoutNaNValues(J),Q=Z.chords(),ee=Math.round(b/5).toString().length-1;return K=e.getChordArcDescriptors(e.copyArcDescriptorsWithoutNaNValues(J),P),{dataMatrix:h,dataView:t,settings:o,labelDataPoints:K,legendData:y,tooltipData:v,sliceTooltipData:x,tickUnit:Math.pow(10,ee),differentFromTo:C,prevAxisVisible:void 0===r?o.axis.show:r,groups:$,chords:Q}},e.parseSettings=function(t){return A.parse(t,e.capabilities)},e.getValidArrayLength=function(e){for(var t=0,i=0,a=e.length;i<a;i++)void 0!==e[i]&&t++;return t},e.getChordArcDescriptors=function(e,t){return e.forEach(function(e,i){e.data=t[i]}),e},e.prototype.init=function(t){var i=t.element;this.selectionManager=new h({hostServices:t.host}),this.layout=new C(t.viewport,e.DefaultMargin),this.layout.minViewport={width:150,height:150},this.svg=d3.select(i.get(0)).append("svg").style("position","absolute").classed(e.VisualClassName,!0),this.mainGraphicsContext=this.svg.append("g"),this.mainGraphicsContext.append("g").classed("chords",!0),this.slices=this.mainGraphicsContext.append("g").classed("slices",!0),this.mainGraphicsContext.append("g").classed("ticks",!0),this.labels=this.mainGraphicsContext.append("g").classed(e.labelGraphicsContextClass.class,!0),this.lines=this.mainGraphicsContext.append("g").classed(e.linesGraphicsContextClass.class,!0),this.colors=t.style.colorPalette.dataColors},e.prototype.update=function(t){if(t.dataViews&&t.dataViews[0]){if(this.layout.viewport=t.viewport,this.duration=t.suppressAnimations?0:y.MinervaAnimationDuration,this.data=e.converter(t.dataViews[0],this.colors,this.settings&&this.settings.axis.show),!this.data)return void this.clear();this.layout.resetMargin(),this.layout.margin.top=this.layout.margin.bottom=i.fromPointToPixel(this.settings.labels.fontSize)/2,this.render()}},e.prototype.enumerateObjectInstances=function(t){var i=A.enumerateObjectInstances(this.settings,t,e.capabilities);if(this.settings&&"dataPoint"===t.objectName&&!_.isEmpty(this.data.labelDataPoints)&&this.settings.dataPoint.showAllDataPoints)for(var a=0,r=this.data.labelDataPoints.length;a<r;a++){var s=this.data.labelDataPoints[a].data;if(s.isCategory){var o={objectName:"dataPoint",displayName:s.label,selector:p.normalizeSelector(s.identity.getSelector()),properties:{fill:{solid:{color:s.barColor}}}};i.pushInstance(o)}}return i.complete()},e.prototype.calculateRadius=function(){if(this.settings.labels.show){var e=this.layout.viewportIn.height/this.layout.viewportIn.width,t=2+1/(1+Math.exp(-5*(e-1)));return Math.min(this.layout.viewportIn.height,this.layout.viewportIn.width)/t}return Math.min(this.layout.viewportIn.height,this.layout.viewportIn.width)/2},e.prototype.drawCategoryLabels=function(){var e=d3.svg.arc().innerRadius(0).outerRadius(this.innerRadius),t=d3.svg.arc().innerRadius(this.outerRadius).outerRadius(this.outerRadius);if(this.settings.labels.show){var i=this.getChordChartLabelLayout(t),a=this.getDataLabelManager().hideCollidedLabels(this.layout.viewportIn,this.data.labelDataPoints,i,!0);this.renderLabels(a,i,!0),this.renderLines(a,e,t)}else n.cleanDataLabels(this.labels),n.cleanDataLabels(this.lines,!0)},e.prototype.getDataLabelManager=function(){function e(e,t,i,a){if(e.hasConflict(i))return!0;var r={left:0,top:i.height/2,width:a.width,height:a.height};return r=x.Rect.inflate(r,{left:v.InflateAmount,top:0,right:v.InflateAmount,bottom:0}),r=x.Rect.intersect(r,i),!!x.Rect.isEmpty(r)||w(r.height,i.height/2)}var t=new v;return t.hasCollisions=e.bind(t),t},e.prototype.render=function(){var t=this;this.radius=this.calculateRadius();var i=d3.svg.arc().innerRadius(this.radius).outerRadius(this.innerRadius);this.svg.attr({width:this.layout.viewport.width,height:this.layout.viewport.height}),this.mainGraphicsContext.attr("transform",b.translate(this.layout.viewport.width/2,this.layout.viewport.height/2));var a=this.slices.selectAll("path"+e.sliceClass.selector).data(this.getChordTicksArcDescriptors());a.enter().insert("path").classed(e.sliceClass.class,!0),a.style("fill",function(e,i){return t.data.labelDataPoints[i].data.barColor}).style("stroke",function(e,i){return t.data.labelDataPoints[i].data.barColor}).on("click",P.addContext(this,function(e,i,r){t.selectionManager.select(t.data.labelDataPoints[r].data.identity).then(function(i){i.length>0?(t.mainGraphicsContext.selectAll(".chords path.chord").style("opacity",1),t.slices.selectAll("path.slice").style("opacity",.3),t.mainGraphicsContext.selectAll(".chords path.chord").filter(function(e){return e.source.index!==r&&e.target.index!==r}).style("opacity",.3),d3.select(e).style("opacity",1)):(a.style("opacity",1),t.mainGraphicsContext.selectAll(".chords path.chord").filter(function(e){return e.source.index!==r&&e.target.index!==r}).style("opacity",1))}),d3.event.stopPropagation()})).transition().duration(this.duration).attrTween("d",P.interpolateArc(i)),a.exit().remove(),S.addTooltip(a,function(e){return t.data.sliceTooltipData[e.data.index].tooltipInfo});var r=this.svg.select(".chords").selectAll("path"+e.chordClass.selector).data(this.data.chords);r.enter().insert("path").classed(e.chordClass.class,!0),r.style({fill:function(e){return t.data.labelDataPoints[e.target.index].data.barColor},opacity:1}).transition().duration(this.duration).attr("d",d3.svg.chord().radius(this.radius)),r.exit().remove(),this.svg.on("click",function(){return t.selectionManager.clear().then(function(){a.style("opacity",1),r.style("opacity",1)})}),this.drawTicks(),this.drawCategoryLabels(),S.addTooltip(r,function(e){var i=[];return t.data.differentFromTo?i=t.data.tooltipData[e.data.source.index][e.data.source.subindex].tooltipInfo:(i.push({displayName:t.data.labelDataPoints[e.data.source.index].data.label+"->"+t.data.labelDataPoints[e.data.source.subindex].data.label,value:t.data.dataMatrix[e.data.source.index][e.data.source.subindex].toString()}),i.push({displayName:t.data.labelDataPoints[e.data.target.index].data.label+"->"+t.data.labelDataPoints[e.data.target.subindex].data.label,value:t.data.dataMatrix[e.data.target.index][e.data.target.subindex].toString()})),i})},e.prototype.clear=function(){this.mainGraphicsContext.selectAll(e.sliceClass.selector).remove(),this.mainGraphicsContext.selectAll(e.sliceTicksClass.selector).remove(),this.mainGraphicsContext.selectAll(e.chordClass.selector).remove(),this.mainGraphicsContext.selectAll(e.labelsClass.selector).remove(),this.mainGraphicsContext.selectAll(e.lineClass.selector).remove()},e.prototype.clearTicks=function(){var t=[],i=this.mainGraphicsContext.selectAll(e.tickLineClass.selector).data(t);i.exit().remove();var a=this.mainGraphicsContext.selectAll(e.tickTextClass.selector).data(t);a.exit().remove(),this.mainGraphicsContext.selectAll(e.tickPairClass.selector).remove(),this.mainGraphicsContext.selectAll(e.sliceTicksClass.selector).remove()},e.prototype.getChordTicksArcDescriptors=function(){var t=this.data.groups,i=!_.isEmpty(t)&&_.max(t,function(e){return e.value}).value||0,a=!_.isEmpty(t)&&_.min(t,function(e){return e.value}).value||0,r=this.radius/Math.abs(i-a)*1.25,s=d.create({format:"0.##",value:i});return t.forEach(function(t){var i=(t.endAngle-t.startAngle)/t.value,a=Math.abs(t.value),o=d3.range(0,a,a-1<.15?.15:a-1);t.value<0&&(o=o.map(function(e){return e*-1}).reverse());for(var n=1;n<o.length;n++){var l=Math.abs(o[n]-o[n-1])*r;l<e.TicksFontSize&&(o.length>2&&n===o.length-1?o.splice(--n,1):o.splice(n--,1))}t.angleLabels=o.map(function(e,a){return{angle:e*i+t.startAngle,label:s.format(e)}})}),t},e.copyArcDescriptorsWithoutNaNValues=function(e){return _.isEmpty(e)?e:e.map(function(e){var t={};for(var i in e)!e[i]&&isNaN(e[i])?t[i]=0:t[i]=e[i];return t})},e.prototype.drawTicks=function(){var t=this;if(this.settings.axis.show){var i=this.mainGraphicsContext.select(".ticks").selectAll("g"+e.sliceTicksClass.selector).data(this.data.groups),a=this.data.prevAxisVisible===this.settings.axis.show?this.duration:0;i.enter().insert("g").classed(e.sliceTicksClass.class,!0);var r=i.selectAll("g"+e.tickPairClass.selector).data(function(e){return e.angleLabels});r.enter().insert("g").classed(e.tickPairClass.class,!0),r.transition().duration(a).attr("transform",function(e){return"rotate("+(180*e.angle/Math.PI-90)+")translate("+t.innerRadius+",0)"}),r.selectAll("line"+e.tickLineClass.selector).data(function(e){return[e]}).enter().insert("line").classed(e.tickLineClass.class,!0).style("stroke","#000").attr("x1",1).attr("y1",0).attr("x2",5).attr("y2",0),r.selectAll("text"+e.tickTextClass.selector).data(function(e){return[e]}).enter().insert("text").classed(e.tickTextClass.class,!0).style("pointer-events","none").attr("x",8).attr("dy",".35em"),r.selectAll("text"+e.tickTextClass.selector).text(function(e){return e.label}).style("text-anchor",function(e){return e.angle>Math.PI?"end":null}).attr("transform",function(e){return e.angle>Math.PI?"rotate(180)translate(-16)":null}),r.exit().remove(),i.exit().remove()}else this.clearTicks()},e.prototype.renderLabels=function(t,i,a,r){if(void 0===a&&(a=!1),void 0===r&&(r=!1),0===t.length)return n.cleanDataLabels(this.labels,!0),null;var s=null!==t[0].key,o=null!==t[0].identity,l=s?function(e){return e.key}:o?function(e){return e.identity.getKey()}:void 0,c=a?this.labels.selectAll(e.labelsClass.selector).data(t,function(e){return e.data.identity.getKey()}):null!==l?this.labels.selectAll(e.labelsClass.selector).data(t,l):this.labels.selectAll(e.labelsClass.selector).data(t),u=c.enter().append("text").classed(e.labelsClass.class,!0);r&&u.style("opacity",0),c.attr({x:function(e){return e.labelX},y:function(e){return e.labelY},dy:".35em"}).text(function(e){return e.labeltext}).style(i.style),c.exit().remove()},e.prototype.renderLines=function(t,i,a){var r=this,s=this.lines.selectAll("polyline").data(t,function(e){return e.data.identity.getKey()}),o=function(e){return e.startAngle+(e.endAngle-e.startAngle)/2};s.enter().append("polyline").classed(e.lineClass.class,!0),s.attr("points",function(t){var s=a.centroid(t);s[0]=(r.radius+e.LabelMargin/2)*(o(t)<Math.PI?1:-1);var n=a.centroid(t),l=i.centroid(t);return l[0]*=e.InnerLinePointMultiplier,l[1]*=e.InnerLinePointMultiplier,[l,n,s]}).style({opacity:function(t){return e.PolylineOpacity},stroke:function(e){return e.data.labelColor},"pointer-events":"none"}),s.exit().remove()},e.prototype.getChordChartLabelLayout=function(t){var a=this,r=function(e){return e.startAngle+(e.endAngle-e.startAngle)/2},s=(this.layout.viewportIn.width-2*this.radius-2*e.LabelMargin)/1.6;return{labelText:function(e){return n.getLabelFormattedText({label:e.data.label,maxWidth:s,fontSize:i.fromPointToPixel(a.settings.labels.fontSize)})},labelLayout:{x:function(t){return(a.radius+e.LabelMargin)*(r(t)<Math.PI?1:-1)},y:function(e){var i=t.centroid(e);return i[1]}},filter:function(e){return null!==e&&null!==e.data&&null!==e.data.label},style:{fill:function(e){return e.data.labelColor},"text-anchor":function(e){return r(e)<Math.PI?"start":"end"},"font-size":function(e){return i.fromPoint(a.settings.labels.fontSize)}}}},e.union_arrays=function(e,t){for(var i={},a=0;a<e.length;a++)i[e[a]]=e[a];for(var a=0;a<t.length;a++)i[t[a]]=t[a];var r=[];for(var s in i)i.hasOwnProperty(s)&&r.push(i[s]);return r},e.capabilities={dataRoles:[{name:T.Roles.Category,kind:c.Grouping,displayName:"From"},{name:T.Roles.Series,kind:c.Grouping,displayName:"To"},{name:T.Roles.Y,kind:c.Measure,displayName:"Values"}],dataViewMappings:[{conditions:[{Category:{max:1},Series:{max:0}},{Category:{max:1},Series:{min:1,max:1},Y:{max:1}},{Category:{max:1},Series:{max:0},Y:{min:0,max:1}}],categorical:{categories:{for:{in:"Category"},dataReductionAlgorithm:{top:{}}},values:{group:{by:"Series",select:[{bind:{to:"Y"}}],dataReductionAlgorithm:{top:{}}}},rowCount:{preferred:{min:2},supported:{min:1}}}}],objects:{dataPoint:{displayName:u("Visual_DataPoint"),properties:{defaultColor:{displayName:u("Visual_DefaultColor"),type:{fill:{solid:{color:!0}}}},showAllDataPoints:{displayName:u("Visual_DataPoint_Show_All"),type:{bool:!0}},fill:{displayName:u("Visual_Fill"),type:{fill:{solid:{color:!0}}}}}},axis:{displayName:"Axis",properties:{show:{type:{bool:!0}}}},labels:{displayName:"Labels",properties:{show:{type:{bool:!0}},color:{displayName:u("Visual_Reference_Line_Data_Label_Color"),description:u("Visual_Reference_Line_Data_Label_Color_Description"),type:{fill:{solid:{color:!0}}}},fontSize:{displayName:u("Visual_TextSize"),type:{formatting:{fontSize:!0}}}}}}},e.PolylineOpacity=.5,e.OuterArcRadiusRatio=.9,e.InnerArcRadiusRatio=.8,e.LabelMargin=10,e.DefaultMargin={left:10,right:10,top:10,bottom:10},e.VisualClassName="chordChart",e.TicksFontSize=12,e.InnerLinePointMultiplier=2.05,e.ChordLayoutPadding=.1,e.sliceClass={class:"slice",selector:".slice"},e.chordClass={class:"chord",selector:".chord"},e.sliceTicksClass={class:"slice-ticks",selector:".slice-ticks"},e.tickPairClass={class:"tick-pair",selector:".tick-pair"},e.tickLineClass={class:"tick-line",selector:".tick-line"},e.tickTextClass={class:"tick-text",selector:".tick-text"},e.labelGraphicsContextClass={class:"labels",selector:".labels"},e.labelsClass={class:"data-labels",selector:".data-labels"},e.linesGraphicsContextClass={class:"lines",selector:".lines"},e.lineClass={class:"line-label",selector:".line-label"},e}();t.ChordChart=D}(i=t.samples||(t.samples={}))}(t=e.visuals||(e.visuals={}))}(i||(i={}))},function(e,t){var i,a=window.jsCommon,i=window.powerbi;window.powerbitests,window.InJs,window.debug,window.jasmine,window.Microsoft;!function(e){var t;!function(t){var i;!function(t){var i=a.PixelConverter,r=a.CssConstants.createClassAndSelector,s=e.data.DataRoleHelper.getCategoryIndexOfRole,o=e.data.DataRoleHelper.getMeasureIndexOfRole,n=e.visuals.InteractivityUtils.registerStandardInteractivityHandlers,l=a.Lazy,c=e.TextMeasurementService.measureSvgTextWidth,u=e.TextMeasurementService.measureSvgTextHeight,h=e.TextMeasurementService.estimateSvgTextHeight,p=e.TextMeasurementService.svgEllipsis,d=e.visuals.TooltipManager.addTooltip,g=a.PixelConverter.fromPoint,m=e.visuals.dataLabelUtils.LabelTextProperties,f=e.visuals.dataLabelUtils.getLabelFormattedText,y=e.Double.equalWithPrecision,v=e.visuals.AnimatorCommon.GetAnimationDuration,x=e.TextMeasurementService.getTailoredTextOrDefault,b=e.visuals.LegendData,S=e.visuals.SelectionId,w=e.DataViewObject,C=e.VisualDataRoleKind,P=e.visuals.legendPosition,A=e.visuals.BaseAnimator,T=e.visuals.yAxisPosition,D=e.visuals.appendClearCatcher,V=e.visuals.createInteractivityService,N=e.visuals.createLegend,L=e.visuals.AxisHelper,M=e.DataViewObjects,k=e.visuals.valueFormatter,I=e.visuals.dataLabelUtils,O=e.visuals.ColorHelper,F=e.visuals.LegendIcon,z=e.visuals.SelectionIdBuilder,j=e.visuals.TooltipBuilder,G=e.visuals.getInvalidValueWarnings,R=e.visuals.legendProps,B=e.visuals.LegendPosition,H=e.visuals.Legend,E=e.visuals.SVGUtil,W=e.visuals.ObjectEnumerationBuilder,U=e.visuals.GradientUtils,Y=e.visuals.axisType,X=e.visuals.axisScale,q=e.visuals.axisStyle,K=function(){function e(){this.ScrollBarWidth=10}return Object.defineProperty(e.prototype,"margin",{get:function(){return this._margin||{left:0,right:0,top:0,bottom:0}},set:function(t){this._margin=$.extend({},t),this._viewportIn=e.substractMargin(this.viewport,this.margin)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"viewport",{get:function(){return this._viewport||{width:0,height:0}},set:function(t){this._viewport=$.extend({},t),this._viewportIn=e.substractMargin(this.viewport,this.margin)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"viewportIn",{get:function(){return this._viewportIn||this.viewport},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"legendViewport",{get:function(){return this.legend.getMargins()},enumerable:!0,configurable:!0}),e.getPropertiesByCapabilities=function(e){var t={};if(!e)return t;for(var i in e.objects){var a=e.objects[i];if(t[i]={},a)for(var r in a.properties)t[i][r]={objectName:i,propertyName:r}}return t},e.substractMargin=function(e,t){return{width:Math.max(e.width-(t.left+t.right),0),height:Math.max(e.height-(t.top+t.bottom),0)}},e.getCustomSymbolType=function(e){var t=d3.map({circle:function(e){var t=Math.sqrt(e/Math.PI);return"M0,"+t+"A"+t+","+t+" 0 1,1 0,"+-t+"A"+t+","+t+" 0 1,1 0,"+t+"Z"},cross:function(e){var t=Math.sqrt(e/5)/2;return"M"+-3*t+","+-t+"H"+-t+"V"+-3*t+"H"+t+"V"+-t+"H"+3*t+"V"+t+"H"+t+"V"+3*t+"H"+-t+"V"+t+"H"+-3*t+"Z"},diamond:function(e){var t=Math.sqrt(e/(2*Math.tan(Math.PI/6))),i=t*Math.tan(Math.PI/6);return"M0,"+-t+"L"+i+",0 0,"+t+" "+-i+",0Z"},square:function(e){var t=Math.sqrt(e)/2;return"M"+-t+","+-t+"L"+t+","+-t+" "+t+","+t+" "+-t+","+t+"Z"},"triangle-up":function(e){var t=Math.sqrt(e/Math.sqrt(3)),i=t*Math.sqrt(3)/2;return"M0,"+-i+"L"+t+","+i+" "+-t+","+i+"Z"},"triangle-down":function(e){var t=Math.sqrt(e/Math.sqrt(3)),i=t*Math.sqrt(3)/2;return"M0,"+i+"L"+t+","+-i+" "+-t+","+-i+"Z"},star:function(e){for(var t=Math.sqrt(e/2),i=Math.sqrt(e/10),a="",r=Math.PI/5,s=0;s<10;s++){var o=0===(1&s)?t:i,n=Math.cos(s*r)*o,l=Math.sin(s*r)*o;0===s?a="M"+n+","+l+"L":a+=" "+n+","+l}return a+"Z"},hexagon:function(e){var t=Math.sqrt(e/(6*Math.sqrt(3))),i=Math.sqrt(e/(2*Math.sqrt(3)));return"M0,"+2*t+"L"+-i+","+t+" "+-i+","+-t+" 0,"+-2*t+" "+i+","+-t+" "+i+","+t+"Z"},x:function(e){var t=Math.sqrt(e/10);return"M0,"+t+"L"+-t+","+2*t+" "+-2*t+","+t+" "+-t+",0 "+-2*t+","+-t+" "+-t+","+-2*t+" 0,"+-t+" "+t+","+-2*t+" "+2*t+","+-t+" "+t+",0 "+2*t+","+t+" "+t+","+2*t+"Z"},uparrow:function(e){var t=Math.sqrt(e/12);return"M"+t+","+3*t+"L"+-t+","+3*t+" "+-t+","+-t+" "+-2*t+","+-t+" 0,"+-3*t+" "+2*t+","+-t+" "+t+","+-t+"Z"},downarrow:function(e){var t=Math.sqrt(e/12);return"M0,"+3*t+"L"+-2*t+","+t+" "+-t+","+t+" "+-t+","+-3*t+" "+t+","+-3*t+" "+t+","+t+" "+2*t+","+t+"Z"}}),i=t.entries()[0].value;if(e){if(isNaN(e))return t[e&&e.toString().toLowerCase()]||i;var a=t.entries()[Math.floor(e)];return a?a.value:i}return i},e.prototype.init=function(t){this.options=t,this.animator=new A,this.behavior=new Z([new J(e.DimmedBubbleOpacity,e.DefaultBubbleOpacity)]);var i=this.element=t.element;this.viewport=_.clone(t.viewport),this.style=t.style,this.hostServices=t.host,this.colors=this.style.colorPalette.dataColors,this.interactivity=t.interactivity,this.margin={top:1,right:1,bottom:1,left:1},this.yAxisOrientation=T.left,this.adjustMargins();var a=this.scrollY=!0,r=this.scrollX=!0,s=this.svg=d3.select(i.get(0)).append("svg").style("position","absolute").classed(e.ClassName,!0),o=this.axisGraphicsContext=s.append("g").classed(e.AxisGraphicsContextClassName,!0);this.svgScrollable=s.append("svg").classed("svgScrollable",!0).style("overflow","hidden");var n=this.axisGraphicsContextScrollable=this.svgScrollable.append("g").classed(e.AxisGraphicsContextClassName,!0);this.clearCatcher=D(this.axisGraphicsContextScrollable);var l=a?n:o;this.backgroundGraphicsContext=o.append("svg:image"),this.xAxisGraphicsContext=a?o.append("g").attr("class","x axis"):n.append("g").attr("class","x axis"),this.y1AxisGraphicsContext=l.append("g").attr("class","y axis"),this.xAxisGraphicsContext.classed("showLinesOnAxis",a),this.y1AxisGraphicsContext.classed("showLinesOnAxis",r),this.xAxisGraphicsContext.classed("hideLinesOnAxis",!a),this.y1AxisGraphicsContext.classed("hideLinesOnAxis",!r),this.interactivityService=V(this.hostServices),this.legend=N(i,this.interactivity&&this.interactivity.isInteractiveLegend,this.interactivityService,!0),this.mainGraphicsG=this.axisGraphicsContextScrollable.append("g").classed(e.MainGraphicsContextClassName,!0),this.mainGraphicsSVGSelection=this.mainGraphicsG.append("svg"),this.mainGraphicsContext=this.mainGraphicsSVGSelection.append("g"),this.svgDefaultImage="",this.keyArray=[]},e.prototype.adjustMargins=function(){var e=this.element.find(".x.axis");0===L.getRecommendedNumberOfTicksForXAxis(this.viewportIn.width)&&0===L.getRecommendedNumberOfTicksForYAxis(this.viewportIn.height)?(this.margin={top:0,right:0,bottom:0,left:0},e.hide()):e.show()},e.prototype.getValueAxisProperties=function(e,t){var i={};if(!e)return i;var a=e.objects;if(a){var r=a.valueAxis;r&&(i={show:r.show,position:r.position,axisScale:r.axisScale,start:r.start,end:r.end,showAxisTitle:null==r.showAxisTitle?t:r.showAxisTitle,axisStyle:r.axisStyle,axisColor:r.axisColor,secShow:r.secShow,secPosition:r.secPosition,secAxisScale:r.secAxisScale,secStart:r.secStart,secEnd:r.secEnd,secShowAxisTitle:r.secShowAxisTitle,secAxisStyle:r.secAxisStyle,labelDisplayUnits:r.labelDisplayUnits})}return i},e.prototype.getCategoryAxisProperties=function(e,t){var i={};if(!e)return i;var a=e.objects;if(a){var r=a.categoryAxis;r&&(i={show:r.show,axisType:r.axisType,axisScale:r.axisScale,axisColor:r.axisColor,start:r.start,end:r.end,showAxisTitle:null==r.showAxisTitle?t:r.showAxisTitle,axisStyle:r.axisStyle,labelDisplayUnits:r.labelDisplayUnits})}return i},e.converter=function(t,i,a,r,s){if(!t)return e.getDefaultData();var o,n,l,c,u,h=t.categorical,p=t.metadata,d=h.categories||[],g=h.values,m=!!g.source,f=g.grouped(),y=g.source,v=e.getMetadata(d,f,y),x=v.idx.category,b=v.idx.image>=0,S=v.idx.colorFill>=0;if(h.categories&&h.categories.length>0&&h.categories[x]){var w=h.categories[x];o=w.values,n=k.create({format:k.getFormatString(w.source,e.Properties.general.formatString),value:o[0],value2:o[o.length-1]}),c=w.identity,l=w.objects,u=w.source?w.source.queryName:null}else o=[null],n=k.createDefaultFormatter(null);var C=I.getDefaultPointLabelSettings(),P=!1,A={show:!1,url:""},T=!1,D=!1,V="",N=!0;if(p&&p.objects){var L=p.objects;V=M.getFillColor(L,e.Properties.dataPoint.defaultColor),N=M.getValue(L,e.Properties.dataPoint.showAllDataPoints);var O=L.categoryLabels;O&&(C.show=void 0!==O.show?O.show:C.show,C.fontSize=void 0!==O.fontSize?O.fontSize:C.fontSize,void 0!==O.color&&(C.labelColor=O.color.solid.color)),
P=M.getValue(L,e.Properties.fillPoint.show,P);var F=L.backdrop;void 0!==F&&(A.show=F.show,A.show&&(A.url=F.url));var z=L.crosshair;void 0!==z&&(T=z.show);var j=L.outline;void 0!==j&&(D=j.show)}var G=e.createDataPoints(g,v,d,o,n,c,l,i,m,C,V,u);a&&a.applySelectionStateToData(G);var R=[];if(m){var B=k.getFormatString(y,e.Properties.general.formatString);R=e.createSeriesLegend(g,i,g,B,V)}var H=g&&y?y.displayName:"";H||(H=d&&d[x]&&d[x].source&&d[x].source.displayName?d[x].source.displayName:"");var E={title:H,dataPoints:R},W=e.getSizeRangeForGroups(f,v.idx.size);if(r&&null!==r.showAxisTitle&&r.showAxisTitle===!1&&(v.axesLabels.x=null),s&&null!==s.showAxisTitle&&s.showAxisTitle===!1&&(v.axesLabels.y=null),G&&G[0]){var U=G[0];null!=U.backdrop&&(A.show=!0,A.url=U.backdrop),null!=U.xStart&&(r.start=U.xStart),null!=U.xEnd&&(r.end=U.xEnd),null!=U.yStart&&(s.start=U.yStart),null!=U.yEnd&&(s.end=U.yEnd)}return{xCol:v.cols.x,yCol:v.cols.y,dataPoints:G,legendData:E,axesLabels:v.axesLabels,selectedIds:[],size:v.cols.size,sizeRange:W,dataLabelsSettings:C,defaultDataPointColor:V,hasDynamicSeries:m,showAllDataPoints:N,fillPoint:P,useShape:b,useCustomColor:S,backdrop:A,crosshair:T,outline:D}},e.createSeriesLegend=function(t,i,a,r,s){for(var o=[],n=t.grouped(),l=new O(i,e.Properties.dataPoint.fill,s),c=0,u=n.length;c<u;c++){var h,p,d=n[c];p=l.getColorForSeriesValue(d.objects,t.identityFields,d.name),h=d.identity?S.createWithId(d.identity):S.createNull(),o.push({color:p,icon:F.Circle,label:k.format(d.name,r),identity:h,selected:!1})}return o},e.getSizeRangeForGroups=function(t,i){var a={};return t&&t.forEach(function(t){var r=e.getMeasureValue(i,t.values),s=L.getRangeForColumn(r);(null==a.min||a.min>s.min)&&(a.min=s.min),(null==a.max||a.max<s.max)&&(a.max=s.max)}),a},e.getMetadata=function(t,i,a){var r,n,l,c=s(t,e.ColumnCategory),u=s(t,e.ColumnColorFill),h=s(t,e.ColumnImage),p=s(t,e.ColumnBackdrop),d=o(i,e.ColumnX),g=o(i,e.ColumnY),m=o(i,e.ColumnSize),f=o(i,e.ColumnShape),y=o(i,e.ColumnRotation),v=o(i,e.ColumnXStart),x=o(i,e.ColumnXEnd),b=o(i,e.ColumnYStart),S=o(i,e.ColumnYEnd),w="",C="";if(i&&i.length){var P=i[0];d>=0&&(r=P.values[d].source,w=P.values[d].source.displayName),g>=0&&(n=P.values[g].source,C=P.values[g].source.displayName),m>=0&&(l=P.values[m].source)}return{idx:{category:c,x:d,y:g,size:m,colorFill:u,shape:f,image:h,rotation:y,backdrop:p,xStart:v,xEnd:x,yStart:b,yEnd:S},cols:{x:r,y:n,size:l},axesLabels:{x:w,y:C}}},e.createLazyFormattedCategory=function(e,t){return new l(function(){return e.format(t)})},e.createDataPoints=function(t,a,r,s,o,n,l,c,u,h,p,d){var g,m,f=[],y=a.idx,v=t.source,x=t.grouped(),b=i.fromPoint(h.fontSize);m=e.Properties.general.formatString,g=new O(c,e.Properties.dataPoint.fill,p);for(var S=0,w=s.length;S<w;S++)for(var C=s[S],P=0,A=x.length;P<A;P++){var T=r[y.colorFill],D=r[y.image],V=r[y.backdrop],N=x[P],L=N.values,M=e.getMeasureValue(y.x,L),k=e.getMeasureValue(y.y,L),I=e.getMeasureValue(y.size,L),F=e.getMeasureValue(y.shape,L),G=e.getMeasureValue(y.rotation,L),R=e.getMeasureValue(y.xStart,L),B=e.getMeasureValue(y.xEnd,L),H=e.getMeasureValue(y.yStart,L),E=e.getMeasureValue(y.yEnd,L),W=M&&M.values&&!isNaN(M.values[S])?M.values[S]:null,U=k&&k.values&&!isNaN(k.values[S])?k.values[S]:0,_=null==W||null==U;if(!_){var Y,X,q,K,Z,J,$,Q,ee,te,ie;if(Y=e.getValueFromDataViewValueColumnById(I,S),X=e.getValueFromDataViewValueColumnById(T,S),q=e.getCustomSymbolType(e.getValueFromDataViewValueColumnById(F,S)),K=e.getValueFromDataViewValueColumnById(D,S),Z=e.getNumberFromDataViewValueColumnById(G,S),J=e.getValueFromDataViewValueColumnById(V,S),$=e.getValueFromDataViewValueColumnById(R,S),Q=e.getValueFromDataViewValueColumnById(B,S),ee=e.getValueFromDataViewValueColumnById(H,S),te=e.getValueFromDataViewValueColumnById(E,S),u)ie=g.getColorForSeriesValue(N.objects,t.identityFields,N.name);else{var ae=null!=I?I.source.queryName:"";ie=g.getColorForMeasure(l&&l[S],ae)}var re=r&&r.length>0?r[y.category]:null,se=z.builder().withCategory(re,S).withSeries(t,N).createSelectionId(),oe=[];v&&oe.push({value:N.name,metadata:{source:v,values:[]}}),M&&oe.push({value:W,metadata:M}),k&&oe.push({value:U,metadata:k}),I&&I.values&&I.values.length>0&&oe.push({value:I.values[S],metadata:I}),T&&T.values&&T.values.length>0&&oe.push({value:T.values[S],metadata:T}),F&&F.values&&F.values.length>0&&oe.push({value:F.values[S],metadata:F}),D&&D.values&&D.values.length>0&&oe.push({value:D.values[S],metadata:D}),G&&G.values&&G.values.length>0&&oe.push({value:G.values[S],metadata:G}),V&&V.values&&V.values.length>0&&oe.push({value:V.values[S],metadata:V}),R&&R.values&&R.values.length>0&&oe.push({value:R.values[S],metadata:R}),B&&B.values&&B.values.length>0&&oe.push({value:B.values[S],metadata:B}),H&&H.values&&H.values.length>0&&oe.push({value:H.values[S],metadata:H}),E&&E.values&&E.values.length>0&&oe.push({value:E.values[S],metadata:E});var ne=j.createTooltipInfo(m,void 0,C,null,re?[re]:void 0,oe,void 0),le={x:W,y:U,size:Y,radius:{sizeMeasure:I,index:S},fill:ie,formattedCategory:this.createLazyFormattedCategory(o,C),selected:!1,identity:se,tooltipInfo:ne,labelFill:h.labelColor,labelFontSize:b,contentPosition:8,colorFill:X,shapeSymbolType:q,svgurl:K,rotation:Z,backdrop:J,xStart:$,xEnd:Q,yStart:ee,yEnd:te};f.push(le)}}return f},e.getMeasureValue=function(e,t){return t&&e>=0?t[e]:null},e.getNumberFromDataViewValueColumnById=function(t,i){var a=e.getValueFromDataViewValueColumnById(t,i);return a&&!isNaN(a)?a:0},e.getValueFromDataViewValueColumnById=function(e,t){return e&&e.values?e.values[t]:null},e.getDefaultData=function(){return{xCol:void 0,yCol:void 0,dataPoints:[],legendData:{dataPoints:[]},axesLabels:{x:"",y:""},selectedIds:[],sizeRange:[],dataLabelsSettings:I.getDefaultPointLabelSettings(),defaultDataPointColor:null,hasDynamicSeries:!1,useShape:!1,useCustomColor:!1}},e.prototype.setData=function(t){if(this.data=e.getDefaultData(),t&&t.length>0){var i=t[0];i&&(this.categoryAxisProperties=this.getCategoryAxisProperties(i.metadata,!0),this.valueAxisProperties=this.getValueAxisProperties(i.metadata,!0),this.dataView=i,i.categorical&&i.categorical.values&&(this.data=e.converter(i,this.colors,this.interactivityService,this.categoryAxisProperties,this.valueAxisProperties)))}},e.prototype.update=function(e){var t=this.dataViews=e.dataViews;if(this.viewport=_.clone(e.viewport),t){if(t&&t.length>0){var i=G(t,!1,!1,!1);i&&i.length>0&&this.hostServices.setWarnings(i),this.populateObjectProperties(t)}this.setData(t),this.options.interactivity&&this.options.interactivity.isInteractiveLegend||this.renderLegend(),this.render(e.suppressAnimations)}},e.prototype.populateObjectProperties=function(e){if(e&&e.length>0){var t=e[0].metadata;t?this.legendObjectProperties=M.getObject(t.objects,"legend",{}):this.legendObjectProperties={},this.categoryAxisProperties=this.getCategoryAxisProperties(t),this.valueAxisProperties=this.getValueAxisProperties(t);var i=this.valueAxisProperties.position;this.yAxisOrientation=i?i.toString():T.left}},e.prototype.renderLegend=function(){var t={title:"",dataPoints:[]},i=this.legend;this.layerLegendData=this.data.legendData,this.layerLegendData&&(t.title=this.layerLegendData.title||"",t.dataPoints=t.dataPoints.concat(this.layerLegendData.dataPoints||[]),t.fontSize=this.legendLabelFontSize?this.legendLabelFontSize:e.LegendLabelFontSizeDefault,this.layerLegendData.grouped&&(t.grouped=!0));var a=this.legendObjectProperties;if(a){b.update(t,a);var r=a[R.position];r&&i.changeOrientation(B[r])}else i.changeOrientation(B.Top);1!==t.dataPoints.length||t.grouped||(t.dataPoints=[]);var s=this.viewport;i.drawLegend(t,{height:s.height,width:s.width}),H.positionChartArea(this.svg,i)},e.prototype.shouldRenderAxis=function(e,t){return void 0===t&&(t="show"),!!e&&(!e.isCategoryAxis||this.categoryAxisProperties&&null!=this.categoryAxisProperties[t]&&!this.categoryAxisProperties[t]?!(e.isCategoryAxis||this.valueAxisProperties&&null!=this.valueAxisProperties[t]&&!this.valueAxisProperties[t])&&(e.values&&e.values.length>0):e.values&&e.values.length>0)},e.prototype.getMaxMarginFactor=function(){return this.options.style.maxMarginFactor||.25},e.prototype.adjustViewportbyBackdrop=function(){var e=new Image,t=this;if(e.src=this.data.backdrop.url,e.onload=function(){t.oldBackdrop!==this.src&&(t.render(!0),t.oldBackdrop=this.src)},e.width>0&&e.height>0)if(e.width*this.viewportIn.height<this.viewportIn.width*e.height){var i=this.viewportIn.width-this.viewportIn.height*e.width/e.height;this.viewport={width:this.viewport.width-i,height:this.viewport.height}}else{var a=this.viewportIn.height-this.viewportIn.width*e.height/e.width;this.viewport={width:this.viewport.width,height:this.viewport.height-a}}},e.prototype.render=function(t){if(this.viewport.height-=this.legendViewport.height,this.viewport.width-=this.legendViewport.width,0!==this.viewportIn.width&&0!==this.viewportIn.height){var i=this.getMaxMarginFactor();this.leftRightMarginLimit=this.viewport.width*i;var a=this.bottomMarginLimit=Math.max(25,Math.ceil(this.viewport.height*i));this.margin.top=8,this.margin.bottom=a,this.margin.right=0,this.calculateAxes(this.categoryAxisProperties,this.valueAxisProperties,e.TextProperties,!0),this.yAxisIsCategorical=this.yAxisProperties.isCategoryAxis,this.hasCategoryAxis=this.yAxisIsCategorical?this.yAxisProperties&&this.yAxisProperties.values.length>0:this.xAxisProperties&&this.xAxisProperties.values.length>0;var r,s=this.shouldRenderAxis(this.xAxisProperties),o=this.shouldRenderAxis(this.yAxisProperties);this.isXScrollBarVisible=!1,this.isYScrollBarVisible=!1;var n,l,h,p=this.yAxisOrientation,g=p===T.right;this.calculateAxes(this.categoryAxisProperties,this.valueAxisProperties,e.TextProperties,!0);for(var m=!1,f=2,y=0;!m&&y<f;){y++,n=L.getTickLabelMargins({width:this.viewportIn.width,height:this.viewport.height},this.leftRightMarginLimit,c,u,{x:this.xAxisProperties,y1:this.yAxisProperties},this.bottomMarginLimit,e.TextProperties,this.isXScrollBarVisible||this.isYScrollBarVisible,g,s,o,!1);var x=g?n.yRight:n.yLeft,b=g?n.yLeft:n.yRight,S=n.xMax;x+=10,b+=10,S+=12,g&&o&&(b+=20),!g&&o&&(x+=20),this.addUnitTypeToAxisLabel(this.xAxisProperties,this.yAxisProperties),l={x:this.xAxisProperties.axisLabel,y:this.yAxisProperties.axisLabel,y2:null},h=null!=l.x||null!=l.y||null!=l.y2,null!=l.x&&(S+=18),null!=l.y&&(x+=20),null!=l.y2&&(b+=20),this.margin.left=g?b:x,this.margin.right=g?x:b,this.margin.bottom=S;var w=this.yAxisProperties.values.length;this.calculateAxes(this.categoryAxisProperties,this.valueAxisProperties,e.TextProperties,!0),this.yAxisProperties.values.length===w&&(m=!0)}if(this.data.backdrop&&this.data.backdrop.show&&void 0!==this.data.backdrop.url)for(this.adjustViewportbyBackdrop(),m=!1,f=2,y=0;!m&&y<f;){y++,n=L.getTickLabelMargins({width:this.viewportIn.width,height:this.viewport.height},this.leftRightMarginLimit,c,u,{x:this.xAxisProperties,y1:this.yAxisProperties},this.bottomMarginLimit,e.TextProperties,this.isXScrollBarVisible||this.isYScrollBarVisible,g,s,o,!1);var x=g?n.yRight:n.yLeft,b=g?n.yLeft:n.yRight,S=n.xMax;x+=10,g&&o&&(b+=15),S+=12,this.addUnitTypeToAxisLabel(this.xAxisProperties,this.yAxisProperties),l={x:this.xAxisProperties.axisLabel,y:this.yAxisProperties.axisLabel,y2:null},h=null!=l.x||null!=l.y||null!=l.y2,null!=l.x&&(S+=18),null!=l.y&&(x+=20),null!=l.y2&&(b+=20),this.margin.left=g?b:x,this.margin.right=g?x:b,this.margin.bottom=S;var w=this.yAxisProperties.values.length;this.calculateAxes(this.categoryAxisProperties,this.valueAxisProperties,e.TextProperties,!0),this.yAxisProperties.values.length===w&&(m=!0)}if(this.renderChart(r,this.xAxisProperties,this.yAxisProperties,n,h,l,t),this.updateAxis(),this.data){var C=this.data,P=this.data.dataPoints,A=this.interactivityService&&this.interactivityService.hasSelection();this.mainGraphicsSVGSelection.attr("width",this.viewportIn.width).attr("height",this.viewportIn.height);var D=P.sort(function(e,t){return t.radius.sizeMeasure?t.radius.sizeMeasure.values[t.radius.index]-e.radius.sizeMeasure.values[e.radius.index]:0}),V=v(this.animator,t),N=this.drawScatterMarkers(D,A,C.sizeRange,V),M=this.data.dataLabelsSettings;if(M.show){var k,O,F;k=this.getEnhanchedScatterChartLabelLayout(M,this.viewportIn,C.sizeRange),O=this.cloneDataPoints(P),F=I.drawDefaultLabelsForDataPointChart(O,this.mainGraphicsG,k,this.viewportIn),F&&F.attr("transform",function(t){var i,a,r=t.size;return i=r.width/e.DataLabelXOffset,a=r.height/e.DataLabelYOffset,E.translate(i,a)})}else I.cleanDataLabels(this.mainGraphicsG);this.renderCrosshair(C);var z;if(this.interactivityService&&(z={dataPointsSelection:N,data:this.data,plotContext:this.mainGraphicsSVGSelection}),d(N,function(e){return e.data.tooltipInfo}),E.flushAllD3TransitionsIfNeeded(this.options),this.behavior){var j=[z];if(this.interactivityService){var G={layerOptions:j,clearCatcher:this.clearCatcher};this.interactivityService.bind(P,this.behavior,G)}}}}},e.prototype.cloneDataPoints=function(e){return e.map(function(e){return _.clone(e)})},e.prototype.darkenZeroLine=function(e){var t=e.selectAll("g.tick").filter(function(e){return 0===e}).node();t&&d3.select(t).select("line").classed("zero-line",!0)},e.prototype.getCategoryAxisFill=function(){if(this.dataView&&this.dataView.metadata.objects){var e=this.dataView.metadata.objects.categoryAxis;if(e)return e.axisColor}return{solid:{color:"#333"}}},e.prototype.getEnhanchedScatterChartLabelLayout=function(t,i,a){var r=this.xAxisProperties.scale,s=this.yAxisProperties.scale,o=g(t.fontSize),n=m.fontFamily;return{labelText:function(e){return f({label:e.formattedCategory.getValue(),fontSize:t.fontSize,maxWidth:i.width})},labelLayout:{x:function(e){return r(e.x)},y:function(r){var o=e.getBubbleRadius(r.radius,a,i)+I.labelMargin;return 0===t.position?s(r.y)-o:s(r.y)+o}},filter:function(e){return null!=e&&null!=e.formattedCategory.getValue()},style:{fill:function(e){return e.labelFill},"font-size":o,"font-family":n}}},e.getBubbleRadius=function(t,i,a){var r=null,s=null,o=t.sizeMeasure;if(!o)return e.BubbleRadius;var n=i.min?i.min:0,l=i.max?i.max:0,c=Math.min(n,0),u=Math.max(l,0);if(r={minRange:c,maxRange:u,delta:u-c},s=e.getBubblePixelAreaSizeRange(a,e.MinSizeRange,e.MaxSizeRange),o.values){var h=o.values[t.index];if(null!=h)return e.projectSizeToPixels(h,r,s)/2}return e.BubbleRadius},e.getBubblePixelAreaSizeRange=function(t,i,a){var r=1;if(t.height>0&&t.width>0){var s=Math.min(t.height,t.width);r=s*s/e.AreaOf300By300Chart}var o=Math.round(i*r),n=Math.round(a*r);return{minRange:o,maxRange:n,delta:n-o}},e.projectSizeToPixels=function(t,i,a){var r=0;if(i){if(r=a.maxRange,0!==i.delta){var s=Math.min(Math.max(t,i.minRange),i.maxRange);r=e.project(s,i,a)}r=2*Math.sqrt(r/Math.PI)}return Math.round(r)},e.project=function(t,i,a){if(0===i.delta||0===a.delta)return e.rangeContains(i,t)?a.minRange:null;var r=(t-i.minRange)/i.delta;return a.minRange+r*a.delta},e.rangeContains=function(e,t){return e.minRange<=t&&t<=e.maxRange},e.prototype.getValueAxisFill=function(){if(this.dataView&&this.dataView.metadata.objects){var e=this.dataView.metadata.objects.valueAxis;if(e)return e.axisColor}return{solid:{color:"#333"}}},e.prototype.renderCrosshair=function(t){if(this.mainGraphicsSVGSelection)return this.crosshairCanvasSelection=this.addCrosshairCanvasToDOM(this.mainGraphicsSVGSelection),t&&t.crosshair?(this.crosshairVerticalLineSelection=this.addCrosshairLineToDOM(this.crosshairCanvasSelection,e.CrosshairVerticalLineSelector),this.crosshairHorizontalLineSelection=this.addCrosshairLineToDOM(this.crosshairCanvasSelection,e.CrosshairHorizontalLineSelector),this.crosshairTextSelection=this.addCrosshairTextToDOM(this.crosshairCanvasSelection),this.bindCrosshairEvents()):this.clearCrosshair(),this.crosshairCanvasSelection},e.prototype.clearCrosshair=function(){this.crosshairCanvasSelection&&this.crosshairCanvasSelection.selectAll("*").remove()},e.prototype.addCrosshairCanvasToDOM=function(t){var i=e.CrosshairCanvasSelector;return this.addElementToDOM(t,{name:"g",selector:i.selector,className:i.class,styles:{display:"none"}})},e.prototype.addCrosshairLineToDOM=function(t,i){var a=e.CrosshairLineSelector;return this.addElementToDOM(t,{name:"line",selector:i.selector,className:a.class+" "+i.class,attributes:{x1:0,y1:0,x2:0,y2:0}})},e.prototype.addCrosshairTextToDOM=function(t){var i=e.CrosshairTextSelector;return this.addElementToDOM(t,{name:"text",selector:i.selector,className:i.class})},e.prototype.bindCrosshairEvents=function(){var e=this;this.axisGraphicsContextScrollable&&this.axisGraphicsContextScrollable.on("mousemove",function(){var t=d3.event.currentTarget,i=d3.mouse(t),a=t.viewportElement,r=a.getBoundingClientRect(),s=a.getBBox(),o=r.width/s.width,n=r.height/s.height,l=i[0],c=i[1];s.width>0&&!y(o,1,1e-5)&&(l/=o),s.height>0&&!y(n,1,1e-5)&&(c/=n),e.updateCrosshair(l,c)}).on("mouseover",function(){e.crosshairCanvasSelection.style("display","block")}).on("mouseout",function(){e.crosshairCanvasSelection.style("display","none")})},e.prototype.updateCrosshair=function(t,i){if(this.viewportIn&&this.crosshairHorizontalLineSelection&&this.crosshairVerticalLineSelection&&this.crosshairTextSelection&&this.xAxisProperties){var a,r,s=e.CrosshairTextMargin,o=this.xAxisProperties.scale,n=this.yAxisProperties.scale;this.crosshairHorizontalLineSelection.attr({x1:0,y1:i,x2:this.viewportIn.width,y2:i}),this.crosshairVerticalLineSelection.attr({x1:t,y1:0,x2:t,y2:this.viewportIn.height}),a=Math.round(100*o.invert(t))/100,r=Math.round(100*n.invert(i))/100,this.crosshairTextSelection.attr({x:t+s,y:i-s}).text("("+a+", "+r+")")}},e.prototype.addElementToDOM=function(e,t){if(!e||!t)return null;var i,a;return i=e.selectAll(t.selector),a=i.data(t.data||[[]]),a.enter().append(t.name).attr(t.attributes).style(t.styles).classed(t.className,!0),a.exit().remove(),a},e.prototype.renderBackground=function(){this.data.backdrop&&this.data.backdrop.show&&void 0!==this.data.backdrop.url?this.backgroundGraphicsContext.attr("xlink:href",this.data.backdrop.url).attr("x",0).attr("y",0).attr("width",this.viewportIn.width).attr("height",this.viewportIn.height):this.backgroundGraphicsContext.attr("width",0).attr("height",0)},e.prototype.renderChart=function(t,i,a,r,s,o,n,l,c){var u=this.bottomMarginLimit,h=this.leftRightMarginLimit,d=v(this.animator,n);if(this.renderBackground(),this.shouldRenderAxis(i)){i.axis.orient("bottom"),i.willLabelsFit||i.axis.tickPadding(5);var g=this.xAxisGraphicsContext;d?g.transition().duration(d).call(i.axis).call(this.darkenZeroLine):g.call(i.axis).call(this.darkenZeroLine);var m=g.selectAll("g.tick").filter(function(e){return 0===e});if(m){var f=this.getValueAxisFill();f&&m.selectAll("line").style({stroke:f.solid.color})}var y=g.selectAll("text");i.willLabelsWordBreak?y.call(L.LabelLayoutStrategy.wordBreak,i,u):y.call(L.LabelLayoutStrategy.rotate,u,x,e.TextProperties,!i.willLabelsFit,u===r.xMax,i,this.margin,this.isXScrollBarVisible||this.isYScrollBarVisible)}else this.xAxisGraphicsContext.selectAll("*").remove();if(this.shouldRenderAxis(a)){var b=this.yAxisOrientation;a.axis.tickSize(-this.viewportIn.width).tickPadding(10).orient(b.toLowerCase());var S=this.y1AxisGraphicsContext;d?S.transition().duration(d).call(a.axis).call(this.darkenZeroLine):S.call(a.axis).call(this.darkenZeroLine);var w=S.selectAll("g.tick").filter(function(e){return 0===e});if(w){var C=this.getCategoryAxisFill();C&&w.selectAll("line").style({stroke:C.solid.color})}r.yLeft>=h&&S.selectAll("text").call(L.LabelLayoutStrategy.clip,h-10,p)}else this.y1AxisGraphicsContext.selectAll("*").remove();if(s){var P=!this.shouldRenderAxis(i,"showAxisTitle"),A=!this.shouldRenderAxis(a,"showAxisTitle"),T=this.valueAxisProperties&&null!=this.valueAxisProperties.secShowAxisTitle&&this.valueAxisProperties.secShowAxisTitle===!1;this.renderAxesLabels(o,this.legendViewport.height,P,A,T)}else this.axisGraphicsContext.selectAll(".xAxisLabel").remove(),this.axisGraphicsContext.selectAll(".yAxisLabel").remove()},e.prototype.renderAxesLabels=function(t,i,a,r,s){this.axisGraphicsContext.selectAll(".xAxisLabel").remove(),this.axisGraphicsContext.selectAll(".yAxisLabel").remove();var o=this.margin,n=this.viewportIn.width,l=this.viewport.height,c=e.AxisFontSize,u=this.yAxisOrientation,h=u===T.right;if(!a){var d=this.axisGraphicsContext.append("text").style("text-anchor","middle").text(t.x).call(function(e){e.each(function(){var e=d3.select(this);e.attr({class:"xAxisLabel",transform:E.translate(n/2,l-c-2)})})});d.call(L.LabelLayoutStrategy.clip,n,p)}if(!r){var g=this.axisGraphicsContext.append("text").style("text-anchor","middle").text(t.y).call(function(e){e.each(function(){var e=d3.select(this);e.attr({class:"yAxisLabel",transform:"rotate(-90)",y:h?n+o.right-c:-o.left,x:-((l-o.top-i)/2),dy:"1em"})})});g.call(L.LabelLayoutStrategy.clip,l-(o.bottom+o.top),p)}if(!s&&t.y2){var m=this.axisGraphicsContext.append("text").style("text-anchor","middle").text(t.y2).call(function(e){e.each(function(){var e=d3.select(this);e.attr({class:"yAxisLabel",transform:"rotate(-90)",y:h?-o.left:n+o.right-c,x:-((l-o.top-i)/2),dy:"1em"})})});m.call(L.LabelLayoutStrategy.clip,l-(o.bottom+o.top),p)}},e.prototype.updateAxis=function(){this.adjustMargins();var e=this.yAxisOrientation,t=e===T.right;this.xAxisGraphicsContext.attr("transform",E.translate(0,this.viewportIn.height)),this.y1AxisGraphicsContext.attr("transform",E.translate(t?this.viewportIn.width:0,0)),this.svg.attr({width:this.viewport.width,height:this.viewport.height}),this.svgScrollable.attr({width:this.viewport.width,height:this.viewport.height}),this.svgScrollable.attr({x:0});var i=this.margin.left,a=this.margin.top;this.axisGraphicsContext.attr("transform",E.translate(i,a)),this.axisGraphicsContextScrollable.attr("transform",E.translate(i,a)),this.clearCatcher.attr("transform",E.translate(-i,-a)),this.isXScrollBarVisible?(this.svgScrollable.attr({x:i}),this.axisGraphicsContextScrollable.attr("transform",E.translate(0,a)),this.svgScrollable.attr("width",this.viewportIn.width),this.svg.attr("width",this.viewport.width).attr("height",this.viewport.height+this.ScrollBarWidth)):this.isYScrollBarVisible&&(this.svgScrollable.attr("height",this.viewportIn.height+a),this.svg.attr("width",this.viewport.width+this.ScrollBarWidth).attr("height",this.viewport.height))},e.prototype.getUnitType=function(e){return e.formatter&&e.formatter.displayUnit&&e.formatter.displayUnit.value>1?e.formatter.displayUnit.title:null},e.prototype.addUnitTypeToAxisLabel=function(e,t){var i=this.getUnitType(e);e.isCategoryAxis?this.categoryAxisHasUnitType=null!==i:this.valueAxisHasUnitType=null!==i,e.axisLabel&&i&&(e.isCategoryAxis?e.axisLabel=L.createAxisLabel(this.categoryAxisProperties,e.axisLabel,i):e.axisLabel=L.createAxisLabel(this.valueAxisProperties,e.axisLabel,i)),i=this.getUnitType(t),t.isCategoryAxis?this.categoryAxisHasUnitType=null!==i:this.valueAxisHasUnitType=null!==i,t.axisLabel&&i&&(t.isCategoryAxis?t.axisLabel=L.createAxisLabel(this.categoryAxisProperties,t.axisLabel,i):t.axisLabel=L.createAxisLabel(this.valueAxisProperties,t.axisLabel,i))},e.prototype.drawScatterMarkers=function(t,i,a,r){var s,o=this,n=this.xAxisProperties.scale,l=this.yAxisProperties.scale,c=(!a||!a.min)&&this.data.fillPoint,u=this.data.useCustomColor;this.data.useShape?(this.mainGraphicsContext.selectAll(e.DotClasses.selector).remove(),s=this.mainGraphicsContext.classed("ScatterMarkers",!0).selectAll(e.ImageClasses.selector).data(t,function(e){return e.identity.getKey()}),s.enter().append("svg:image").classed(e.ImageClasses.class,!0).attr("id","markerimage"),s.attr("xlink:href",function(e){return void 0!==e.svgurl&&null!=e.svgurl&&""!==e.svgurl?e.svgurl:o.svgDefaultImage}).attr("width",function(t){return 2*e.getBubbleRadius(t.radius,a,o.viewport)}).attr("height",function(t){return 2*e.getBubbleRadius(t.radius,a,o.viewport)}).transition().duration(function(e){return o.keyArray.indexOf(e.identity.getKey())>=0?r:0}).attr("transform",function(t){var i=e.getBubbleRadius(t.radius,a,o.viewport);return"translate("+(n(t.x)-i)+","+(l(t.y)-i)+") rotate("+t.rotation+","+i+","+i+")"})):(this.mainGraphicsContext.selectAll(e.ImageClasses.selector).remove(),s=this.mainGraphicsContext.classed("ScatterMarkers",!0).selectAll(e.DotClasses.selector).data(t,function(e){return e.identity.getKey()}),s.enter().append("path").classed(e.DotClasses.class,!0).attr("id","markershape"),s.style({"stroke-opacity":function(t){return e.getBubbleOpacity(t,i)},"stroke-width":"1px",stroke:function(e){var t=u?e.colorFill:e.fill;return o.data.outline?d3.rgb(t).darker():d3.rgb(t)},fill:function(e){return d3.rgb(u?e.colorFill:e.fill)},"fill-opacity":function(t){return null!=t.size||c?e.getBubbleOpacity(t,i):0}}).attr("d",function(t){var i=e.getBubbleRadius(t.radius,a,o.viewport),r=4*i*i;return t.shapeSymbolType(r)}).transition().duration(function(e){return o.keyArray.indexOf(e.identity.getKey())>=0?r:0}).attr("transform",function(e){return"translate("+n(e.x)+","+l(e.y)+") rotate("+e.rotation+")"})),s.exit().remove(),this.keyArray=[];for(var h=0;h<t.length;h++)this.keyArray.push(t[h].identity.getKey());return s},e.getBubbleOpacity=function(t,i){return i&&!t.selected?e.DimmedBubbleOpacity:e.DefaultBubbleOpacity},e.prototype.calculateAxes=function(t,i,a,r){var s={viewport:this.viewport,margin:this.margin,forcedXDomain:[t?t.start:null,t?t.end:null],forceMerge:i&&i.secShow===!1,showCategoryAxisLabel:!1,showValueAxisLabel:!1,categoryAxisScaleType:t&&null!=t.axisScale?t.axisScale:null,valueAxisScaleType:i&&null!=i.axisScale?i.axisScale:null,valueAxisDisplayUnits:i&&null!=i.labelDisplayUnits?i.labelDisplayUnits:e.LabelDisplayUnitsDefault,categoryAxisDisplayUnits:t&&null!=t.labelDisplayUnits?t.labelDisplayUnits:e.LabelDisplayUnitsDefault,trimOrdinalDataOnOverflow:!1};i&&(s.forcedYDomain=L.applyCustomizedDomain([i.start,i.end],s.forcedYDomain)),s.showCategoryAxisLabel=!!t&&!!t.showAxisTitle,s.showValueAxisLabel=!0;var o=this.viewport.width-(this.margin.left+this.margin.right),n=this.calculateAxesProperties(s);return n[0].willLabelsFit=L.LabelLayoutStrategy.willLabelsFit(n[0],o,c,a),n[0].willLabelsWordBreak=!n[0].willLabelsFit&&!r&&L.LabelLayoutStrategy.willLabelsWordBreak(n[0],this.margin,o,c,h,x,a),n},e.prototype.calculateAxesProperties=function(t){var i=this.data,a=i.dataPoints;this.margin=t.margin,this.viewport=t.viewport;var r=0,s=10,o=0,n=10;a.length>0&&(r=d3.min(a,function(e){return e.y}),s=d3.max(a,function(e){return e.y}),o=d3.min(a,function(e){return e.x}),n=d3.max(a,function(e){return e.x}));var l,c,u,h,p=[o,n];return l=L.combineDomain(this.optimizeTranslateValues(t.forcedXDomain),p),u=k.getFormatString(i.xCol,e.Properties.general.formatString),this.xAxisProperties=L.createAxis({pixelSpan:this.viewportIn.width,dataDomain:l,metaDataColumn:i.xCol,formatString:u,outerPadding:0,isScalar:!0,isVertical:!1,forcedTickCount:t.forcedTickCount,useTickIntervalForDisplayUnits:!0,isCategoryAxis:!0,scaleType:t.categoryAxisScaleType,axisDisplayUnits:t.categoryAxisDisplayUnits}),this.xAxisProperties.axis.tickSize(-this.viewportIn.height,0),this.xAxisProperties.axisLabel=this.data.axesLabels.x,c=L.combineDomain(this.optimizeTranslateValues(t.forcedYDomain),[r,s]),h=k.getFormatString(i.yCol,e.Properties.general.formatString),this.yAxisProperties=L.createAxis({pixelSpan:this.viewportIn.height,dataDomain:c,metaDataColumn:i.yCol,formatString:h,outerPadding:0,isScalar:!0,isVertical:!0,forcedTickCount:t.forcedTickCount,useTickIntervalForDisplayUnits:!0,isCategoryAxis:!1,scaleType:t.valueAxisScaleType,axisDisplayUnits:t.valueAxisDisplayUnits}),this.yAxisProperties.axisLabel=this.data.axesLabels.y,[this.xAxisProperties,this.yAxisProperties]},e.prototype.optimizeTranslateValues=function(e){var t=this;return e&&e.map?e.map(function(e){return t.optimizeTranslateValue(e)}):e},e.prototype.optimizeTranslateValue=function(t){if(t){var i=t>=0?1:-1,a=Math.abs(t);if(a>e.MaxTranslateValue)return e.MaxTranslateValue*i;if(a<e.MinTranslateValue)return e.MinTranslateValue*i}return t},e.prototype.enumerateDataPoints=function(e){var t=this.data;if(t){var i=t.dataPoints.length;if(t.hasDynamicSeries)for(var a=t.legendData.dataPoints.length,r=0;r<a;r++){var s=t.legendData.dataPoints[r];e.pushInstance({objectName:"dataPoint",displayName:s.label,selector:O.normalizeSelector(s.identity.getSelector()),properties:{fill:{solid:{color:s.color}}}})}else{var o=t.showAllDataPoints;if(e.pushInstance({objectName:"dataPoint",selector:null,properties:{defaultColor:{solid:{color:t.defaultDataPointColor||this.colors.getColorByIndex(0).value}}}}).pushInstance({objectName:"dataPoint",selector:null,properties:{showAllDataPoints:o}}),o)for(var r=0;r<i;r++){var n=t.dataPoints[r];e.pushInstance({objectName:"dataPoint",displayName:n.formattedCategory.getValue(),selector:O.normalizeSelector(n.identity.getSelector(),!0),properties:{fill:{solid:{color:n.fill}}}})}}}},e.prototype.enumerateObjectInstances=function(e){var t=new W;switch(e.objectName){case"dataPoint":var i=this.dataView&&this.dataView.categorical?this.dataView.categorical:null;U.hasGradientRole(i)||this.enumerateDataPoints(t);break;case"categoryAxis":this.getCategoryAxisValues(t);break;case"valueAxis":this.getValueAxisValues(t);break;case"categoryLabels":this.data?I.enumerateCategoryLabels(t,this.data.dataLabelsSettings,!0):I.enumerateCategoryLabels(t,null,!0);break;case"fillPoint":var a=this.data.sizeRange;if(a&&a.min)break;t.pushInstance({objectName:"fillPoint",selector:null,properties:{show:this.data.fillPoint}});break;case"backdrop":t.pushInstance({objectName:"backdrop",displayName:"Backdrop",selector:null,properties:{show:!!this.data.backdrop&&this.data.backdrop.show,url:this.data.backdrop?this.data.backdrop.url:null}});break;case"crosshair":t.pushInstance({objectName:"crosshair",selector:null,properties:{show:this.data.crosshair}});break;case"outline":t.pushInstance({objectName:"outline",selector:null,properties:{show:this.data.outline}});break;case"legend":this.enumerateLegend(t)}return t.complete()||[]},e.prototype.hasLegend=function(){return this.data&&this.data.hasDynamicSeries},e.prototype.enumerateLegend=function(t){if(this.hasLegend()){var i=w.getValue(this.legendObjectProperties,R.show,this.legend.isVisible()),a=w.getValue(this.legendObjectProperties,R.showTitle,!0),r=w.getValue(this.legendObjectProperties,R.titleText,this.layerLegendData?this.layerLegendData.title:""),s=w.getValue(this.legendObjectProperties,R.labelColor,b.DefaultLegendLabelFillColor);this.legendLabelFontSize=w.getValue(this.legendObjectProperties,R.fontSize,e.LegendLabelFontSizeDefault);var o=w.getValue(this.legendObjectProperties,R.position,P.top);t.pushInstance({selector:null,properties:{show:i,position:o,showTitle:a,titleText:r,labelColor:s,fontSize:this.legendLabelFontSize},objectName:"legend"})}},e.prototype.getCategoryAxisValues=function(t){var i=Y.both,a=!0,r=!1,s=[X.log,X.linear];a||this.categoryAxisProperties&&(this.categoryAxisProperties.start=null,this.categoryAxisProperties.end=null);var o={selector:null,properties:{},objectName:"categoryAxis",validValues:{axisScale:s}};o.properties.show=!this.categoryAxisProperties||null==this.categoryAxisProperties.show||this.categoryAxisProperties.show,this.yAxisIsCategorical&&(o.properties.position=this.valueAxisProperties&&null!=this.valueAxisProperties.position?this.valueAxisProperties.position:T.left),i===Y.both&&(o.properties.axisType=a?Y.scalar:Y.categorical),a&&(o.properties.axisScale=this.categoryAxisProperties&&null!=this.categoryAxisProperties.axisScale&&r?this.categoryAxisProperties.axisScale:X.linear,o.properties.start=this.categoryAxisProperties?this.categoryAxisProperties.start:null,o.properties.end=this.categoryAxisProperties?this.categoryAxisProperties.end:null,o.properties.labelDisplayUnits=this.categoryAxisProperties&&null!=this.categoryAxisProperties.labelDisplayUnits?this.categoryAxisProperties.labelDisplayUnits:e.LabelDisplayUnitsDefault),o.properties.showAxisTitle=!this.categoryAxisProperties||null==this.categoryAxisProperties.showAxisTitle||this.categoryAxisProperties.showAxisTitle,
t.pushInstance(o).pushInstance({selector:null,properties:{axisStyle:this.categoryAxisProperties&&this.categoryAxisProperties.axisStyle?this.categoryAxisProperties.axisStyle:q.showTitleOnly,labelColor:this.categoryAxisProperties?this.categoryAxisProperties.labelColor:null},objectName:"categoryAxis",validValues:{axisStyle:this.categoryAxisHasUnitType?[q.showTitleOnly,q.showUnitOnly,q.showBoth]:[q.showTitleOnly]}})},e.prototype.getValueAxisValues=function(t){var i=[X.log,X.linear],a=!1,r={selector:null,properties:{},objectName:"valueAxis",validValues:{axisScale:i,secAxisScale:i}};r.properties.show=!this.valueAxisProperties||null==this.valueAxisProperties.show||this.valueAxisProperties.show,this.yAxisIsCategorical||(r.properties.position=this.valueAxisProperties&&null!=this.valueAxisProperties.position?this.valueAxisProperties.position:T.left),r.properties.axisScale=this.valueAxisProperties&&null!=this.valueAxisProperties.axisScale&&a?this.valueAxisProperties.axisScale:X.linear,r.properties.start=this.valueAxisProperties?this.valueAxisProperties.start:null,r.properties.end=this.valueAxisProperties?this.valueAxisProperties.end:null,r.properties.showAxisTitle=!this.valueAxisProperties||null==this.valueAxisProperties.showAxisTitle||this.valueAxisProperties.showAxisTitle,r.properties.labelDisplayUnits=this.valueAxisProperties&&null!=this.valueAxisProperties.labelDisplayUnits?this.valueAxisProperties.labelDisplayUnits:e.LabelDisplayUnitsDefault,t.pushInstance(r).pushInstance({selector:null,properties:{axisStyle:this.valueAxisProperties&&null!=this.valueAxisProperties.axisStyle?this.valueAxisProperties.axisStyle:q.showTitleOnly,labelColor:this.valueAxisProperties?this.valueAxisProperties.labelColor:null},objectName:"valueAxis",validValues:{axisStyle:this.valueAxisHasUnitType?[q.showTitleOnly,q.showUnitOnly,q.showBoth]:[q.showTitleOnly]}})},e.prototype.onClearSelection=function(){this.interactivityService&&this.interactivityService.clearSelection()},e.AxisGraphicsContextClassName="axisGraphicsContext",e.ClassName="enhancedScatterChart",e.MainGraphicsContextClassName="mainGraphicsContext",e.LegendLabelFontSizeDefault=9,e.LabelDisplayUnitsDefault=0,e.AxisFontSize=11,e.CrosshairTextMargin=5,e.BubbleRadius=6,e.MinSizeRange=200,e.MaxSizeRange=3e3,e.AreaOf300By300Chart=9e4,e.DataLabelXOffset=2,e.DataLabelYOffset=1.8,e.DotClasses=r("dot"),e.ImageClasses=r("img"),e.TextProperties={fontFamily:"'Segoe UI', wf_segoe-ui_normal, helvetica, arial, sans-serif",fontSize:i.toString(e.AxisFontSize)},e.CrosshairCanvasSelector=r("crosshairCanvas"),e.CrosshairLineSelector=r("crosshairLine"),e.CrosshairVerticalLineSelector=r("crosshairVerticalLine"),e.CrosshairHorizontalLineSelector=r("crosshairHorizontalLine"),e.CrosshairTextSelector=r("crosshairText"),e.MaxTranslateValue=1e25,e.MinTranslateValue=1e-25,e.DefaultBubbleOpacity=.85,e.DimmedBubbleOpacity=.4,e.ColumnCategory="Category",e.ColumnSeries="Series",e.ColumnX="X",e.ColumnY="Y",e.ColumnSize="Size",e.ColumnGradient="Gradient",e.ColumnColorFill="ColorFill",e.ColumnShape="Shape",e.ColumnImage="Image",e.ColumnRotation="Rotation",e.ColumnBackdrop="Backdrop",e.ColumnXStart="X Start",e.ColumnXEnd="X End",e.ColumnYStart="Y Start",e.ColumnYEnd="Y End",e.capabilities={dataRoles:[{name:e.ColumnCategory,kind:C.Grouping,displayName:"Details"},{name:e.ColumnSeries,kind:C.Grouping,displayName:"Legend"},{name:e.ColumnX,kind:C.Measure,displayName:"X Axis"},{name:e.ColumnY,kind:C.Measure,displayName:"Y Axis"},{name:e.ColumnSize,kind:C.Measure,displayName:"Size"},{name:e.ColumnGradient,kind:C.Measure,displayName:"Color saturation"},{name:e.ColumnColorFill,kind:C.Grouping,displayName:"Customized Color"},{name:e.ColumnShape,kind:C.Measure,displayName:"Shape"},{name:e.ColumnImage,kind:C.Grouping,displayName:"Image"},{name:e.ColumnRotation,kind:C.Measure,displayName:"Rotation"},{name:e.ColumnBackdrop,kind:C.Grouping,displayName:"Backdrop"},{name:e.ColumnXStart,kind:C.Measure,displayName:"X Start"},{name:e.ColumnXEnd,kind:C.Measure,displayName:"X End"},{name:e.ColumnYStart,kind:C.Measure,displayName:"Y Start"},{name:e.ColumnYEnd,kind:C.Measure,displayName:"Y End"}],dataViewMappings:[{conditions:[{Category:{max:1},Series:{max:0},X:{max:1},Y:{max:1},Size:{max:1},Gradient:{max:1},ColorFill:{max:0},Shape:{max:1},Image:{max:0},Rotation:{max:1},Backdrop:{max:1},"X Start":{max:1},"X End":{max:1},"Y Start":{max:1},"Y End":{max:1}},{Category:{max:1},Series:{max:0},X:{max:1},Y:{max:1},Size:{max:1},Gradient:{max:0},ColorFill:{max:1},Shape:{max:1},Image:{max:0},Rotation:{max:1},Backdrop:{max:1},"X Start":{max:1},"X End":{max:1},"Y Start":{max:1},"Y End":{max:1}},{Category:{max:1},Series:{max:0},X:{max:1},Y:{max:1},Size:{max:1},Gradient:{max:0},ColorFill:{max:0},Shape:{max:0},Image:{max:1},Rotation:{max:1},Backdrop:{max:1},"X Start":{max:1},"X End":{max:1},"Y Start":{max:1},"Y End":{max:1}},{Category:{max:1},Series:{max:1},X:{max:1},Y:{max:1},Size:{max:1},Gradient:{max:0},ColorFill:{max:1},Shape:{max:1},Image:{max:0},Rotation:{max:1},Backdrop:{max:1},"X Start":{max:1},"X End":{max:1},"Y Start":{max:1},"Y End":{max:1}},{Category:{max:1},Series:{max:1},X:{max:1},Y:{max:1},Size:{max:1},Gradient:{max:0},ColorFill:{max:0},Shape:{max:0},Image:{max:1},Rotation:{max:1},Backdrop:{max:1},"X Start":{max:1},"X End":{max:1},"Y Start":{max:1},"Y End":{max:1}}],categorical:{categories:{select:[{bind:{to:e.ColumnCategory}},{bind:{to:e.ColumnColorFill}},{bind:{to:e.ColumnImage}},{bind:{to:e.ColumnBackdrop}}],dataReductionAlgorithm:{sample:{}}},values:{group:{by:e.ColumnSeries,select:[{bind:{to:e.ColumnX}},{bind:{to:e.ColumnY}},{bind:{to:e.ColumnSize}},{bind:{to:e.ColumnGradient}},{bind:{to:e.ColumnShape}},{bind:{to:e.ColumnRotation}},{bind:{to:e.ColumnXStart}},{bind:{to:e.ColumnXEnd}},{bind:{to:e.ColumnYStart}},{bind:{to:e.ColumnYEnd}}],dataReductionAlgorithm:{top:{}}}},rowCount:{preferred:{min:2}}}}],objects:{dataPoint:{displayName:"Data colors",properties:{defaultColor:{displayName:"Default color",type:{fill:{solid:{color:!0}}}},showAllDataPoints:{displayName:"Show all",type:{bool:!0}},fill:{displayName:"Fill",type:{fill:{solid:{color:!0}}}},fillRule:{displayName:"Color saturation",type:{fillRule:{}},rule:{inputRole:e.ColumnGradient,output:{property:"fill",selector:[e.ColumnCategory]}}}}},general:{displayName:"General",properties:{formatString:{type:{formatting:{formatString:!0}}}}},categoryAxis:{displayName:"X-Axis",properties:{show:{displayName:"Show",type:{bool:!0}},axisScale:{displayName:"Scale type",type:{formatting:{axisScale:!0}}},start:{displayName:"Start",type:{numeric:!0}},end:{displayName:"End",type:{numeric:!0}},showAxisTitle:{displayName:"Title",type:{bool:!0}},axisStyle:{displayName:"Style",type:{formatting:{axisStyle:!0}}},axisColor:{displayName:"Color",type:{fill:{solid:{color:!0}}}},labelDisplayUnits:{displayName:"Display Units",type:{formatting:{labelDisplayUnits:!0}}}}},valueAxis:{displayName:"Y-Axis",properties:{show:{displayName:"Show",type:{bool:!0}},position:{displayName:"Position",type:{formatting:{yAxisPosition:!0}}},axisScale:{displayName:"Scale type",type:{formatting:{axisScale:!0}}},start:{displayName:"Start",type:{numeric:!0}},end:{displayName:"End",type:{numeric:!0}},showAxisTitle:{displayName:"Title",type:{bool:!0}},axisStyle:{displayName:"Style",type:{formatting:{axisStyle:!0}}},axisColor:{displayName:"Color",type:{fill:{solid:{color:!0}}}},labelDisplayUnits:{displayName:"Display Units",type:{formatting:{labelDisplayUnits:!0}}}}},legend:{displayName:"Legend",properties:{show:{displayName:"Show",type:{bool:!0}},position:{displayName:"Position",description:"Select the location for the legend",type:{enumeration:P.type}},showTitle:{displayName:"Title",description:"Display a title for legend symbols",type:{bool:!0}},titleText:{displayName:"Legend Name",description:"Title text",type:{text:!0}},labelColor:{displayName:"Color",type:{fill:{solid:{color:!0}}}},fontSize:{displayName:"Text Size",type:{formatting:{fontSize:!0}}}}},categoryLabels:{displayName:"Category labels",properties:{show:{displayName:"Show",type:{bool:!0}},color:{displayName:"Color",type:{fill:{solid:{color:!0}}}},fontSize:{displayName:"Text Size",type:{formatting:{fontSize:!0}}}}},fillPoint:{displayName:"Fill point",properties:{show:{displayName:"Fill",type:{bool:!0}}}},backdrop:{displayName:"Backdrop",properties:{show:{displayName:"Show",type:{bool:!0}},url:{displayName:"Image URL",type:{text:!0}}}},crosshair:{displayName:"Crosshair",properties:{show:{displayName:"Crosshair",type:{bool:!0}}}},outline:{displayName:"Outline",properties:{show:{displayName:"Outline",type:{bool:!0}}}}}},e.Properties=e.getPropertiesByCapabilities(e.capabilities),e}();t.EnhancedScatterChart=K;var Z=function(){function e(e){this.behaviors=e||[]}return e.prototype.bindEvents=function(e,t){for(var i=this.behaviors,a=0,r=i.length;a<r;a++)i[a].bindEvents(e.layerOptions[a],t);e.clearCatcher.on("click",function(){t.handleClearSelection()})},e.prototype.renderSelection=function(e){for(var t=0,i=this.behaviors;t<i.length;t++){var a=i[t];a.renderSelection(e)}},e}();t.CustomVisualBehavior=Z;var J=function(){function e(e,t){this.dimmedBubbleOpacity=e,this.defaultBubbleOpacity=t}return e.prototype.bindEvents=function(e,t){var i=this.bubbles=e.dataPointsSelection,a=e.data;this.shouldEnableFill=(!a.sizeRange||!a.sizeRange.min)&&a.fillPoint,this.colorBorder=a.colorBorder,n(i,t)},e.prototype.renderSelection=function(e){var t=this,i=this.shouldEnableFill,a=this.colorBorder;this.bubbles.style("fill-opacity",function(a){return t.getMarkerFillOpacity(null!=a.size,i,e,a.selected)}),this.bubbles.style("stroke-opacity",function(i){return t.getMarkerStrokeOpacity(null!=i.size,a,e,i.selected)})},e.prototype.getMarkerFillOpacity=function(e,t,i,a){return e||t?i&&!a?this.dimmedBubbleOpacity:this.defaultBubbleOpacity:0},e.prototype.getMarkerStrokeOpacity=function(e,t,i,a){return e&&t?1:i&&!a?this.dimmedBubbleOpacity:this.defaultBubbleOpacity},e}();t.EnhancedScatterChartWebBehavior=J}(i=t.samples||(t.samples={}))}(t=e.visuals||(e.visuals={}))}(i||(i={}))},function(e,t){var i,a,r,s,s=(window.jsCommon,window.powerbi);window.powerbitests,window.InJs,window.debug,window.jasmine,window.Microsoft;!function(e){var t;!function(t){var s;!function(s){var o=function(){function e(e,t){this.defaultViewport=e||{width:0,height:0},this.defaultMargin=t||{top:0,bottom:0,right:0,left:0}}return Object.defineProperty(e.prototype,"viewport",{get:function(){return this.viewportValue||(this.viewportValue=this.defaultViewport)},set:function(t){var i=this;this.previousOriginalViewportValue=_.clone(this.originalViewportValue),this.originalViewportValue=_.clone(t),this.setUpdateObject(t,function(e){return i.viewportValue=e},function(t){return e.restrictToMinMax(t,i.minViewport)})},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"viewportCopy",{get:function(){return _.clone(this.viewport)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"viewportIn",{get:function(){return this.viewportInValue||this.viewport},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"minViewport",{get:function(){return this.minViewportValue||{width:0,height:0}},set:function(t){var i=this;this.setUpdateObject(t,function(e){return i.minViewportValue=e},e.restrictToMinMax)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"margin",{get:function(){return this.marginValue||(this.marginValue=this.defaultMargin)},set:function(t){var i=this;this.setUpdateObject(t,function(e){return i.marginValue=e},e.restrictToMinMax)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"viewportChanged",{get:function(){return!(!this.originalViewportValue||this.previousOriginalViewportValue&&this.previousOriginalViewportValue.height===this.originalViewportValue.height&&this.previousOriginalViewportValue.width===this.originalViewportValue.width)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"viewportInIsZero",{get:function(){return 0===this.viewportIn.width||0===this.viewportIn.height},enumerable:!0,configurable:!0}),e.prototype.resetMargin=function(){this.margin=this.defaultMargin},e.prototype.update=function(){this.viewportInValue=e.restrictToMinMax({width:this.viewport.width-(this.margin.left+this.margin.right),height:this.viewport.height-(this.margin.top+this.margin.bottom)},this.minViewportValue)},e.prototype.setUpdateObject=function(t,i,a){var r=this;t=_.clone(t),i(e.createNotifyChangedObject(t,function(e){a&&a(t),r.update()})),a&&a(t),this.update()},e.createNotifyChangedObject=function(e,t){var i={};return _.keys(e).forEach(function(a){return Object.defineProperty(i,a,{get:function(){return e[a]},set:function(i){e[a]=i,t(e,a)},enumerable:!0,configurable:!0})}),i},e.restrictToMinMax=function(e,t){return _.keys(e).forEach(function(i){return e[i]=Math.max(t&&t[i]||0,e[i])}),e},e}(),n=function(){function i(){this.dataPoint={}}return Object.defineProperty(i,"Default",{get:function(){return new this},enumerable:!0,configurable:!0}),i.parse=function(e,t){var i=new this;if(!e||!e.metadata||!e.metadata.objects)return i;var a=this.getProperties(t);for(var r in t.objects)for(var s in t.objects[r].properties)if(i[r]&&_.has(i[r],s)){var o=t.objects[r].properties[s].type,n=this.getValueFnByType(o);i[r][s]=n(e.metadata.objects,a[r][s],i[r][s])}return i},i.getProperties=function(e){var t=_.merge({general:{properties:{formatString:{}}}},e.objects),i={};for(var a in t){i[a]={};for(var r in t[a].properties)i[a][r]={objectName:a,propertyName:r}}return i},i.createEnumTypeFromEnum=function(t){var i=!1;return e.createEnumType(Object.keys(t).filter(function(e,a){return!!(a%2)===i&&t[e]===e&&!void(i=!i)||!!(a%2)!==i}).map(function(e){return{value:e,displayName:e}}))},i.getValueFnByType=function(t){switch(_.keys(t)[0]){case"fill":return e.DataViewObjects.getFillColor;default:return e.DataViewObjects.getValue}},i.enumerateObjectInstances=function(e,i,a){void 0===e&&(e=new this);var r=new t.ObjectEnumerationBuilder,s=e&&e[i.objectName];if(!s)return r;var o={objectName:i.objectName,selector:null,properties:{}};for(var n in s)_.has(s,n)&&(o.properties[n]=s[n]);return r.pushInstance(o),r},i.prototype.createOriginalSettings=function(){this.originalSettings=_.cloneDeep(this)},i}();s.GlobeMapSettings=n;var l=function(){function e(){this.Category=null,this.Series=null,this.X=null,this.Y=null,this.Height=null,this.Heat=null}return e.getColumnSources=function(e){return this.getColumnSourcesT(e)},e.getTableValues=function(e){var t=e&&e.table,i=this.getColumnSourcesT(e);return i&&t&&_.mapValues(i,function(e,i){return e&&t.rows.map(function(t){return t[e.index]})})},e.getTableRows=function(e){var t=e&&e.table,i=this.getColumnSourcesT(e);return i&&t&&t.rows.map(function(e){return _.mapValues(i,function(t,i){return t&&e[t.index]})})},e.getCategoricalValues=function(e){var t=e&&e.categorical,i=t&&t.categories||[],a=t&&t.values||[],r=t&&a.source&&this.getSeriesValues(e);return t&&_.mapValues(new this,function(e,t){return _.toArray(i).concat(_.toArray(a)).filter(function(e){return e.source.roles&&e.source.roles[t]}).map(function(e){return e.values})[0]||a.source&&a.source.roles&&a.source.roles[t]&&r})},e.getSeriesValues=function(e){return e&&e.categorical&&e.categorical.values&&e.categorical.values.map(function(e){return t.converterHelper.getSeriesName(e.source)})},e.getCategoricalColumns=function(e){var t=e&&e.categorical,i=t&&t.categories||[],a=t&&t.values||[];return t&&_.mapValues(new this,function(e,t){return i.filter(function(e){return e.source.roles&&e.source.roles[t]})[0]||a.source&&a.source.roles&&a.source.roles[t]&&a||a.filter(function(e){return e.source.roles&&e.source.roles[t]})})},e.getGroupedValueColumns=function(e){var t=this,i=e&&e.categorical,a=i&&i.values,r=a&&a.grouped();return r&&r.map(function(e){return _.mapValues(new t,function(t,i){return e.values.filter(function(e){return e.source.roles[i]})[0]})})},e.getColumnSourcesT=function(e){var t=e&&e.metadata&&e.metadata.columns;return t&&_.mapValues(new this,function(e,i){return t.filter(function(e){return e.roles&&e.roles[i]})[0]})},e.Roles=Object.freeze(_.mapValues(new e,function(e,t){return t})),e}();s.GlobeMapColumns=l;var c=function(){function s(){this.locationsToLoad=0,this.locationsLoaded=0,this.renderLoopEnabled=!0,this.needsRender=!1}return Object.defineProperty(s.prototype,"settings",{get:function(){return this.data&&this.data.settings},enumerable:!0,configurable:!0}),s.converter=function(e,i){var a=l.getCategoricalColumns(e);if(!a||!a.Category||_.isEmpty(a.Category.values)||_.isEmpty(a.Height)&&_.isEmpty(a.Heat))return null;var r,o,c,u,h,p=n.getProperties(s.capabilities),d=s.parseSettings(e),g=l.getGroupedValueColumns(e),m=[],f=[],y=[],v=new t.ColorHelper(i,p.dataPoint.fill);if(a.Category&&a.Category.values){y=a.Category.values;var x=a.Category.source.type;r=x.category?x.category.toLowerCase():""}else y=[];if(_.isEmpty(a.Height))c=new Array(y.length),o=new Array(y.length);else if(g.length>1){o=new Array(y.length),c=new Array(y.length),u=new Array(y.length),f=new Array(g.length);for(var b=0;b<g.length;b++){var S=g[b].Height.values;f[b]=s.createDataPointForEnumeration(e,g[b].Height.source,b,null,v,i);for(var w=0;w<S.length;w++)o[w]||(o[w]=0),o[w]+=S[w]?S[w]:0,c[w]||(c[w]=[]),c[w][b]=S[w],u[w]||(u[w]=[]),u[w][b]={displayName:a.Series&&a.Series.source.displayName,value:e.categorical.values.grouped()[b].name,dataPointValue:S[w]}}for(var b=0;b<g.length;b++)for(var S=g[b].Height.values,w=0;w<S.length;w++)c[w][b]=S[w]/o[w]}else o=a.Height[0].values,c=new Array(g.length),f[0]=s.createDataPointForEnumeration(e,g[0].Height.source,0,e.metadata,v,i);if(_.isEmpty(a.Heat))h=new Array(y.length);else if(g.length>1){h=new Array(y.length);for(var b=0;b<g.length;b++)for(var S=g[b].Heat.values,w=0;w<S.length;w++)h[w]||(h[w]=0),h[w]+=S[w]?S[w]:0}else h=a.Heat[0].values;for(var C=Math.max.apply(null,o)||1,P=Math.max.apply(null,h)||1,A=t.valueFormatter.create({format:!_.isEmpty(a.Heat)&&a.Heat[0].source.format,value:h[0],value2:h[1]}),T=t.valueFormatter.create({format:!_.isEmpty(a.Height)&&a.Height[0].source.format,value:o[0],value2:o[1]}),b=0,D=y.length;b<D;++b)if("string"==typeof y[b]){var V=y[b].toLowerCase(),N=V+"/"+r,L=_.isEmpty(a.X)||_.isEmpty(a.Y)?void 0:{longitude:a.X[0].values[b]||0,latitude:a.Y[0].values[b]||0},M=o[b]/C,k=h[b]/P,I={location:L,placeKey:N,place:V,locationType:r,height:M?M||.01:void 0,heightBySeries:c[b],seriesToolTipData:u?u[b]:void 0,heat:k||0,toolTipData:{location:{displayName:a.Category&&a.Category.source.displayName,value:y[b]},height:{displayName:!_.isEmpty(a.Height)&&a.Height[0].source.displayName,value:T.format(o[b])},heat:{displayName:!_.isEmpty(a.Heat)&&a.Heat[0].source.displayName,value:A.format(h[b])}}};m.push(I)}return{dataView:e,dataPoints:m,seriesDataPoints:f,settings:d}},s.parseSettings=function(e){var t=n.parse(e,s.capabilities);return t.createOriginalSettings(),t},s.createDataPointForEnumeration=function(e,i,a,r,s,o){var n=e.categorical.values.grouped()[a],l=t.converterHelper.getFormattedLegendLabel(i,n.values,null),c=t.SelectionId.createWithId(n.identity),u=t.converterHelper.getSeriesName(i),h=n.objects,p=h&&h.dataPoint?h.dataPoint.fill.solid.color:r&&r.objects?s.getColorForMeasure(r.objects,""):o.getColorByIndex(a).value;return{label:l,identity:c,category:u,color:p,selected:null}},s.prototype.enumerateObjectInstances=function(e){var i=n.enumerateObjectInstances(this.settings&&this.settings.originalSettings,e,s.capabilities);switch(e.objectName){case"dataPoint":if(this.data&&this.data.seriesDataPoints)for(var a=0;a<this.data.seriesDataPoints.length;a++){var r=this.data.seriesDataPoints[a];i.pushInstance({objectName:"dataPoint",displayName:r.label,selector:t.ColorHelper.normalizeSelector(r.identity.getSelector()),properties:{fill:{solid:{color:r.color}}}})}}return i.complete()},s.prototype.init=function(e){this.root=$("<div>").appendTo(e.element).attr("drag-resize-disabled","true").css({position:"absolute"}),this.layout=new o(e.viewport),this.readyToRender=!1,this.globeMapLocationCache||(this.globeMapLocationCache={}),this.style=e.style,this.colors=this.style.colorPalette.dataColors,window.THREE&&this.setup()},s.prototype.setup=function(){this.initTextures(),this.initMercartorSphere(),this.initZoomControl(),this.initScene(),this.initHeatmap(),this.readyToRender=!0,this.initRayCaster()},s.prototype.initScene=function(){var e=this;this.renderer=new i.WebGLRenderer({antialias:!0,preserveDrawingBuffer:!0}),this.rendererContainer=$("<div>").appendTo(this.root).css({width:"100%",height:"100%",position:"relative"}),this.rendererContainer.append(this.renderer.domElement),this.rendererCanvas=this.renderer.domElement,this.camera=new i.PerspectiveCamera(35,this.layout.viewportIn.width/this.layout.viewportIn.height,.1,1e4),this.orbitControls=new i.OrbitControls(this.camera,this.rendererCanvas),this.orbitControls.enablePan=!1,this.scene=new i.Scene,this.renderer.setSize(this.layout.viewportIn.width,this.layout.viewportIn.height),this.renderer.setClearColor(12240082,1),this.camera.position.z=s.GlobeSettings.cameraRadius,this.orbitControls.maxDistance=s.GlobeSettings.cameraRadius,this.orbitControls.minDistance=s.GlobeSettings.earthRadius+1,this.orbitControls.rotateSpeed=s.GlobeSettings.rotateSpeed,this.orbitControls.zoomSpeed=s.GlobeSettings.zoomSpeed,this.orbitControls.autoRotate=s.GlobeSettings.autoRotate;var t=new i.AmbientLight(0),a=new i.DirectionalLight(16777215,.4),r=new i.DirectionalLight(16777215,.4),o=this.earth=this.createEarth();this.scene.add(t),this.scene.add(a),this.scene.add(r),this.scene.add(o),a.position.set(20,20,20),r.position.set(0,0,-20);var n=function(){try{if(e.renderLoopEnabled&&(e.animationFrameId=requestAnimationFrame(n)),!e.shouldRender())return;e.orbitControls.update(),e.setEarthTexture(),e.heatmap&&e.heatmap.display&&e.heatmap.display(),e.renderer.render(e.scene,e.camera),e.intersectBars(),e.needsRender=!1}catch(e){}};this.animationFrameId=requestAnimationFrame(n)},s.prototype.shouldRender=function(){return this.readyToRender&&this.needsRender},s.prototype.createEarth=function(){var e=new s.MercartorSphere(s.GlobeSettings.earthRadius,s.GlobeSettings.earthSegments,s.GlobeSettings.earthSegments),t=new i.MeshPhongMaterial({map:this.mapTextures[0],side:i.DoubleSide,shading:i.SmoothShading,shininess:1}),a=new i.Mesh(e,t);return a.add(new i.AmbientLight(11184810,1)),a},s.prototype.zoomClicked=function(e){this.orbitControls.enabled!==!1&&(e===-1?this.orbitControls.dollyOut(Math.pow(.95,s.GlobeSettings.zoomSpeed)):1===e&&this.orbitControls.dollyIn(Math.pow(.95,s.GlobeSettings.zoomSpeed)),this.orbitControls.update(),this.animateCamera(this.camera.position))},s.prototype.rotateCam=function(e,t){this.orbitControls.enabled&&(this.orbitControls.rotateLeft(2*Math.PI*e/this.rendererCanvas.offsetHeight*s.GlobeSettings.rotateSpeed),this.orbitControls.rotateUp(2*Math.PI*t/this.rendererCanvas.offsetHeight*s.GlobeSettings.rotateSpeed),this.orbitControls.update(),this.animateCamera(this.camera.position))},s.prototype.initTextures=function(){var e=this;if(!r){r=[];for(var t=2;t<=5;++t){var a=this.getBingMapCanvas(t);r.push(a)}}var s=function(t){var a=new i.Texture(t.get(0));return a.needsUpdate=!0,t.on("ready",function(t,i){a.needsUpdate=!0,e.needsRender=!0}),a};this.mapTextures=[];for(var o=0;o<r.length;++o)this.mapTextures.push(s(r[o]))},s.prototype.initHeatmap=function(){try{var e=this.heatmap=new a({width:s.GlobeSettings.heatmapSize,height:s.GlobeSettings.heatmapSize,intensityToAlpha:!0})}catch(e){}var t=this.heatTexture=new i.Texture(e.canvas);t.needsUpdate=!0;var r=new i.MeshBasicMaterial({map:t,transparent:!0}),o=new i.SphereGeometry(s.GlobeSettings.earthRadius+.01,s.GlobeSettings.earthSegments,s.GlobeSettings.earthSegments),n=new i.Mesh(o,r);window.heatmap=e,window.heatmapTexture=t,this.scene.add(n)},s.prototype.setEarthTexture=function(){if(this.camera){var e,t=s.GlobeSettings.cameraRadius-s.GlobeSettings.earthRadius,i=(this.camera.position.length()-s.GlobeSettings.earthRadius)/t;e=i<=.2?this.mapTextures[3]:i<=.4?this.mapTextures[2]:i<=.6?this.mapTextures[1]:this.mapTextures[0],this.earth.material.map!==e&&(this.earth.material.map=e),this.selectedBar?this.orbitControls.rotateSpeed=s.GlobeSettings.rotateSpeed:this.orbitControls.rotateSpeed=s.GlobeSettings.rotateSpeed*i}},s.prototype.update=function(t){if(this.layout.viewport=t.viewport,this.root.css(this.layout.viewportIn),this.zoomContainer.style({"padding-left":this.layout.viewportIn.width-parseFloat(this.zoomControl.attr("width"))+6+"px",display:this.layout.viewportIn.height>$(this.zoomContainer.node()).height()&&this.layout.viewportIn.width>$(this.zoomContainer.node()).width()?null:"none"}),this.layout.viewportChanged&&this.camera&&this.renderer&&(this.camera.aspect=this.layout.viewportIn.width/this.layout.viewportIn.height,this.camera.updateProjectionMatrix(),this.renderer.setSize(this.layout.viewportIn.width,this.layout.viewportIn.height),this.renderer.render(this.scene,this.camera)),t.type===e.VisualUpdateType.Data){this.cleanHeatAndBar();var i=s.converter(t.dataViews[0],this.colors);i&&(this.data=i,this.renderMagic())}},s.prototype.cleanHeatAndBar=function(){this.heatmap.clear(),this.heatTexture.needsUpdate=!0,this.barsGroup&&this.scene.remove(this.barsGroup)},s.prototype.renderMagic=function(){var e=this;if(this.data){if(this.data.dataPoints.forEach(function(t){return e.geocodeRenderDatum(t)}),this.data.dataPoints.forEach(function(t){return t.location=t.location||e.globeMapLocationCache[t.placeKey]}),!this.readyToRender)return void this.defferedRender();this.heatmap.clear(),this.barsGroup&&this.scene.remove(this.barsGroup),this.barsGroup=new i.Object3D,this.scene.add(this.barsGroup),this.averageBarVector=new i.Vector3;for(var t=0,a=this.data.dataPoints.length;t<a;++t){var r=this.data.dataPoints[t];if(r.location&&void 0!==r.location.longitude&&void 0!==r.location.latitude){if(r.heat>.001){r.heat<.1&&(r.heat=.1);var o=(180+r.location.longitude)/360*s.GlobeSettings.heatmapSize,n=(1-(90+r.location.latitude)/180)*s.GlobeSettings.heatmapSize;this.heatmap.addPoint(o,n,s.GlobeSettings.heatPointSize,r.heat*s.GlobeSettings.heatIntensity)}if(r.height>=0){r.height<.01&&(r.height=.01);var l=r.location.latitude/180*Math.PI,c=r.location.longitude/180*Math.PI,o=Math.cos(c)*Math.cos(l),u=-Math.sin(c)*Math.cos(l),n=Math.sin(l),h=new i.Vector3(o,n,u);this.averageBarVector.add(h);var p=s.GlobeSettings.barHeight*r.height,d=[],g=[];if(r.heightBySeries)for(var m=0;m<r.heightBySeries.length;m++)r.heightBySeries[m]&&d.push(r.heightBySeries[m]),g.push(r.seriesToolTipData[m]);else d.push(1);for(var f=0,y=0;y<d.length;y++){f+=d[y];var v=new i.BoxGeometry(s.GlobeSettings.barWidth,s.GlobeSettings.barWidth,p*d[y]),x=new i.Mesh(v,this.getBarMaterialByIndex(y)),b=h.clone().multiplyScalar(s.GlobeSettings.earthRadius+p/2*f);x.position.set(b.x,b.y,b.z),x.lookAt(h),x.toolTipData=0===g.length?r.toolTipData:this.getToolTipDataForSeries(r.toolTipData,g[y]),this.barsGroup.add(x),f+=d[y]}}}}this.barsGroup.children.length>0&&this.camera&&(this.averageBarVector.multiplyScalar(1/this.barsGroup.children.length),this.locationsLoaded===this.locationsToLoad&&this.animateCamera(this.averageBarVector)),this.heatmap.update(),this.heatmap.blur(),this.heatTexture.needsUpdate=!0,this.needsRender=!0}},s.prototype.getBarMaterialByIndex=function(e){return new i.MeshPhongMaterial({color:this.data.seriesDataPoints[e].color})},s.prototype.getToolTipDataForSeries=function(e,t){var i=jQuery.extend(!0,{series:{displayName:t.displayName,value:t.value}},e);return i.height.value=t.dataPointValue,i},s.prototype.geocodeRenderDatum=function(i){var a=this;if(!i.location&&!this.globeMapLocationCache[i.placeKey]){var r={};this.globeMapLocationCache[i.placeKey]=r,this.locationsToLoad++;try{var s=e.visuals.BI.Services.GeocodingManager.geocode}catch(e){s=t.services.geocode}s&&s(i.place,i.locationType).always(function(e){e&&(r.latitude=e.latitude,r.longitude=e.longitude),a.locationsLoaded++,a.defferedRender()})}},s.prototype.defferedRender=function(){var e=this;this.deferredRenderTimerId||(this.deferredRenderTimerId=setTimeout(function(){e.deferredRenderTimerId=null,e.renderMagic()},500))},s.prototype.initRayCaster=function(){var e=this;this.rayCaster=new i.Raycaster;var t,a=this.root.get(0),r=window.getComputedStyle(a);$(this.rendererCanvas).on("mousemove",function(t){var s=a.offsetHeight-a.offsetTop-parseFloat(r.paddingTop)-parseFloat(r.paddingBottom),o=a.offsetWidth-a.offsetLeft-parseFloat(r.paddingLeft)-parseFloat(r.paddingRight),n=t.offsetX/o,l=t.offsetY/s;e.mousePos=new i.Vector2(t.clientX,t.clientY),e.mousePosNormalized=new i.Vector2(2*n-1,2*-l+1),e.needsRender=!0}).on("mousedown",function(i){cancelAnimationFrame(e.cameraAnimationFrameId),t=Date.now()}).on("mouseup",function(i){Date.now()-t>s.GlobeSettings.clickInterval||(e.hoveredBar&&i.shiftKey?(e.selectedBar=e.hoveredBar,e.animateCamera(e.selectedBar.position,function(){e.selectedBar&&(e.orbitControls.target.copy(e.selectedBar.position.clone().normalize().multiplyScalar(s.GlobeSettings.earthRadius)),e.orbitControls.minDistance=1)})):e.selectedBar&&(e.animateCamera(e.selectedBar.position,function(){e.orbitControls.target.set(0,0,0),e.orbitControls.minDistance=s.GlobeSettings.earthRadius+1}),e.selectedBar=null))}).on("mousewheel DOMMouseScroll",function(t){if(e.needsRender=!0,e.orbitControls.enabled&&e.orbitControls.enableZoom){cancelAnimationFrame(e.cameraAnimationFrameId),e.heatTexture.needsUpdate=!0,t=t.originalEvent;var i=t.wheelDelta>0||t.detail<0?1:-1,a=i>0?s.GlobeSettings.heatmapScaleOnZoom:1/s.GlobeSettings.heatmapScaleOnZoom;e.heatmap.multiply(a),e.heatmap.update()}})},s.prototype.intersectBars=function(){if(this.rayCaster&&this.barsGroup&&this.mousePosNormalized&&this.mousePos){var e=this.rayCaster;e.setFromCamera(this.mousePosNormalized,this.camera);var i=e.intersectObjects(this.barsGroup.children);if(i&&i.length>0){var a=i[0].object;if(!a||!a.toolTipData)return;var r=a.toolTipData,s=[];r.location.displayName&&s.push(r.location),r.series&&s.push(r.series),r.height.displayName&&s.push(r.height),r.heat.displayName&&s.push(r.heat),this.hoveredBar=a,t.TooltipManager.ToolTipInstance.show(s,{x:this.mousePos.x,y:this.mousePos.y,width:0,height:0})}else this.hoveredBar=null,t.TooltipManager.ToolTipInstance.hide()}},s.prototype.animateCamera=function(e,a){var r=this;if(t.TooltipManager.ToolTipInstance.hide(),this.camera){cancelAnimationFrame(this.cameraAnimationFrameId);var o=Date.now(),n=s.GlobeSettings.cameraAnimDuration,l=o+n,c=this.camera.position.clone().normalize(),u=e.clone().normalize(),h=this.camera.position.length(),p=function(e){return e*=2,e<1?e*e*e/2:(e-=2,(e*e*e+2)/2)},d=function(){var e=Date.now(),t=(e-o)/n;t>1&&(t=1),t=p(t);var s=(new i.Vector3).add(c.clone().multiplyScalar(1-t)).add(u.clone().multiplyScalar(t)).normalize().multiplyScalar(h);r.camera.position.set(s.x,s.y,s.z),e<l?r.cameraAnimationFrameId=requestAnimationFrame(d):a&&a(),r.needsRender=!0};this.cameraAnimationFrameId=requestAnimationFrame(d)}},s.prototype.destroy=function(){if(cancelAnimationFrame(this.animationFrameId),cancelAnimationFrame(this.cameraAnimationFrameId),clearTimeout(this.deferredRenderTimerId),this.renderLoopEnabled=!1,this.scene=null,this.heatmap=null,this.heatTexture=null,this.camera=null,this.renderer){if(this.renderer.context){var e=this.renderer.context.getExtension("WEBGL_lose_context");e&&e.loseContext(),this.renderer.context=null}this.renderer.domElement=null}this.renderer=null,this.data=null,this.barsGroup=null,this.orbitControls&&this.orbitControls.dispose(),this.orbitControls=null,this.rendererCanvas&&$(this.rendererCanvas).off("mousemove mouseup mousedown mousewheel DOMMouseScroll"),this.rendererCanvas=null,this.root&&this.root.empty(),t.TooltipManager.ToolTipInstance.hide()},s.prototype.initZoomControl=function(){function e(e){d3.event.stopPropagation(),0===d3.event.button&&e()}var t=this,i=17,a=8.5*i,r=8.5*i,s=3*i,o=i+3,n=2*i;this.zoomContainer=d3.select(this.root[0]).append("div").style({
position:"absolute",bottom:"-5px","z-index":"1000","pointer-events":"none"}),this.zoomControl=this.zoomContainer.append("svg").attr({width:a,height:r,"pointer-events":"all"});var l=this.zoomControl.append("g").on("mousedown",function(){return e(function(){return t.rotateCam(0,-5)})});l.append("circle").attr({cx:s+n,cy:o+2*n,r:i,fill:"white",opacity:.5,stroke:"gray"}),l.append("path").attr({d:"M"+(s+2*i)+" "+(o+4.7*i)+" l12 -20 a40,70 0 0,1 -24,0z",fill:"gray"});var c=this.zoomControl.append("g").on("mousedown",function(){return e(function(){return t.rotateCam(5,0)})});c.append("circle").attr({cx:s,cy:o+n,r:i,fill:"white",stroke:"gray",opacity:.5}),c.append("path").attr({d:"M"+(s-i/1.5)+" "+(o+2*i)+" l20 -12 a70,40 0 0,0 0,24z",fill:"gray"});var u=this.zoomControl.append("g").on("mousedown",function(){return e(function(){return t.rotateCam(0,5)})});u.append("circle").attr({cx:s+n,cy:o,r:i,fill:"white",stroke:"gray",opacity:.5}),u.append("path").attr({d:"M"+(s+2*i)+" "+(o-i/1.5)+" l12 20 a40,70 0 0,0 -24,0z",fill:"gray"});var h=this.zoomControl.append("g").on("mousedown",function(){return e(function(){return t.rotateCam(-5,0)})});h.append("circle").attr({cx:s+2*n,cy:o+n,r:i,fill:"white",stroke:"gray",opacity:.5}),h.append("path").attr({d:"M"+(s+4.7*i)+" "+(o+2*i)+" l-20 -12 a70,40 0 0,1 0,24z",fill:"gray"});var p=this.zoomControl.append("g").on("mousedown",function(){return e(function(){return t.zoomClicked(-1)})});p.append("circle").attr({cx:s+4*i,cy:o+6*i,r:i,fill:"white",stroke:"gray",opacity:.5}),p.append("rect").attr({x:s+3.5*i,y:o+5.9*i,width:i,height:i/3,fill:"gray"}),p.append("rect").attr({x:s+4*i-i/6,y:o+5.55*i,width:i/3,height:i,fill:"gray"});var d=this.zoomControl.append("g").on("mousedown",function(){return e(function(){return t.zoomClicked(1)})});d.append("circle").attr({cx:s,cy:o+6*i,r:i,fill:"white",stroke:"gray",opacity:"0.50"}),d.append("rect").attr({x:s-i/2,y:o+5.9*i,width:i,height:i/3,fill:"gray"})},s.prototype.initMercartorSphere=function(){if(!s.MercartorSphere){var e=function(e,t,a){function r(e,t,i){return(1-i)*e+i*t}function s(e,t,a){var s=2*Math.PI,o=Math.PI,n=this.radius,l=-n*Math.cos(e*s)*Math.sin(t*o),c=-n*Math.cos(t*o),u=n*Math.sin(e*s)*Math.sin(t*o),h=e*n*2-n,p=t*n*2-n,d=0,g=r(l,h,a),m=r(c,p,a),f=r(u,d,a);return new i.Vector3(g,m,f)}function o(e,t,a){var r=89.99*(t-.5)*2/180*Math.PI,s=Math.sin(r),o=.5+.25*Math.log((1+s)/(1-s))/Math.PI;return new i.Vector2(e,o)}i.Geometry.call(this),this.radius=e,this.widthSegments=t,this.heightSegments=a,this.t=0;var n,l,c=[],u=[];for(l=0;l<=a;l++){var h=[],p=[];for(n=0;n<=t;n++){var d=n/t,g=l/a;this.vertices.push(s.call(this,d,g,this.t)),p.push(o.call(this,d,g,this.t)),h.push(this.vertices.length-1)}c.push(h),u.push(p)}for(l=0;l<this.heightSegments;l++)for(n=0;n<this.widthSegments;n++){var m=c[l][n+1],f=c[l][n],y=c[l+1][n],v=c[l+1][n+1],x=this.vertices[m].clone().normalize(),b=this.vertices[f].clone().normalize(),S=this.vertices[y].clone().normalize(),w=this.vertices[v].clone().normalize(),C=u[l][n+1],P=u[l][n],A=u[l+1][n],T=u[l+1][n+1];this.faces.push(new i.Face3(m,f,y,[x,b,S])),this.faces.push(new i.Face3(m,y,v,[x,S,w])),this.faceVertexUvs[0].push([C.clone(),P.clone(),A.clone()]),this.faceVertexUvs[0].push([C.clone(),A.clone(),T.clone()])}this.computeFaceNormals(),this.computeVertexNormals(),this.computeBoundingSphere()};e.prototype=Object.create(i.Geometry.prototype),s.MercartorSphere=e}},s.prototype.getBingMapCanvas=function(e){function t(a,r){a<=e&&(a===e&&i(r),t(a+1,r+"0"),t(a+1,r+"1"),t(a+1,r+"2"),t(a+1,r+"3"))}function i(t){var i="https://t{server}.tiles.virtualearth.net/tiles/r{quad}.jpeg?g=0&mkt={language}",s=7,l=Math.round(Math.random()*s),u=navigator.languages&&navigator.languages.length?navigator.languages[0]:navigator.language,p=i.replace("{server}",l).replace("{quad}",t).replace("{language}",u),d=a(t),g=new Image;g.onload=function(){n++,h.drawImage(g,d.x*r,d.y*r,r,r),n===o&&c.trigger("ready",e)},g.crossOrigin="",g.src=p}function a(e){for(var t=0,i=0,a=e.length-1,r=a;r>=0;r--){var s=e.charAt(r),o=Math.pow(2,a-r);"1"===s?t+=o:"2"===s?i+=o:"3"===s&&(t+=o,i+=o)}return{x:t,y:i}}var r=256,s=Math.pow(2,e),o=s*s,n=0,l=r*s,c=$("<canvas/>").attr({width:l,height:l}),u=c.get(0),h=u.getContext("2d");return t(0,""),c},s.GlobeSettings={autoRotate:!1,earthRadius:30,cameraRadius:100,earthSegments:100,heatmapSize:1e3,heatPointSize:7,heatIntensity:10,heatmapScaleOnZoom:.95,barWidth:.3,barHeight:5,rotateSpeed:.5,zoomSpeed:.8,cameraAnimDuration:1e3,clickInterval:200},s.capabilities={dataRoles:[{name:"Category",kind:e.VisualDataRoleKind.Grouping,displayName:"Location",preferredTypes:[{geography:{address:!0}},{geography:{city:!0}},{geography:{continent:!0}},{geography:{country:!0}},{geography:{county:!0}},{geography:{place:!0}},{geography:{postalCode:!0}},{geography:{region:!0}},{geography:{stateOrProvince:!0}}]},{name:"Series",kind:e.VisualDataRoleKind.Grouping,displayName:"Legend"},{name:"X",kind:e.VisualDataRoleKind.Measure,displayName:"Longitude",description:"Use to override the longitude of locations",preferredTypes:[{geography:{longitude:!0}}]},{name:"Y",kind:e.VisualDataRoleKind.Measure,displayName:"Latitude",description:"Use to override the latitude of locations",preferredTypes:[{geography:{latitude:!0}}]},{name:"Height",kind:e.VisualDataRoleKind.Measure,displayName:"Bar Height"},{name:"Heat",kind:e.VisualDataRoleKind.Measure,displayName:"Heat Intensity"}],objects:{general:{displayName:e.data.createDisplayNameGetter("Visual_General"),properties:{formatString:{type:{formatting:{formatString:!0}}}}},dataPoint:{displayName:e.data.createDisplayNameGetter("Visual_DataPoint"),properties:{defaultColor:{displayName:e.data.createDisplayNameGetter("Visual_DefaultColor"),type:{fill:{solid:{color:!0}}}},showAllDataPoints:{displayName:e.data.createDisplayNameGetter("Visual_DataPoint_Show_All"),type:{bool:!0}},fill:{displayName:e.data.createDisplayNameGetter("Visual_Fill"),type:{fill:{solid:{color:!0}}}},fillRule:{displayName:e.data.createDisplayNameGetter("Visual_Gradient"),type:{fillRule:{}},rule:{inputRole:"Gradient",output:{property:"fill",selector:["Category"]}}}}}},dataViewMappings:[{conditions:[{Category:{max:1},Series:{max:1},Height:{max:1},Heat:{max:1}}],categorical:{categories:{for:{in:"Category"},dataReductionAlgorithm:{top:{}}},values:{group:{by:"Series",select:[{bind:{to:"Height"}},{bind:{to:"Heat"}},{bind:{to:"X"}},{bind:{to:"Y"}}],dataReductionAlgorithm:{top:{}}}},rowCount:{preferred:{min:2}}}}],sorting:{custom:{}}},s}();s.GlobeMap=c}(s=t.samples||(t.samples={}))}(t=e.visuals||(e.visuals={}))}(s||(s={}))},function(e,t){var i,a=window.jsCommon,i=window.powerbi;window.powerbitests,window.InJs,window.debug,window.jasmine,window.Microsoft;!function(e){var t;!function(t){var i;!function(i){var r=a.CssConstants.createClassAndSelector,s=a.PixelConverter,o=function(){function e(){}return e.prototype.bindEvents=function(e,t){var i=this.selection=e.selection,a=e.clearCatcher;this.interactivityService=e.interactivityService,this.hasHighlights=e.hasHighlights,i.on("click",function(e){t.handleSelection(e,d3.event.ctrlKey),d3.event.stopPropagation()}),a.on("click",function(){t.handleClearSelection()})},e.prototype.renderSelection=function(e){var t=this.hasHighlights;this.selection.style("opacity",function(i){return l.getFillOpacity(i.selected,i.highlight,!i.highlight&&e,!i.selected&&t)})},e}();i.RadarChartWebBehavior=o;var n=function(){function i(e){e&&(e.svg&&(this.svg=e.svg),e.animator&&(this.animator=e.animator),e.margin&&(this.margin=e.margin))}return i.converter=function(e,r,s){if(!(e&&e.categorical&&e.categorical.categories&&e.categorical.categories.length>0&&e.categorical.categories[0]&&e.categorical.values&&e.categorical.values.length>0&&r))return{legendData:{dataPoints:[]},settings:{showLegend:!0,line:!0,lineWidth:4},series:[],dataLabelsSettings:t.dataLabelUtils.getDefaultPointLabelSettings()};for(var o=e.categorical,n=o.values,l=o&&o.values?o.values.grouped():null,c=[],u=new t.ColorHelper(r,i.Properties.dataPoint.fill),h=!!(n.length>0&&n[0].highlights),p={fontSize:8.25,dataPoints:[],title:""},d=i.parseSettings(e),g=i.parseLabelSettings(e),m=0,f=n.length;m<f;m++){var y,v,x,b=r.getColorByIndex(m).value,S=[],w=l&&l.length>m&&l[m].values?l[m]:null;if(n[m].source){var C=n[m].source;if(C.queryName&&(v=C.queryName,y=t.SelectionId.createWithMeasure(v)),C.displayName&&(x=C.displayName),C.objects){var P=C.objects;b=u.getColorForMeasure(P,v)}}p.dataPoints.push({label:x,color:b,icon:t.LegendIcon.Box,selected:!1,identity:y});for(var A=0,T=n[m].values.length;A<T;A++){var D=t.SelectionIdBuilder.builder().withMeasure(v).withCategory(o.categories[0],A).withSeries(e.categorical.values,w).createSelectionId(),V=t.TooltipBuilder.createTooltipInfo(i.formatStringProp,o,o.categories[0].values[A],n[m].values[A],null,null,m),N=t.valueFormatter.getFormatString(o.values[m].source,i.formatStringProp),L=a.PixelConverter.fromPoint(g.fontSize);S.push({x:A,y:n[m].values[A],color:b,identity:D,selected:!1,tooltipInfo:V,value:n[m].values[A],labelFormatString:N,labelFontSize:L,highlight:h&&!!n[0].highlights[A]})}S.length>0&&(s&&!h&&s.applySelectionStateToData(S),c.push({fill:b,name:x,dataPoints:S,identity:y,hasHighlights:h}))}return{legendData:p,settings:d,series:c,dataLabelsSettings:g}},i.prototype.init=function(e){var a=e.element;this.svg||(this.svg=d3.select(a.get(0)).append("svg"),this.svg.style("position","absolute")),this.margin||(this.margin=i.DefaultMargin),this.svg.classed(i.VisualClassName,!0),this.interactivityService=t.createInteractivityService(e.host),this.behavior=new o,this.isInteractiveChart=e.interactivity&&e.interactivity.isInteractiveLegend,this.legend=t.createLegend(a,this.isInteractiveChart,this.interactivityService,!0,t.LegendPosition.Top),this.colors=e.style.colorPalette.dataColors,this.mainGroupElement=this.svg.append("g"),this.segments=this.mainGroupElement.append("g").classed(i.Segments.class,!0),this.zeroSegment=this.mainGroupElement.append("g").classed(i.ZeroSegment.class,!0),this.axis=this.mainGroupElement.append("g").classed(i.Axis.class,!0),this.chart=this.mainGroupElement.append("g").classed(i.Chart.class,!0)},i.prototype.update=function(e){if(e.dataViews&&e.dataViews[0]){var a=e.dataViews[0];this.radarChartData=i.converter(a,this.colors,this.interactivityService);var r,s=[],o=this.radarChartData.series,n=t.AnimatorCommon.GetAnimationDuration(this.animator,e.suppressAnimations);a.categorical&&a.categorical.categories&&a.categorical.categories[0]&&a.categorical.categories[0].values&&(s=a.categorical.categories[0].values),a.metadata&&a.metadata.columns&&a.metadata.columns.length>0&&(r=a.metadata.columns[0]),this.viewport={height:e.viewport.height>0?e.viewport.height:0,width:e.viewport.width>0?e.viewport.width:0},this.parseLegendProperties(a),this.parseLineWidth(),this.renderLegend(this.radarChartData),this.updateViewport(),this.svg.attr({height:this.viewport.height,width:this.viewport.width});var l=this.mainGroupElement;l.attr("transform",t.SVGUtil.translate(this.viewport.width/2,this.viewport.height/2));var c=this.viewport.width-this.margin.left-this.margin.right,u=this.viewport.height-this.margin.top-this.margin.bottom;this.angle=i.Radians/s.length,this.radius=i.SegmentFactor*i.Scale*Math.min(c,u)/2,this.drawCircularSegments(s),this.drawAxes(s),this.drawAxesLabels(s,r),this.drawChart(o,n),this.drawDataLabels(o),this.drawZeroCircularSegment(s),0!==this.zeroPointRadius?this.drawZeroLabel():this.mainGroupElement.selectAll(i.ZeroLabel.selector).remove()}},i.prototype.getRadarChartLabelLayout=function(e,i){var a=t.dataLabelUtils.createColumnFormatterCacheManager(),r=this.angle,o=this.viewport,n=this.viewport.height/2,l=this.viewport.width/2,c=this.calculateChartDomain(this.radarChartData.series);return{labelText:function(r){var s=a.getOrCreate(r.labelFormatString,e);if(0===e.displayUnits){var n=_.max(i,function(e){return e.value}),l=n.value>0?n.value:0;s=a.getOrCreate(r.labelFormatString,e,l)}return t.dataLabelUtils.getLabelFormattedText({label:s.format(r.value),maxWidth:o.width,fontSize:e.fontSize})},labelLayout:{x:function(e){return-1*c(e.y)*Math.sin(e.x*r)+l},y:function(e){return-1*c(e.y)*Math.cos(e.x*r)+n-7}},filter:function(e){return null!=e&&null!=e.value},style:{fill:e.labelColor,"font-size":function(t){return s.fromPoint(e.fontSize)}}}},i.prototype.drawCircularSegments=function(e){for(var a=[],r=this.angle,s=i.SegmentFactor,o=i.SegmentLevels,n=this.radius,l=0;l<o;l++)for(var c=n*((l+1)/o),u=-1*c,h=0;h<e.length;h++)a.push({x1:c*(1-s*Math.sin(h*r)),y1:c*(1-s*Math.cos(h*r)),x2:c*(1-s*Math.sin((h+1)*r)),y2:c*(1-s*Math.cos((h+1)*r)),translate:t.SVGUtil.translate(u,u)});var p=this.mainGroupElement.select(i.Segments.selector).selectAll(i.SegmentNode.selector).data(a);p.enter().append("svg:line").classed(i.SegmentNode.class,!0),p.attr({x1:function(e){return e.x1},y1:function(e){return e.y1},x2:function(e){return e.x2},y2:function(e){return e.y2},transform:function(e){return e.translate}}),p.exit().remove()},i.prototype.drawDataLabels=function(e){var i=this.getAllDataPointsList(e);if(this.radarChartData.dataLabelsSettings.show){var a=this.getRadarChartLabelLayout(this.radarChartData.dataLabelsSettings,i),r=this.viewport,s=t.dataLabelUtils.drawDefaultLabelsForDataPointChart(i,this.mainGroupElement,a,r);s.attr("transform",t.SVGUtil.translate(-(r.width/2),-(r.height/2)))}else t.dataLabelUtils.cleanDataLabels(this.mainGroupElement)},i.prototype.drawAxes=function(e){var t=this.angle,a=-1*this.radius,r=this.mainGroupElement.select(i.Axis.selector).selectAll(i.AxisNode.selector),s=r.data(e);s.enter().append("svg:line"),s.attr({x1:0,y1:0,x2:function(e,i){return a*Math.sin(i*t)},y2:function(e,i){return a*Math.cos(i*t)}}).classed(i.AxisNode.class,!0),s.exit().remove()},i.prototype.drawAxesLabels=function(a,r){var s=this,o=this.angle,n=-1*this.radius,l=a.length,c=t.valueFormatter.create({format:t.valueFormatter.getFormatString(r,i.formatStringProp,!0),value:a[0],value2:a[l-1]}),u=this.mainGroupElement.select(i.Axis.selector).selectAll(i.AxisLabel.selector),h=u.data(a);h.enter().append("svg:text"),h.attr("text-anchor",function(e,t){return t*o>Math.PI?"start":"end"}).attr("dy","1.5em").attr("transform",function(e,i){var a=i*o*180/Math.PI,r=90-a;r<-90?(r+=180,a+=2.5):a-=3;var s=a/180*Math.PI,l=(n-8)*Math.sin(s),c=(n-7)*Math.cos(s);return t.SVGUtil.translate(l,c)+" rotate("+r+") "}).text(function(t){var a={fontFamily:i.AxesLabelsFontFamily,fontSize:i.AxesLabelsfontSize,text:c.format(t)};return e.TextMeasurementService.getTailoredTextOrDefault(a,Math.min(i.AxesLabelsMaxWidth,s.viewport.width))}).classed(i.AxisLabel.class,!0),h.exit().remove()},i.prototype.drawChart=function(e,a){var r=this.angle,s=5,o=this.getDataPoints(e),n=d3.layout.stack(),c=n(o),u=this.calculateChartDomain(e),h=function(e){return e.map(function(e){var t=-1*u(e.y)*Math.sin(e.x*r),i=-1*u(e.y)*Math.cos(e.x*r);return t+","+i}).join(" ")},p=this.chart.selectAll(i.ChartArea.selector).data(c);p.enter().append("g").classed(i.ChartArea.class,!0);var d=p.selectAll(i.ChartPolygon.selector).data(function(e){return e&&e.length>0?[e]:[]});d.enter().append("polygon").classed(i.ChartPolygon.class,!0);var g=this.radarChartData.settings;g.line?d.style("fill","none").style("stroke",function(e){return e[0].color}).style("stroke-width",g.lineWidth):d.style("fill",function(e){return e[0].color}).style("stroke-width",0),d.style("opacity",i.DimmedAreaFillOpacity).on("mouseover",function(e){d3.select(this).transition().duration(a).style("opacity",i.AreaFillOpacity)}).on("mouseout",function(e){d3.select(this).transition().duration(a).style("opacity",i.DimmedAreaFillOpacity)}).attr("points",h),d.exit().remove(),p.exit().remove();var m=this.chart.selectAll(i.ChartNode.selector).data(c);m.enter().append("g").classed(i.ChartNode.class,!0);var f=e.length>0&&e[0].hasHighlights,y=this.interactivityService&&this.interactivityService.hasSelection(),v=m.selectAll(i.ChartDot.selector).data(function(e){return e.filter(function(e){return null!=e.y})});v.enter().append("svg:circle").classed(i.ChartDot.class,!0),v.attr("r",s).attr({cx:function(e){return-1*u(e.y)*Math.sin(e.x*r)},cy:function(e){return-1*u(e.y)*Math.cos(e.x*r)}}).style("fill",function(e){return e.color}).style("opacity",function(e){return l.getFillOpacity(e.selected,e.highlight,!e.highlight&&y,!e.selected&&f)}),v.exit().remove(),t.TooltipManager.addTooltip(v,function(e){return e.data.tooltipInfo},!0),m.exit().remove();var x=void 0;if(this.interactivityService){var b=this.getAllDataPointsList(e);x={selection:v,clearCatcher:this.svg,interactivityService:this.interactivityService,hasHighlights:f},this.interactivityService.bind(b,this.behavior,x)}},i.prototype.onClearSelection=function(){this.interactivityService&&this.interactivityService.clearSelection()},i.prototype.calculateChartDomain=function(e){var t=this.radius*i.SegmentFactor,a=this.getAllDataPointsList(e),r=d3.min(a,function(e){return e.y}),s=d3.max(a,function(e){return e.y});this.isPercentChart(a)&&(r=r>=0?0:-1,s=s<=0?0:1);var o=d3.scale.linear().domain([r,s]).range([0,t]);return this.zeroPointRadius=r<0&&s>0?o(0):0,o},i.prototype.renderLegend=function(e){if(e.legendData){var i=e.legendData;if(this.legendObjectProperties){t.LegendData.update(i,this.legendObjectProperties);var a=this.legendObjectProperties[t.legendProps.position];a&&this.legend.changeOrientation(t.LegendPosition[a])}else this.legend.changeOrientation(t.LegendPosition.Top);var r=this.viewport;this.legend.drawLegend(i,{height:r.height,width:r.width}),t.Legend.positionChartArea(this.svg,this.legend)}},i.prototype.drawZeroCircularSegment=function(e){for(var a=[],r=this.angle,s=i.SegmentFactor,o=this.zeroPointRadius,n=-1*o,l=0;l<e.length;l++)a.push({x1:o*(1-s*Math.sin(l*r)),y1:o*(1-s*Math.cos(l*r)),x2:o*(1-s*Math.sin((l+1)*r)),y2:o*(1-s*Math.cos((l+1)*r)),translate:t.SVGUtil.translate(n,n)});var c=this.mainGroupElement.select(i.ZeroSegment.selector).selectAll(i.ZeroSegmentNode.selector).data(a);c.enter().append("svg:line").classed(i.ZeroSegmentNode.class,!0),c.attr({x1:function(e){return e.x1},y1:function(e){return e.y1},x2:function(e){return e.x2},y2:function(e){return e.y2},transform:function(e){return e.translate}}),c.exit().remove()},i.prototype.drawZeroLabel=function(){var e=[];e.push({x:this.zeroPointRadius*(1-i.SegmentFactor)+5,y:-1*this.zeroPointRadius});var t=this.mainGroupElement.select(i.ZeroSegment.selector).selectAll(i.ZeroLabel.selector).data(e);t.enter().append("text").classed(i.ZeroLabel.class,!0).text("0"),t.attr({x:function(e){return e.x},y:function(e){return e.y}})},i.prototype.getDataPoints=function(e){for(var t=[],i=0;i<e.length;i++)t.push(e[i].dataPoints);return t},i.prototype.getAllDataPointsList=function(e){for(var t=[],i=0;i<e.length;i++)t=t.concat(e[i].dataPoints);return t},i.prototype.isPercentChart=function(e){for(var t=0;t<e.length;t++)if(e[t].labelFormatString.indexOf("%")===-1)return!1;return!0},i.prototype.parseLegendProperties=function(t){return t&&t.metadata?void(this.legendObjectProperties=e.DataViewObjects.getObject(t.metadata.objects,"legend",{})):void(this.legendObjectProperties={})},i.parseSettings=function(t){var a;return a=t&&t.metadata&&t.metadata.columns&&t.metadata.objects?t.metadata.objects:null,{showLegend:e.DataViewObjects.getValue(a,i.Properties.legend.show,!0),line:e.DataViewObjects.getValue(a,i.Properties.line.show,!1),lineWidth:e.DataViewObjects.getValue(a,i.Properties.line.lineWidth,i.DefaultLineWidth)}},i.getPrecision=function(e){return Math.max(i.MinPrecision,Math.min(i.MaxPrecision,e))},i.parseLabelSettings=function(a){var r;r=a&&a.metadata&&a.metadata.objects?a.metadata.objects:null;var s=t.dataLabelUtils.getDefaultPointLabelSettings(),o={show:e.DataViewObjects.getValue(r,i.Properties.labels.show,s.show),labelColor:e.DataViewObjects.getFillColor(r,i.Properties.labels.color,s.labelColor),displayUnits:e.DataViewObjects.getValue(r,i.Properties.labels.displayUnits,s.displayUnits),precision:i.getPrecision(e.DataViewObjects.getValue(r,i.Properties.labels.precision,s.precision)),fontSize:e.DataViewObjects.getValue(r,i.Properties.labels.fontSize,s.fontSize),position:s.position};return o},i.prototype.enumerateObjectInstances=function(e){var i,a=new t.ObjectEnumerationBuilder;if(!this.radarChartData||!this.radarChartData.settings)return[];switch(i=this.radarChartData.settings,e.objectName){case"legend":a.pushInstance(this.enumerateLegend(i));break;case"dataPoint":this.enumerateDataPoint(a);break;case"line":a.pushInstance(this.enumerateLine(i));break;case"labels":this.enumerateDataLabels(a)}return a.complete()},i.prototype.getLabelSettingsOptions=function(e,t){return{enumeration:e,dataLabelsSettings:t,show:!0,displayUnits:!0,precision:!0,fontSize:!0}},i.prototype.enumerateDataLabels=function(e){var i=this.radarChartData.dataLabelsSettings;t.dataLabelUtils.enumerateDataLabels(this.getLabelSettingsOptions(e,i))},i.prototype.enumerateLegend=function(i){var a,r,s,o=!0,n="",l=8;return o=e.DataViewObject.getValue(this.legendObjectProperties,t.legendProps.showTitle,o),n=e.DataViewObject.getValue(this.legendObjectProperties,t.legendProps.titleText,n),r=e.DataViewObject.getValue(this.legendObjectProperties,t.legendProps.labelColor,r),l=e.DataViewObject.getValue(this.legendObjectProperties,t.legendProps.fontSize,l),s=e.DataViewObject.getValue(this.legendObjectProperties,t.legendProps.position,t.legendPosition.top),a={objectName:"legend",displayName:"legend",selector:null,properties:{show:i.showLegend,position:s,showTitle:o,titleText:n,labelColor:r,fontSize:l}}},i.prototype.enumerateLine=function(e){return{objectName:i.Properties.line.show.objectName,displayName:"Draw Lines",selector:null,properties:{show:e.line,lineWidth:e.lineWidth}}},i.prototype.enumerateDataPoint=function(e){if(this.radarChartData&&this.radarChartData.series)for(var i=this.radarChartData.series,a=0;a<i.length;a++){var r=i[a];e.pushInstance({objectName:"dataPoint",displayName:r.name,selector:t.ColorHelper.normalizeSelector(r.identity.getSelector(),!1),properties:{fill:{solid:{color:r.fill}}}})}},i.prototype.updateViewport=function(){var e,i=this.legend.getMargins();switch(e=t.LegendPosition[this.legendObjectProperties[t.legendProps.position]]){case t.LegendPosition.Top:case t.LegendPosition.TopCenter:case t.LegendPosition.Bottom:case t.LegendPosition.BottomCenter:this.viewport.height=Math.max(this.viewport.height-i.height,0);break;case t.LegendPosition.Left:case t.LegendPosition.LeftCenter:case t.LegendPosition.Right:case t.LegendPosition.RightCenter:this.viewport.width=Math.max(this.viewport.width-i.width,0)}},i.prototype.parseLineWidth=function(){var e=this.radarChartData.settings;e.lineWidth=Math.max(i.MinLineWidth,Math.min(i.MaxLineWidth,e.lineWidth))},i.capabilities={dataRoles:[{displayName:"Category",name:"Category",kind:e.VisualDataRoleKind.Grouping},{displayName:"Y Axis",name:"Y",kind:e.VisualDataRoleKind.Measure}],dataViewMappings:[{conditions:[{Category:{min:1,max:1}}],categorical:{categories:{for:{in:"Category"},dataReductionAlgorithm:{top:{}}},values:{group:{by:"Series",select:[{bind:{to:"Y"}}],dataReductionAlgorithm:{top:{}}}},rowCount:{preferred:{min:2},supported:{min:1}}}}],supportsHighlight:!0,objects:{general:{displayName:"General",properties:{formatString:{type:{formatting:{formatString:!0}}}}},legend:{displayName:"Legend",description:"Display Legend Options",properties:{show:{displayName:"Show",type:{bool:!0}},position:{displayName:"Position",description:"Select the location for the legend",type:{enumeration:t.legendPosition.type}},showTitle:{displayName:"Title",description:"Display a title for legend symbols",type:{bool:!0}},titleText:{displayName:"Name",description:"Title Text",type:{text:!0},suppressFormatPainterCopy:!0},labelColor:{displayName:"Color",type:{fill:{solid:{color:!0}}}},fontSize:{displayName:"Text Size",type:{formatting:{fontSize:!0}}}}},dataPoint:{displayName:"Data colors",description:"Display data color options",properties:{fill:{displayName:"Fill",type:{fill:{solid:{color:!0}}}}}},line:{displayName:"Draw Lines",properties:{show:{displayName:"Draw Lines",type:{bool:!0}},lineWidth:{displayName:"Line Width",type:{numeric:!0}}}},labels:{displayName:"Data Labels",description:"Display data label options",properties:{show:{displayName:"Show",type:{bool:!0}},color:{displayName:"Color",description:"Select color for data labels",type:{fill:{solid:{color:!0}}}},labelDisplayUnits:{displayName:"Display Units",description:"Select the units (millions, billions, etc.)",type:{formatting:{labelDisplayUnits:!0}},suppressFormatPainterCopy:!0},labelPrecision:{displayName:"Decimal Places",description:"Select the number of decimal places to display",placeHolderText:"Auto",type:{numeric:!0},suppressFormatPainterCopy:!0},fontSize:{displayName:"Text Size",type:{formatting:{fontSize:!0}}}}}}},i.formatStringProp={objectName:"general",propertyName:"formatString"},i.Properties={legend:{show:{objectName:"legend",propertyName:"show"}},line:{show:{objectName:"line",propertyName:"show"},lineWidth:{objectName:"line",propertyName:"lineWidth"}},dataPoint:{fill:{objectName:"dataPoint",propertyName:"fill"}},labels:{show:{objectName:"labels",propertyName:"show"},color:{objectName:"labels",propertyName:"color"},displayUnits:{objectName:"labels",propertyName:"labelDisplayUnits"},precision:{objectName:"labels",propertyName:"labelPrecision"},fontSize:{objectName:"labels",propertyName:"fontSize"}}},i.VisualClassName="radarChart",i.Segments=r("segments"),i.SegmentNode=r("segmentNode"),i.ZeroSegment=r("zeroSegment"),i.ZeroSegmentNode=r("zeroSegmentNode"),i.ZeroLabel=r("zeroLabel"),i.Axis=r("axis"),i.AxisNode=r("axisNode"),i.AxisLabel=r("axisLabel"),i.Chart=r("chart"),i.ChartNode=r("chartNode"),i.ChartArea=r("chartArea"),i.ChartPolygon=r("chartPolygon"),i.ChartDot=r("chartDot"),i.MaxPrecision=17,i.MinPrecision=0,i.MaxLineWidth=10,i.MinLineWidth=1,i.DefaultLineWidth=5,i.DefaultMargin={top:50,bottom:50,right:100,left:100},i.SegmentLevels=5,i.SegmentFactor=.9,i.Radians=2*Math.PI,i.Scale=1,i.NodeFillOpacity=1,i.AreaFillOpacity=.6,i.DimmedAreaFillOpacity=.4,i.AxesLabelsFontFamily="sans-serif",i.AxesLabelsfontSize="11px",i.AxesLabelsMaxWidth=200,i}();i.RadarChart=n;var l;!function(e){function t(t,i,a,r){return r&&!i||a&&!t?e.DimmedOpacity:e.DefaultOpacity}e.DimmedOpacity=.4,e.DefaultOpacity=1,e.getFillOpacity=t}(l=i.radarChartUtils||(i.radarChartUtils={}))}(i=t.samples||(t.samples={}))}(t=e.visuals||(e.visuals={}))}(i||(i={}))},function(e,t){var i,a=window.jsCommon,i=window.powerbi;window.powerbitests,window.InJs,window.debug,window.jasmine,window.Microsoft;!function(e){var t;!function(t){var i;!function(i){var r=a.PixelConverter,s=a.CssConstants.createClassAndSelector,o=e.VisualDataRoleKind,n=e.ValueType,l=e.DateTimeSequence,c=e.DataViewObjects,u=e.TextMeasurementService,h=e.visuals.valueFormatter,p=e.visuals.SelectionId,d=e.visuals.axisStyle,g=e.visuals.yAxisPosition,m=e.visuals.DataColorPalette,f=e.visuals.ColorHelper,y=e.visuals.SVGUtil,v=e.visuals.TooltipManager,x=e.visuals.dataLabelUtils,b=e.visuals.AxisHelper.LabelLayoutStrategy.willLabelsFit,S=e.visuals.AxisHelper.LabelLayoutStrategy.willLabelsWordBreak,w=e.visuals.axisScale,C=e.visuals.valueFormatter,P=e.visuals.ObjectEnumerationBuilder,A=e.visuals.appendClearCatcher,T=e.visuals.createInteractivityService,D=function(){function e(e){this.message=e}return Object.defineProperty(e.prototype,"code",{get:function(){return"HistogramChartWarning"},enumerable:!0,configurable:!0}),e.prototype.getMessages=function(e){return{message:this.message,title:e.get(""),detail:e.get("")}},e.ErrorInvalidDataValues="Some data values are invalid or too big",e}();i.HistogramChartWarning=D;var V=function(){function e(t){this.widthOfColumn=0,this.yTitleMargin=0,this.outerPadding=0,t&&(this.svg=t.svg,this.animator=t.animator,this.margin=t.margin,this.behavior=t.behavior),this.svg=this.svg||void 0,this.animator=this.animator||void 0,this.margin=this.margin||e.DefaultMargin,this.behavior=this.behavior||L.create()}return Object.defineProperty(e.prototype,"columnsSelection",{get:function(){return this.main.select(e.Columns.selector).selectAll(e.Column.selector)},enumerable:!0,configurable:!0}),e.prototype.init=function(t){this.hostService=t.host,this.interactivityService=T(this.hostService),this.svg?this.root=this.svg:this.root=d3.select(t.element.get(0)).append("svg");var i=t.style;this.colors=i&&i.colorPalette?i.colorPalette.dataColors:new m,this.clearCatcher=A(this.root),this.root.classed(e.ClassName,!0),this.main=this.root.append("g"),this.columns=this.main.append("g").classed(e.Columns.class,!0),this.axes=this.main.append("g").classed(e.Axes.class,!0),this.axisX=this.axes.append("g").classed(e.Axis.class,!0).classed(e.XAxis.class,!0),this.axisY=this.axes.append("g").classed(e.Axis.class,!0).classed(e.YAxis.class,!0),this.legend=this.main.append("g").classed(e.Legends.class,!0),this.labelGraphicsContext=this.main.append("g").classed(e.LabelGraphicsContext.class,!0)},e.converter=function(t,i){if(!(t&&t.categorical&&t.categorical.categories&&t.categorical.categories[0]&&t.categorical.categories[0].values&&t.categorical.categories[0].values.length>0&&i))return null;var a,r,s,o,n,l,c,u,p,d,g,m,f=[],y=[],v=[],x=0,b=0,S=t.categorical.categories[0].values;if(a=e.parseSettings(t,i),!a||!e.areValuesNumbers(t.categorical.categories[0])||S.length<e.MinAmountOfValues)return null;p=e.getLegendSize(a.xAxisSettings),d=e.getLegendSize(a.yAxisSettings),t.categorical.values&&t.categorical.values[0]&&t.categorical.values[0].values&&(y=t.categorical.values[0].values),t.categorical.categories[0].identity&&t.categorical.categories[0].identity.length>0&&(v=t.categorical.categories[0].identity),s=e.getValuesByFrequencies(S,y,v),s.forEach(function(e){f.push(e.value),b+=e.frequency}),r=d3.layout.histogram(),a.bins&&a.bins>e.MinNumberOfBins&&(r=r.bins(a.bins)),o=r.frequency(a.frequency)(f),o.forEach(function(t,i){var r,o;r=s.filter(function(a){return e.isValueContainedInRange(a,t,i)}),o=r.reduce(function(e,t){return e+t.frequency},0),t.y=a.frequency?o:o/b,x+=t.length}),g=e.getBorderValues(o),m=a.yAxisSettings;var w=null!==m.end&&m.end>m.start?m.end:g.maxY,C=m.start<w?m.start:0;return a.yAxisSettings.start=e.getCorrectXAxisValue(C),a.yAxisSettings.end=e.getCorrectXAxisValue(w),s.length>=e.MinAmountOfValues&&(l=h.create({format:h.getFormatString(t.categorical.categories[0].source,e.Properties.general.formatString),value:s[0].value,value2:s[s.length-1].value,precision:a.precision}),c=h.create({value:0===a.xAxisSettings.displayUnits?s[s.length-1].value:a.xAxisSettings.displayUnits,precision:a.xAxisSettings.precision}),u=h.create({value:a.yAxisSettings.displayUnits,precision:a.yAxisSettings.precision})),n=e.getDataPoints(s,f,o,a,u,c),{dataPoints:n,borderValues:g,settings:a,formatter:l,xLabelFormatter:c,yLabelFormatter:u,xLegendSize:p,yLegendSize:d}},e.getBorderValues=function(e){var t={minX:Number.MAX_VALUE,maxX:-Number.MAX_VALUE,minY:Number.MAX_VALUE,maxY:-Number.MAX_VALUE};return e.forEach(function(e){var i=Number.MAX_VALUE,a=-Number.MAX_VALUE;e.forEach(function(e){e>a&&(a=e),e<i&&(i=e)}),i<t.minX&&(t.minX=i),a>t.maxX&&(t.maxX=a),e.y<t.minY&&(t.minY=e.y),e.y>t.maxY&&(t.maxY=e.y)}),t},e.getCorrectXAxisValue=function(t){return Math.max(Math.min(t,e.MaxXAxisEndValue),e.MinXAxisStartValue)},e.areValuesNumbers=function(e){return e&&e.source&&(e.source.type.numeric||e.source.type.integer)},e.getValuesByFrequencies=function(e,t,i){var a=[];return e.forEach(function(e,r){var s=1,o=Number(e);o=isNaN(o)?0:o,t&&t[r]&&!isNaN(t[r])&&t[r]>1&&(s=t[r]),a.push({value:o,frequency:s,selectionId:p.createWithId(i[r])})}),a},e.getDataPoints=function(t,i,a,s,o,n){var l=r.fromPoint(s.labelSettings.fontSize);return a.map(function(i,a){return i.range=e.getRange(i.x,i.dx),i.tooltipInfo=e.getTooltipData(i.y,i.range,s,0===a,o,n),i.subDataPoints=e.getSubDataPoints(t,i,a),i.labelFontSize=l,i})},e.getRange=function(e,t){return[e,e+t]},e.getTooltipData=function(t,i,a,r,s,o){
return[{displayName:e.getLegendText(a),value:s.format(t)},{displayName:e.TooltipDisplayName,value:e.rangeToString(i,r,o)}]},e.getSubDataPoints=function(t,i,a){var r=[];return t.forEach(function(t){e.isValueContainedInRange(t,i,a)&&r.push({identity:t.selectionId,selected:!1})}),r},e.isValueContainedInRange=function(e,t,i){return(0===i&&e.value>=t.x||e.value>t.x)&&e.value<=t.x+t.dx},e.parseSettings=function(t,i){if(!(t&&t.metadata&&t.metadata.columns&&t.metadata.columns[0]))return null;var a,r,s={};r=new f(i,e.Properties.dataPoint.fill,e.DefaultHistogramSettings.fillColor),s.displayName=t.metadata.columns[0].displayName||e.DefaultHistogramSettings.displayName,a=e.getObjectsFromDataView(t);var o={axisColor:e.getXAxisColor(a).solid.color,title:e.getXTitle(a),precision:e.getXPrecision(a),style:e.getXStyle(a),displayUnits:e.getXDisplayUnit(a),show:e.getXAxisShow(a)},n={axisColor:e.getYAxisColor(a).solid.color,title:e.getYTitle(a),precision:e.getYPrecision(a),style:e.getYStyle(a),displayUnits:e.getYDisplayUnit(a),show:e.getYAxisShow(a),start:e.getYStart(a),end:e.getYEnd(a),position:e.getYPosition(a)},l={show:e.getLabelShow(a),color:e.getLabelColor(a).solid.color,displayUnits:e.getLabelDisplayUnits(a),precision:e.getLabelPrecision(a),fontSize:e.getLabelFontSize(a)};return s.fillColor=r.getColorForMeasure(a,""),s.bins=e.getBins(a),s.frequency=e.getFrequency(a),s.precision=e.getPrecision(a),s.displayName=e.getLegend(s.displayName,o.style,o.displayUnits),s.xAxisSettings=o,s.yAxisSettings=n,s.labelSettings=l,s},e.getLegend=function(e,t,i){var a,r;switch(r=h.create({value:i}),t){case d.showTitleOnly:a=e;break;case d.showUnitOnly:a=0!==i&&1!==i&&r.displayUnit?r.displayUnit.title:e;break;case d.showBoth:a=0!==i&&1!==i&&r.displayUnit?e+" ("+r.displayUnit.title+")":e}return a},e.getLabelFontSize=function(t){return c.getValue(t,e.Properties.labels.fontSize,e.DefaultHistogramSettings.labelSettings.fontSize)},e.getLabelShow=function(t){return c.getValue(t,e.Properties.labels.show,e.DefaultHistogramSettings.labelSettings.show)},e.getLabelColor=function(t){return c.getValue(t,e.Properties.labels.color,{solid:{color:e.DefaultHistogramSettings.labelSettings.color}})},e.getLabelDisplayUnits=function(t){return c.getValue(t,e.Properties.labels.displayUnits,e.DefaultHistogramSettings.labelSettings.displayUnits)},e.getLabelPrecision=function(t){var i=c.getValue(t,e.Properties.labels.precision,e.DefaultHistogramSettings.labelSettings.precision);return i<=e.MinPrecision?e.MinPrecision:i>=e.MaxPrecision?e.MaxPrecision:i},e.getXStyle=function(t){return c.getValue(t,e.Properties.xAxis.style,e.DefaultHistogramSettings.xAxisSettings.style)},e.getXDisplayUnit=function(t){return c.getValue(t,e.Properties.xAxis.displayUnits,e.DefaultHistogramSettings.xAxisSettings.displayUnits)},e.getXPrecision=function(t){var i=c.getValue(t,e.Properties.xAxis.precision,e.DefaultHistogramSettings.xAxisSettings.precision);return i<=e.MinPrecision?e.MinPrecision:i>=e.MaxPrecision?e.MaxPrecision:i},e.getXAxisShow=function(t){return c.getValue(t,e.Properties.xAxis.show,e.DefaultHistogramSettings.xAxisSettings.show)},e.getXAxisColor=function(t){return c.getValue(t,e.Properties.xAxis.axisColor,{solid:{color:e.DefaultHistogramSettings.xAxisSettings.axisColor}})},e.getXTitle=function(t){return c.getValue(t,e.Properties.xAxis.title,e.DefaultHistogramSettings.xAxisSettings.title)},e.getYStyle=function(t){return c.getValue(t,e.Properties.yAxis.style,e.DefaultHistogramSettings.yAxisSettings.style)},e.getYPosition=function(t){return c.getValue(t,e.Properties.yAxis.position,e.DefaultHistogramSettings.yAxisSettings.position)},e.getYAxisShow=function(t){return c.getValue(t,e.Properties.yAxis.show,e.DefaultHistogramSettings.yAxisSettings.show)},e.getYAxisColor=function(t){return c.getValue(t,e.Properties.yAxis.axisColor,{solid:{color:e.DefaultHistogramSettings.yAxisSettings.axisColor}})},e.getYStart=function(t){return c.getValue(t,e.Properties.yAxis.start,e.DefaultHistogramSettings.yAxisSettings.start)},e.getYEnd=function(t){return c.getValue(t,e.Properties.yAxis.end,e.DefaultHistogramSettings.yAxisSettings.end)},e.getYDisplayUnit=function(t){return c.getValue(t,e.Properties.yAxis.displayUnits,e.DefaultHistogramSettings.yAxisSettings.displayUnits)},e.getYPrecision=function(t){var i=c.getValue(t,e.Properties.yAxis.precision,e.DefaultHistogramSettings.yAxisSettings.precision);return i<=e.MinPrecision?e.MinPrecision:i>=e.MaxPrecision?e.MaxPrecision:i},e.getYTitle=function(t){return c.getValue(t,e.Properties.yAxis.title,e.DefaultHistogramSettings.yAxisSettings.title)},e.getBins=function(t){var i=Number(c.getValue(t,e.Properties.general.bins,e.DefaultHistogramSettings.bins));return!i||isNaN(i)||i<=e.MinNumberOfBins?e.DefaultHistogramSettings.bins:i>e.MaxNumberOfBins?e.MaxNumberOfBins:i},e.getFrequency=function(t){return c.getValue(t,e.Properties.general.frequency,e.DefaultHistogramSettings.frequency)},e.getPrecision=function(t){var i=c.getValue(t,e.Properties.labels.precision,e.DefaultHistogramSettings.precision);return i<=e.MinPrecision?e.MinPrecision:i>=e.MaxPrecision?e.MaxPrecision:i},e.prototype.isDataValid=function(e){return!(!e||!e.dataPoints||0===e.dataPoints.length)&&(!e.dataPoints.some(function(e){return e.range.some(function(e){return isNaN(e)||e===1/0||e===-(1/0)})})||(this.hostService.setWarnings([new D(D.ErrorInvalidDataValues)]),!1))},e.prototype.update=function(t){if(t&&t.dataViews&&t.dataViews[0]){var i,a=t.dataViews[0];if(this.setSize(t.viewport),this.dataView=e.converter(a,this.colors),!this.isDataValid(this.dataView))return void this.clear();this.updateViewportIn(),i=this.updateAxes(a),this.columsAndAxesTransform(i),this.updateWidthOfColumn(),this.createScales(),this.applySelectionStateToData(),this.render()}},e.prototype.updateAxes=function(t){var i,a,r;i=e.getWidthOfLabel(this.dataView.borderValues.maxY,this.dataView.yLabelFormatter),a=e.getWidthOfLabel(this.dataView.borderValues.maxX,this.dataView.xLabelFormatter),r=e.getHeightOfLabel(this.dataView.borderValues.maxX,this.dataView.xLabelFormatter);var s=t.categorical.values&&t.categorical.values[0]&&t.categorical.values[0].values?t.categorical.values[0].source:t.categorical.categories[0].source;return this.yAxisProperties=this.calculateYAxes(s,r),this.renderYAxis(),this.yTitleMargin=this.shouldShowYOnRight()?this.viewport.width-e.YTitleMargin+this.dataView.yLegendSize:0,this.updateViewportIn(i),this.xAxisProperties=this.calculateXAxes(t.categorical.categories[0].source,e.DefaultTextProperties,a,!1),this.renderXAxis(),i},e.prototype.applySelectionStateToData=function(){var e=this;this.interactivityService&&this.dataView.dataPoints.forEach(function(t){e.interactivityService.applySelectionStateToData(t.subDataPoints)})},e.prototype.createScales=function(){var e=this.dataView.settings.yAxisSettings,t=this.dataView.borderValues;this.dataView.xScale=d3.scale.linear().domain([t.minX,t.maxX]).range([0,this.viewportIn.width]),this.dataView.yScale=d3.scale.linear().domain([e.start,e.end]).range([this.viewportIn.height,this.outerPadding])},e.prototype.updateViewportIn=function(t){void 0===t&&(t=0);var i,a;i=this.viewport.width-this.dataView.yLegendSize-t,a=this.viewport.height-this.dataView.xLegendSize,this.viewportIn={height:Math.max(a,e.MinViewportInSize),width:Math.max(i,e.MinViewportInSize)}},e.prototype.updateWidthOfColumn=function(){var t,i=this.dataView.dataPoints.length;t=i?this.viewportIn.width/i-e.ColumnPadding:e.MinViewportInSize,this.widthOfColumn=Math.max(t,e.MinViewportInSize)},e.prototype.clear=function(){var e=this;[this.axisX,this.axisY,this.legend,this.columns,this.labelGraphicsContext].forEach(function(t){e.clearElement(t)})},e.prototype.clearElement=function(e){e.selectAll("*").remove()},e.getLegendSize=function(t){return t.title?e.LegendSizeWhenTitleIsActive:e.LegendSizeWhenTitleIsNotActive},e.getWidthOfLabel=function(t,i){var a=e.getTextPropertiesForMeasurement(t,i);return u.measureSvgTextWidth(a)+e.AdditionalWidthOfLabel},e.getHeightOfLabel=function(t,i){var a=e.getTextPropertiesForMeasurement(t,i);return u.measureSvgTextHeight(a)+e.AdditionalHeightOfLabel},e.getTextPropertiesForMeasurement=function(t,i){var a;return a=i?i.format(t):t,e.getTextProperties(a)},e.prototype.setSize=function(t){var i,a;i=t.height-this.margin.top-this.margin.bottom,a=t.width-this.margin.left-this.margin.right,this.viewport={height:Math.max(i,e.MinViewportSize),width:Math.max(a,e.MinViewportSize)},this.updateElements(Math.max(t.height,e.MinViewportSize),Math.max(t.width,e.MinViewportSize))},e.prototype.updateElements=function(e,t){var i=y.translate(this.margin.left,this.margin.top);this.root.attr({height:e,width:t}),this.main.attr("transform",i),this.legend.attr("transform",i)},e.prototype.shouldShowYOnRight=function(){return this.dataView.settings.yAxisSettings.position===g.right},e.prototype.columsAndAxesTransform=function(t){var i,a=this.shouldShowYOnRight()?this.margin.left:this.dataView.settings.yAxisSettings.title?this.margin.left+t+e.YAxisMargin:this.margin.left+t;i=y.translate(a+e.ColumnAndLabelOffset,0),this.columns.attr("transform",i),this.labelGraphicsContext.attr("transform",i),this.axes.attr("transform",y.translate(a,0)),this.axisY.attr("transform",y.translate(this.shouldShowYOnRight()?this.viewportIn.width:0,0)),this.axisX.attr("transform",y.translate(0,this.viewportIn.height))},e.prototype.render=function(){var t=this.renderColumns();e.bindTooltipsToSelection(t),this.bindSelectionHandler(t),this.renderLegend(),this.renderLabels()},e.prototype.renderColumns=function(){var t,i=this,a=this.dataView.dataPoints,r=this.dataView.xScale,s=this.dataView.yScale;return t=this.columnsSelection.data(a),t.enter().append("svg:rect").classed(e.Column.class,!0),t.attr({x:function(e){return r(e.x)},y:function(e){return s(e.y)},width:this.widthOfColumn,height:function(e){return i.getColumnHeight(e,s)}}).style("fill",this.dataView.settings.fillColor),M.updateFillOpacity(t,this.interactivityService,!1),t.exit().remove(),t},e.bindTooltipsToSelection=function(e){v.addTooltip(e,function(e){return e.data.tooltipInfo})},e.prototype.getColumnHeight=function(t,i){var a=this.viewportIn.height-i(t.y);return Math.max(a,e.MinColumnHeight)},e.prototype.renderXAxis=function(){var e,t=this,i=this.dataView.settings.xAxisSettings.show,a=this.dataView.settings.xAxisSettings.axisColor;e=this.xAxisProperties.axis.tickFormat(function(e,i){var a=t.xAxisProperties.axis.tickValues(),r=a&&a.length||0;return t.formatLabelOfXAxis(e,i,r)}).orient("bottom"),i?this.axisX.call(e):this.axisX.selectAll("*").remove(),this.updateFillColorOfAxis(this.axisX,a)},e.prototype.formatLabelOfXAxis=function(t,i,a){var r,s=this.dataView.xLabelFormatter.format(t);return 0!==i&&i!==a-1||(r=Math.min(this.viewportIn.width,e.MaxWidthOfTheLatestLabel),s=e.getTailoredTextOrDefault(s,r)),s},e.getTailoredTextOrDefault=function(t,i){var a=e.getTextProperties(t);return u.getTailoredTextOrDefault(a,i)},e.getTextProperties=function(t){return{text:t,fontFamily:e.DefaultTextProperties.fontFamily,fontSize:e.DefaultTextProperties.fontSize}},e.prototype.renderYAxis=function(){var e,t=this,i=this.dataView.settings.yAxisSettings.show,a=this.dataView.settings.yAxisSettings.axisColor;e=this.yAxisProperties.axis.orient(this.dataView.settings.yAxisSettings.position.toLowerCase()).tickFormat(function(e){return t.dataView.yLabelFormatter.format(e)}),i?this.axisY.call(e):this.axisY.selectAll("*").remove(),this.updateFillColorOfAxis(this.axisY,a)},e.prototype.updateFillColorOfAxis=function(e,t){e.selectAll("g.tick text").style({fill:t})},e.prototype.getLabelLayout=function(){var t=this,i=this.dataView.settings.labelSettings,a=r.fromPoint(i.fontSize),s=x.LabelTextProperties.fontFamily,o=this.dataView.xScale,n=this.dataView.yScale,l=h.create({value:i.displayUnits,precision:i.precision});return{labelText:function(e){return l.format(e.y).toString()},labelLayout:{x:function(i){var a,r;return a=o(i.x),r=i.size.width/e.DataLabelXOffset-t.widthOfColumn/2,a-r},y:function(e){var t,i;return t=n(e.y),i=e.size.height,t-i}},filter:function(e){return null!=e},style:{fill:i.color,"font-size":a,"font-family":s}}},e.prototype.renderLabels=function(){var t,i=this.dataView.settings.labelSettings,a=this.dataView.dataPoints;return i.show?(t=x.drawDefaultLabelsForDataPointChart(a,this.labelGraphicsContext,this.getLabelLayout(),this.viewportIn),void(t&&t.attr("transform",function(t){var i,a,r=t.size;return i=r.width/e.DataLabelXOffset,a=r.height/e.DataLabelYOffset,y.translate(i,a)}))):void x.cleanDataLabels(this.labelGraphicsContext)},e.rangesToArray=function(e){return e.reduce(function(e,t,i){var a;return a=0===i?t.range:t.range.slice(1),e.concat(a)},[])},e.rangeToString=function(t,i,a){var r,s=e.IncludeBrackets.right,o=a.format(t[0]),n=a.format(t[1]);return r=i?e.IncludeBrackets.left:e.ExcludeBrackets.left,""+r+o+e.SeparatorNumbers+n+s},e.prototype.renderLegend=function(){var t,i,a=this.getDataLegends(this.dataView.settings);t=this.main.select(e.Legends.selector).selectAll(e.Legend.selector),i=t.data(a),i.enter().append("svg:text"),i.attr({x:0,y:0,dx:function(e){return e.dx},dy:function(e){return e.dy},transform:function(e){return e.transform}}).text(function(e){return e.text}).classed(e.Legend.class,!0),i.exit().remove(),this.legend.select("text").style({display:e.getDispayForAxisTitle(this.dataView.settings.xAxisSettings)}),this.legend.selectAll("text").filter(function(e,t){return 1===t}).style({display:e.getDispayForAxisTitle(this.dataView.settings.yAxisSettings)})},e.getDispayForAxisTitle=function(e){return e&&e.title?null:"none"},e.prototype.getDataLegends=function(t){var i=e.getLegendText(t);return i=e.getLegend(i,t.yAxisSettings.style,t.yAxisSettings.displayUnits),[{transform:y.translate(this.viewport.width/2,this.viewport.height),text:e.getTailoredTextOrDefault(t.displayName,this.viewportIn.width),dx:"-0.5em",dy:"-1em"},{transform:y.translateAndRotate(this.shouldShowYOnRight()?this.yTitleMargin:0,this.viewport.height/2,0,0,270),text:e.getTailoredTextOrDefault(i,this.viewportIn.height),dx:"3em"}]},e.getLegendText=function(t){return t.frequency?e.FrequencyText:e.DensityText},e.prototype.bindSelectionHandler=function(e){if(this.interactivityService&&this.dataView&&this.dataView.dataPoints){var t=[];this.dataView.dataPoints.forEach(function(e){t=t.concat(e.subDataPoints)});var i={columns:e,clearCatcher:this.clearCatcher,interactivityService:this.interactivityService};this.interactivityService.bind(t,this.behavior,i)}},e.prototype.enumerateObjectInstances=function(e){var t,i=new P;if(!this.dataView||!this.dataView.settings)return[];switch(t=this.dataView.settings,e.objectName){case"general":this.enumerateGeneral(i,t);break;case"dataPoint":this.enumerateDataPoint(i,t);break;case"labels":this.enumerateLabels(i,t);break;case"xAxis":this.enumerateXAxis(i,t);break;case"yAxis":this.enumerateYAxis(i,t)}return i.complete()||[]},e.prototype.enumerateGeneral=function(e,t){var i={objectName:"general",displayName:"general",selector:null,properties:{bins:t.bins,frequency:t.frequency}};e.pushInstance(i)},e.prototype.enumerateDataPoint=function(e,t){var i={objectName:"dataPoint",displayName:"dataPoint",selector:null,properties:{fill:t.fillColor}};e.pushInstance(i)},e.prototype.enumerateLabels=function(e,t){var i=t.labelSettings,a={objectName:"labels",displayName:"labels",selector:null,properties:{show:i.show,color:i.color,displayUnits:i.displayUnits,precision:i.precision,fontSize:i.fontSize}};e.pushInstance(a)},e.prototype.enumerateXAxis=function(e,t){var i=t.xAxisSettings,a={objectName:"xAxis",displayName:"X-Axis",selector:null,properties:{show:i.show,title:i.title,style:i.style,axisColor:i.axisColor,displayUnits:i.displayUnits,precision:i.precision}};e.pushInstance(a)},e.prototype.enumerateYAxis=function(e,t){var i=t.yAxisSettings,a={objectName:"yAxis",displayName:"Y-Axis",selector:null,properties:{show:i.show,position:i.position,start:i.start,end:i.end,title:i.title,style:i.style,axisColor:i.axisColor,displayUnits:i.displayUnits,precision:i.precision}};e.pushInstance(a)},e.getObjectsFromDataView=function(e){return e&&e.metadata&&e.metadata.columns&&e.metadata.objects?e.metadata.objects:null},e.prototype.destroy=function(){this.root=null},e.prototype.calculateXAxes=function(t,i,a,r){var s,o=this.viewportIn.width;return s=this.calculateXAxesProperties(e.rangesToArray(this.dataView.dataPoints),w.linear,t,e.InnerPaddingRatio,a),s.willLabelsFit=b(s,o,u.measureSvgTextWidth,i),s.willLabelsWordBreak=!s.willLabelsFit&&!r&&S(s,this.margin,o,u.measureSvgTextWidth,u.estimateSvgTextHeight,u.getTailoredTextOrDefault,i),s},e.prototype.calculateXAxesProperties=function(t,i,a,r,s){var o=N.createAxis({pixelSpan:this.viewportIn.width,dataDomain:t,metaDataColumn:a,formatString:C.getFormatString(a,e.Properties.general.formatString),outerPadding:0,isScalar:!1,isVertical:!1,useTickIntervalForDisplayUnits:!0,isCategoryAxis:!0,getValueFn:function(e,t){return e},scaleType:i,innerPaddingRatio:r,minOrdinalRectThickness:s,tickLabelPadding:void 0});return o.axisLabel=this.dataView.settings.displayName,o},e.prototype.calculateYAxes=function(t,i){var a=this.dataView.settings.yAxisSettings;return this.calculateYAxesProperties([a.start,a.end],w.linear,t,e.InnerPaddingRatio,i)},e.prototype.calculateYAxesProperties=function(t,i,a,r,s){var o=void 0;return this.dataView.settings.frequency&&(o=C.getFormatString(a,e.Properties.general.formatString)),N.createAxis({pixelSpan:this.viewportIn.height,dataDomain:t,metaDataColumn:a,formatString:o,outerPadding:this.outerPadding,isScalar:!0,isVertical:!0,useTickIntervalForDisplayUnits:!0,isCategoryAxis:!1,getValueFn:function(e,t){return e},scaleType:i,innerPaddingRatio:r,minOrdinalRectThickness:s,tickLabelPadding:void 0,is100Pct:!0})},e.ClassName="histogram",e.FrequencyText="Frequency",e.DensityText="Density",e.Properties={general:{bins:{objectName:"general",propertyName:"bins"},frequency:{objectName:"general",propertyName:"frequency"},formatString:{objectName:"general",propertyName:"formatString"}},dataPoint:{fill:{objectName:"dataPoint",propertyName:"fill"}},labels:{show:{objectName:"labels",propertyName:"show"},color:{objectName:"labels",propertyName:"color"},displayUnits:{objectName:"labels",propertyName:"displayUnits"},precision:{objectName:"labels",propertyName:"precision"},fontSize:{objectName:"labels",propertyName:"fontSize"}},xAxis:{show:{objectName:"xAxis",propertyName:"show"},axisColor:{objectName:"xAxis",propertyName:"axisColor"},title:{objectName:"xAxis",propertyName:"title"},displayUnits:{objectName:"xAxis",propertyName:"displayUnits"},precision:{objectName:"xAxis",propertyName:"precision"},style:{objectName:"xAxis",propertyName:"style"}},yAxis:{show:{objectName:"yAxis",propertyName:"show"},axisColor:{objectName:"yAxis",propertyName:"axisColor"},title:{objectName:"yAxis",propertyName:"title"},displayUnits:{objectName:"yAxis",propertyName:"displayUnits"},precision:{objectName:"yAxis",propertyName:"precision"},style:{objectName:"yAxis",propertyName:"style"},start:{objectName:"yAxis",propertyName:"start"},end:{objectName:"yAxis",propertyName:"end"},position:{objectName:"yAxis",propertyName:"position"}}},e.DefaultHistogramSettings={frequency:!0,displayName:"Histogram",bins:null,fillColor:"#01b8aa",precision:2,xAxisSettings:{show:!0,axisColor:"#777",title:!0,displayUnits:0,precision:2,style:d.showTitleOnly},yAxisSettings:{show:!0,axisColor:"#777",title:!0,displayUnits:0,precision:2,style:d.showTitleOnly,start:0,position:g.left},labelSettings:{show:!1,color:"#777",displayUnits:0,precision:2,fontSize:9}},e.Axes=s("axes"),e.Axis=s("axis"),e.XAxis=s("xAxis"),e.YAxis=s("yAxis"),e.Columns=s("columns"),e.Column=s("column"),e.Legends=s("legends"),e.Legend=s("legend"),e.LabelGraphicsContext=s("labelGraphicsContext"),e.MinNumberOfBins=0,e.MaxNumberOfBins=100,e.MinPrecision=0,e.MaxPrecision=17,e.MinXAxisStartValue=0,e.MaxXAxisEndValue=1e25,e.YTitleMargin=70,e.YAxisMargin=20,e.MinViewportSize=100,e.MinViewportInSize=0,e.MinAmountOfValues=2,e.AdditionalWidthOfLabel=3,e.AdditionalHeightOfLabel=3,e.LegendSizeWhenTitleIsActive=50,e.LegendSizeWhenTitleIsNotActive=25,e.InnerPaddingRatio=1,e.DataLabelXOffset=2,e.DataLabelYOffset=1.8,e.ColumnPadding=2.5,e.ColumnAndLabelOffset=1.5,e.MinColumnHeight=1,e.TooltipDisplayName="Range",e.SeparatorNumbers=", ",e.MaxWidthOfTheLatestLabel=40,e.ExcludeBrackets={left:"(",right:")"},e.IncludeBrackets={left:"[",right:"]"},e.DefaultMargin={top:10,right:10,bottom:10,left:10},e.DefaultTextProperties={fontFamily:"'Segoe UI', 'wf_segoe-ui_normal', helvetica, arial, sans-serif",fontSize:r.toString(11)},e.capabilities={dataRoles:[{name:"Values",kind:o.Grouping,displayName:"Values"},{name:"Frequency",kind:o.Measure,displayName:"Frequency"}],dataViewMappings:[{conditions:[{Values:{min:1,max:1},Frequency:{min:0,max:1}}],categorical:{categories:{bind:{to:"Values"},dataReductionAlgorithm:{top:{}}},values:{for:{in:"Frequency"}}}}],sorting:{implicit:{clauses:[{role:"Values",direction:1}]}},objects:{general:{displayName:"General",properties:{formatString:{type:{formatting:{formatString:!0}}},bins:{displayName:"Bins",type:{numeric:!0}},frequency:{displayName:"Frequency",type:{bool:!0}}}},dataPoint:{displayName:"Data colors",properties:{fill:{displayName:"Fill",type:{fill:{solid:{color:!0}}}}}},xAxis:{displayName:"X-Axis",properties:{show:{displayName:"Show",type:{bool:!0}},axis:{displayName:"Axis",type:{bool:!0}},axisColor:{displayName:"Color",type:{fill:{solid:{color:!0}}}},title:{displayName:"Title",type:{bool:!0}},displayUnits:{displayName:"Display Units",type:{formatting:{labelDisplayUnits:!0}}},precision:{displayName:"Decimal Places",type:{numeric:!0}},style:{displayName:"Style",type:{enumeration:d.type}}}},yAxis:{displayName:"Y-Axis",properties:{show:{displayName:"Show",type:{bool:!0}},axis:{displayName:"yAxis",type:{bool:!0}},axisColor:{displayName:"Color",type:{fill:{solid:{color:!0}}}},title:{displayName:"Title",type:{bool:!0}},displayUnits:{displayName:"Display Units",type:{formatting:{labelDisplayUnits:!0}}},precision:{displayName:"Decimal Places",type:{numeric:!0}},style:{displayName:"Style",type:{enumeration:d.type}},start:{displayName:"Start",type:{numeric:!0},placeHolderText:"Start",suppressFormatPainterCopy:!0},end:{displayName:"End",type:{numeric:!0},placeHolderText:"End",suppressFormatPainterCopy:!0},position:{displayName:"Position",type:{enumeration:g.type}}}},labels:{displayName:"Data Labels",properties:{show:{displayName:"Show",type:{bool:!0}},color:{displayName:"Color",type:{fill:{solid:{color:!0}}}},displayUnits:{displayName:"Display Units",type:{formatting:{labelDisplayUnits:!0}},suppressFormatPainterCopy:!0},precision:{displayName:"Decimal Places",type:{numeric:!0},suppressFormatPainterCopy:!0},fontSize:{displayName:"Text Size",type:{formatting:{fontSize:!0}}}}}}},e}();i.Histogram=V;var N;!function(i){function a(e){var t=e.pixelSpan,i=e.dataDomain,a=e.metaDataColumn,n=e.formatString,l=e.outerPadding||0,p=!!e.isCategoryAxis,g=!!e.isScalar,m=!!e.isVertical,f=!!e.useTickIntervalForDisplayUnits,y=e.getValueFn,x=e.categoryThickness,S=e.axisDisplayUnits,C=e.axisPrecision,P=!!e.is100Pct,A=e.tickLabelPadding||G,T=v(a,g),D=b(e),V=D.scale,N=D.bestTickCount,L=V.domain(),M=h(i,T);if(x&&g&&i&&2===i.length){var k=i[1]-i[0],I=L[1]-L[0];k>0&&I>0&&(x=x*k/I)}var O;if(g&&1===N)O=[i[0]];else{var F=g?c(n,T,P):void 0;O=d(N,V,T,g,F)}e.scaleType&&e.scaleType===w.log&&M&&(O=O.filter(function(e){return r(e)}));var z=o(L,i,T,g,n,N,O,y,f,S,C),j=d3.svg.axis().scale(V).tickSize(6,0).orient(m?"left":"bottom").ticks(N).tickValues(O),R=[];a&&(R=u(j,O,z,T,y));var H;return!g&&x?H=Math.max(1,x-2*A):(H=O.length>1?s(V,O):t,H-=2*B),{scale:V,axis:j,formatter:z,values:R,axisType:T,axisLabel:null,isCategoryAxis:p,xLabelMaxWidth:H,categoryThickness:x,outerPadding:l,usingDefaultDomain:D.usingDefaultDomain,isLogScaleAllowed:M,dataDomain:i}}function r(e){var t=Math.abs(e),i=Math.log(t)/Math.LN10;return i=Math.ceil(i-1e-12),t/Math.pow(10,i)===1}function s(e,t){return e&&!_.isEmpty(t)?Math.abs(e(t[1])-e(t[0])):1}function o(e,i,a,r,s,o,n,l,c,u,h){void 0===c&&(c=!1);var p;if(a.dateTime)if(r){var d=new Date(e[0]),g=new Date(e[1]);1===o&&(d=g=new Date(i[0])),p=C.create({format:s,value:d,value2:g,tickCount:o})}else p=C.createDefaultFormatter(s,!0);else if(c&&r&&n.length>1){var m=u?u:n[1]-n[0],f={format:s,value:m,value2:0,allowFormatBeautification:!0};h?f.precision=h:f.precision=t.AxisHelper.calculateAxisPrecision(n[1]-n[0],u,s),p=C.create(f)}else p=C.createDefaultFormatter(s,!0);return p}function c(e,t,i){var a=e&&!z.isStandardFormat(e);if(a){var r=z.getCustomFormatMetadata(e,!0).precision;return e.indexOf("%")>-1&&(r+=2),Math.pow(10,-r)}return i?.01:t.integer?1:0}function u(e,t,i,a,r){var s=[];return r||(r=function(e){return e}),i?(e.tickFormat(function(e){return i.format(r(e,a))}),s=t.map(function(e){return i.format(r(e,a))})):s=t.map(function(e){return r(e,a)}),s}function h(e,t){return null!=e&&(!p(t)&&(e[0]>0&&e[1]>0||e[0]<0&&e[1]<0))}function p(e){return!(!e||!e.dateTime)}function d(e,t,i,a,r){return!a||y(t)?g(e,t.domain()):p(i)?f(e,t.domain()):m(e,t,r)}function g(e,t){var i=[];if(e<=0)return i;var a=t.length;if(e>a)return t;for(var r=0,s=Math.ceil(a/e);r<a;r+=s)i.push(t[r]);return i}function m(e,t,i){var a=[];if(0===e)return a;var r=t;if(r.ticks){if(a=r.ticks(e),a.length>e&&e>1&&(a=r.ticks(e-1)),a.length<H&&(a=r.ticks(e+1)),a=F(a),i&&a.length>1){for(var s=a[1]-a[0];s>0&&s<i;){for(var o=1;o<a.length;o++)a.splice(o,1);s=2*s}1===a.length&&a.push(a[0]+i)}return a}return a}function f(e,t){var i=[];if(0===t[0]&&0===t[1])return[];var a=l.calculate(new Date(t[0]),new Date(t[1]),e).sequence;return i=a.map(function(e){return e.getTime()}),i=I(i,t[0],t[1])}function y(e){return"undefined"==typeof e.invert}function v(e,t){return e&&x(e.type)?e.type:t?n.fromDescriptor({numeric:!0}):n.fromDescriptor({text:!0})}function x(e){return e&&(e.bool||e.numeric||e.text||e.dateTime)}function b(e){var t=e.pixelSpan,a=e.dataDomain,r=e.metaDataColumn,s=e.outerPadding||0,o=!!e.isScalar,n=!!e.isVertical,l=e.forcedTickCount,c=e.categoryThickness,u=!!e.shouldClamp,h=e.maxTickCount,p=e.innerPaddingRatio||j,d=e.minOrdinalRectThickness||R,g=v(r,o),m=n?L(t):N(t);h&&m>h&&(m=h);var f,y=a?a.slice():null,x=m,b=!1;if(null==a||2===a.length&&null==a[0]&&null==a[1]||2!==a.length&&o)b=!0,a=g.dateTime||!M(g)?i.emptyDomain:[],f=M(g)?P(t,a,p,c?s/c:0):T(e.scaleType,t,a,g,s,x);else{if(o&&a.length>0){x=void 0!==l?0!==m?l:0:k(a[0],a[a.length-1],[r],m,g.dateTime);var w=A({min:a[0],max:a[a.length-1]});y=[w.min,w.max]}o&&g.numeric&&!g.dateTime?(f=T(e.scaleType,t,y,g,s,null,u),x=0===m?0:Math.floor((t-2*s)/d)):o&&g.dateTime?f=V(t,y,s,null,u):(g.text||g.dateTime||g.numeric||g.bool)&&(f=P(t,y,p,c?s/c:0),x=0===m?0:Math.min(y.length,(t-2*s)/d))}return n&&o&&f.range(f.range().reverse()),S(f),{scale:f,bestTickCount:x,usingDefaultDomain:b}}function S(e){for(var t=e.domain(),i=0,a=t.length;i<a;++i)t[i]===Number.POSITIVE_INFINITY?t[i]=Number.MAX_VALUE:t[i]===Number.NEGATIVE_INFINITY&&(t[i]=-Number.MAX_VALUE);e.domain(t)}function P(e,t,i,a){var r=d3.scale.ordinal().rangeBands([0,e],i,a).domain(t);return r}function A(e){return isNaN(e.min)||isNaN(e.max)?(e.min=i.emptyDomain[0],e.max=i.emptyDomain[1]):e.min===e.max?(e.min=e.min<0?1.2*e.min:.8*e.min,e.max=e.max<0?.8*e.max:1.2*e.max):Math.abs(e.min)<1e-4&&e.min/(e.max-e.min)<1e-4&&(e.min=0),e}function T(e,t,i,a,r,s,o){return void 0===r&&(r=0),e===w.log&&h(i,a)?D(t,i,r,s):V(t,i,r,s,o)}function D(e,t,i,a){void 0===i&&(i=0);var r=d3.scale.log().range([i,e-i]).domain([t[0],t[1]]).clamp(!0);return a&&r.nice(a),r}function V(e,t,i,a,r){void 0===i&&(i=0);var s=d3.scale.linear().range([i,e-i]).domain([t[0],t[1]]).clamp(r);return a&&s.nice(a),s}function N(e){return e<300?3:e<500?5:8}function L(e){return e<150?3:e<300?5:8}function M(e){return!(!e||!(e.text||e.bool||e.misc&&e.misc.barcode||e.geography&&e.geography.postalCode))}function k(e,t,i,a,r){return isNaN(e)||isNaN(t)?E:a<=1||t<=1&&e>=-1?a:e===t?r?1:E:O(i)?a:Math.min(t-e+1,a)}function I(e,t,i){var a=e.filter(function(e){return e>=t&&e<=i});return a.length<2&&(a=[t,i]),a}function O(e){for(var t=0,i=e.length;t<i;t++){var a=e[t];if(a&&a.type&&!a.type.integer)return!0}return!1}function F(e,t){if(void 0===t&&(t=1e-5),!e||e.length<2)return e;var i=t*Math.abs(e[1]-e[0]);return e.map(function(e){return Math.abs(e)<=i?0:e})}var z=e.NumberFormat;i.emptyDomain=[0,0];var j=.2,G=2,R=20,B=3,H=2,E=3;i.createAxis=a,i.powerOfTen=r,i.createFormatter=o,i.getMinTickValueInterval=c,i.isLogScalePossible=h,i.isDateTime=p,i.getRecommendedTickValues=d,i.getRecommendedTickValuesForAnOrdinalRange=g,i.getRecommendedTickValuesForAQuantitativeRange=m,i.isOrdinalScale=y,i.getCategoryValueType=v,i.columnDataTypeHasValue=x,i.createScale=b,i.normalizeInfinityInScale=S,i.createOrdinalScale=P,i.createNumericalScale=T,i.createLinearScale=V,i.getRecommendedNumberOfTicksForXAxis=N,i.getRecommendedNumberOfTicksForYAxis=L,i.isOrdinal=M,i.getBestNumberOfTicks=k,i.ensureValuesInRange=I,i.hasNonIntegerData=O}(N=i.HistogramAxisHelper||(i.HistogramAxisHelper={}));var L=function(){function e(){}return e.create=function(){return new e},e.prototype.bindEvents=function(t,i){var a=this;this.columns=t.columns,this.interactivityService=t.interactivityService,this.clearCatcher=t.clearCatcher,this.columns.on("click",function(t){i.handleClearSelection(),e.areDataPointsSelected(a.selectedDataPoints,t.subDataPoints)?a.createAnEmptySelectedDataPoints():(t.subDataPoints.forEach(function(e){i.handleSelection(e,!0)}),a.selectedDataPoints=t.subDataPoints)}),this.clearCatcher.on("click",function(){i.handleClearSelection(),a.createAnEmptySelectedDataPoints()})},e.prototype.renderSelection=function(e){M.updateFillOpacity(this.columns,this.interactivityService,e)},e.areDataPointsSelected=function(e,t){return!(!t||!e||t.length!==e.length)&&e.every(function(e){return t.some(function(t){return e&&t&&e.identity&&t.identity&&e.identity.equals(t.identity)})})},e.prototype.createAnEmptySelectedDataPoints=function(){this.selectedDataPoints=[]},e}();i.HistogramBehavior=L;var M;!function(e){function t(t,i,a,r){return r&&!i||a&&!t?e.DimmedOpacity:e.DefaultOpacity}function i(e){var t=!1,i=!1;return e.subDataPoints&&e.subDataPoints.length>0&&e.subDataPoints.forEach(function(e){t=t||e.selected,i=i||e.highlight}),{selected:t,highlight:i}}function a(t,i,a){void 0===a&&(a=!1);var r=!1;i&&(r=i.hasSelection()),t.style("fill-opacity",function(t){var i=e.getStateOfDataPoint(t);return e.getFillOpacity(i.selected,i.highlight,!i.highlight&&a,!i.selected&&r)})}e.DimmedOpacity=.4,e.DefaultOpacity=1,e.getFillOpacity=t,e.getStateOfDataPoint=i,e.updateFillOpacity=a}(M=i.histogramUtils||(i.histogramUtils={}))}(i=t.samples||(t.samples={}))}(t=e.visuals||(e.visuals={}))}(i||(i={}))},function(e,t){var i,a=window.jsCommon,i=window.powerbi;window.powerbitests,window.InJs,window.debug,window.jasmine,window.Microsoft;!function(e){var t;!function(t){var i;!function(t){var i=e.visuals.AnimatorCommon.GetAnimationDuration,r=a.CssConstants.createClassAndSelector,s=e.visuals.axisScale,o=a.PixelConverter,n=e.createEnumType,l=e.visuals.SelectionId,c=e.VisualDataRoleKind,u=e.visuals.dataLabelUtils,h=e.DataViewObjects,p=e.visuals.SelectionIdBuilder,d=e.visuals.createInteractivityService,g=e.visuals.appendClearCatcher,m=e.visuals.SVGUtil,f=e.visuals.ObjectEnumerationBuilder,y=e.visuals.valueFormatter,v=e.visuals.TooltipManager,x=e.visuals.AxisHelper,b=e.TextMeasurementService,S=e.visuals.dataLabelUtils.LabelTextProperties,w=5,C=1;!function(e){e[e.Horizontal="Horizontal"]="Horizontal",e[e.Vertical="Vertical"]="Vertical"}(t.DotPlotLabelsOrientation||(t.DotPlotLabelsOrientation={}));var P=t.DotPlotLabelsOrientation,A=function(){function e(e,t){this.defaultViewport=e||{width:0,height:0},this.defaultMargin=t||{top:0,bottom:0,right:0,left:0}}return Object.defineProperty(e.prototype,"viewport",{get:function(){return this.viewportValue||(this.viewportValue=this.defaultViewport)},set:function(t){var i=this;this.previousOriginalViewportValue=_.clone(this.originalViewportValue),
this.originalViewportValue=_.clone(t),this.setUpdateObject(t,function(e){return i.viewportValue=e},function(t){return e.restrictToMinMax(t,i.minViewport)})},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"viewportCopy",{get:function(){return _.clone(this.viewport)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"viewportIn",{get:function(){return this.viewportInValue||this.viewport},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"minViewport",{get:function(){return this.minViewportValue||{width:0,height:0}},set:function(t){var i=this;this.setUpdateObject(t,function(e){return i.minViewportValue=e},e.restrictToMinMax)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"margin",{get:function(){return this.marginValue||(this.marginValue=this.defaultMargin)},set:function(t){var i=this;this.setUpdateObject(t,function(e){return i.marginValue=e},e.restrictToMinMax)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"viewportChanged",{get:function(){return!(!this.originalViewportValue||this.previousOriginalViewportValue&&this.previousOriginalViewportValue.height===this.originalViewportValue.height&&this.previousOriginalViewportValue.width===this.originalViewportValue.width)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"viewportInIsZero",{get:function(){return 0===this.viewportIn.width||0===this.viewportIn.height},enumerable:!0,configurable:!0}),e.prototype.resetMargin=function(){this.margin=this.defaultMargin},e.prototype.update=function(){this.viewportInValue=e.restrictToMinMax({width:this.viewport.width-(this.margin.left+this.margin.right),height:this.viewport.height-(this.margin.top+this.margin.bottom)},this.minViewportValue)},e.prototype.setUpdateObject=function(t,i,a){var r=this;t=_.clone(t),i(e.createNotifyChangedObject(t,function(e){a&&a(t),r.update()})),a&&a(t),this.update()},e.createNotifyChangedObject=function(e,t){var i={};return _.keys(e).forEach(function(a){return Object.defineProperty(i,a,{get:function(){return e[a]},set:function(i){e[a]=i,t(e,a)},enumerable:!0,configurable:!0})}),i},e.restrictToMinMax=function(e,t){return _.keys(e).forEach(function(i){return e[i]=Math.max(t&&t[i]||0,e[i])}),e},e}(),T=function(){function e(){this.categoryAxis={show:!0,showAxisTitle:!0,labelColor:u.defaultLabelColor},this.dataPoint={fill:"#00B8AA"},this.labels={show:!0,color:u.defaultLabelColor,labelDisplayUnits:0,labelPrecision:2,fontSize:u.DefaultFontSizeInPt}}return Object.defineProperty(e,"Default",{get:function(){return new this},enumerable:!0,configurable:!0}),e.parse=function(e,t){var i=new this;if(!e||!e.metadata||!e.metadata.objects)return i;var a=this.getProperties(t);for(var r in t.objects)for(var s in t.objects[r].properties)if(i[r]&&_.has(i[r],s)){var o=t.objects[r].properties[s].type,n=this.getValueFnByType(o);i[r][s]=n(e.metadata.objects,a[r][s],i[r][s])}return i},e.getProperties=function(e){var t=_.merge({general:{properties:{formatString:{}}}},e.objects),i={};for(var a in t){i[a]={};for(var r in t[a].properties)i[a][r]={objectName:a,propertyName:r}}return i},e.createEnumTypeFromEnum=function(e){var t=!1;return n(Object.keys(e).filter(function(i,a){return!!(a%2)===t&&e[i]===i&&!void(t=!t)||!!(a%2)!==t}).map(function(e){return{value:e,displayName:e}}))},e.getValueFnByType=function(e){switch(_.keys(e)[0]){case"fill":return h.getFillColor;default:return h.getValue}},e.enumerateObjectInstances=function(e,t,i){void 0===e&&(e=new this);var a=new f,r=e&&e[t.objectName];if(!r)return a;var s={objectName:t.objectName,selector:null,properties:{}};for(var o in r)_.has(r,o)&&(s.properties[o]=r[o]);return a.pushInstance(s),a},e.prototype.createOriginalSettings=function(){this.originalSettings=_.cloneDeep(this)},e}();t.DotPlotSettings=T;var D=function(){function e(e){this.durationAnimations=200,this.scaleType=s.linear,this.dotPlotSelectors={scrollableContainer:r("dotPlotScrollableContainer"),svgPlotSelector:r("dotplot"),plotSelector:r("dotplotSelector"),plotGroupSelector:r("dotplotGroup"),axisSelector:r("axisGraphicsContext"),xAxisSelector:r("x axis"),circleSeletor:r("circleSelector")},e&&(e.svg&&(this.svg=e.svg),e.animator&&(this.animator=e.animator),this.radius=e.radius||w,this.strokeWidth=e.strokeWidth||C)}return e.getCategoryTextProperties=function(e){return{text:e,fontFamily:"'Segoe UI',wf_segoe-ui_normal,helvetica,arial,sans-serif",fontSize:o.toString(11)}},e.getValueTextProperties=function(e,t){return{text:t,fontFamily:"'Segoe UI',wf_segoe-ui_normal,helvetica,arial,sans-serif",fontSize:o.toString(e)}},Object.defineProperty(e.prototype,"settings",{get:function(){return this.data&&this.data.settings},enumerable:!0,configurable:!0}),e.getTooltipData=function(e){return[{displayName:"Value",value:e.toString()}]},e.converter=function(t,i,a,r){if(!t||!t.categorical||_.isEmpty(t.categorical.values)||_.isEmpty(t.categorical.categories))return null;for(var s=T.getProperties(this.capabilities),n=this.parseSettings(t),c=t.categorical.categories[0],u=t.categorical.values[0],h=u.values.map(function(e){return e||0}),d=_.min(h),g=_.max(h),m=y.create({format:y.getFormatString(u.source,s.general.formatString),precision:n.labels.labelPrecision,value:n.labels.labelDisplayUnits||g}),f=h.map(m.format),v=y.create({format:y.getFormatString(c.source,s.general.formatString)}),x=c.values.map(function(e,t){return{value:v.format(e),selectionId:l.createWithId(c.identity[t])}}),S=o.fromPointToPixel(n.labels.fontSize),w=15,C=(n.categoryAxis.show?20:0)+(n.categoryAxis.showAxisTitle?w:0),P=_.max(x.map(function(e){return e.value.length})),A=P*b.measureSvgTextWidth(e.getCategoryTextProperties("W")),D=_.max(f.map(function(e){return e.length})),V=Math.max(70,D*b.measureSvgTextWidth(e.getValueTextProperties(S,"0"))*.8),N=2*r+1,L=i-C-2*r-S,M=Math.floor(L/N),k=d3.scale.linear().domain([0,M]).range([L,0]),I=[],O=n.dataPoint.fill,F=d/(g/M),z=d3.scale.log().domain([d<0?1:d,g]).range([F<=0?1:F,M]).clamp(!0),j=0,G=h.length;j<G;j++){for(var R=h[j],B=z(R),H=[],E=0;E<B&&M>0;E++)H.push({y:k(E),tooltipInfo:e.getTooltipData(R.toFixed(n.labels.labelPrecision).toString())});var W=p.builder().withCategory(c,j).createSelectionId(),U=e.getTooltipData(R.toFixed(n.labels.labelPrecision));I.push({category:x[j],selected:!1,value:R,label:f[j],color:O,identity:W,tooltipInfo:U,dataPoints:H,highlight:!1,index:I.length,labelFontSize:S+"px"})}return{dataGroups:I,categoryAxisName:c.source.displayName,categoryColumn:c,settings:n,maxXAxisHeight:C,labelFontSize:S,categoryLabelHeight:w,dotsTotalHeight:L,maxLabelWidth:V,maxCategoryWidth:A}},e.parseSettings=function(e){var t=T.parse(e,this.capabilities);return t.labels.labelPrecision=Math.min(Math.max(0,t.labels.labelPrecision),17),t.createOriginalSettings(),t},e.prototype.init=function(e){var t=e.element;this.behavior=new V,this.interactivityService=d(e.host),this.radius=w,this.strokeWidth=C,this.colors=e.style.colorPalette.dataColors,this.layout=new A(e.viewport,{top:5,bottom:15,right:0,left:0}),this.divContainer=d3.select(t.get(0)).append("div").classed(this.dotPlotSelectors.scrollableContainer.class,!0),this.svg=this.divContainer.append("svg").classed(this.dotPlotSelectors.svgPlotSelector.class,!0),this.clearCatcher=g(this.svg);var i=this.svg.append("g").classed(this.dotPlotSelectors.axisSelector.class,!0);this.dotPlot=this.svg.append("g").classed(this.dotPlotSelectors.plotSelector.class,!0),this.xAxisSelection=i.append("g").classed(this.dotPlotSelectors.xAxisSelector.class,!0)},e.prototype.update=function(t){if(t.dataViews&&t.dataViews[0]){this.layout.viewport=t.viewport;var a=e.converter(t.dataViews[0],this.layout.viewportIn.height,this.colors,this.radius);if(!a)return void this.clear();if(this.data=a,this.durationAnimations=i(this.animator,t.suppressAnimations),this.dataViewport={height:this.layout.viewportIn.height,width:Math.max(this.layout.viewportIn.width,this.data.dataGroups.length*(2*this.radius+2)+this.data.maxLabelWidth)},this.svg.style({height:o.toString(this.dataViewport.height),width:o.toString(this.dataViewport.width)}),this.divContainer.style({width:this.layout.viewport.width+"px",height:this.layout.viewport.height+"px"}),this.interactivityService&&this.interactivityService.applySelectionStateToData(this.data.dataGroups),this.calculateAxes(!1),this.renderAxis(this.durationAnimations),this.drawDotPlot(),this.settings.labels.show){var r=this.getDotPlotLabelsLayout(),s=u.drawDefaultLabelsForDataPointChart(this.data.dataGroups,this.svg,r,this.dataViewport,!t.suppressAnimations,this.durationAnimations);s&&s.attr("transform",function(t){var i=t.size;if(e.DefaultValues.labelOrientation===P.Vertical){var a=t.anchorPoint.x,r=t.anchorPoint.y,s=i.width/e.DataLabelXOffset+i.height*e.DataLabelXOffsetIndex,o=i.height+i.height/e.DataLabelYOffset;return m.translateAndRotate(s,-o,a,r,e.DataLabelAngle)}var s=i.width/e.DataLabelXOffset,o=i.height/e.DataLabelYOffset;return m.translate(s,o)})}else u.cleanDataLabels(this.svg)}},e.prototype.enumerateObjectInstances=function(t){if(!this.settings||!this.settings.originalSettings)return[];var i=T.enumerateObjectInstances(this.settings.originalSettings,t,e.capabilities);return i.complete()},e.prototype.drawDotPlot=function(){var e=this,t=this.dotPlot.selectAll(this.dotPlotSelectors.plotGroupSelector.selector).data(this.data.dataGroups),i=this.interactivityService&&this.interactivityService.hasSelection();t.enter().append("g").classed(this.dotPlotSelectors.plotGroupSelector.class,!0),t.attr({transform:function(t){return m.translate(e.getXDotPositionByIndex(t.index),e.layout.margin.top+e.data.labelFontSize)},stroke:"black","stroke-width":this.strokeWidth}).style("fill-opacity",function(e){return N.getFillOpacity(e.selected,e.highlight,i,!1)});var a=t.selectAll(this.dotPlotSelectors.circleSeletor.selector).data(function(e){return e.dataPoints});a.enter().append("circle").classed(this.dotPlotSelectors.circleSeletor.class,!0),a.attr({cy:function(e){return e.y},r:this.radius,fill:this.settings.dataPoint.fill}),this.renderTooltip(t),a.exit().remove(),t.exit().remove();var r=this.interactivityService;if(r){r.applySelectionStateToData(this.data.dataGroups);var s={columns:t,clearCatcher:this.clearCatcher,interactivityService:this.interactivityService};r.bind(this.data.dataGroups,this.behavior,s)}},e.prototype.getXDotPositionByIndex=function(e){var t=this.xAxisProperties.scale;return this.data.maxLabelWidth/2+t(e)},e.prototype.getDotPlotLabelsLayout=function(){var t=this;return{labelText:function(e){return u.getLabelFormattedText({label:e.label,fontSize:parseFloat(t.settings.labels.fontSize),maxWidth:t.dataViewport.width})},labelLayout:{x:function(i){var a=t.getXDotPositionByIndex(i.index),r=i.size.width/e.DataLabelXOffset;return a-r},y:function(e){var i=(_.isEmpty(e.dataPoints)?t.data.dotsTotalHeight+2*t.radius:_.last(e.dataPoints).y)+t.data.labelFontSize,a=e.size.height;return i-a}},filter:function(e){return!!(e&&e.dataPoints&&t.layout.viewportIn.height-t.data.maxXAxisHeight+2*t.radius>t.data.labelFontSize)},style:{fill:this.settings.labels.color,"font-size":this.data.labelFontSize+"px","font-family":S.fontFamily}}},e.prototype.clear=function(){this.dotPlot.selectAll("*").remove(),this.xAxisSelection.selectAll("*").remove(),u.cleanDataLabels(this.svg)},e.prototype.renderTooltip=function(e){v.addTooltip(e,function(e){return e.data.tooltipInfo})},e.prototype.calculateAxes=function(t){var i=this,a=this.dataViewport.width-this.data.maxLabelWidth,r=x.createAxis({pixelSpan:a,dataDomain:[0,this.data.dataGroups.length-1],metaDataColumn:null,formatString:null,outerPadding:0,isScalar:!0,isVertical:!1,forcedTickCount:Math.min(this.data.dataGroups.length,Math.floor((a+this.data.maxCategoryWidth)/Math.min(55,this.data.maxCategoryWidth))),useTickIntervalForDisplayUnits:!0,isCategoryAxis:!1,scaleType:this.scaleType,axisDisplayUnits:0}),s=r.axis.scale();s.domain([0,this.data.dataGroups.length-1]);var o=r.axis.tickValues().filter(function(e){return e<i.data.dataGroups.length});r.axis.tickValues(o);var n=(o.length>1?s(o[1])-s(o[0]):a)-3;r.axis.tickFormat(function(t){if(!i.settings.categoryAxis.show||!i.data.dataGroups[t])return"";var a=e.getCategoryTextProperties(i.data.dataGroups[t].category.value);return b.getTailoredTextOrDefault(a,n)}),this.settings.categoryAxis.show&&(r.axisLabel=this.data.categoryAxisName),this.xAxisProperties=r},e.prototype.renderAxis=function(t){var i=this,a=this.dataViewport.height-this.data.maxXAxisHeight;this.xAxisSelection.attr({transform:m.translate(this.data.maxLabelWidth/2,a)});var r=this.xAxisProperties.axis.orient("bottom");if(this.xAxisSelection.transition().duration(t).call(r).selectAll("g.tick text").style("fill",this.settings.categoryAxis.labelColor),this.xAxisSelection.selectAll(".tick text").append("title").text(function(e){return i.data.dataGroups[e]&&i.data.dataGroups[e].category.value}),this.xAxisSelection.selectAll("line").style("opacity",this.settings.categoryAxis.show?1:0),this.xAxisSelection.selectAll(".xAxisLabel").remove(),this.settings.categoryAxis.showAxisTitle){var s=b.measureSvgTextWidth(e.getCategoryTextProperties(this.data.categoryAxisName));this.xAxisSelection.append("text").text(this.data.categoryAxisName).style("text-anchor","middle").attr("class","xAxisLabel").style("fill",this.settings.categoryAxis.labelColor).attr("transform",m.translate(this.dataViewport.width/2-s/2,this.data.maxXAxisHeight-this.data.categoryLabelHeight+13))}},e.DataLabelXOffset=2,e.DataLabelYOffset=1.5,e.DataLabelAngle=-90,e.DataLabelXOffsetIndex=.3,e.capabilities={dataRoles:[{name:"Category",kind:c.Grouping,displayName:"Category"},{name:"Values",kind:c.Measure,displayName:"Values"}],dataViewMappings:[{conditions:[{Category:{max:1},Values:{max:1}}],categorical:{categories:{for:{in:"Category"},dataReductionAlgorithm:{top:{}}},values:{group:{by:"Series",select:[{for:{in:"Values"}}],dataReductionAlgorithm:{top:{}}}}}}],objects:{general:{displayName:"General",properties:{formatString:{type:{formatting:{formatString:!0}}}}},categoryAxis:{displayName:"X-Axis",properties:{show:{displayName:"Show",type:{bool:!0}},showAxisTitle:{displayName:"Title",description:"Title options",type:{bool:!0}},labelColor:{displayName:"Label color",type:{fill:{solid:{color:!0}}}}}},dataPoint:{displayName:"Data colors",properties:{fill:{displayName:"Fill",type:{fill:{solid:{color:!0}}}}}},labels:{displayName:"Data labels",description:"Display data label options",properties:{show:{displayName:"Show",type:{bool:!0}},color:{displayName:"Color",description:"Select color for data labels",type:{fill:{solid:{color:!0}}}},labelDisplayUnits:{displayName:"Display units",description:"Select the units (millions, billions, etc.)",type:{formatting:{labelDisplayUnits:!0}},suppressFormatPainterCopy:!0},labelPrecision:{displayName:"Decimal places",description:"Select the number of decimal places to display",placeHolderText:"Auto",type:{numeric:!0},suppressFormatPainterCopy:!0},fontSize:{displayName:"Text Size",type:{formatting:{fontSize:!0}}}}}}},e.DefaultValues={labelOrientation:P.Horizontal},e}();t.DotPlot=D;var V=function(){function e(){}return e.prototype.bindEvents=function(e,t){this.columns=e.columns,this.clearCatcher=e.clearCatcher,this.interactivityService=e.interactivityService,this.columns.on("click",function(e,i){t.handleSelection(e,d3.event.ctrlKey)}),e.clearCatcher.on("click",function(){t.handleClearSelection()})},e.prototype.renderSelection=function(e){var t=this.interactivityService.hasSelection();this.columns.style("fill-opacity",function(i){return N.getFillOpacity(i.selected,i.highlight,!i.highlight&&e,!i.selected&&t)})},e}();t.DotplotBehavior=V;var N;!function(e){function t(t,i,a,r){return r&&!i||a&&!t?e.DimmedOpacity:e.DefaultOpacity}e.DimmedOpacity=.4,e.DefaultOpacity=1,e.getFillOpacity=t}(N=t.dotPlotUtils||(t.dotPlotUtils={}))}(i=t.samples||(t.samples={}))}(t=e.visuals||(e.visuals={}))}(i||(i={}))},function(e,t){var i,a=window.jsCommon,i=window.powerbi;window.powerbitests,window.InJs,window.debug,window.jasmine,window.Microsoft;!function(e){var t;!function(t){var i;!function(t){var i=a.PixelConverter,r=e.createEnumType,s=e.DataViewObjects,o=e.visuals.ObjectEnumerationBuilder,n=e.visuals.dataLabelUtils,l=e.VisualDataRoleKind,c=e.visuals.valueFormatter,u=e.visuals.TooltipManager,h=e.data.DataRoleHelper.hasRole;!function(e){e[e.ByWeight="By Weight"]="ByWeight",e[e.ByLinkType="By Link Type"]="ByLinkType",e[e.Interactive="Interactive"]="Interactive"}(t.LinkColorType||(t.LinkColorType={}));var p=t.LinkColorType,d=function(){function e(){this.labels={show:!0,color:n.defaultLabelColor,fontSize:n.DefaultFontSizeInPt},this.links={showArrow:!1,showLabel:!1,colorLink:p.Interactive,thickenLink:!0,displayUnits:0,decimalPlaces:null},this.nodes={displayImage:!1,defaultImage:"Home",imageUrl:"",imageExt:".png",nameMaxLength:10,highlightReachableLinks:!1},this.size={charge:-15}}return Object.defineProperty(e,"Default",{get:function(){return new this},enumerable:!0,configurable:!0}),e.parse=function(e,t){var i=new this;if(!e||!e.metadata||!e.metadata.objects)return i;var a=this.getProperties(t);for(var r in t.objects)for(var s in t.objects[r].properties)if(i[r]&&_.has(i[r],s)){var o=t.objects[r].properties[s].type,n=this.getValueFnByType(o);i[r][s]=n(e.metadata.objects,a[r][s],i[r][s])}return i},e.getProperties=function(e){var t={};for(var i in e.objects){t[i]={};for(var a in e.objects[i].properties)t[i][a]={objectName:i,propertyName:a}}return t},e.createEnumTypeFromEnum=function(e){var t=!1;return r(Object.keys(e).filter(function(i,a){return!!(a%2)===t&&e[i]===i&&!void(t=!t)||!!(a%2)!==t}).map(function(e){return{value:e,displayName:e}}))},e.getValueFnByType=function(e){switch(_.keys(e)[0]){case"fill":return s.getFillColor;default:return s.getValue}},e.enumerateObjectInstances=function(e,t,i){var a=new o,r=e&&e[t.objectName];if(!r)return a.complete();var s={objectName:t.objectName,selector:null,properties:{}};for(var n in r)_.has(r,n)&&(s.properties[n]=r[n]);return a.pushInstance(s),a.complete()},e}();t.ForceGraphSettings=d;var g=function(){function e(){}return e.build=function(e,t,i){var a=[];if(!e)return a;for(var r in e){var s,o;s=m.getColumnByRoleName(t,r),s&&s.displayName&&(o=e[r],i&&!_.isNumber(o)&&(o=c.format(o,c.getFormatString(s,i))),a.push({displayName:s.displayName,value:o}))}return a},e}();t.ForceGraphTooltipsFactory=g;var m=function(){function e(){}return e.getColumnByRoleName=function(e,t){if(!_.isEmpty(e)&&t)for(var i=0,a=e.length;i<a;i++){var r=e[i];if(r&&h(r,t))return r}return null},e}();t.ForceGraphMetadataRoleHelper=m;var f=function(){function e(){this.Source=null,this.Target=null,this.Weight=null,this.LinkType=null,this.SourceType=null,this.TargetType=null}return e.getMetadataColumns=function(t){var i=t&&t.metadata&&t.metadata.columns;return i&&_.mapValues(new e,function(e,t){return i.filter(function(e){return e.roles&&e.roles[t]})[0]})},e.getTableValues=function(e){var t=e&&e.table,i=this.getMetadataColumns(e);return i&&t&&_.mapValues(i,function(e,i){return e&&t.rows.map(function(t){return t[e.index]})})},e.getTableRows=function(e){var t=e&&e.table,i=this.getMetadataColumns(e);return i&&t&&t.rows.map(function(e){return _.mapValues(i,function(t,i){return t&&e[t.index]})})},e.Roles=Object.freeze(_.mapValues(new e,function(e,t){return t})),e}();t.ForceGraphColumns=f;var y=function(){function e(){this.uniqieId="_"+e.Count++ +"_"}return Object.defineProperty(e,"Href",{get:function(){return window.location.href.replace(window.location.hash,"")},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"settings",{get:function(){return this.data&&this.data.settings},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"margin",{get:function(){return this.marginValue||{left:0,right:0,top:0,bottom:0}},set:function(t){this.marginValue=$.extend({},t),this.viewportInValue=e.substractMargin(this.viewport,this.margin)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"viewport",{get:function(){return this.viewportValue||{width:0,height:0}},set:function(t){this.viewportValue=$.extend({},t),this.viewportInValue=e.substractMargin(this.viewport,this.margin)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"viewportIn",{get:function(){return this.viewportInValue||this.viewport},enumerable:!0,configurable:!0}),e.substractMargin=function(e,t){return{width:Math.max(e.width-(t.left+t.right),0),height:Math.max(e.height-(t.top+t.bottom),0)}},e.prototype.scale1to10=function(e){var t=d3.scale.linear().domain([this.data.minFiles,this.data.maxFiles]).rangeRound([1,10]).clamp(!0);return t(e)},e.prototype.getLinkColor=function(t){switch(this.settings.links.colorLink){case p.ByWeight:return this.colors.getColorByIndex(this.scale1to10(t.weight)).value;case p.ByLinkType:return t.type&&this.data.linkTypes[t.type]?this.data.linkTypes[t.type].color:e.DefaultValues.defaultLinkColor}return e.DefaultValues.defaultLinkColor},e.prototype.enumerateObjectInstances=function(t){return d.enumerateObjectInstances(this.settings,t,e.capabilities)},e.converter=function(t,i){var a=e.parseSettings(t),r={},s=Number.MAX_VALUE,o=0,n={},l=[],u={},h=0,p=[],m=f.getMetadataColumns(t);if(!m||!m.Source||!m.Target)return null;var y=f.getTableRows(t),v=d.getProperties(e.capabilities).general.formatString,x=m.Weight&&c.create({format:c.getFormatString(m.Weight,v,!0),precision:a.links.decimalPlaces,value:a.links.displayUnits||_.max(y,function(e){return e.Weight}).Weight}),b=c.create({format:c.getFormatString(m.Source,v,!0)}),S=c.create({format:c.getFormatString(m.Target,v,!0)});return y.forEach(function(e){n[e.Source+","+e.Target]=1;var a=r[e.Source]||(r[e.Source]={name:b.format(e.Source),image:e.SourceType||"",adj:{}}),c=r[e.Target]||(r[e.Target]={name:S.format(e.Target),image:e.TargetType||"",adj:{}});a.adj[c.name]=1,c.adj[a.name]=1,p=g.build(e,t.metadata.columns,v);var d={source:a,target:c,weight:Math.max(m.Weight?e.Weight||0:1,0),formattedWeight:e.Weight&&x.format(e.Weight),type:e.LinkType||"",tooltipInfo:p};m.LinkType&&!u[e.LinkType]&&(u[e.LinkType]={label:e.LinkType,color:i.getColorByIndex(h++).value}),d.weight<s&&(s=d.weight),d.weight>o&&(o=d.weight),l.push(d)}),{nodes:r,links:l,minFiles:s,maxFiles:o,linkedByName:n,linkTypes:u,settings:a}},e.parseSettings=function(t){var i=d.parse(t,e.capabilities);return i.size.charge=Math.min(Math.max(i.size.charge,-100),-.1),i.links.decimalPlaces=i.links.decimalPlaces&&Math.min(Math.max(i.links.decimalPlaces,0),5),i},e.prototype.init=function(e){var t=this;this.root=d3.select(e.element.get(0)),this.forceLayout=d3.layout.force(),this.forceLayout.drag().on("dragstart",function(e){e.isDrag=!0,t.fadeNode(e)}).on("dragend",function(e){e.isDrag=!1,t.fadeNode(e)}).on("drag",function(e){return t.fadeNode(e)}),this.colors=e.style.colorPalette.dataColors},e.prototype.update=function(t){var a=this;if(t.dataViews&&!(t.dataViews.length<1)){if(this.data=e.converter(this.dataView=t.dataViews[0],this.colors),!this.data)return void this.removeElements();this.viewport=t.viewport;var r=Math.sqrt(Object.keys(this.data.nodes).length/(this.viewport.width*this.viewport.height));this.removeElements();var s=this.root.append("svg").attr("width",this.viewport.width).attr("height",this.viewport.height).classed(e.VisualClassName,!0);if(this.forceLayout.gravity(100*r).links(this.data.links).size([this.viewport.width,this.viewport.height]).linkDistance(100).charge(this.settings.size.charge/r).on("tick",this.tick()),this.updateNodes(),this.forceLayout.start(),this.paths=s.selectAll(".link").data(this.forceLayout.links()).enter().append("path").attr("class","link").attr("id",function(e,t){return"linkid_"+a.uniqieId+t}).attr("stroke-width",function(t){return a.settings.links.thickenLink?a.scale1to10(t.weight):e.DefaultValues.defaultLinkThickness}).style("stroke",function(e){return a.getLinkColor(e)}).style("fill",function(e){if(a.settings.links.showArrow)return a.getLinkColor(e)}).on("mouseover",this.fadePath(.3,e.DefaultValues.defaultLinkHighlightColor)).on("mouseout",this.fadePath(1,e.DefaultValues.defaultLinkColor)),u.addTooltip(this.paths,function(e){return e.data.tooltipInfo}),this.settings.links.showLabel){var o=s.selectAll(".linklabelholder").data(this.forceLayout.links());o.enter().append("g").attr("class","linklabelholder").append("text").attr("class","linklabel").attr("y","-12").attr("text-anchor","middle").style("fill","#000").append("textPath").attr("xlink:href",function(t,i){return e.Href+"#linkid_"+a.uniqieId+i}).attr("startOffset","25%").text(function(e){return a.settings.links.colorLink===p.ByLinkType?e.type:e.formattedWeight}),o.exit().remove()}this.nodes=s.selectAll(".node").data(this.forceLayout.nodes()).enter().append("g").attr("class","node").call(this.forceLayout.drag).on("mouseover",function(e){e.isOver=!0,a.fadeNode(e)}).on("mouseout",function(e){e.isOver=!1,a.fadeNode(e)}).on("mousedown",function(){return d3.event.stopPropagation()}).attr("drag-resize-disabled",!0),this.settings.nodes.displayImage?this.nodes.append("image").attr("xlink:href",function(e){return e.image&&""!==e.image?a.settings.nodes.imageUrl+e.image+a.settings.nodes.imageExt:a.settings.nodes.defaultImage&&""!==a.settings.nodes.defaultImage?a.settings.nodes.imageUrl+a.settings.nodes.defaultImage+a.settings.nodes.imageExt:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABsAAAAbCAMAAAHNDTTxAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAACuUExURQAAAMbGxvLy8sfHx/Hx8fLy8vHx8cnJycrKyvHx8fHx8cvLy/Ly8szMzM3NzfHx8dDQ0PHx8fLy8vHx8e/v79LS0tPT0/Ly8tTU1NXV1dbW1vHx8fHx8fDw8NjY2PT09PLy8vLy8vHx8fLy8vHx8fHx8enp6fDw8PLy8uPj4+Tk5OXl5fHx8b+/v/Pz8+bm5vHx8ejo6PLy8vHx8fLy8sTExPLy8vLy8sXFxfHx8YCtMbUAAAA6dFJOUwD/k/+b7/f///+r/////0z/w1RcEP//ZP///4fj/v8Yj3yXn/unDEhQ////YP9Y/8//aIMU/9+L/+fzC4s1AAAACXBIWXMAABcRAAAXEQHKJvM/AAABQElEQVQoU5WS61LCMBCFFymlwSPKVdACIgWkuNyL+P4v5ibZ0jKjP/xm0uw5ySa7mRItAhnMoIC5TwQZdCZiZjcoC8WU6EVsmZgzoqGdxafgvJAvjUXCb2M+0cXNsd/GDarZqSf7av3M2P1E3xhfLkPUvLD5joEYwVVJQXM6+9McWUwLf4nDTCQZAy96UoDjNI/jhl3xPLbQamu8xD7iaIsPKw7GJ7KZEnWLY3Gi8EFj5nqibXnwD5VEGjJXk5sbpLppfvvo1RazQVrhSopPK4TODrtnjS3dY4ic8KurruWQYF+UG60BacexTMyT2jlNg41dOmKvTpkUd/Jevy7ZxQ61ULRUpoododx8GeDPvIrktbFVdUsK6f8Na5VlVpjZJtowTXVy7kfXF5wCaV1tqXAFuIdWJu+JviaQzNzfQvQDGKRXXEmy83cAAAAASUVORK5CYII="}).attr("x","-12px").attr("y","-12px").attr("width","24px").attr("height","24px"):this.nodes.append("circle").attr("r",function(e){return e.weight<5?5:e.weight}),this.settings.labels.show&&this.nodes.append("text").attr({x:12,dy:".35em"}).style({fill:this.settings.labels.color,"font-size":i.fromPoint(this.settings.labels.fontSize)}).text(function(e){return e.name?e.name.length>a.settings.nodes.nameMaxLength?e.name.substr(0,a.settings.nodes.nameMaxLength):e.name:""})}},e.prototype.removeElements=function(){this.root&&this.root.selectAll("svg").remove()},e.prototype.updateNodes=function(){var e=this.forceLayout.nodes();this.forceLayout.nodes(d3.values(this.data.nodes)),this.forceLayout.nodes().forEach(function(t,i){e[i]&&(t.x=e[i].x,t.y=e[i].y,t.px=e[i].px,t.py=e[i].py,t.weight=e[i].weight)})},e.prototype.tick=function(){var e=this,t=this.viewportIn,i=20*t.width,a=20*t.height,r=function(e){return Math.max((t.width-i)/2,Math.min((t.width+i)/2,e))},s=function(e){return Math.max((t.height-a)/2,Math.min((t.height+a)/2,e))},o=this.settings.links.showArrow?function(e){e.source.x=r(e.source.x),e.source.y=s(e.source.y),e.target.x=r(e.target.x),e.target.y=s(e.target.y);var t=e.target.x-e.source.x,i=e.target.y-e.source.y,a=Math.sqrt(t*t+i*i),o=Math.atan2(i,t)+Math.PI/7.85,n=Math.PI/2,l=e.target.x-6*Math.cos(o),c=e.target.y-6*Math.sin(o);return"M"+e.source.x+","+e.source.y+"A"+a+","+a+" 0 0 1,"+e.target.x+","+e.target.y+"A"+a+","+a+" 0 0 0,"+e.source.x+","+e.source.y+"M"+l+","+c+"l"+(3.5*Math.cos(n-o)-10*Math.cos(o))+","+(-3.5*Math.sin(n-o)-10*Math.sin(o))+"L"+(l-3.5*Math.cos(n-o)-10*Math.cos(o))+","+(c+3.5*Math.sin(n-o)-10*Math.sin(o))+"z"}:function(e){e.source.x=r(e.source.x),e.source.y=s(e.source.y),e.target.x=r(e.target.x),e.target.y=s(e.target.y);var t=e.target.x-e.source.x,i=e.target.y-e.source.y,a=Math.sqrt(t*t+i*i);return"M"+e.source.x+","+e.source.y+"A"+a+","+a+" 0 0,1 "+e.target.x+","+e.target.y};return function(){e.paths.each(function(){this.parentNode.insertBefore(this,this)}),e.paths.attr("d",o),e.nodes.attr("transform",function(e){return"translate("+r(e.x)+","+s(e.y)+")"})}},e.prototype.fadePath=function(t,i){var a=this;if(this.settings.links.colorLink===p.Interactive)return function(r){a.paths.style("stroke-opacity",function(e){return e.source===r.source&&e.target===r.target?1:t}),a.paths.style("stroke",function(t){return t.source===r.source&&t.target===r.target?i:e.DefaultValues.defaultLinkColor})}},e.prototype.isReachable=function(e,t){if(e.name===t.name)return!0;if(this.data.linkedByName[e.name+","+t.name])return!0;var i={};for(var a in this.data.nodes)i[a]=!1;i[e.name]=!0;var r=[];for(r.push(e.name);r.length>0;){var s=r.pop(),o=this.data.nodes[s];for(var n in o.adj){if(n===t.name)return!0;i[n]||(i[n]=!0,r.push(n))}}return!1},e.prototype.fadeNode=function(t){var i=this;if(this.settings&&this.settings.links.colorLink===p.Interactive){var a=function(e,t){return i.data.linkedByName[e.name+","+t.name]||i.data.linkedByName[t.name+","+e.name]||e.name===t.name},r=t.isOver||t.isDrag,s=r?.3:1,o=r?e.DefaultValues.defaultLinkHighlightColor:e.DefaultValues.defaultLinkColor,n=this;this.nodes.style("stroke-opacity",function(e){var i=(n.settings.nodes.highlightReachableLinks?n.isReachable(t,e):a(t,e))?1:s;return this.setAttribute("fill-opacity",i),i}),this.paths.style("stroke-opacity",function(e){return(i.settings.nodes.highlightReachableLinks?i.isReachable(t,e.source):e.source===t||e.target===t)?1:s}),this.paths.style("stroke",function(a){return(i.settings.nodes.highlightReachableLinks?i.isReachable(t,a.source):a.source===t||a.target===t)?o:e.DefaultValues.defaultLinkColor})}},e.prototype.destroy=function(){this.root=null},e.VisualClassName="forceGraph",e.Count=0,e.DefaultValues={defaultLinkColor:"#bbb",defaultLinkHighlightColor:"#f00",defaultLinkThickness:"1.5px"},e.capabilities={dataRoles:[{name:f.Roles.Source,kind:l.Grouping,displayName:"Source"},{name:f.Roles.Target,kind:l.Grouping,displayName:"Target"},{name:f.Roles.Weight,kind:l.Measure,displayName:"Weight"},{name:f.Roles.LinkType,kind:l.Grouping,displayName:"Link Type",description:"Links can be colored by link types"},{name:f.Roles.SourceType,kind:l.Grouping,displayName:"Source Type",description:"Source type represents the image name for source entities"},{name:f.Roles.TargetType,kind:l.Grouping,displayName:"Target Type",description:"Target type represents the image name for target entities"}],objects:{general:{properties:{formatString:{type:{formatting:{formatString:!0}}}}},labels:{displayName:"Data labels",properties:{show:{displayName:"Show",type:{bool:!0}},color:{displayName:"Fill",type:{fill:{solid:{color:!0}}}},fontSize:{displayName:"Text Size",type:{formatting:{fontSize:!0}}}}},links:{displayName:"Links",properties:{showArrow:{type:{bool:!0},displayName:"Arrow"},showLabel:{type:{bool:!0},displayName:"Label",description:"Displays weight on links"},colorLink:{type:{enumeration:d.createEnumTypeFromEnum(p)},displayName:"Color"},thickenLink:{type:{bool:!0},displayName:"Thickness",description:"Thickenss of links represents weight"},displayUnits:{displayName:"Display Units",type:{formatting:{labelDisplayUnits:!0}}},decimalPlaces:{displayName:"Decimal Places",placeHolderText:"Auto",type:{numeric:!0}}}},nodes:{displayName:"Nodes",properties:{displayImage:{type:{bool:!0},displayName:"Image",description:"Images are loaded from image url + source or target type + image extension"},defaultImage:{type:{text:!0},displayName:"Default image"},imageUrl:{type:{text:!0},displayName:"Image url"},imageExt:{type:{text:!0},displayName:"Image extension"},nameMaxLength:{type:{numeric:!0},displayName:"Max name length",description:"Max length of the name of entities displayed"},highlightReachableLinks:{type:{bool:!0},displayName:"Highlight all reachable links",
description:"In interactive mode, whether a node's all reachable links will be highlighted"}}},size:{displayName:"Size",properties:{charge:{type:{numeric:!0},displayName:"Charge",description:"The larger the negative charge the more apart the entities, must be negative but greater than -100"}}}},dataViewMappings:[{conditions:[{Source:{max:1},Target:{max:1},Weight:{max:1},LinkType:{max:1},SourceType:{max:1},TargetType:{max:1}}],categorical:{categories:{for:{in:"Source"},dataReductionAlgorithm:{top:{count:1e4}}},values:{select:[{bind:{to:"Target"}},{bind:{to:"Weight"}},{bind:{to:"LinkType"}},{bind:{to:"SourceType"}},{bind:{to:"TargetType"}}]},rowCount:{preferred:{min:1}}}}],suppressDefaultTitle:!0},e}();t.ForceGraph=y}(i=t.samples||(t.samples={}))}(t=e.visuals||(e.visuals={}))}(i||(i={}))},function(e,t){var i,a=window.jsCommon,i=window.powerbi;window.powerbitests,window.InJs,window.debug,window.jasmine,window.Microsoft;!function(e){var t;!function(t){var i;!function(i){var r=a.PixelConverter,s=a.CssConstants.createClassAndSelector,o=e.visuals.utility.SelectionManager,n=e.createEnumType,l=e.visuals.LegendData,c=e.visuals.legendPosition,u=e.VisualDataRoleKind,h=e.visuals.createInteractivityService,p=e.visuals.appendClearCatcher,d=e.visuals.createLegend,g=e.visuals.LegendPosition,m=e.visuals.valueFormatter,f=e.visuals.ColorHelper,y=e.visuals.SelectionId,v=e.DataViewObjects,x=e.visuals.LegendIcon,b=e.visuals.Legend,S=e.ValueType,w=e.PrimitiveType,C=e.visuals.AxisHelper,P=e.TextMeasurementService,A=e.visuals.TooltipManager,T=e.visuals.SVGUtil,D=e.visuals.ObjectEnumerationBuilder,V=e.visuals.axisScale,N="0.00 %;-0.00 %;0.00 %",L=864e5,M=6048e5,k=2629746e3,I=31556952e3,O=40,F=5;!function(e){e[e.Day="Day"]="Day",e[e.Week="Week"]="Week",e[e.Month="Month"]="Month",e[e.Year="Year"]="Year"}(i.GanttDateType||(i.GanttDateType={}));var z,j=i.GanttDateType;!function(e){e.ClassName=s("gantt"),e.Chart=s("chart"),e.ChartLine=s("chart-line"),e.Body=s("gantt-body"),e.AxisGroup=s("axis"),e.Domain=s("domain"),e.AxisTick=s("tick"),e.Tasks=s("tasks"),e.TaskGroup=s("task-group"),e.SingleTask=s("task"),e.TaskRect=s("task-rect"),e.TaskProgress=s("task-progress"),e.TaskResource=s("task-resource"),e.SingleMilestone=s("milestone"),e.TaskLabels=s("task-labels"),e.TaskLines=s("task-lines"),e.SingleTaskLine=s("task-line"),e.Label=s("label"),e.LegendItems=s("legendItem"),e.LegendTitle=s("legendTitle")}(z||(z={}));var G=function(){function e(){this.general={groupTasks:!1},this.legend={show:!0,position:c.right,showTitle:!0,titleText:"",labelColor:"#000000",fontSize:8},this.taskLabels={show:!0,fill:"#000000",fontSize:9,width:110},this.taskCompletion={show:!0,fill:"#000000"},this.taskResource={show:!0,fill:"#000000",fontSize:9},this.dateType={type:j.Week}}return Object.defineProperty(e,"Default",{get:function(){return new this},enumerable:!0,configurable:!0}),e.parse=function(e,t){var i=new this;if(!e||!e.metadata||!e.metadata.objects)return i;var a=this.getProperties(t);for(var r in t.objects)for(var s in t.objects[r].properties)if(i[r]&&_.has(i[r],s)){var o=t.objects[r].properties[s].type,n=this.getValueFnByType(o);i[r][s]=n(e.metadata.objects,a[r][s],i[r][s])}return i},e.getProperties=function(e){var t=_.merge({general:{properties:{formatString:{}}}},e.objects),i={};for(var a in t){i[a]={};for(var r in t[a].properties)i[a][r]={objectName:a,propertyName:r}}return i},e.createEnumTypeFromEnum=function(e){var t=!1;return n(Object.keys(e).filter(function(i,a){return!!(a%2)===t&&e[i]===i&&!void(t=!t)||!!(a%2)!==t}).map(function(e){return{value:e,displayName:e}}))},e.getValueFnByType=function(e){switch(_.keys(e)[0]){case"fill":return v.getFillColor;default:return v.getValue}},e.enumerateObjectInstances=function(e,t,i){void 0===e&&(e=new this);var a=new D,r=e&&e[t.objectName];if(!r)return a;var s={objectName:t.objectName,selector:null,properties:{}};for(var o in r)_.has(r,o)&&(s.properties[o]=r[o]);return a.pushInstance(s),a},e.prototype.createOriginalSettings=function(){this.originalSettings=_.cloneDeep(this)},e}();i.GanttSettings=G;var R=function(){function e(){this.Legend=null,this.Task=null,this.StartDate=null,this.Duration=null,this.Completion=null,this.Resource=null}return e.getColumnSources=function(e){return this.getColumnSourcesT(e)},e.getTableValues=function(e){var t=e&&e.table,i=this.getColumnSourcesT(e);return i&&t&&_.mapValues(i,function(e,i){return e&&t.rows.map(function(t){return t[e.index]})})},e.getTableRows=function(e){var t=e&&e.table,i=this.getColumnSourcesT(e);return i&&t&&t.rows.map(function(e){return _.mapValues(i,function(t,i){return t&&e[t.index]})})},e.getCategoricalValues=function(e){var t=e&&e.categorical,i=t&&t.categories||[],a=t&&t.values||[],r=t&&a.source&&this.getSeriesValues(e);return t&&_.mapValues(new this,function(e,t){return _.toArray(i).concat(_.toArray(a)).filter(function(e){return e.source.roles&&e.source.roles[t]}).map(function(e){return e.values})[0]||a.source&&a.source.roles&&a.source.roles[t]&&r})},e.getSeriesValues=function(e){return e&&e.categorical&&e.categorical.values&&e.categorical.values.map(function(e){return t.converterHelper.getSeriesName(e.source)})},e.getCategoricalColumns=function(e){var t=e&&e.categorical,i=t&&t.categories||[],a=t&&t.values||[];return t&&_.mapValues(new this,function(e,t){return i.filter(function(e){return e.source.roles&&e.source.roles[t]})[0]||a.source&&a.source.roles&&a.source.roles[t]&&a||a.filter(function(e){return e.source.roles&&e.source.roles[t]})})},e.getColumnSourcesT=function(e){var t=e&&e.metadata&&e.metadata.columns;return t&&_.mapValues(new this,function(e,i){return t.filter(function(e){return e.roles&&e.roles[i]})[0]})},e.Roles=Object.freeze(_.mapValues(new e,function(e,t){return t})),e}();i.GanttColumns=R;var B=function(){function e(){this.textProperties={fontFamily:"wf_segoe-ui_normal",fontSize:r.toString(9)},this.margin=e.DefaultMargin}return Object.defineProperty(e,"DefaultMargin",{get:function(){return{top:50,right:40,bottom:40,left:10}},enumerable:!0,configurable:!0}),e.prototype.init=function(e){this.viewport=_.clone(e.viewport),this.style=e.style,this.body=d3.select(e.element.get(0)),this.hostServices=e.host,this.selectionManager=new o({hostServices:e.host}),this.isInteractiveChart=e.interactivity&&e.interactivity.isInteractiveLegend,this.interactivityService=h(this.hostServices),this.createViewport(e.element),this.updateChartSize(),this.behavior=new H,this.colors=e.style.colorPalette.dataColors},e.prototype.createViewport=function(e){this.ganttDiv=this.body.append("div").classed(z.Body.class,!0),this.ganttSvg=this.ganttDiv.append("svg").classed(z.ClassName.class,!0),this.clearCatcher=p(this.ganttSvg),this.axisGroup=this.ganttSvg.append("g").classed(z.AxisGroup.class,!0),this.lineGroup=this.ganttSvg.append("g").classed(z.TaskLines.class,!0),this.chartGroup=this.ganttSvg.append("g").classed(z.Chart.class,!0),this.taskGroup=this.chartGroup.append("g").classed(z.Tasks.class,!0),this.legend=d(e,this.isInteractiveChart,this.interactivityService,!0,g.Top)},e.prototype.clearViewport=function(){this.body.selectAll(z.LegendItems.selector).remove(),this.body.selectAll(z.LegendTitle.selector).remove(),this.axisGroup.selectAll(z.AxisTick.selector).remove(),this.axisGroup.selectAll(z.Domain.selector).remove(),this.lineGroup.selectAll("*").remove(),this.chartGroup.selectAll(z.ChartLine.selector).remove(),this.chartGroup.selectAll(z.TaskGroup.selector).remove(),this.chartGroup.selectAll(z.SingleTask.selector).remove()},e.prototype.updateChartSize=function(){this.ganttDiv.style({height:r.toString(this.viewport.height),width:r.toString(this.viewport.width)})},e.getTaskProperty=function(e,t,i){if(!(t&&e&&e.length>0&&e[0].roles))return null;var a=e.indexOf(e.filter(function(e){return e.roles[i]})[0]);return a!==-1?t[a]:null},e.hasRole=function(e,t){var i=e.roles;return i&&i[t]},e.getTooltipInfo=function(t,i,a){void 0===a&&(a="Days");var r=[];return t.taskType&&r.push({displayName:e.capabilities.dataRoles[0].name,value:t.taskType}),r.push({displayName:e.capabilities.dataRoles[1].name,value:t.name}),isNaN(t.start.getDate())||r.push({displayName:e.capabilities.dataRoles[2].name,value:i.startDateFormatter.format(t.start.toLocaleDateString())}),r.push({displayName:e.capabilities.dataRoles[3].name,value:i.durationFormatter.format(t.duration)+" "+a}),r.push({displayName:e.capabilities.dataRoles[4].name,value:i.completionFormatter.format(t.completion)}),t.resource&&r.push({displayName:e.capabilities.dataRoles[5].name,value:t.resource}),r},e.isChartHasTask=function(t){if(t.table&&t.table.columns)for(var i=0,a=t.table.columns;i<a.length;i++){var r=a[i];if(e.hasRole(r,"Task"))return!0}return!1},e.getFormatters=function(t){if(!t||!t.metadata||!t.metadata.columns)return null;for(var i="d",a="#",r=0,s=t.metadata.columns;r<s.length;r++){var o=s[r];if(t.categorical.categories)for(var n=0,l=t.categorical.categories;n<l.length;n++){var c=l[n];e.hasRole(c.source,"StartDate")&&(i=o.format)}}return{startDateFormatter:m.create({format:i}),durationFormatter:m.create({format:a}),completionFormatter:m.create({format:N,value:1,allowFormatBeautification:!0})}},e.createTasks=function(t,i,a){var r=R.getColumnSources(t),s=t.table.columns,o=new f(a,(void 0));return t.table.rows.map(function(a,n){var l=e.getTaskProperty(s,a,"StartDate");l=e.isValidDate(l)?l:new Date(Date.now());var c=e.getTaskProperty(s,a,"Duration"),u=e.getTaskProperty(s,a,"Completion"),h=e.convertToDecimal(u);h=h<=1?h:1;var p=e.getTaskProperty(s,a,"Legend"),d=o.getColorForMeasure(t.metadata.objects,p),g=y.createWithIdAndMeasureAndCategory(t.categorical.categories[0].identity[n],p,r.Task.queryName),m={id:n,name:e.getTaskProperty(s,a,"Task"),start:l?l:new Date(Date.now()),duration:c>0?c:1,end:null,completion:h>0?h:0,resource:e.getTaskProperty(s,a,"Resource"),taskType:p,color:d?d:e.DefaultValues.TaskColor,tooltipInfo:null,description:"",identity:g,selected:!1};return m.end=d3.time.day.offset(m.start,m.duration),m.tooltipInfo=e.getTooltipInfo(m,i),m})},e.createSeries=function(t,i,a,r){var s=new f(r,(void 0)),o=_.groupBy(i,function(e){return e.taskType}),n=e.getAllTasksTypes(a),l=_.map(n.types,function(e){return{tasks:o[e],fill:s.getColorForMeasure(t,e),name:e,identity:y.createWithMeasure(e),selected:!1}});return l},e.converter=function(t,i){if(!t||!t.categorical||!e.isChartHasTask(t)||0===t.table.rows.length)return null;var a=e.parseSettings(t,i),r=e.getAllTasksTypes(t),s={fontSize:a.legend.fontSize,dataPoints:[],title:r.typeName},o=new f(i,(void 0));s.dataPoints=_.map(r.types,function(e){return{label:e,color:o.getColorForMeasure(t.metadata.objects,e),icon:x.Circle,selected:!1,identity:y.createWithMeasure(e)}});var n=this.getFormatters(t),l=e.createTasks(t,n,i),c=e.createSeries(t.metadata.objects,l,t,i),u={dataView:t,settings:a,tasks:l,series:c,legendData:s,taskTypes:r};return u},e.parseSettings=function(t,i){var a=G.parse(t,e.capabilities);return delete a.taskCompletion.show,a.createOriginalSettings(),a},e.isValidDate=function(e){return"[object Date]"===Object.prototype.toString.call(e)&&!isNaN(e.getTime())},e.convertToDecimal=function(e){return e>=0&&e<=1?e:e/100},e.getAllTasksTypes=function(e){var t,i=[],a="",r=e.table.rows,s=_.findIndex(e.table.columns,function(e){return e.roles.hasOwnProperty("Legend")});return s!==-1&&(a=e.table.columns[s].displayName,i=_.unique(r,function(e){return e[s]}).map(function(e){return e[s]})),t={typeName:a,types:i}},e.prototype.renderLegend=function(){if(this.viewModel.legendData){l.update(this.viewModel.legendData,v.getObject(this.viewModel.dataView.metadata.objects,"legend",{}));var e=this.viewModel.settings.legend.show?g[this.viewModel.settings.legend.position]:g.None;switch(this.legend.changeOrientation(e),this.legend.drawLegend(this.viewModel.legendData,_.clone(this.viewport)),b.positionChartArea(this.ganttDiv,this.legend),this.legend.getOrientation()){case g.Left:case g.LeftCenter:case g.Right:case g.RightCenter:this.viewport.width-=this.legend.getMargins().width;break;case g.Top:case g.TopCenter:case g.Bottom:case g.BottomCenter:this.viewport.height-=this.legend.getMargins().height}}},e.prototype.update=function(t){if(t.dataViews&&t.dataViews[0]){if(this.viewModel=e.converter(t.dataViews[0],this.colors),!this.viewModel)return void this.clearViewport();this.viewport=_.clone(t.viewport),this.margin=e.DefaultMargin,this.renderLegend(),this.updateChartSize();var i=this.viewModel.tasks;if(this.interactivityService&&(this.interactivityService.applySelectionStateToData(i),this.interactivityService.applySelectionStateToData(this.viewModel.series)),i.length>0){var a=_.sortBy(i,function(e){return e.start}),s=_.sortBy(i,function(e){return e.end}),o=this.getDateType(),n=a[0].start,l=s[i.length-1].end,c=Math.ceil(Math.round(l.valueOf()-n.valueOf())/o),u=this.groupTasks(i);c=0===c||1===c?2:c;var h=50*c;this.ganttSvg.attr({height:r.toString(u.length*O+this.margin.top),width:r.toString(this.margin.left+this.viewModel.settings.taskLabels.width+h+e.DefaultValues.ResourceWidth)});var p={height:this.viewport.height,width:h},d=this.calculateAxes(p,this.textProperties,n,l,h,c,!1);if(this.timeScale=d.scale,this.renderAxis(d,200),this.renderTasks(u),this.createMilestoneLine(u),this.updateTaskLabels(u,this.viewModel.settings.taskLabels.width),this.updateElementsPositions(this.viewport,this.margin),this.interactivityService){var g={clearCatcher:this.clearCatcher,taskSelection:this.taskGroup.selectAll(z.SingleTask.selector),legendSelection:this.body.selectAll(z.LegendItems.selector),interactivityService:this.interactivityService};this.interactivityService.bind(i,this.behavior,g)}}}},e.prototype.getDateType=function(){var e=M;switch(this.viewModel.settings.dateType.type){case j.Day:e=L;break;case j.Week:e=M;break;case j.Month:e=k;break;case j.Year:e=I}return e},e.prototype.calculateAxes=function(e,t,i,a,r,s,o){var n=S.fromPrimitiveTypeAndCategory(w.Date),l={displayName:"StartDate",queryName:"StartDate",type:n,index:0},c={viewport:e,margin:this.margin,forcedXDomain:[i,a],forceMerge:!1,showCategoryAxisLabel:!1,showValueAxisLabel:!1,categoryAxisScaleType:V.linear,valueAxisScaleType:null,valueAxisDisplayUnits:0,categoryAxisDisplayUnits:0,trimOrdinalDataOnOverflow:!1,forcedTickCount:s},u=e.width,h=this.calculateAxesProperties(e,c,r,l);return h.willLabelsFit=C.LabelLayoutStrategy.willLabelsFit(h,u,P.measureSvgTextWidth,t),h.willLabelsWordBreak=!h.willLabelsFit&&!o&&C.LabelLayoutStrategy.willLabelsWordBreak(h,this.margin,u,P.measureSvgTextWidth,P.estimateSvgTextHeight,P.getTailoredTextOrDefault,t),h},e.prototype.calculateAxesProperties=function(t,i,a,r){var s=this,o=C.createAxis({pixelSpan:t.width,dataDomain:i.forcedXDomain,metaDataColumn:r,formatString:e.DefaultValues.DateFormatStrings[this.viewModel.settings.dateType.type],outerPadding:0,isScalar:!0,isVertical:!1,forcedTickCount:i.forcedTickCount,useTickIntervalForDisplayUnits:!0,isCategoryAxis:!0,getValueFn:function(t,i){return m.format(new Date(t),e.DefaultValues.DateFormatStrings[s.viewModel.settings.dateType.type])},scaleType:i.categoryAxisScaleType,axisDisplayUnits:i.categoryAxisDisplayUnits});return o.axisLabel=r.displayName,o},e.prototype.groupTasks=function(e){if(this.viewModel.settings.general.groupTasks){var t=_.groupBy(e,function(e){return e.name}),i=_.map(t,function(e,i){return{name:i,tasks:t[i]}});return i.forEach(function(e,t){e.tasks.forEach(function(e){return e.id=t}),e.id=t}),i}return e.map(function(e){return{name:e.name,id:e.id,tasks:[e]}})},e.prototype.renderAxis=function(e,t){var i=e.axis;i.orient("bottom"),this.axisGroup.transition().duration(t).call(i)},e.prototype.updateTaskLabels=function(e,t){var i,a=this,s=15,o=!this.viewModel||this.viewModel.settings.taskLabels.show,n=this.viewModel?this.viewModel.settings.taskLabels.fill:G.Default.taskLabels.fill,l=this.viewModel?this.viewModel.settings.taskLabels.fontSize:G.Default.taskLabels.fontSize;o?(i=this.lineGroup.selectAll(z.Label.selector).data(e),i.enter().append("text").classed(z.Label.class,!0),i.attr({x:s,y:function(e,t){return a.getTaskLabelCoordinateY(e.id)},fill:n,"stroke-width":1}).style("font-size",r.fromPoint(l)).text(function(e){return e.name}),i.call(C.LabelLayoutStrategy.clip,t-20,P.svgEllipsis),i.append("title").text(function(e){return e.name}),i.exit().remove()):this.lineGroup.selectAll(z.Label.selector).remove()},e.prototype.renderTasks=function(t){var i=this,a=this.taskGroup.selectAll(z.TaskGroup.selector).data(t),s=this.viewModel?this.viewModel.settings.taskCompletion.fill:G.Default.taskCompletion.fill,o=!this.viewModel||this.viewModel.settings.taskResource.show,n=4,l=this.viewModel?this.viewModel.settings.taskResource.fill:G.Default.taskResource.fill,c=this.viewModel?this.viewModel.settings.taskResource.fontSize:G.Default.taskResource.fontSize;a.enter().append("g").classed(z.TaskGroup.class,!0);var u=a.selectAll(z.SingleTask.selector).data(function(e){return e.tasks});u.enter().append("g").classed(z.SingleTask.class,!0);var h=u.selectAll(z.TaskRect.selector).data(function(e){return[e]});h.enter().append("rect").classed(z.TaskRect.class,!0),h.classed(z.TaskRect.class,!0).attr({x:function(e){return i.timeScale(e.start)},y:function(e){return i.getBarYCoordinate(e.id)},width:function(e){return i.taskDurationToWidth(e)},height:function(){return i.getBarHeight()}}).style("fill",function(e){return e.color}),h.exit().remove();var p=u.selectAll(z.TaskProgress.selector).data(function(e){return[e]});if(p.enter().append("rect").classed(z.TaskProgress.class,!0),p.attr({x:function(e){return i.timeScale(e.start)},y:function(t){return i.getBarYCoordinate(t.id)+i.getBarHeight()/2-e.DefaultValues.ProgressBarHeight/2},width:function(e){return i.setTaskProgress(e)},height:e.DefaultValues.ProgressBarHeight}).style("fill",s),p.exit().remove(),o){var d=u.selectAll(z.TaskResource.selector).data(function(e){return[e]});d.enter().append("text").classed(z.TaskResource.class,!0),d.attr({x:function(e){return i.timeScale(e.end)+n},y:function(e){return i.getBarYCoordinate(e.id)+i.getBarHeight()/2+n}}).text(function(e){return e.resource}).style({fill:l,"font-size":r.fromPoint(c)}).call(C.LabelLayoutStrategy.clip,e.DefaultValues.ResourceWidth-10,P.svgEllipsis),d.exit().remove()}else u.selectAll(z.TaskResource.selector).remove();A.addTooltip(u,function(e){return e.data.tooltipInfo}),u.exit().remove(),a.exit().remove()},e.prototype.onClearSelection=function(){this.selectionManager.clear()},e.prototype.getTaskLabelCoordinateY=function(e){var t=+this.viewModel.settings.taskLabels.fontSize;return O*e+(this.getBarHeight()+5-(40-t)/4)},e.prototype.setTaskProgress=function(e){var t=e.completion/1,i=this.timeScale,a=(i(e.end)-i(e.start))*t;return a},e.prototype.getBarYCoordinate=function(e){return O*e+F},e.prototype.getBarHeight=function(){return O/1.5},e.prototype.taskDurationToWidth=function(e){return this.timeScale(e.end)-this.timeScale(e.start)},e.prototype.getTooltipForMilstoneLine=function(e,t){var i=new Date(e).toDateString(),a=[{displayName:t,value:i}];return a},e.prototype.createMilestoneLine=function(e,t,i){void 0===t&&(t="Today"),void 0===i&&(i=Date.now());var a=[{x1:this.timeScale(i),y1:0,x2:this.timeScale(i),y2:this.getMilestoneLineLength(e.length),tooltipInfo:this.getTooltipForMilstoneLine(i,t)}],r=this.chartGroup.selectAll(z.ChartLine.selector).data(a);r.enter().append("line").classed(z.ChartLine.class,!0),r.attr({x1:function(e){return e.x1},y1:function(e){return e.y1},x2:function(e){return e.x2},y2:function(e){return e.y2},tooltipInfo:function(e){return e.tooltipInfo}}),A.addTooltip(r,function(e){return e.data.tooltipInfo}),r.exit().remove()},e.prototype.updateElementsPositions=function(e,t){this.axisGroup.attr("transform",T.translate(this.viewModel.settings.taskLabels.width+t.left,15)),this.chartGroup.attr("transform",T.translate(this.viewModel.settings.taskLabels.width+t.left,t.top)),this.lineGroup.attr("transform",T.translate(0,t.top))},e.prototype.getMilestoneLineLength=function(e){return e*O},e.prototype.enumerateObjectInstances=function(t){var i=this.viewModel&&this.viewModel.settings;if(_.isEmpty(i))return[];var a=G.enumerateObjectInstances(i.originalSettings,t,e.capabilities);switch(t.objectName){case"general":return[]}return a.complete()},e.DefaultValues={AxisTickSize:6,MaxTaskOpacity:1,MinTaskOpacity:.4,ProgressBarHeight:4,ResourceWidth:100,TaskColor:"#00B099",TaskLineWidth:15,DefaultDateType:j.Week,DateFormatStrings:{Day:"MMM dd",Week:"MMM dd",Month:"MMM yyyy",Year:"yyyy"}},e.capabilities={dataRoles:[{name:"Legend",kind:u.Grouping,displayName:"Legend"},{name:"Task",kind:u.Grouping,displayName:"Task"},{name:"StartDate",kind:u.Grouping,displayName:"Start Date"},{name:"Duration",kind:u.Measure,displayName:"Duration",requiredTypes:[{numeric:!0},{integer:!0}]},{name:"Completion",kind:u.Measure,displayName:"% Completion",requiredTypes:[{numeric:!0},{integer:!0}]},{name:"Resource",kind:u.Grouping,displayName:"Resource"}],dataViewMappings:[{conditions:[{Legend:{min:0,max:1},Task:{min:1,max:1},StartDate:{min:0,max:0},Duration:{min:0,max:0},Completion:{min:0,max:0},Resource:{min:0,max:0}},{Legend:{min:0,max:1},Task:{min:1,max:1},StartDate:{min:0,max:1},Duration:{min:0,max:0},Completion:{min:0,max:0},Resource:{min:0,max:0}},{Legend:{min:0,max:1},Task:{min:0,max:1},StartDate:{min:0,max:1},Duration:{min:0,max:1},Completion:{min:0,max:1},Resource:{min:0,max:1}}],table:{rows:{select:[{for:{in:"Legend"}},{for:{in:"Task"}},{for:{in:"StartDate"}},{for:{in:"Duration"}},{for:{in:"Completion"}},{for:{in:"Resource"}}]}}}],objects:{general:{displayName:"General",properties:{groupTasks:{displayName:"Group Tasks",type:{bool:!0}}}},legend:{displayName:"Legend",description:"Display legend options",properties:{show:{displayName:"Show",type:{bool:!0}},position:{displayName:"Position",description:"Select the location for the legend",type:{enumeration:c.type}},showTitle:{displayName:"Title",description:"Display a title for legend symbols",type:{bool:!0}},titleText:{displayName:"Legend Name",description:"Title text",type:{text:!0},suppressFormatPainterCopy:!0},labelColor:{displayName:"Color",type:{fill:{solid:{color:!0}}}},fontSize:{displayName:"Text Size",type:{formatting:{fontSize:!0}}}}},taskLabels:{displayName:"Category Labels",properties:{show:{displayName:"Show",type:{bool:!0}},fill:{displayName:"Fill",type:{fill:{solid:{color:!0}}}},fontSize:{displayName:"Font Size",type:{formatting:{fontSize:!0}}},width:{displayName:"Width",type:{numeric:!0}}}},taskCompletion:{displayName:"Task Completion",properties:{show:{type:{bool:!0}},fill:{displayName:"Completion Color",type:{fill:{solid:{color:!0}}}}}},taskResource:{displayName:"Data Labels",properties:{show:{displayName:"Show",type:{bool:!0}},fill:{displayName:"Color",type:{fill:{solid:{color:!0}}}},fontSize:{displayName:"Font Size",type:{formatting:{fontSize:!0}}}}},dateType:{displayName:"Gantt Date Type",properties:{type:{displayName:"Type",type:{enumeration:G.createEnumTypeFromEnum(j)}}}}},sorting:{default:{}}},e}();i.Gantt=B;var H=function(){function e(){}return e.prototype.bindEvents=function(e,t){this.options=e;var i=e.clearCatcher;e.taskSelection.on("click",function(e){t.handleSelection(e,d3.event.ctrlKey),d3.event.stopPropagation()}),i.on("click",function(){t.handleClearSelection()})},e.prototype.renderSelection=function(e){this.options.taskSelection.style("opacity",function(t){return e&&!t.selected?B.DefaultValues.MinTaskOpacity:B.DefaultValues.MaxTaskOpacity})},e}();i.GanttChartBehavior=H;var E=function(){function e(){}return Object.defineProperty(e.prototype,"code",{get:function(){return"GanttChartWarning"},enumerable:!0,configurable:!0}),e.prototype.getMessages=function(e){var t,i="This visual requires task value",a="",r="";return t={message:i,title:e.get(a),detail:e.get(r)}},e}();i.GanttChartWarning=E}(i=t.samples||(t.samples={}))}(t=e.visuals||(e.visuals={}))}(i||(i={}))},function(e,t){var i,a=window.jsCommon,i=window.powerbi,r=(window.powerbitests,window.InJs,window.debug,window.jasmine,window.Microsoft,this&&this.__extends||function(e,t){function i(){this.constructor=e}for(var a in t)t.hasOwnProperty(a)&&(e[a]=t[a]);e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)});!function(e){var t;!function(t){var i;!function(t){var i=a.CssConstants.createClassAndSelector,s=a.PixelConverter.toString,o=a.PixelConverter.fromPoint,n=a.PixelConverter.fromPointToPixel,l=e.createEnumType,c=e.DataViewObjects,u=e.TextMeasurementService,h=e.VisualDataRoleKind,p=e.data.SQExprBuilder,d=e.data.SemanticFilter,g=e.visuals.appendClearCatcher,m=e.visuals.SVGUtil,f=e.visuals.dataLabelUtils.getLabelFormattedText,y=e.visuals.ObjectEnumerationBuilder,v=e.visuals.utility.SelectionManager;t.Months=l([{value:1,displayName:"January"},{value:2,displayName:"February"},{value:3,displayName:"March"},{value:4,displayName:"April"},{value:5,displayName:"May"},{value:6,displayName:"June"},{value:7,displayName:"July"},{value:8,displayName:"August"},{value:9,displayName:"September"},{value:10,displayName:"October"},{value:11,displayName:"November"},{value:12,displayName:"December"}]),t.WeekDays=l([{value:0,displayName:"Sunday"},{value:1,displayName:"Monday"},{value:2,displayName:"Tuesday"},{value:3,displayName:"Wednesday"},{value:4,displayName:"Thursday"},{value:5,displayName:"Friday"},{value:6,displayName:"Saturday"}]),t.Granularities=l([{value:0,displayName:"Year"},{value:1,displayName:"Quarter"},{value:2,displayName:"Month"},{value:3,displayName:"Week"},{value:4,displayName:"Day"}]),function(e){e[e.year=0]="year",e[e.quarter=1]="quarter",e[e.month=2]="month",e[e.week=3]="week",e[e.day=4]="day"}(t.GranularityType||(t.GranularityType={}));var x=t.GranularityType,b={objectName:"cells",propertyName:"fillSelected"},S={objectName:"cells",propertyName:"fillUnselected"},w={objectName:"granularity",propertyName:"granularity"},C={objectName:"granularity",propertyName:"scaleColor"},P={objectName:"granularity",propertyName:"sliderColor"},A={objectName:"rangeHeader",propertyName:"fontColor"},T={objectName:"rangeHeader",propertyName:"textSize"},D={objectName:"rangeHeader",propertyName:"show"},V={objectName:"labels",propertyName:"fontColor"},N={objectName:"labels",propertyName:"textSize"},L={objectName:"labels",propertyName:"show"},M={objectName:"calendar",propertyName:"month"},k={objectName:"calendar",propertyName:"day"},I={objectName:"weekDay",propertyName:"day"},O=[{granularityType:x.year,name:"year"},{granularityType:x.quarter,name:"quarter"},{granularityType:x.month,name:"month"},{granularityType:x.week,name:"week"},{granularityType:x.day,name:"day"}],F=function(){function e(){this.datePeriods=[]}return e.prototype.shortMonthName=function(e){return e.toString().split(" ")[1]},e.prototype.resetDatePeriods=function(){this.datePeriods=[]},e.prototype.getDatePeriods=function(){return this.datePeriods},e.prototype.getExtendedLabel=function(){return this.extendedLabel},e.prototype.setExtendedLabel=function(e){this.extendedLabel=e},e.prototype.createLabels=function(e){var t,i=[];return this.datePeriods.forEach(function(a){!_.isEmpty(i)&&e.sameLabel(a,t)||(t=a,i.push(e.generateLabel(a)))}),i},e.prototype.addDate=function(e,t){var i=this.getDatePeriods(),a=i[i.length-1];0!==i.length&&_.isEqual(a.identifierArray,t)?a.endDate=e:(i.length>0&&(a.endDate=e),i.push({identifierArray:t,startDate:e,endDate:e,week:this.determineWeek(e),year:this.determineYear(e),fraction:1,index:i.length}))},e.prototype.setNewEndDate=function(e){_.last(this.datePeriods).endDate=e},e.prototype.splitPeriod=function(e,t,i){var a=this.datePeriods[e];a.fraction-=t;var r={identifierArray:a.identifierArray,startDate:i,endDate:a.endDate,week:this.determineWeek(i),year:this.determineYear(i),fraction:t,index:a.index+a.fraction};a.endDate=i,this.datePeriods.splice(e+1,0,r)},e.prototype.previousMonth=function(e){return e>0?e-1:11},e.prototype.nextMonth=function(e){return e<11?e+1:0},e.prototype.countWeeks=function(e,t){var i;if(t.getFullYear()===e.getFullYear()&&t.getMonth()===e.getMonth()&&t.getDate()>=e.getDate())i=t.getDate()-e.getDate();else{i=t.getDate()-1;for(var a=this.nextMonth(e.getMonth()),r=t.getMonth();r!==a;)i+=new Date(t.getFullYear(),r,0).getDate(),r=this.previousMonth(r);i+=new Date(t.getFullYear(),a,0).getDate()-e.getDate()}return 1+Math.floor(i/7)},e.prototype.determineWeek=function(e){var t=e.getFullYear();this.inPreviousYear(e)&&t--;var i=U.calendar.getDateOfFirstWeek(t),a=this.countWeeks(i,e);return[a,t]},e.prototype.inPreviousYear=function(e){var t=U.calendar.getDateOfFirstWeek(e.getFullYear());return e<t},e.prototype.determineYear=function(e){var t=new Date(e.getFullYear(),U.calendar.getFirstMonthOfYear(),U.calendar.getFirstDayOfYear());return e.getFullYear()-(t<=e?0:1)},e}();t.TimelineGranularity=F;var z=function(e){function t(){e.apply(this,arguments)}return r(t,e),t.prototype.getType=function(){return x.day},t.prototype.splitDate=function(e){return[this.shortMonthName(e),e.getDate(),e.getFullYear()]},t.prototype.sameLabel=function(e,t){return e.startDate.getTime()===t.startDate.getTime()},t.prototype.generateLabel=function(e){return{title:this.shortMonthName(e.startDate)+" "+e.startDate.getDate()+" - "+e.year,text:e.startDate.getDate().toString(),id:e.index}},t}(F);t.DayGranularity=z;var j=function(e){function t(){e.apply(this,arguments)}return r(t,e),t.prototype.getType=function(){return x.month},t.prototype.splitDate=function(e){return[this.shortMonthName(e),e.getFullYear()]},t.prototype.sameLabel=function(e,t){return this.shortMonthName(e.startDate)===this.shortMonthName(t.startDate)},t.prototype.generateLabel=function(e){var t=this.shortMonthName(e.startDate);return{title:t,text:t,id:e.index}},t}(F);t.MonthGranularity=j;var G=function(e){function t(){e.apply(this,arguments)}return r(t,e),t.prototype.getType=function(){return x.week},t.prototype.splitDate=function(e){return this.determineWeek(e)},t.prototype.sameLabel=function(e,t){return _.isEqual(e.week,t.week)},t.prototype.generateLabel=function(e){return{title:"Week "+e.week[0]+" - "+e.week[1],text:"W"+e.week[0],id:e.index}},t}(F);t.WeekGranularity=G;var R=function(e){function t(){e.apply(this,arguments)}return r(t,e),t.prototype.quarterText=function(e){for(var t=3,i=e.getFullYear();e<U.calendar.getQuarterStartDate(i,t);)t>0?t--:(t=3,i--);return t++,"Q"+t},t.prototype.getType=function(){return x.quarter},t.prototype.splitDate=function(e){return[this.quarterText(e),e.getFullYear()]},t.prototype.sameLabel=function(e,t){return this.quarterText(e.startDate)===this.quarterText(t.startDate)&&e.year===t.year},t.prototype.generateLabel=function(e){var t=this.quarterText(e.startDate);return{title:t+" "+e.year,text:t,id:e.index}},t}(F);t.QuarterGranularity=R;var B=function(e){function t(){e.apply(this,arguments)}return r(t,e),t.prototype.getType=function(){return x.year},t.prototype.splitDate=function(e){return[e.getFullYear()]},t.prototype.sameLabel=function(e,t){return e.year===t.year},t.prototype.generateLabel=function(e){return{title:"Year "+e.year,text:e.year.toString(),id:e.index}},t}(F);t.YearGranularity=B;var H=function(){function e(t,i){this.granularities=[],this.setDatesRange(t,i);var a=this.dates[this.dates.length-1];this.endingDate=e.nextDay(a)}return e.previousDay=function(e){var t=new Date(e.getTime());return t.setDate(t.getDate()-1),t},e.nextDay=function(e){var t=new Date(e.getTime());return t.setDate(t.getDate()+1),t},e.prototype.setDatesRange=function(t,i){var a=t;for(this.dates=[];a<=i;)this.dates.push(a),a=e.nextDay(a)},e.prototype.addGranularity=function(e){e.resetDatePeriods();for(var t=0,i=this.dates;t<i.length;t++){var a=i[t],r=e.splitDate(a);e.addDate(a,r)}e.setNewEndDate(this.endingDate),this.granularities.push(e)},e.prototype.getGranularity=function(e){return this.granularities[e]},e.prototype.createGranularities=function(){this.granularities=[],this.addGranularity(new B),this.addGranularity(new R),this.addGranularity(new j),this.addGranularity(new G),this.addGranularity(new z)},e.prototype.createLabels=function(){var e=this;this.granularities.forEach(function(t){
t.setExtendedLabel({dayLabels:t.getType()>=x.day?t.createLabels(e.granularities[x.day]):[],weekLabels:t.getType()>=x.week?t.createLabels(e.granularities[x.week]):[],monthLabels:t.getType()>=x.month?t.createLabels(e.granularities[x.month]):[],quarterLabels:t.getType()>=x.quarter?t.createLabels(e.granularities[x.quarter]):[],yearLabels:t.getType()>=x.year?t.createLabels(e.granularities[x.year]):[]})})},e}();t.TimelineGranularityData=H;var E=function(){function e(){}return e.isValueEmpty=function(e){return void 0===e||null===e||isNaN(e)},e.getStartSelectionDate=function(e){return e.currentGranularity.getDatePeriods()[e.selectionStartIndex].startDate},e.getEndSelectionDate=function(e){return e.currentGranularity.getDatePeriods()[e.selectionEndIndex].endDate},e.getEndSelectionPeriod=function(e){return e.currentGranularity.getDatePeriods()[e.selectionEndIndex]},e.getCellColor=function(t,i,a){var r=t.datePeriod.startDate>=e.getStartSelectionDate(i)&&t.datePeriod.endDate<=e.getEndSelectionDate(i);return r?a.colorInProperty:a.colorOutProperty||"transparent"},e.getGranularityType=function(e){var t=_.findIndex(O,function(t){return t.name===e});return O[t].granularityType},e.getGranularityName=function(e){var t=_.findIndex(O,function(t){return t.granularityType===e});return O[t].name},e.separateSelection=function(t,i,a){var r=t.currentGranularity.getDatePeriods(),s=_.findIndex(r,function(e){return i<e.endDate}),o=_.findIndex(r,function(e){return a<=e.endDate});t.selectionStartIndex=s,t.selectionEndIndex=o;var n=e.getDateRatio(r[s],i,!0),l=e.getDateRatio(r[o],a,!1);if(l>0&&t.currentGranularity.splitPeriod(o,l,a),n>0){var c=r[s].fraction-n;t.currentGranularity.splitPeriod(s,c,i),t.selectionStartIndex++,t.selectionEndIndex++}},e.getDateRatio=function(e,t,i){var a=i?t.getTime()-e.startDate.getTime():e.endDate.getTime()-t.getTime(),r=e.endDate.getTime()-e.startDate.getTime();return 0===r?0:a/r},e.timeRangeText=function(t){var i=t.currentGranularity.splitDate(e.getStartSelectionDate(t)),a=t.currentGranularity.splitDate(e.getEndSelectionPeriod(t).startDate);return i.join(" ")+" - "+a.join(" ")},e.dateRangeText=function(e){return e.startDate.toDateString()+" - "+H.previousDay(e.endDate).toDateString()},e.unseparateSelection=function(e){var t=_.findIndex(e,function(e){return e.fraction<1});return t>=0&&(e[t].endDate=e[t+1].endDate,e[t].fraction+=e[t+1].fraction,e.splice(t+1,1),!0)},e}();t.Utils=E;var W=function(){function e(e){var t=this;this.firstDayOfWeek=e.weekDayProperty,this.firstMonthOfYear=e.firstMonthProperty-1,this.firstDayOfYear=e.firstDayProperty,this.dateOfFirstWeek={},this.quarterFirstMonths=[0,3,6,9].map(function(e){return e+t.firstMonthOfYear})}return e.prototype.getFirstDayOfWeek=function(){return this.firstDayOfWeek},e.prototype.getFirstMonthOfYear=function(){return this.firstMonthOfYear},e.prototype.getFirstDayOfYear=function(){return this.firstDayOfYear},e.prototype.getQuarterStartDate=function(e,t){return new Date(e,this.quarterFirstMonths[t],this.firstDayOfYear)},e.prototype.isChanged=function(e){return this.firstMonthOfYear!==e.firstMonthProperty-1||this.firstDayOfYear!==e.firstDayProperty||this.firstDayOfWeek!==e.weekDayProperty},e.prototype.calculateDateOfFirstWeek=function(e){for(var t=new Date(e,this.firstMonthOfYear,this.firstDayOfYear);t.getDay()!==this.firstDayOfWeek;)t=H.nextDay(t);return t},e.prototype.getDateOfFirstWeek=function(e){return this.dateOfFirstWeek[e]||(this.dateOfFirstWeek[e]=this.calculateDateOfFirstWeek(e)),this.dateOfFirstWeek[e]},e}();t.Calendar=W;var U=function(){function e(){var e=this;this.datasetsChangedState=!1,this.granularitySelectors=["Y","Q","M","W","D"],this.requiresNoUpdate=!1,this.timelineMargins={LeftMargin:15,RightMargin:15,TopMargin:15,BottomMargin:10,CellWidth:40,CellHeight:25,StartXpoint:10,StartYpoint:20,ElementWidth:30,MinCellWidth:30,MaxCellHeight:60,PeriodSlicerRectWidth:15,PeriodSlicerRectHeight:23},this.defaultTimelineProperties={DefaultLabelsShow:!0,TimelineDefaultTextSize:9,TimelineDefaultCellColor:"#ADD8E6",TimelineDefaultCellColorOut:"",TimelineDefaultTimeRangeShow:!0,DefaultTimeRangeColor:"#777777",DefaultLabelColor:"#777777",DefaultScaleColor:"#000000",DefaultSliderColor:"#AAAAAA",DefaultGranularity:x.month,DefaultFirstMonth:1,DefaultFirstDay:1,DefaultFirstWeekDay:0},this.timelineSelectors={TimelineVisual:i("timeline"),SelectionRangeContainer:i("selectionRangeContainer"),textLabel:i("label"),LowerTextCell:i("lowerTextCell"),UpperTextCell:i("upperTextCell"),UpperTextArea:i("upperTextArea"),LowerTextArea:i("lowerTextArea"),RangeTextArea:i("rangeTextArea"),CellsArea:i("cellsArea"),CursorsArea:i("cursorsArea"),MainArea:i("mainArea"),SelectionCursor:i("selectionCursor"),Cell:i("cell"),CellRect:i("cellRect"),VertLine:i("timelineVertLine"),TimelineSlicer:i("timelineSlicer"),PeriodSlicerGranularities:i("periodSlicerGranularities"),PeriodSlicerSelection:i("periodSlicerSelection"),PeriodSlicerSelectionRect:i("periodSlicerSelectionRect"),PeriodSlicerRect:i("periodSlicerRect")},this.drag=d3.behavior.drag().origin(function(t){return t.x=t.selectionIndex*e.timelineProperties.cellWidth,t}).on("drag",function(t){e.dragged(t)}).on("dragend",function(){e.dragended()})}return e.getIndexByPosition=function(e,t,i){e=e||[];var a=e.length;if(!E.isValueEmpty(e[0])&&!E.isValueEmpty(e[1])&&i<=e[1]*t)return 0;if(!E.isValueEmpty(e[a-1])&&i>=e[a-1]*t)return a-1;for(var r=1;r<a;r++){var s=e[r]*t,o=e[r+1]*t;if(i>=s&&i<=o)return r}return 0},e.prototype.changeGranularity=function(e,t,i){E.unseparateSelection(this.timelineData.currentGranularity.getDatePeriods())&&E.unseparateSelection(this.timelineData.currentGranularity.getDatePeriods()),this.timelineData.currentGranularity=this.timelineGranularityData.getGranularity(e),E.separateSelection(this.timelineData,t,i)},e.prototype.init=function(e){var t=e.element;this.hostServices=e.host,this.initialized=!1,this.selectionManager=new v({hostServices:e.host}),this.timelineProperties={element:t,textYPosition:50,cellsYPosition:3*this.timelineMargins.TopMargin+65,topMargin:this.timelineMargins.TopMargin,bottomMargin:this.timelineMargins.BottomMargin,leftMargin:this.timelineMargins.LeftMargin,startXpoint:this.timelineMargins.StartXpoint,startYpoint:this.timelineMargins.StartYpoint,cellWidth:this.timelineMargins.CellWidth,cellHeight:this.timelineMargins.CellHeight,elementWidth:this.timelineMargins.ElementWidth,rightMargin:this.timelineMargins.RightMargin},this.body=d3.select(t.get(0)),this.timelineDiv=this.body.append("div"),this.svg=this.timelineDiv.append("svg").attr("width",s(e.viewport.width)).classed(this.timelineSelectors.TimelineVisual.class,!0),this.addWrappElements()},e.prototype.addWrappElements=function(){this.clearCatcher=g(this.svg),this.clearCatcher.data([this]).on("click",function(e){return e.clear()}).on("touchstart",function(e){return e.clear()}),this.rangeText=this.svg.append("g").classed(this.timelineSelectors.RangeTextArea.class,!0).append("text"),this.mainGroupElement=this.svg.append("g").classed(this.timelineSelectors.MainArea.class,!0),this.yearLabelsElement=this.mainGroupElement.append("g"),this.quarterLabelsElement=this.mainGroupElement.append("g"),this.monthLabelsElement=this.mainGroupElement.append("g"),this.weekLabelsElement=this.mainGroupElement.append("g"),this.dayLabelsElement=this.mainGroupElement.append("g"),this.cellsElement=this.mainGroupElement.append("g").classed(this.timelineSelectors.CellsArea.class,!0),this.cursorGroupElement=this.svg.append("g").classed(this.timelineSelectors.CursorsArea.class,!0)},e.prototype.clear=function(){this.initialized&&(this.selectionManager.clear(),this.timelineData&&(this.timelineData.selectionStartIndex=0,this.timelineData.selectionEndIndex=this.timelineData.currentGranularity.getDatePeriods().length-1,_.any(this.timelineData.timelineDatapoints,function(e){return e.index%1!==0})?this.selectPeriod(this.timelineData.currentGranularity.getType()):(e.updateCursors(this.timelineData,this.timelineProperties.cellWidth),this.fillCells(this.timelineFormat.cellFormat),this.renderCursors(this.timelineData,this.timelineFormat,this.timelineProperties.cellHeight,this.timelineProperties.cellsYPosition),this.renderTimeRangeText(this.timelineData,this.timelineFormat.rangeTextFormat),this.fillColorGranularity(this.timelineFormat.granularityFormat)),this.setSelection(this.timelineData)))},e.prototype.drawGranular=function(e,t){var i=this,a=e.startXpoint,r=e.startYpoint,o=e.elementWidth,n=this.granularitySelectors;this.selectorContainer=this.svg.append("g").classed(this.timelineSelectors.TimelineSlicer.class,!0);var l=d3.behavior.drag().on("drag",function(){i.selectPeriod(i.getGranularityIndexByPosition(d3.event.x))});this.selectorContainer.call(l),this.horizLine=this.selectorContainer.append("rect"),this.horizLine.attr({x:s(a),y:s(r+2),height:s(1),width:s((n.length-1)*o)}),this.vertLine=this.selectorContainer.selectAll("vertLines").data(n).enter().append("rect"),this.vertLine.classed(this.timelineSelectors.VertLine.class,!0).attr({x:function(e,t){return s(a+t*o)},y:s(r),width:s(2),height:s(3)});var c=this.selectorContainer.selectAll(this.timelineSelectors.PeriodSlicerGranularities.selector).data(n).enter().append("text").classed(this.timelineSelectors.PeriodSlicerGranularities.class,!0);this.textLabels=c.text(function(e){return e}).attr({x:function(e,t){return s(a-3+t*o)},y:s(r-3),dx:"0.5em"}),this.selectedText=this.selectorContainer.append("text").classed(this.timelineSelectors.PeriodSlicerSelection.class,!0),this.selectedText.text(E.getGranularityName(t)).attr({x:s(a+2*o),y:s(r+17)});var u=this.selectorContainer.selectAll(this.timelineSelectors.PeriodSlicerSelectionRect.selector).data(n).enter().append("rect").classed(this.timelineSelectors.PeriodSlicerSelectionRect.class,!0),h=function(e,t){i.selectPeriod(t)};u.attr({x:function(e,t){return s(a-o/2+t*o)},y:s(3),width:s(o),height:s(23)}).on("mousedown",h).on("touchstart",h),this.periodSlicerRect=this.selectorContainer.append("rect").classed(this.timelineSelectors.PeriodSlicerRect.class,!0).attr({y:s(e.startYpoint-16),rx:s(4),width:s(15),height:s(23)}),this.setPeriodSlicerRectPosition(t)},e.prototype.getGranularityIndexByPosition=function(t){var i=this.granularitySelectors.map(function(e,t){return t});return e.getIndexByPosition(i,this.timelineProperties.elementWidth,t)},e.prototype.setPeriodSlicerRectPosition=function(e){return this.periodSlicerRect.datum()!==e&&(this.periodSlicerRect.data([e]),this.periodSlicerRect.transition().attr({x:s(this.timelineProperties.startXpoint-6+e*this.timelineProperties.elementWidth)}),this.selectedText.text(E.getGranularityName(e)),!0)},e.prototype.fillColorGranularity=function(e){this.periodSlicerRect.style("stroke",e.sliderColorProperty),this.selectedText.attr("fill",e.scaleColorProperty),this.textLabels.attr("fill",e.scaleColorProperty),this.vertLine.attr("fill",e.scaleColorProperty),this.horizLine.attr("fill",e.scaleColorProperty)},e.prototype.redrawPeriod=function(e){if(this.setPeriodSlicerRectPosition(e)){var t=E.getStartSelectionDate(this.timelineData),i=E.getEndSelectionDate(this.timelineData);this.changeGranularity(e,t,i)}},e.setMeasures=function(e,t,i,a,r,s){r.cellsYPosition=r.textYPosition;var o=n(e.sizeProperty);e.showProperty&&(r.cellsYPosition+=1.5*o*(t+1));var l=Math.max(0,a.height-s.TopMargin),c=a.width-s.RightMargin-s.MinCellWidth*i,u=Math.max(s.MinCellWidth,Math.min(s.MaxCellHeight,c,l-r.cellsYPosition-20)),h=Math.max(s.MinCellWidth,(a.width-u-s.RightMargin)/i);r.cellHeight=u,r.cellWidth=h},e.prototype.visualChangeOnly=function(e){if(e&&e.dataViews&&e.dataViews[0]&&e.dataViews[0].metadata&&this.options&&this.options.dataViews&&this.options.dataViews[0]&&this.options.dataViews[0].metadata){var t=e.dataViews[0].metadata.objects,i=this.options.dataViews[0].metadata.objects,a=["rangeHeader","cells","labels","granularity"],r=!a.every(function(e){return _.isEqual(t?t[e]:void 0,i?i[e]:void 0)});return e.suppressAnimations||r}return!1},e.prototype.datasetsChanged=function(e){if(e&&e.dataViews&&e.dataViews[0]&&e.dataViews[0].categorical&&e.dataViews[0].categorical.categories&&e.dataViews[0].categorical.categories[0]&&e.dataViews[0].categorical.categories[0].source&&this.options&&this.options.dataViews&&this.options.dataViews[0]&&this.options.dataViews[0].categorical&&this.options.dataViews[0].categorical.categories&&this.options.dataViews[0].categorical.categories[0]&&this.options.dataViews[0].categorical.categories[0].source){var t=e.dataViews[0].categorical.categories[0].source.displayName,i=this.options.dataViews[0].categorical.categories[0].source.displayName;if(!_.isEqual(t,i))return!0}return!1},e.prototype.unavailableType=function(e){return!(e.categories&&1===e.categories.length&&e.categories[0].values&&0!==e.categories[0].values.length&&e.categories[0].source&&e.categories[0].source.type)},e.prototype.createTimelineOptions=function(e){if(this.dataView=e,!e.categorical||!e.metadata||this.unavailableType(e.categorical))return!1;var t=e.categorical.categories[0].source.expr;return this.valueType=t?t.level:null,!(!e.categorical.categories[0].source.type.dateTime&&(!e.categorical.categories[0].source.type.numeric||"Year"!==this.valueType&&"Date"!==this.valueType))&&(this.values=this.prepareDates(this.dataView.categorical.categories[0].values,this.valueType),!0)},e.prototype.prepareDates=function(e,t){var i=[];return e.forEach(function(e){if(e){var a=typeof e;if("string"===a||"number"===a){var r=void 0;r="Year"===t?new Date(e,0):new Date(e),r&&"Invalid Date"!==r.toString()&&i.push(r)}else _.isDate(e)&&i.push(e)}}),i},e.prototype.createTimelineData=function(t){var i,a;if(i=_.min(this.values),a=_.max(this.values),this.timelineFormat=e.fillTimelineFormat(this.options.dataViews[0].metadata.objects,this.defaultTimelineProperties),this.initialized||(this.drawGranular(this.timelineProperties,this.newGranularity),this.fillColorGranularity(this.timelineFormat.granularityFormat)),this.initialized){var r=H.nextDay(a),s=this.timelineGranularityData.getGranularity(x.day).getDatePeriods(),o=s[0].startDate,n=s[s.length-1].endDate,l=i.getTime()>=o.getTime()&&r.getTime()<=n.getTime();l?this.changeGranularity(this.newGranularity,i,r):(r<n&&(a=s[s.length-1].startDate),i>o&&(i=o),this.initialized=!1)}this.initialized||(this.timelineGranularityData=new H(i,a),this.timelineData={elementsCount:0,timelineDatapoints:[],cursorDataPoints:new Array})},e.prototype.update=function(t){var i=this.visualChangeOnly(t);if(this.datasetsChangedState=this.datasetsChanged(t),this.requiresNoUpdate=this.requiresNoUpdate&&!this.datasetsChangedState&&!i,this.requiresNoUpdate)return void(this.requiresNoUpdate=!1);if(this.options=t,t.dataViews&&t.dataViews[0]){var a=this.createTimelineOptions(t.dataViews[0]);if(!a)return void this.clearData();this.newGranularity=c.getValue(t.dataViews[0].metadata.objects,w,this.defaultTimelineProperties.DefaultGranularity),i||this.createTimelineData(t.dataViews[0]),this.initialized&&this.redrawPeriod(this.newGranularity),this.timelineFormat=e.converter(this.timelineData,this.timelineProperties,this.defaultTimelineProperties,this.timelineGranularityData,t.dataViews[0],this.initialized,this.newGranularity,t.viewport,this.timelineMargins),this.render(this.timelineData,this.timelineFormat,this.timelineProperties,t),this.initialized=!0}},e.prototype.selectPeriod=function(t){this.timelineData.currentGranularity.getType()!==t&&this.hostServices.persistProperties({merge:[{objectName:"granularity",selector:null,properties:{granularity:t}}]}),this.redrawPeriod(t),this.timelineFormat=e.converter(this.timelineData,this.timelineProperties,this.defaultTimelineProperties,this.timelineGranularityData,this.options.dataViews[0],this.initialized,this.timelineData.currentGranularity.getType(),this.options.viewport,this.timelineMargins),this.render(this.timelineData,this.timelineFormat,this.timelineProperties,this.options)},e.isDataNotMatch=function(e){return e.categorical.categories.length<=0||void 0===e.categorical.categories[0]||void 0===e.categorical.categories[0].identityFields||e.categorical.categories[0].identityFields.length<=0},e.converter=function(t,i,a,r,s,o,n,l,c){var u=e.fillTimelineFormat(s.metadata.objects,a);if(o||(t.cursorDataPoints.push({x:0,selectionIndex:0,cursorIndex:0}),t.cursorDataPoints.push({x:0,selectionIndex:0,cursorIndex:1})),o&&!e.calendar.isChanged(u.calendarFormat)||(e.calendar=new W(u.calendarFormat),r.createGranularities(),r.createLabels(),t.currentGranularity=r.getGranularity(n),t.selectionStartIndex=0,t.selectionEndIndex=t.currentGranularity.getDatePeriods().length-1),t.categorySourceName=s.categorical.categories[0].source.displayName,t.columnIdentity=s.categorical.categories[0].identityFields[0],s.categorical.categories[0].source.type.numeric&&(t.columnIdentity.ref="Date"),!this.isDataNotMatch(s)){var h=t.currentGranularity.getDatePeriods();t.elementsCount=h.length,t.timelineDatapoints=[];for(var p=0,d=h;p<d.length;p++){var g=d[p],m={index:g.index,datePeriod:g};t.timelineDatapoints.push(m)}var f=t.currentGranularity.getDatePeriods().filter(function(e){return e.index%1===0}).length;return e.setMeasures(u.labelFormat,t.currentGranularity.getType(),f,l,i,c),e.updateCursors(t,i.cellWidth),u}},e.prototype.render=function(t,i,a,r){var o=this.timelineData.timelineDatapoints.filter(function(e){return e.index%1===0}).length;this.svgWidth=1+this.timelineProperties.cellHeight+a.cellWidth*o,this.renderTimeRangeText(t,i.rangeTextFormat),this.fillColorGranularity(this.timelineFormat.granularityFormat),this.timelineDiv.attr({height:s(r.viewport.height),width:s(r.viewport.width),"drag-resize-disabled":!0}).style({"overflow-x":"auto","overflow-y":"auto"}),this.svg.attr({height:s(Math.max(e.MinSizeOfViewport,r.viewport.height-this.timelineMargins.TopMargin)),width:s(Math.max(e.MinSizeOfViewport,this.svgWidth))});var n=m.translate(a.leftMargin,a.topMargin),l=m.translate(a.cellHeight/2,a.topMargin);this.mainGroupElement.attr("transform",l),this.selectorContainer.attr("transform",n),this.cursorGroupElement.attr("transform",l);var c=this.timelineData.currentGranularity.getExtendedLabel(),u=this.timelineData.currentGranularity.getType(),h=0,p=1.5;this.renderLabels(c.yearLabels,this.yearLabelsElement,h,0===u),h+=p,this.renderLabels(c.quarterLabels,this.quarterLabelsElement,h,1===u),h+=p,this.renderLabels(c.monthLabels,this.monthLabelsElement,h,2===u),h+=p,this.renderLabels(c.weekLabels,this.weekLabelsElement,h,3===u),h+=p,this.renderLabels(c.dayLabels,this.dayLabelsElement,h,4===u),this.renderCells(t,i,a,r.suppressAnimations),this.renderCursors(t,i,a.cellHeight,a.cellsYPosition)},e.prototype.renderLabels=function(e,t,i,a){var r=this,s=t.selectAll(this.timelineSelectors.textLabel.selector);if(!this.timelineFormat.labelFormat.showProperty)return void s.remove();var l=s.data(e);l.enter().append("text").classed(this.timelineSelectors.textLabel.class,!0),l.text(function(t,i){if(!a&&0===i&&e.length>1){var s=o(r.timelineFormat.labelFormat.sizeProperty),n={text:e[0].text,fontFamily:"arial",fontSize:s},l=u.measureSvgTextWidth(n)/2;n={text:e[1].text,fontFamily:"arial",fontSize:s};var c=u.measureSvgTextWidth(n)/2,h=r.timelineProperties.cellWidth*(e[1].id-e[0].id);if(h<l+c)return""}var p={label:t.text,maxWidth:r.timelineProperties.cellWidth*(a?.9:3),fontSize:r.timelineFormat.labelFormat.sizeProperty};return f(p)}).style("font-size",o(this.timelineFormat.labelFormat.sizeProperty)).attr({x:function(e){return(e.id+.5)*r.timelineProperties.cellWidth},y:this.timelineProperties.textYPosition+(1+i)*n(this.timelineFormat.labelFormat.sizeProperty),fill:this.timelineFormat.labelFormat.colorProperty}).append("title").text(function(e){return e.title}),l.exit().remove()},e.prototype.clearData=function(){this.initialized=!1,this.mainGroupElement.selectAll(this.timelineSelectors.CellRect.selector).remove(),this.mainGroupElement.selectAll(this.timelineSelectors.textLabel.selector).remove(),this.rangeText.text(""),this.cursorGroupElement.selectAll(this.timelineSelectors.SelectionCursor.selector).remove(),this.svg.attr("width",0).selectAll(this.timelineSelectors.TimelineSlicer.selector).remove(),this.mainGroupElement.selectAll(this.timelineSelectors.textLabel.selector).remove()},e.updateCursors=function(e,t){var i=e.timelineDatapoints[e.selectionStartIndex].datePeriod,a=e.timelineDatapoints[e.selectionEndIndex].datePeriod;e.cursorDataPoints[0].selectionIndex=i.index,e.cursorDataPoints[1].selectionIndex=a.index+a.fraction},e.fillTimelineFormat=function(e,t){var i={rangeTextFormat:{showProperty:c.getValue(e,D,t.TimelineDefaultTimeRangeShow),colorProperty:c.getFillColor(e,A,t.DefaultTimeRangeColor),sizeProperty:c.getValue(e,T,t.TimelineDefaultTextSize)},cellFormat:{colorInProperty:c.getFillColor(e,b,t.TimelineDefaultCellColor),colorOutProperty:c.getFillColor(e,S,t.TimelineDefaultCellColorOut)},granularityFormat:{scaleColorProperty:c.getFillColor(e,C,t.DefaultScaleColor),sliderColorProperty:c.getFillColor(e,P,t.DefaultSliderColor)},labelFormat:{showProperty:c.getValue(e,L,t.DefaultLabelsShow),colorProperty:c.getFillColor(e,V,t.DefaultLabelColor),sizeProperty:c.getValue(e,N,t.TimelineDefaultTextSize)},calendarFormat:{firstMonthProperty:c.getValue(e,M,1),firstDayProperty:Math.max(1,Math.min(31,c.getValue(e,k,t.DefaultFirstDay))),weekDayProperty:Math.max(0,Math.min(6,c.getValue(e,I,t.DefaultFirstWeekDay)))}};return i},e.prototype.fillCells=function(e){var t=this,i=this.timelineData.timelineDatapoints,a=this.mainGroupElement.selectAll(this.timelineSelectors.CellRect.selector).data(i);a.attr("fill",function(i){return E.getCellColor(i,t.timelineData,e)})},e.prototype.renderCells=function(e,t,i,a){var r=this,o=e.timelineDatapoints,n=0,l=this.cellsElement.selectAll(this.timelineSelectors.CellRect.selector).data(o);l.enter().append("rect").classed(this.timelineSelectors.CellRect.class,!0),l.attr({height:s(i.cellHeight),width:function(e){return s(e.datePeriod.fraction*i.cellWidth)},x:function(e){var t=n;return n+=e.datePeriod.fraction*i.cellWidth,s(t)},y:s(i.cellsYPosition),id:function(e){return e.index}});var c=function(a,s){d3.event.preventDefault();var o=r.timelineData.cursorDataPoints,n=d3.event;n.altKey||n.shiftKey?r.timelineData.selectionEndIndex<s?(o[1].selectionIndex=a.datePeriod.index+a.datePeriod.fraction,e.selectionEndIndex=s):(o[0].selectionIndex=a.datePeriod.index,e.selectionStartIndex=s):(e.selectionStartIndex=s,e.selectionEndIndex=s,o[0].selectionIndex=a.datePeriod.index,o[1].selectionIndex=a.datePeriod.index+a.datePeriod.fraction),r.fillCells(t.cellFormat),r.renderCursors(e,t,i.cellHeight,i.cellsYPosition),r.renderTimeRangeText(e,t.rangeTextFormat),r.fillColorGranularity(r.timelineFormat.granularityFormat),r.setSelection(e)};l.on("click",c).on("touchstart",c),this.fillCells(t.cellFormat),l.exit().remove()},e.prototype.dragged=function(e){var t=1,i=d3.select(this.timelineSelectors.TimelineVisual.selector);if(i){var a=i.style("transform");if(void 0!==a&&"none"!==a){var r=a.split("(")[1];t=Number(r.split(", ")[0])}}var s=this.findCursorOverElement(d3.event.x);if(s){var o=s.datapoint,n=s.index;0===e.cursorIndex&&n<=this.timelineData.selectionEndIndex&&(this.timelineData.selectionStartIndex=n,this.timelineData.cursorDataPoints[0].selectionIndex=o.datePeriod.index),1===e.cursorIndex&&n>=this.timelineData.selectionStartIndex&&(this.timelineData.selectionEndIndex=n,this.timelineData.cursorDataPoints[1].selectionIndex=o.datePeriod.index+o.datePeriod.fraction),this.fillCells(this.timelineFormat.cellFormat),this.renderCursors(this.timelineData,this.timelineFormat,this.timelineProperties.cellHeight,this.timelineProperties.cellsYPosition),this.renderTimeRangeText(this.timelineData,this.timelineFormat.rangeTextFormat),this.fillColorGranularity(this.timelineFormat.granularityFormat)}},e.prototype.findCursorOverElement=function(t){var i,a,r=this.timelineData.timelineDatapoints||[],s=this.timelineProperties.cellWidth;return i=r.map(function(e){return e.index}),a=e.getIndexByPosition(i,s,t),r[a]?{index:a,datapoint:r[a]}:null},e.prototype.dragended=function(){this.setSelection(this.timelineData)},e.prototype.renderCursors=function(e,t,i,a){var r=this,s=this.cursorGroupElement.selectAll(this.timelineSelectors.SelectionCursor.selector).data(e.cursorDataPoints);return s.enter().append("path").classed(this.timelineSelectors.SelectionCursor.class,!0),s.attr("transform",function(e){var t,s;return t=e.selectionIndex*r.timelineProperties.cellWidth,s=i/2+a,m.translate(t,s)}).attr({d:d3.svg.arc().innerRadius(0).outerRadius(i/2).startAngle(function(e){return e.cursorIndex*Math.PI+Math.PI}).endAngle(function(e){return e.cursorIndex*Math.PI+2*Math.PI})}).call(this.drag),s.exit().remove(),s},e.prototype.renderTimeRangeText=function(e,t){var i=(O.length+2)*this.timelineProperties.elementWidth,a=this.svgWidth-i-this.timelineProperties.leftMargin-t.sizeProperty;if(t.showProperty&&a>0){var r=E.timeRangeText(e),s={label:r,maxWidth:a,fontSize:t.sizeProperty},n=f(s);this.rangeText.classed(this.timelineSelectors.SelectionRangeContainer.class,!0).attr({x:O.length*(this.timelineProperties.elementWidth+this.timelineProperties.leftMargin),y:40,fill:t.colorProperty}).style({"font-size":o(t.sizeProperty)}).text(n).append("title").text(r)}else this.rangeText.text("")},e.prototype.setSelection=function(e){this.requiresNoUpdate=!0;var t=p.dateTime(E.getStartSelectionDate(e)),i=p.dateTime(new Date(E.getEndSelectionDate(e).getTime()-1)),a=p.between(e.columnIdentity,t,i),r=d.fromSQExpr(a),s={merge:[{objectName:"general",selector:void 0,properties:{filter:r}}]};this.hostServices.persistProperties(s),this.hostServices.onSelect({visualObjects:[]})},e.prototype.enumerateObjectInstances=function(e){var t=new y,i=this.dataView&&this.dataView.metadata?this.dataView.metadata.objects:void 0;switch(e.objectName){case"rangeHeader":this.enumerateRangeHeader(t,i);break;case"cells":this.enumerateCells(t,i);break;case"granularity":this.enumerateGranularity(t,i);break;case"labels":this.enumerateLabels(t,i);break;case"calendar":this.enumerateCalendar(t,i);break;case"weekDay":this.enumerateWeekDay(t,i)}return t.complete()},e.prototype.enumerateRangeHeader=function(e,t){e.pushInstance({objectName:"rangeHeader",displayName:"Selection Color",selector:null,properties:{show:c.getValue(t,D,this.defaultTimelineProperties.TimelineDefaultTimeRangeShow),fontColor:c.getFillColor(t,A,this.defaultTimelineProperties.DefaultTimeRangeColor),textSize:c.getValue(t,T,this.defaultTimelineProperties.TimelineDefaultTextSize)}})},e.prototype.enumerateCells=function(e,t){e.pushInstance({objectName:"cells",selector:null,properties:{fillSelected:c.getFillColor(t,b,this.defaultTimelineProperties.TimelineDefaultCellColor),fillUnselected:c.getFillColor(t,S,this.defaultTimelineProperties.TimelineDefaultCellColorOut)}})},e.prototype.enumerateGranularity=function(e,t){e.pushInstance({objectName:"granularity",selector:null,properties:{granularity:c.getValue(t,w,this.defaultTimelineProperties.DefaultGranularity),scaleColor:c.getFillColor(t,C,this.defaultTimelineProperties.DefaultScaleColor),sliderColor:c.getFillColor(t,P,this.defaultTimelineProperties.DefaultSliderColor)}})},e.prototype.enumerateLabels=function(e,t){e.pushInstance({objectName:"labels",selector:null,properties:{show:c.getValue(t,L,this.defaultTimelineProperties.DefaultLabelsShow),fontColor:c.getFillColor(t,V,this.defaultTimelineProperties.DefaultLabelColor),textSize:c.getValue(t,N,this.defaultTimelineProperties.TimelineDefaultTextSize)}})},e.prototype.enumerateCalendar=function(e,t){e.pushInstance({objectName:"calendar",selector:null,properties:{month:Math.max(1,Math.min(12,c.getValue(t,M,1))),day:Math.max(1,Math.min(31,c.getValue(t,k,1)))}})},e.prototype.enumerateWeekDay=function(e,t){e.pushInstance({objectName:"weekDay",selector:null,properties:{day:Math.max(0,Math.min(6,c.getValue(t,I,0)))}})},e.MinSizeOfViewport=0,e.capabilities={dataRoles:[{name:"Time",kind:h.Grouping,displayName:"Time"}],dataViewMappings:[{conditions:[{Time:{max:1}}],categorical:{categories:{for:{in:"Time"},dataReductionAlgorithm:{sample:{}}},values:{select:[{bind:{to:"Time"}}]}}}],objects:{general:{displayName:"General",properties:{formatString:{type:{formatting:{formatString:!0}}},selected:{type:{bool:!0}},filter:{type:{filter:{}},rule:{output:{property:"selected",selector:["Time"]}}}}},calendar:{displayName:"Fiscal Year Start",properties:{month:{displayName:"Month",type:{enumeration:t.Months}},day:{displayName:"Day",type:{numeric:!0}}}},weekDay:{displayName:"First Day of Week",properties:{day:{displayName:"Day",type:{enumeration:t.WeekDays}}}},rangeHeader:{displayName:"Range Header",properties:{show:{displayName:"Show",type:{bool:!0}},fontColor:{displayName:"Font color",type:{fill:{solid:{color:!0}}}},textSize:{displayName:"Text Size",type:{numeric:!0}}}},cells:{displayName:"Cells",properties:{fillSelected:{displayName:"Selected cell color",type:{fill:{solid:{color:!0}}}},fillUnselected:{displayName:"Unselected cell color",type:{fill:{solid:{color:{nullable:!0}}}}}}},granularity:{displayName:"Granularity",properties:{scaleColor:{displayName:"Scale color",type:{fill:{solid:{color:!0}}}},sliderColor:{displayName:"Slider color",type:{fill:{solid:{color:!0}}}},granularity:{displayName:"Granularity",type:{enumeration:t.Granularities}}}},labels:{displayName:"Labels",properties:{show:{displayName:"Show",type:{bool:!0}},fontColor:{displayName:"Font color",type:{fill:{solid:{color:!0}}}},textSize:{displayName:"Text Size",type:{numeric:!0}}}}}},e}();t.Timeline=U}(i=t.samples||(t.samples={}))}(t=e.visuals||(e.visuals={}))}(i||(i={}))},function(e,t){var i,a=window.jsCommon,i=window.powerbi;window.powerbitests,window.InJs,window.debug,window.jasmine,window.Microsoft;!function(e){var t;!function(t){var i;!function(t){var i=a.PixelConverter,r=e.visuals.valueFormatter,s=e.visuals.LegendData,o=e.VisualDataRoleKind,n=e.data.createDisplayNameGetter,l=e.visuals.legendPosition,c=e.visuals.SelectionId,u=e.visuals.LegendIcon,h=e.visuals.TooltipBuilder,p=e.TextMeasurementService,d=e.DataViewObjects,g=e.visuals.appendClearCatcher,m=e.visuals.createInteractivityService,f=e.visuals.createLegend,y=e.visuals.TooltipManager,v=e.visuals.dataLabelUtils,x=e.visuals.SVGUtil,b=e.visuals.AxisHelper,S=e.visuals.valueFormatter,w=e.visuals.legendProps,C=e.visuals.LegendPosition,P=e.visuals.Legend,A=e.visuals.ObjectEnumerationBuilder,T="axisGraphicsContext",D="dataPointsContainer",V="x axis",N="y axis",L="#777",M=8,k=4,I=10,O="#666666",F="wf_segoe-ui_normal",z="normal",j=20,G=10,R=20,B=45,H=10,E=20,W={legendSettings:{show:!0,showTitle:!0,labelColor:O,titleText:"",fontSize:M},categoryAxisSettings:{show:!0,labelColor:L,showAxisTitle:!1},valueAxisSettings:{show:!0,labelColor:L,showAxisTitle:!1},dataLabelsSettings:v.getDefaultPointLabelSettings()},U=function(){function e(){}return e.prototype.bindEvents=function(e,t){this.selection=e.selection,this.clearCatcher=e.clearCatcher,this.interactivityService=e.interactivityService,this.selection.on("click",function(e,i){t.handleSelection(e,d3.event.ctrlKey)}),this.clearCatcher.on("click",function(){t.handleClearSelection()})},e.prototype.renderSelection=function(e){var t=this.interactivityService.hasSelection();this.selection.style("fill-opacity",function(i){return X.getFillOpacity(i.selected,i.highlight,!i.highlight&&e,!i.selected&&t)})},e}(),Y=function(){function e(){this.margin={left:B,right:15,bottom:j,top:10}}return e.prototype.converter=function(t,a,s){if(!(t&&t.categorical&&t.categorical.values&&t.categorical.categories&&a))return null;for(var o,n,l=t.categorical,d=l.categories,g=l.values,m=[],f={dataPoints:[],title:g.source?g.source.displayName:"",fontSize:M},y=0,v=d&&d.length>0?d[0]:null,x=e.Properties.general.formatString,b=!!(g.length>0&&g[0].highlights),S=this.parseSettings(t),w=i.fromPoint(S.dataLabelsSettings.fontSize),C=0;C<g.length;C++){var P=g[C].source.groupName,A=g[C].identity?c.createWithId(g[C].identity):c.createWithMeasure(g[C].source.queryName);P?f.dataPoints.push({
label:P,color:a.getColorByIndex(C).value,icon:u.Box,selected:!1,identity:A}):P=g[C].source.displayName;var T=h.createTooltipInfo(x,{categories:null,values:g},null,null,null,null,C);m[C]={dataPoints:[],tooltipInfo:T,highlight:b,identity:A,selected:!1};var D=g[C].values;if(0!==D.length)for(var V=0;V<D.length;V++){var N=b?g[C].highlights[V]:D[V];N>y&&(y=N),m[C].dataPoints.push({x:V,y:isNaN(N)?0:N,text:P,labelFontSize:w})}}s&&s.applySelectionStateToData(m),o=r.create({format:"g",value:y}),n=r.create({format:r.getFormatString(v.source,e.Properties.general.formatString),value:v.values});for(var L=[],k=this.getTextPropertiesFunction,I=0;I<v.values.length;I++){var O=void 0;if(null!=v.values[I]){O=n.format(v.values[I]);var F=p.measureSvgTextWidth(k(O));F>e.MaxNumberOfAxisXValues&&(e.MaxNumberOfAxisXValues=F)}L.push(O)}return{series:m,legendData:f,valueFormatter:o,categoryFormatter:n,streamGraphSettings:S,categoriesText:L}},e.prototype.parseSettings=function(t){if(!t||!t.metadata)return W;var i=t.metadata.objects,a=_.cloneDeep(W),r=a.categoryAxisSettings;r.show=d.getValue(i,e.Properties.categoryAxis.show,r.show),r.labelColor=d.getFillColor(i,e.Properties.categoryAxis.labelColor,r.labelColor),r.showAxisTitle=d.getValue(i,e.Properties.categoryAxis.showAxisTitle,r.showAxisTitle);var s=a.valueAxisSettings;s.show=d.getValue(i,e.Properties.valueAxis.show,s.show),s.labelColor=d.getFillColor(i,e.Properties.valueAxis.labelColor,s.labelColor),s.showAxisTitle=d.getValue(i,e.Properties.valueAxis.showAxisTitle,s.showAxisTitle);var o=a.dataLabelsSettings;o.show=d.getValue(i,e.Properties.labels.show,o.show),o.labelColor=d.getFillColor(i,e.Properties.labels.color,o.labelColor),o.fontSize=d.getValue(i,e.Properties.labels.fontSize,o.fontSize);var n=a.legendSettings,l=t.categorical.values.source,c=l&&_.isEmpty(n.titleText)?l.displayName:n.titleText;return n.show=d.getValue(i,e.Properties.legend.show,n.show),n.showTitle=d.getValue(i,e.Properties.legend.showTitle,n.showTitle),n.titleText=d.getValue(i,e.Properties.legend.titleText,c),n.labelColor=d.getValue(i,e.Properties.legend.labelColor,n.labelColor),n.fontSize=d.getValue(i,e.Properties.legend.fontSize,n.fontSize),_.isEmpty(n.titleText)&&(n.titleText=c),a},e.prototype.init=function(t){var i=t.element,a=this.svg=d3.select(i.get(0)).append("svg").classed(e.VisualClassName,!0).style("position","absolute");this.clearCatcher=g(a),this.axisGraphicsContext=a.append("g").classed(T,!0),this.xAxis=this.axisGraphicsContext.append("g").classed(V,!0),this.yAxis=this.axisGraphicsContext.append("g").classed(N,!0),this.dataPointsContainer=a.append("g").classed(D,!0),this.viewport=t.viewport,this.colors=t.style.colorPalette.dataColors,this.behavior=new U;var r=t.interactivity;this.interactivityService=m(t.host),this.legend=f(i,r&&r.isInteractiveLegend,this.interactivityService,!0)},e.prototype.update=function(e){if(!e.dataViews||!e.dataViews[0]||!e.dataViews[0].categorical)return void this.clearData();this.viewport={width:Math.max(0,e.viewport.width),height:Math.max(0,e.viewport.height)};var t=e.suppressAnimations?0:250,i=this.dataView=e.dataViews[0],a=this.data=this.converter(i,this.colors,this.interactivityService);if(!a||!a.series||!a.series.length)return void this.clearData();this.renderLegend(a),this.renderXAxisLabels(),this.renderYAxisLabels(),this.svg.attr({width:this.viewport.width+"px",height:this.viewport.height+"px"});var r=this.renderChart(a.series,t);y.addTooltip(r,function(e){return e.data.tooltipInfo});var s=this.interactivityService;if(s){var o={selection:r,clearCatcher:this.clearCatcher,interactivityService:s};s.bind(a.series,this.behavior,o)}},e.prototype.getStreamGraphLabelLayout=function(e,t){var a=this.data.streamGraphSettings.dataLabelsSettings,r=i.fromPoint(a.fontSize);return{labelText:function(e){return e.text},labelLayout:{x:function(t){return e(t.x)},y:function(e){return t(e.y0)}},filter:function(e){return null!=e&&null!=e.text},style:{fill:a.labelColor,"font-size":r}}},e.prototype.renderChart=function(t,i){var a=this,r=d3.layout.stack().values(function(e){return e.dataPoints}),s=this.viewport.width,o=this.viewport.height;this.getWiggle(this.dataView)&&r.offset("wiggle");var n=r(t),l=this.margin,c=d3.scale.linear().domain([0,t[0].dataPoints.length-1]).range([l.left,s-l.right]),u=d3.max(n,function(e){return d3.max(e.dataPoints,function(e){return e.y0+e.y})}),h=d3.min(n,function(e){return d3.min(e.dataPoints,function(e){return e.y0+e.y})}),p=d3.scale.linear().domain([Math.min(h,0),u]).range([o-l.bottom,l.top]).nice(),d=d3.svg.area().interpolate("monotone").x(function(e){return c(e.x)}).y0(function(e){return p(e.y0)}).y1(function(e){return p(e.y0+e.y)}).defined(function(e){return!isNaN(e.y0)&&!isNaN(e.y)}),g=this.dataPointsContainer.selectAll(e.Layer.selector).data(n);if(g.enter().append("path").classed(e.Layer.class,!0),g.style("fill",function(e,t){return a.colors.getColorByIndex(t).value}).style("fill-opacity",X.DefaultOpacity).transition().duration(i).attr("d",function(e){return d(e.dataPoints)}),g.selectAll("path").append("g").classed(D,!0),g.exit().remove(),this.data.streamGraphSettings.dataLabelsSettings.show){var m=d3.scale.linear().domain([0,t[0].dataPoints.length-1]).range([0,s-l.left-l.right]),f=this.getStreamGraphLabelLayout(m,p),y=[];t.forEach(function(e){var t;t=e.dataPoints.filter(function(e){return e&&null!==e.y&&void 0!==e.y}),t.length>0&&(y=y.concat(t))});var b={height:o-l.top-l.bottom,width:s-l.right-l.left},S=v.drawDefaultLabelsForDataPointChart(y,this.svg,f,b);if(S){var w=k+l.left;S.attr("transform",function(e){return x.translate(w+e.size.width/2,e.size.height/2)})}}else v.cleanDataLabels(this.svg);return this.drawAxis(this.data,c,p),g},e.prototype.drawAxis=function(t,i,a){for(var r=this.margin,s=this.viewport.height-r.bottom,o=this.viewport.width-r.left-r.right,n=this.data.categoriesText,l=d3.svg.axis(),c=e.MaxNumberOfAxisXValues,u=this.getTextPropertiesFunction,h=0;h<n.length;h++)if(null!=n[h]){var d=n[h].toString(),g=p.measureSvgTextWidth(u(d));g>c&&(c=g)}l.scale(i).orient("bottom").ticks(n.length).tickFormat(function(e){var i=n[e];return t.categoryFormatter&&(i=t.categoryFormatter.format(i)),null===e||void 0===e||0!==e&&e!==n.length-1||(i=p.getTailoredTextOrDefault(u(i),2*(e?r.right:r.left))),i});var m=d3.svg.axis().scale(a).orient("left").tickFormat(function(e){var i=e;return t.valueFormatter&&(i=t.valueFormatter.format(i)),i=p.getTailoredTextOrDefault(u(i.toString()),B-I)});this.setMaxTicks(l,o,Math.max(2,Math.round(o/c))),this.setMaxTicks(m,s);var f=this.data.streamGraphSettings.valueAxisSettings;if(f.show){var y=f.labelColor;this.yAxis.attr("transform",x.translate(r.left,0)).call(m),this.yAxis.selectAll("text").style("fill",y)}else this.yAxis.selectAll("*").remove();var v=this.data.streamGraphSettings.categoryAxisSettings;if(v.show){var y=v.labelColor;this.xAxis.attr("transform",x.translate(0,s)).call(l),this.xAxis.selectAll("text").style("fill",y)}else this.xAxis.selectAll("*").remove()},e.prototype.renderYAxisLabels=function(){this.axisGraphicsContext.selectAll(e.YAxisLabel.selector).remove();var t=this.data.streamGraphSettings.valueAxisSettings;if(this.margin.left=t.show?B:H,t.showAxisTitle){this.margin.left+=E;var i=this.data.streamGraphSettings.categoryAxisSettings,a=i.show===!0,r=i.showAxisTitle===!0,s=this.margin.top,o=this.viewport.height-s-(a?j:G)-(r?R:0),n=this.dataView.categorical.values,l=n.source?n.source.displayName:this.getYAxisTitleFromValues(n),c=this.getTextPropertiesFunction(l);l=p.getTailoredTextOrDefault(c,o);var u=e.YAxisLabel.class,h=this.axisGraphicsContext.append("text").style("text-anchor","middle").style("font-family",c.fontFamily).style("font-size",c.fontSize).style("font-style",c.fontStyle).style("font-weight",c.fontWeight).text(l).call(function(e){e.each(function(){var e=d3.select(this);e.attr({class:u,transform:"rotate(-90)",fill:t.labelColor,x:-(s+o/2),dy:"1em"})})});h.call(b.LabelLayoutStrategy.clip,o,p.svgEllipsis)}},e.prototype.getYAxisTitleFromValues=function(e){for(var t=[],i=0;i<e.length;i++)e[i]&&e[i].source&&e[i].source.displayName&&t.push({displayName:e[i].source.displayName});var a=t.map(function(e){return e?e.displayName:""}).filter(function(e,t,i){return""!==e&&i.indexOf(e)===t});return S.formatListAnd(a)},e.prototype.renderXAxisLabels=function(){this.axisGraphicsContext.selectAll(e.XAxisLabel.selector).remove();var t=this.data.streamGraphSettings.categoryAxisSettings;if(this.margin.bottom=t.show?j:G,t.showAxisTitle&&this.dataView.categorical.categories[0].source){this.margin.bottom+=R;var i=this.data.streamGraphSettings.valueAxisSettings,a=i.show===!0,r=i.showAxisTitle===!0,s=(a?B:H)+(r?E:0),o=this.viewport.width-this.margin.right-s,n=this.viewport.height,l=this.dataView.categorical.categories[0].source.displayName,c=this.getTextPropertiesFunction(l);l=p.getTailoredTextOrDefault(c,o);var u=e.XAxisLabel.class,h=this.axisGraphicsContext.append("text").style("text-anchor","middle").style("font-family",c.fontFamily).style("font-size",c.fontSize).style("font-weight",c.fontWeight).text(l).call(function(e){e.each(function(){var e=d3.select(this);e.attr({class:u,transform:x.translate(s+o/2,n),fill:t.labelColor,dy:"-0.5em"})})});h.call(b.LabelLayoutStrategy.clip,o,p.svgEllipsis)}},e.prototype.renderLegend=function(e){var t=e.streamGraphSettings.legendSettings,i=e.legendData;if(this.dataView&&this.dataView.metadata){var a=d.getObject(this.dataView.metadata.objects,"legend",{});a.titleText=t.titleText,s.update(i,a);var r=a[w.position];r&&this.legend.changeOrientation(C[r]),this.legend.drawLegend(i,_.clone(this.viewport)),P.positionChartArea(this.svg,this.legend),this.updateViewPort()}},e.prototype.updateViewPort=function(){var e=this.legend.getMargins(),t=this.legend.getOrientation();switch(t){case C.Top:case C.TopCenter:case C.Bottom:case C.BottomCenter:this.viewport.height=Math.max(0,this.viewport.height-e.height);break;case C.Left:case C.LeftCenter:case C.Right:case C.RightCenter:this.viewport.width=Math.max(0,this.viewport.width-e.width)}},e.prototype.setMaxTicks=function(e,t,i){var a=void 0===i?this.getTicksByAxis(e).length:Math.min(i,this.getTicksByAxis(e).length);e.scale().domain.toString()===d3.scale.linear().domain.toString()?e.ticks(this.getFittedTickLength(e,t,a)):e.tickValues(this.getFittedTickValues(e,t,a))},e.prototype.getFittedTickLength=function(e,t,i){for(var a=this.getTicksByAxis(e),r=this.getMeasureTickFunction(e,a);i>0&&t>0&&(this.measureTicks(a,r)>t||e.scale().ticks([i]).length>i);i--,a=this.getTicksByAxis(e))e.ticks(i);return i},e.prototype.getFittedTickValues=function(e,t,i){for(var a,r=this.getTicksByAxis(e),s=[],o=this.getMeasureTickFunction(e,r),n=i,l=[];i>0&&t>0;n--,l=[]){switch(n){case 0:return[];case 1:l=[0];break;case 2:l=[0,r.length-1];break;default:for(var c=r.length/(n-1),u=0;u<n-1;u++)l.push(Math.round(c*u));l.push(r.length-1)}var h=l.map(function(e){return[r[e],e]});if(a=t/r.length*2,h.reduce(function(e,t){return s.push([o(e[0])+o(t[0]),(t[1]-e[1])*a]),t}),!s.some(function(e){return e[0]>e[1]}))return h.map(function(e){return e[0]})}return[]},e.prototype.measureTicks=function(e,t){return e.map(function(e){return t(e)}).reduce(function(e,t){return e+t})},e.prototype.getTicksByAxis=function(e){var t=e.scale(),i=null===e.tickValues()?t.ticks?t.ticks.apply(t,e.ticks()):t.domain():e.tickValues();return void 0===i.length?[i]:i},e.prototype.getMeasureTickFunction=function(e,t){var i="top"===e.orient()||"bottom"===e.orient()?p.measureSvgTextWidth:p.measureSvgTextHeight,a=this.getTextPropertiesFunction,r={};return function(t){return r[t]?r[t]:r[t]=i(a(e.tickFormat()(t)))+e.tickPadding()}},e.prototype.getTextPropertiesFunction=function(e){var t=F,a=i.fromPoint(M),r=z;return{text:e,fontFamily:t,fontSize:a,fontWeight:r}},e.prototype.getWiggle=function(e){if(e&&e.metadata){var t=e.metadata.objects;if(t){var i=d.getObject(t,"general",void 0);if(i)return i.wiggle}}return!0},e.prototype.enumerateValueAxisValues=function(e){var t=this.data&&this.data.streamGraphSettings?this.data.streamGraphSettings.valueAxisSettings:W.valueAxisSettings;e.pushInstance({selector:null,objectName:"valueAxis",displayName:"Y-Axis",properties:{show:t.show,showAxisTitle:t.showAxisTitle,labelColor:t.labelColor}})},e.prototype.enumerateCategoryAxisValues=function(e){var t=this.data&&this.data.streamGraphSettings?this.data.streamGraphSettings.categoryAxisSettings:W.categoryAxisSettings;e.pushInstance({selector:null,objectName:"categoryAxis",displayName:"X-Axis",properties:{show:t.show,showAxisTitle:t.showAxisTitle,labelColor:t.labelColor}})},e.prototype.enumerateLegend=function(e){var t=this.data&&this.data.streamGraphSettings?this.data.streamGraphSettings.legendSettings:W.legendSettings;e.pushInstance({selector:null,objectName:"legend",displayName:"Legend",properties:{show:t.show,position:C[this.legend.getOrientation()],showTitle:t.showTitle,titleText:t.titleText,labelColor:t.labelColor,fontSize:t.fontSize}})},e.prototype.clearData=function(){this.svg.selectAll(e.Layer.selector).remove(),this.legend.drawLegend({dataPoints:[]},this.viewport),this.yAxis.selectAll("*").remove(),this.axisGraphicsContext.selectAll(e.YAxisLabel.selector).remove(),this.xAxis.selectAll("*").remove(),this.axisGraphicsContext.selectAll(e.XAxisLabel.selector).remove(),this.svg.select(".labels").remove()},e.prototype.onClearSelection=function(){this.interactivityService&&this.interactivityService.clearSelection()},e.prototype.enumerateObjectInstances=function(e){var t,i=new A,a=this.dataView;switch(this.data&&(t=this.data.streamGraphSettings.dataLabelsSettings?this.data.streamGraphSettings.dataLabelsSettings:W.dataLabelsSettings),e.objectName){case"legend":a&&a.categorical&&a.categorical.values&&a.categorical.values.source&&this.enumerateLegend(i);break;case"categoryAxis":this.enumerateCategoryAxisValues(i);break;case"valueAxis":this.enumerateValueAxisValues(i);break;case"labels":var r={enumeration:i,dataLabelsSettings:t,show:!0,fontSize:!0};v.enumerateDataLabels(r);break;case"general":var s={objectName:"general",displayName:"General",selector:null,properties:{wiggle:this.getWiggle(a)}};i.pushInstance(s)}return i.complete()},e.VisualClassName="streamGraph",e.Properties={general:{formatString:{objectName:"general",propertyName:"formatString"}},legend:{show:{objectName:"legend",propertyName:"show"},showTitle:{objectName:"legend",propertyName:"showTitle"},titleText:{objectName:"legend",propertyName:"titleText"},labelColor:{objectName:"legend",propertyName:"labelColor"},fontSize:{objectName:"legend",propertyName:"fontSize"}},categoryAxis:{show:{objectName:"categoryAxis",propertyName:"show"},labelColor:{objectName:"categoryAxis",propertyName:"labelColor"},showAxisTitle:{objectName:"categoryAxis",propertyName:"showAxisTitle"}},valueAxis:{show:{objectName:"valueAxis",propertyName:"show"},labelColor:{objectName:"valueAxis",propertyName:"labelColor"},showAxisTitle:{objectName:"valueAxis",propertyName:"showAxisTitle"}},labels:{show:{objectName:"labels",propertyName:"show"},color:{objectName:"labels",propertyName:"color"},fontSize:{objectName:"labels",propertyName:"fontSize"}}},e.Layer={class:"layer",selector:".layer"},e.XAxisLabel={class:"xAxisLabel",selector:".xAxisLabel"},e.YAxisLabel={class:"yAxisLabel",selector:".yAxisLabel"},e.MaxNumberOfAxisXValues=5,e.capabilities={dataRoles:[{name:"Category",kind:o.Grouping,displayName:"Category"},{name:"Series",kind:o.Grouping,displayName:"Series"},{name:"Y",kind:o.Measure,displayName:n("Role_DisplayName_Values")}],dataViewMappings:[{conditions:[{Category:{max:1},Series:{max:0}},{Category:{max:1},Series:{min:1,max:1},Y:{max:1}}],categorical:{categories:{for:{in:"Category"},dataReductionAlgorithm:{bottom:{}}},values:{group:{by:"Series",select:[{for:{in:"Y"}}],dataReductionAlgorithm:{bottom:{}}}}}}],objects:{general:{displayName:"General",properties:{formatString:{type:{formatting:{formatString:!0}}},wiggle:{type:{bool:!0},displayName:"Wiggle"}}},categoryAxis:{displayName:"X-Axis",properties:{show:{displayName:"show",type:{bool:!0}},showAxisTitle:{displayName:"Title",type:{bool:!0}},labelColor:{displayName:"Color",type:{fill:{solid:{color:!0}}}}}},valueAxis:{displayName:"Y-Axis",properties:{show:{displayName:"show",type:{bool:!0}},showAxisTitle:{displayName:"Title",type:{bool:!0}},labelColor:{displayName:"Color",type:{fill:{solid:{color:!0}}}}}},legend:{displayName:"Legend",properties:{show:{displayName:"show",type:{bool:!0}},position:{displayName:"Position",type:{enumeration:l.type}},showTitle:{displayName:"Title",type:{bool:!0}},titleText:{displayName:"Legend Name",type:{text:!0},suppressFormatPainterCopy:!0},labelColor:{displayName:"Color",type:{fill:{solid:{color:!0}}}},fontSize:{displayName:"Text Size",type:{formatting:{fontSize:!0}}}}},labels:{displayName:"Data Labels",properties:{show:{displayName:"Show",type:{bool:!0}},color:{displayName:"Color",type:{fill:{solid:{color:!0}}}},fontSize:{displayName:"Text Size",type:{formatting:{fontSize:!0}}}}}},supportsHighlight:!0},e}();t.StreamGraph=Y;var X;!function(e){function t(t,i,a,r){return r&&!i||a&&!t?e.DimmedOpacity:e.DefaultOpacity}e.DimmedOpacity=.4,e.DefaultOpacity=1,e.getFillOpacity=t}(X=t.streamGraphUtils||(t.streamGraphUtils={}))}(i=t.samples||(t.samples={}))}(t=e.visuals||(e.visuals={}))}(i||(i={}))},function(e,t){var i,a=window.jsCommon,i=window.powerbi;window.powerbitests,window.InJs,window.debug,window.jasmine,window.Microsoft;!function(e){var t;!function(t){var i;!function(i){function r(t){var i=!1;return e.createEnumType(Object.keys(t).filter(function(e,a){return!!(a%2)===i&&t[e]===e&&!void(i===!i)||!!(a%2)!==i}).map(function(e){return{value:e,displayName:e}}))}var s=t.utility.SelectionManager,o=e.visuals.valueFormatter,n=a.CssConstants.createClassAndSelector,l=e.TextMeasurementService,c=t.dataLabelUtils.defaultLabelPrecision,u=t.dataLabelUtils.defaultLabelColor,h=t.dataLabelUtils.DefaultFontSizeInPt,p=t.dataLabelUtils.defaultLabelDensity;i.createEnumTypeFromEnum=r,function(e){e[e.DateOnly="Date only"]="DateOnly",e[e.TimeOnly="Time only"]="TimeOnly"}(i.PulseChartXAxisDateFormat||(i.PulseChartXAxisDateFormat={}));var d=i.PulseChartXAxisDateFormat;!function(e){e[e.Center="Center"]="Center",e[e.Bottom="Bottom"]="Bottom"}(i.XAxisPosition||(i.XAxisPosition={}));var g=i.XAxisPosition;!function(e){e[e.TopLeft="Top Left"]="TopLeft",e[e.TopRight="Top Right"]="TopRight"}(i.RunnerCounterPosition||(i.RunnerCounterPosition={}));var m=i.RunnerCounterPosition,f=function(){function i(e){e&&e.svg&&(this.svg=e.svg),this.margin=i.DefaultMargin}return i.getProperties=function(e){var t={};for(var i in e.objects){t[i]={};for(var a in e.objects[i].properties)t[i][a]={objectName:i,propertyName:a}}return t},i.GetPopupValueTextProperties=function(e,t){return void 0===t&&(t=12),{text:e||"",fontFamily:"sans-serif",fontSize:t+"px"}},i.GetPopupTitleTextProperties=function(e,t){return void 0===t&&(t=12),{text:e||"",fontFamily:"sans-serif",fontWeight:"bold",fontSize:t+"px"}},i.GetPopupDescriptionTextProperties=function(e,t){return void 0===t&&(t=12),{text:e||"",fontFamily:"sans-serif",fontSize:t+"px"}},i.GetRunnerCounterTextProperties=function(e,t){return void 0===t&&(t=12),{text:e||"",fontFamily:"sans-serif",fontSize:t+"px"}},i.ConvertTextPropertiesToStyle=function(e){return{"font-family":e.fontFamily,"font-weight":e.fontWeight,"font-size":e.fontSize}},i.GetDateTimeFormatString=function(e,t){switch(e){case d.DateOnly:return t;case d.TimeOnly:return"H:mm";default:return""}},i.GetFullWidthOfDateFormat=function(e,i){return i.text=t.valueFormatter.create({format:e}).format(new Date(2e3,10,20,20,20,20)),l.measureSvgTextWidth(i)},i.AddOnTouchClick=function(e,t){var i=function(e,i){d3.event.preventDefault(),t(e,i)};return e.on("click",i).on("touchstart",i)},i.getCategoricalColumnOfRole=function(e,t){var i=function(e){return e.filter(function(e){return e.source&&e.source.roles&&e.source.roles[t]})[0]};return i(e.categorical.categories)||i(e.categorical.values)},i.converter=function(e,a,r){if(!(e&&e.categorical&&e.categorical.values&&e.categorical.values[0]&&e.categorical.values[0].values&&e.categorical.categories))return null;var s=_.mapValues(i.RoleNames,function(t,a){return i.getCategoricalColumnOfRole(e,a)}),n=s.Timestamp;if(!n)return null;var c=!(n.source&&n.source.type&&n.source.type.dateTime),u=i.parseSettings(e,a,s),h=n.values;if(!h||_.isEmpty(e.categorical.values)||!s.Value||_.isEmpty(s.Value.values))return null;var p=Math.min.apply(null,s.Value.values),g=Math.max.apply(null,s.Value.values),m=Math.min.apply(null,h),f=Math.max.apply(null,h);u.xAxis.dateFormat=f-m<864e5&&new Date(f).getDate()===new Date(m).getDate()?d.TimeOnly:d.DateOnly,u.xAxis.formatterOptions={value:c?m:new Date(m),value2:c?f:new Date(f)},u.yAxis.formatterOptions={value:p,value2:g,format:o.getFormatString(s.Value.source,i.DefaultSettings.formatStringProperty)},c?u.xAxis.formatterOptions.format=o.getFormatString(n.source,i.DefaultSettings.formatStringProperty):u.xAxis.formatterOptions.format=i.GetDateTimeFormatString(u.xAxis.dateFormat,n.source.format);var y=70,v=c?60:i.GetFullWidthOfDateFormat(n.source.format,i.GetPopupValueTextProperties())+5,S=l.measureSvgTextHeight(i.GetPopupDescriptionTextProperties("lj",u.popup.fontSize)),w=s.RunnerCounter&&t.valueFormatter.getFormatString(s.RunnerCounter.source,u.formatStringProperty);u.popup.width=Math.max(v+20,u.popup.width);var C=i.DefaultSettings.dots.minSize,P=i.DefaultSettings.dots.maxSize;u.dots&&(C=u.dots.minSize,P=u.dots.maxSize);for(var A=i.createScale(!0,s.EventSize?[d3.min(s.EventSize.values),d3.max(s.EventSize.values)]:[0,0],C,P),T=b.getCategoryAxisProperties(e.metadata),D=!(!n.values||!n.source),V=x.getDefaultPulseChartLabelSettings(),N=i.getGapWidths(h),L=Math.max.apply(null,N),M=0,k=0,I=1,O=e.categorical.values&&e.categorical.values.grouped(),F=O[k]&&O[k].values[M]&&O[k].values[M].values,z=O[I]&&O[I].values[M]&&O[I].values[M].values,j=[],G=[],R=0,B=0,H=n.values.length;R<H;R++,B++){var E=h[R],W=t.AxisHelper.normalizeNonFiniteNumber(n.values[R]),U=s.RunnerCounter&&s.RunnerCounter.values&&s.RunnerCounter.values[R],Y=t.SelectionIdBuilder.builder().withCategory(n,R).createSelectionId(),X=Math.max((f-m)/i.MaxGapCount,i.MinGapWidth[u.xAxis.dateFormat]),q=N[R],K=u.gaps.show&&q>0&&q>X+(100-u.gaps.visibleGapsPercentage)*(L-X)/100;if(K&&G.length>0&&(j.push({displayName:O[k].name,key:Y.getKey(),lineIndex:j.length,color:u.series.fill,xCol:n.source,yCol:n.source,data:G,identity:Y,selected:!1,labelSettings:V,width:u.series.width,widthOfGap:q}),B=0,G=[]),!c||null!==E&&null!==W){var Z=null,J=s.EventSize&&s.EventSize.values&&s.EventSize.values[R]||0;if(s.EventTitle&&s.EventTitle.values&&s.EventTitle.values[R]||s.EventDescription&&s.EventDescription.values&&s.EventDescription.values[R]){var $=E;!c&&E&&($=t.valueFormatter.create({format:n.source.format}).format(E)),Z={value:$,title:s.EventTitle&&s.EventTitle.values&&s.EventTitle.values[R],description:s.EventDescription&&s.EventDescription.values&&s.EventDescription.values[R]}}var Q={categoryValue:E,value:W,categoryIndex:R,seriesIndex:j.length,tooltipInfo:null,popupInfo:Z,selected:!1,identity:Y,key:JSON.stringify({ser:Y.getKey(),catIdx:R}),labelFill:V.labelColor,labelSettings:V,x:E,y:F&&F[R]||z&&z[R]||0,pointColor:u.series.fill,groupIndex:i.getGroupIndex(R,O),eventSize:s.EventSize?A(J):0,runnerCounterValue:U,runnerCounterFormatString:w,specificIdentity:void 0};G.push(Q)}}r&&r.applySelectionStateToData(G),G.length>0&&j.push({displayName:O[k].name,key:Y.getKey(),lineIndex:j.length,color:u.series.fill,xCol:n.source,yCol:n.source,data:G,identity:Y,selected:!1,labelSettings:V,width:u.series.width,widthOfGap:0}),T=b.getCategoryAxisProperties(e.metadata);var ee=b.getValueAxisProperties(e.metadata),te=e.categorical.categories,ie=[];if(te)for(var ae=0;ae<te.length;ae++)te[ae]&&te[ae].source&&te[ae].source.displayName&&ie.push({displayName:te[ae].source.displayName});var re=t.converterHelper.createAxesLabels(T,ee,n.source,ie);return r&&r.applySelectionStateToData(j),{columns:s,series:j,isScalar:c,dataLabelsSettings:V,axesLabels:{x:re.xAxisLabel,y:re.yAxisLabel},hasDynamicSeries:D,categoryMetadata:n.source,categories:h,settings:u,grouped:O,hasHighlights:!!s.Value.highlights,widthOfXAxisLabel:y,widthOfTooltipValueLabel:v,heightOfTooltipDescriptionTextLine:S,runnerCounterHeight:l.measureSvgTextHeight(i.GetRunnerCounterTextProperties("lj",u.runnerCounter.fontSize))}},i.createAxisY=function(e,i,a,r){void 0===r&&(r=!0);var s=t.valueFormatter.create(a),o=Math.max(2,Math.round(i/40)),n=d3.svg.axis().scale(e).ticks(o).outerTickSize(0).tickFormat(s.format);return n},i.createAxisX=function(e,a,r,s,o,n,l){for(var c=i.getXAxisScales(a,e,r),u=new Array(c.length),h=0,p=!1;h<u.length;h++){var d=i.getXAxisValuesToDisplay(c[h],p,e,o,l);if(!p&&n===g.Bottom&&d.length<i.MinimumTicksToRotate){var m=i.getXAxisValuesToDisplay(c[h],!0,e,o,l);if(m.length>d.length){p=!0,h=-1;continue}}u[h]={values:d,scale:c[h],rotate:p}}return s.tickCount=u.length&&5*u.map(function(e){return e.values.length}).reduce(function(e,t){return e+t}),s.value=r.domain()[0],s.value2=r.domain()[1],u.forEach(function(e){var i=e.values.filter(function(e){return null!==e}),a=t.valueFormatter.create(s);e.axis=d3.svg.axis().scale(e.scale).tickValues(i).tickFormat(a.format).outerTickSize(0)}),u},i.getXAxisScales=function(e,t,a){return e.map(function(e){var r=e.data,s=r[0].categoryValue,o=r[r.length-1].categoryValue,n=a(r[0].categoryValue),l=a(r[r.length-1].categoryValue);return i.createScale(t,[s,o],n,l)})},i.getXAxisValuesToDisplay=function(e,t,a,r,s){var o=e,n=t?i.XAxisTickHeight*(t?Math.abs(Math.sin(i.AxisTickRotateAngle*Math.PI/180)):0):s,l=i.XAxisTickSpace;if(e.range()[1]<n)return[];var c=e.invert(e.range()[0]+n/2),u=e.invert(e.range()[1]-n/2),h=e.range()[1]-e.range()[0],p=Math.floor((h+l)/(n+l));t&&(p=Math.min(i.MinimumTicksToRotate,p));var g=[];if(g=a?d3.range(c,u,(u-c)/(100*p)):(r===d.TimeOnly?d3.time.minute:d3.time.day).range(c,u),(!g.length||_.last(g)<u)&&g.push(u),!p)return[];p=Math.min(g.length,p);var m=d3.scale.ordinal().domain(d3.range(p)).rangePoints([0,g.length-1]).range();g=m.map(function(e){return g[Math.round(e)]});for(var f=1;f<g.length;f++){var y=o(g[f-1]),v=o(g[f]);v-y<n+l/3&&g.splice(f--,1)}return g},i.getGroupIndex=function(e,t){for(var i=0;i<t.length;i++)if(t[i].values&&t[i].values[0]&&void 0!==t[i].values[0].values[e]&&null!==t[i].values[0].values[e])return i;return 0},i.getGapWidths=function(e){for(var t=[],i=0,a=0,r=e.length;i<r;i++)a&&e[i]?t.push(e[i]-a):t.push(0),a=e[i];return t},i.createScale=function(e,t,i,a){var r;return r=e?d3.scale.linear():d3.time.scale(),r.domain(t).range([i,a])},Object.defineProperty(i.prototype,"runnerCounterPlaybackButtonsHeight",{get:function(){return Math.max(i.PlaybackButtonsHeight,this.data&&this.data.runnerCounterHeight/2+17)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"popupHeight",{get:function(){return this.data&&this.data.settings&&this.data.settings.popup&&this.data.settings.popup.show&&this.data.settings.popup.height||0},enumerable:!0,configurable:!0}),i.prototype.init=function(a){e.formattingService.initialize(),this.host=a.host,this.selectionManager=new s({hostServices:this.host});var r=this.svg=d3.select(a.element.get(0)).append("svg").classed("pulseChart",!0);this.gaps=r.append("g").classed(i.Gaps.class,!0),this.yAxis=r.append("g").attr("class","y axis"),this.chart=r.append("g").attr("class",i.Chart.class),this.dots=r.append("g").attr("class","dots"),this.animationDot=this.dots.append("circle").classed(i.AnimationDot.class,!0).attr("display","none"),this.animationHandler=new v(this,r);var o=a.style;this.colors=o&&o.colorPalette?o.colorPalette.dataColors:new t.DataColorPalette},i.prototype.update=function(e){if(e&&e.dataViews&&e.dataViews[0]){this.viewport=$.extend({},e.viewport);var t=e.dataViews[0];if(this.updateData(i.converter(t,this.colors)),!this.validateData(this.data))return void this.clearAll(!0);var a=this.getChartWidth();if(this.calculateXAxisProperties(a),this.data.xScale.ticks(void 0).length<2)return void this.clearAll(!0);var r=this.getChartHeight(this.data.settings.xAxis.show&&this.data.series.some(function(e){return e.xAxisProperties.rotate}));this.calculateYAxisProperties(r),this.size={width:a,height:r},this.updateElements(),this.render(!0)}},i.prototype.updateData=function(e){if(!this.data)return void(this.data=e);var t=this.getDataArrayToCompare(this.data),i=this.getDataArrayToCompare(e);_.isEqual(t,i)||this.clearAll(!1),this.data=e},i.prototype.getDataArrayToCompare=function(e){if(!e||!e.series)return null;var t=_.flatten(e.series.map(function(e){return e.data}));return _.flatten(t.map(function(e){return e&&_.flatten([[e.categoryValue,e.eventSize,e.groupIndex,e.runnerCounterValue,e.y,e.seriesIndex],e.popupInfo&&[e.popupInfo.description,e.popupInfo.title,e.popupInfo.value]])}))},i.prototype.validateData=function(e){return!!e&&!e.categories.some(function(e){return!(e instanceof Date||$.isNumeric(e))})},i.prototype.getChartWidth=function(){var e=this.margin.right;this.data.settings.yAxis&&this.data.settings.yAxis.show&&(e+=i.MaxWidthOfYAxis);var t=this.viewport.width-this.margin.left-e;return Math.max(t,i.DefaultViewport.width)},i.prototype.getChartHeight=function(e){var t=10+(e?this.data.widthOfXAxisLabel*Math.abs(Math.sin(i.AxisTickRotateAngle*Math.PI/180)):3);!this.data.settings.popup.alwaysOnTop&&this.popupHeight&&(t=Math.max(this.margin.bottom+this.popupHeight,t));var a=this.viewport.height-this.margin.top-this.runnerCounterPlaybackButtonsHeight-t-this.popupHeight;return Math.max(a,i.DefaultViewport.height)},i.prototype.updateElements=function(){var e=this.margin.top+this.runnerCounterPlaybackButtonsHeight+this.popupHeight;this.svg.attr(this.viewport),this.svg.style("display",void 0),this.gaps.attr("transform",t.SVGUtil.translate(this.margin.left,e+this.size.height/2)),this.chart.attr("transform",t.SVGUtil.translate(this.margin.left,e)),this.yAxis.attr("transform",t.SVGUtil.translate(this.size.width+this.margin.left,e)),this.dots.attr("transform",t.SVGUtil.translate(this.margin.left,e))},i.prototype.calculateXAxisProperties=function(e){this.data.xScale=i.createScale(this.data.isScalar,[this.data.categories[0],this.data.categories[this.data.categories.length-1]],0,e);var t=i.createAxisX(this.data.isScalar,this.data.series,this.data.xScale,$.extend({},this.data.settings.xAxis.formatterOptions),this.data.settings.xAxis.dateFormat,this.data.settings.xAxis.position,this.data.widthOfXAxisLabel);this.data.series.forEach(function(e,i){e.xAxisProperties=t[i]})},i.prototype.calculateYAxisProperties=function(e){this.data.yScales=this.getYAxisScales(e);var t=[];this.data.yScales.forEach(function(e){return t=t.concat(e.domain())}),this.data.commonYScale=i.createScale(!0,[d3.max(t),d3.min(t)],0,e),this.data.yAxis=i.createAxisY(this.data.commonYScale,e,this.data.settings.yAxis.formatterOptions)},i.prototype.getYAxisScales=function(e){var t=this.data,a=e/t.grouped.length;return t.grouped.map(function(e,t){var r=e.values[0].values.map(function(e){return e||0}),s=Number.MAX_VALUE,o=-Number.MAX_VALUE;if(r.forEach(function(e){e<s&&(s=e),e>o&&(o=e)}),o===s){var n=0===o?1:Math.abs(o/2);o+=n,s-=n}return i.createScale(!0,[o,s],a*t,a*(t+1))})},Object.defineProperty(i.prototype,"autoplayPauseDuration",{get:function(){return 1e3*(this.data&&this.data.settings&&this.data.settings.playback?this.data.settings.playback.autoplayPauseDuration:i.DefaultSettings.playback.autoplayPauseDuration)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"isAutoPlay",{get:function(){return this.data&&this.data.settings&&this.data.settings.playback&&this.data.settings.playback.autoplay},enumerable:!0,configurable:!0}),i.prototype.render=function(e){var i=t.AnimatorCommon.GetAnimationDuration(this.animator,e),a=this.data;this.lastSelectedPoint=null;var r=a.xScale,s=a.yScales;this.lineX=d3.svg.line().x(function(e){return r(e.categoryValue)}).y(function(e){return s[e.groupIndex](e.y)}),this.data&&this.data.settings&&this.data.settings.playback&&this.data.settings.playback.color&&this.animationHandler.setControlsColor(this.data.settings.playback.color),
this.animationHandler.render(),this.animationHandler.setRunnerCounterValue(),this.renderAxes(a,i),this.renderGaps(a,i)},i.prototype.renderAxes=function(e,t){this.renderXAxis(e,t),this.renderYAxis(e,t)},i.prototype.renderXAxis=function(e,a){var r,s,o,n=i.DefaultSettings.xAxis.color,l=i.DefaultSettings.xAxis.fontColor;this.data&&this.data.settings&&this.data.settings.xAxis&&(n=this.data.settings.xAxis.color,l=this.data.settings.xAxis.fontColor),r=this.rootSelection.selectAll(i.XAxisNode.selector),s=r.data(e.series),s.enter().insert("g","g."+i.LineContainer.class).classed(i.XAxisNode.class,!0),s.call(function(t){t.forEach(function(t,i){d3.select(t[0]).call(e.series[i].xAxisProperties.axis.orient("bottom"))})}),s.exit().remove(),o=s.selectAll(".tick").selectAll(".axisBox").data([[]]),o.enter().insert("rect","text").classed("axisBox",!0),o.style("display",this.data.settings.xAxis.position===g.Center?"inherit":"none").style("fill",this.data.settings.xAxis.backgroundColor);var c=this.data.settings.xAxis.position===g.Center?-11:0;o.attr({x:-(this.data.widthOfXAxisLabel/2),y:c+"px",width:this.data.widthOfXAxisLabel,height:i.XAxisTickHeight+"px"}),o.exit().remove(),s.style("stroke",this.data.settings.xAxis.position===g.Center?n:"none").style("display",this.data.settings.xAxis.show?"inherit":"none"),s.call(function(e){var t=e.datum().xAxisProperties.rotate,a=t?Math.abs(Math.sin(i.AxisTickRotateAngle*Math.PI/180)):0,r=c+3;e.selectAll("text").attr("transform",function(){return"translate(0, "+(r+9+$(this).width()/2*a)+") rotate("+(t?i.AxisTickRotateAngle:0)+")"}).style("fill",l).style("stroke","none").attr("dy",-9)}),s.selectAll(".domain").style("stroke",n),s.selectAll(".domain").forEach(function(e){$(e).insertBefore($(e).parent().children().first())});var u=this.size.height;switch(this.data.settings.xAxis.position){case g.Center:u/=2;break;case g.Bottom:}s.attr("transform",t.SVGUtil.translate(0,u))},i.prototype.renderYAxis=function(e,t){var a=e.yAxis,r=!1,s=i.DefaultSettings.yAxis.color,o=i.DefaultSettings.yAxis.fontColor;a.orient("right"),this.data&&this.data.settings&&this.data.settings.yAxis&&this.data.settings.yAxis.show&&(r=!0),this.data&&this.data.settings&&this.data.settings.yAxis&&this.data.settings.yAxis&&(s=this.data.settings.yAxis.color,o=this.data.settings.yAxis.fontColor),this.yAxis.call(a).attr("display",r?"inline":"none"),this.yAxis.selectAll(".domain, path, line").style("stroke",s),this.yAxis.selectAll("text").style("fill",o),this.yAxis.selectAll("g.tick line").attr("x1",-this.size.width)},i.prototype.renderChart=function(){var e=this.data,t=this.data.series,a=this.rootSelection=this.chart.selectAll(i.LineNode.selector).data(t),r=a.enter().append("g").classed(i.LineNode.class,!0);r.append("g").classed(i.LineContainer.class,!0),r.append("g").classed(i.TooltipContainer.class,!0),r.append("g").classed(i.DotsContainer.class,!0),this.animationHandler.isAnimated?this.showAnimationDot():this.hideAnimationDot(),this.drawTooltips(e,this.selectionManager.getSelectionIds()),this.drawDots(e),this.drawLines(e),a.exit().remove()},i.prototype.drawLinesStatic=function(e,t){var a=this,r=i.Line,s=i.LineContainer,o=this.rootSelection,n=o.filter(function(i,a){return!t||a<e}).select(s.selector).selectAll(r.selector).data(function(e){return[e]});n.enter().append("path").classed(r.class,!0),n.style({fill:"none",stroke:function(e){return e.color},"stroke-width":function(e){return e.width+"px"}}),n.attr("d",function(e){return a.lineX(e.data)}),n.exit().remove()},i.prototype.drawLinesStaticBeforeAnimation=function(e){var t=this,a=i.Line,r=i.LineContainer,s=this.rootSelection;this.animationSelection=s.filter(function(t,i){return i===e}).select(r.selector).selectAll(a.selector).data(function(e){return[e]}),this.animationSelection.enter().append("path").classed(a.class,!0),this.animationSelection.style({fill:"none",stroke:function(e){return e.color},"stroke-width":function(e){return e.width+"px"}}),this.animationSelection.attr("d",function(e){var i=t.animationHandler.flooredPosition.index;if(0===i)return t.moveAnimationDot(e.data[0]),t.lineX([]);var a=e.data.slice(0,i+1);return t.moveAnimationDot(a[a.length-1]),t.lineX(a)}),this.animationSelection.exit().remove()},i.prototype.moveAnimationDot=function(e){var t=this.data.xScale,i=this.data.yScales;this.animationDot.attr("cx",t(e.x)).attr("cy",i[e.groupIndex](e.y))},i.prototype.playAnimation=function(e){var t=this;void 0===e&&(e=0);var i=this.animationHandler.flooredPosition.index;this.showAnimationDot(),this.animationSelection.transition().delay(e).duration(this.animationDuration).ease("linear").attrTween("d",function(e,a){return t.getInterpolation(e.data,i)}).each("end",function(e){return t.handleSelection(t.animationHandler.flooredPosition)})},i.prototype.pauseAnimation=function(){this.animationSelection&&(this.hideAnimationDot(),this.animationSelection.selectAll("path").transition(),this.animationSelection.transition().duration(0).delay(0))},i.prototype.stopAnimation=function(){this.pauseAnimation(),d3.timer.flush()},i.prototype.findNextPoint=function(e){for(var t=e.series;t<this.data.series.length;t++)for(var i=this.data.series[t],a=t===e.series?Math.floor(e.index+1):0;a<i.data.length;a++)if(i.data[a]&&i.data[a].popupInfo)return{series:t,index:a};return null},i.prototype.findPrevPoint=function(e){for(var t=e.series;t>=0;t--)for(var i=this.data.series[t],a=t===e.series?Math.ceil(e.index-1):i.data.length;a>=0;a--)if(i.data[a]&&i.data[a].popupInfo)return{series:t,index:a};return null},i.prototype.isAnimationSeriesAndIndexLast=function(e){return this.isAnimationSeriesLast(e)&&this.isAnimationIndexLast(e)},i.prototype.isAnimationSeriesLast=function(e){return e.series>=this.data.series.length-1},i.prototype.isAnimationIndexLast=function(e){var t=this.data.series[e.series];return e.index>=t.data.length-1},i.prototype.drawLines=function(e){var t=this.animationHandler.position.series,i=this.animationHandler.isAnimated;this.drawLinesStatic(t,i),i&&this.drawLinesStaticBeforeAnimation(t)},i.prototype.showAnimationDot=function(){if(this.animationHandler.isPlaying){var e=i.DefaultSettings.dots.size;this.data&&this.data.settings&&this.data.settings.dots&&this.data.settings.dots.size&&(e=this.data.settings.dots.size),this.animationDot.attr("display","inline").attr("fill",this.data.settings.dots.color).style("opacity",this.dotOpacity).attr("r",e)}},i.prototype.hideAnimationDot=function(){this.animationDot.attr("display","none")},i.prototype.getInterpolation=function(e,t){var i=this;if(this.data){var a=this.data.xScale,r=this.data.yScales,s=t+1;this.showAnimationDot();var o=d3.svg.line().x(function(e){return e.x}).y(function(e){return e.y}).interpolate("linear"),n=e.slice(0,t+1).map(function(e){return{x:a(e.x),y:r[e.groupIndex](e.y)}}),l=a(e[t].x),c=a(e[s].x),u=r[e[t].groupIndex](e[t].y),h=r[e[s].groupIndex](e[s].y),p=d3.scale.linear().domain([0,1]).range([t,s]),d=d3.scale.linear().domain([0,1]).range([l,c]),g=d3.scale.linear().domain([0,1]).range([u,h]);return this.animationHandler.setRunnerCounterValue(t),function(e){if(!i.animationHandler.isPlaying)return o(n);var t=d(e),a=g(e);return i.animationDot.attr("cx",t).attr("cy",a),n.push({x:t,y:a}),i.animationHandler.position.index=p(e),o(n)}}},i.prototype.clearSelection=function(){this.data&&this.data.hasHighlights||!this.selectionManager.hasSelection()?this.selectionManager.selectedIds=[]:this.selectionManager.clear(),this.chart.selectAll(i.Tooltip.selector).remove()},i.prototype.handleSelection=function(e){var t=this;if(this.data){var i=this.animationHandler.animationPlayingIndex,a=this.data.series[e.series].data[e.index],r=this.animationHandler.isPlaying&&this.isAnimationSeriesAndIndexLast(e);if((!a||!a.popupInfo)&&this.animationHandler.isPlaying)return void(r?setTimeout(function(){return t.animationHandler.toEnd()},0):this.animationHandler.play(0,!0));r?setTimeout(function(){return t.animationHandler.toEnd()},0):this.animationHandler.pause(),this.selectionManager.select(a.identity).then(function(e){t.setSelection(e),clearTimeout(t.handleSelectionTimeout),t.handleSelectionTimeout=setTimeout(function(){t.animationHandler.animationPlayingIndex===i&&((r||t.animationHandler.isPaused)&&t.clearSelection(),!r&&t.animationHandler.isPaused&&t.animationHandler.play())},t.pauseDuration)})}},Object.defineProperty(i.prototype,"animationDuration",{get:function(){return 1e3/(this.data&&this.data.settings&&this.data.settings.playback?this.data.settings.playback.playSpeed:i.DefaultSettings.playback.playSpeed)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"pauseDuration",{get:function(){return 1e3*(this.data&&this.data.settings&&this.data.settings.playback?this.data.settings.playback.pauseDuration:i.DefaultSettings.playback.pauseDuration)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"dotOpacity",{get:function(){return 1-(this.data&&this.data.settings&&this.data.settings.dots?this.data.settings.dots.transparency:i.DefaultSettings.dots.transparency)/100},enumerable:!0,configurable:!0}),i.prototype.drawDots=function(e){var t=this;if(e&&e.xScale){var a=e.xScale,r=e.yScales,s=i.Dot,o=i.DotsContainer,n=this.rootSelection,l=this.data.settings.dots.color,c=this.data.settings.dots.size,u=this.animationHandler.isAnimated,h=this.animationHandler.position,p=n.filter(function(e,t){return!u||t<=h.series}).select(o.selector).selectAll(s.selector).data(function(e,t){return _.filter(e.data,function(e,i){return!(u&&t===h.series&&i>h.index)&&!!e.popupInfo})});p.enter().append("circle").classed(s.class,!0),p.attr("cx",function(e){return a(e.categoryValue)}).attr("cy",function(e){return r[e.groupIndex](e.y)}).attr("r",function(e){return e.eventSize||c}).style("fill",l).style("opacity",this.dotOpacity).style("cursor","pointer").call(i.AddOnTouchClick,function(e){d3.event.stopPropagation(),t.selectionManager.select(e.identity,d3.event.ctrlKey).then(function(e){return t.setSelection(e)})}),p.exit().remove()}},i.prototype.renderGaps=function(e,a){var r,s,o,n,l=e.series,c=e.isScalar,u=e.xScale;r=[{left:-4.5,top:-5,height:10,width:3},{left:1.5,top:-5,height:10,width:3}],s=this.gaps.selectAll(i.Gap.selector).data(l.slice(0,l.length-1)),o=s.enter().append("g"),s.attr("transform",function(e,i){var a,r=e.widthOfGap/2,s=e.data[e.data.length-1].categoryValue;return a=u(c?r+s:new Date(r+s.getTime())),t.SVGUtil.translate(a,0)}),n=s.selectAll(i.GapNode.selector).data(r),n.enter().append("rect").attr({x:function(e){return e.left},y:function(e){return e.top},height:function(e){return e.height},width:function(e){return e.width}}).classed(i.GapNode.class,!0),o.classed(i.Gap.class,!0),s.exit().remove(),n.exit().remove()},i.prototype.setSelection=function(e){this.data&&(this.drawDots(this.data),this.drawTooltips(this.data,e))},i.prototype.isPopupShow=function(e,t){return!(!this.popupHeight||!e.popupInfo)&&(!!t&&s.containsSelection(t,e.identity))},i.prototype.drawTooltips=function(e,a){var r=this,s=e.xScale,o=e.yScales,n=i.Tooltip,c=i.TooltipContainer,u=this.rootSelection,h=d3.svg.line().x(function(e){return e.x}).y(function(e){return e.y}),p=i.DefaultTooltipSettings.marginTop,d=this.data.settings.popup.width,g=this.data.settings.popup.height,m=20,f=function(e,t){return r.isHigherMiddle(e,t)?-1*p+m:r.size.height+p},y=u.select(c.selector).selectAll(n.selector).data(function(e){return _.filter(e.data,function(e){return r.isPopupShow(e,a)})});y.enter().append("g").classed(n.class,!0),y.attr("transform",function(e){var i=s(e.x)-d/2,a=f(e.y,e.groupIndex);return e.popupInfo.offsetX=Math.min(r.viewport.width-r.margin.right-d,Math.max(-r.margin.left,i))-i,t.SVGUtil.translate(i+e.popupInfo.offsetX,a)});var v=y.selectAll(i.TooltipRect.selector).data(function(e){return[e]});v.enter().append("path").classed(i.TooltipRect.class,!0),v.attr("display",function(e){return e.popupInfo?"inherit":"none"}).style("fill",this.data.settings.popup.color).attr("d",function(e){var t=[{x:-2,y:r.isHigherMiddle(e.y,e.groupIndex)?-1*p:0},{x:-2,y:r.isHigherMiddle(e.y,e.groupIndex)?-1*(p+g):g},{x:d-2,y:r.isHigherMiddle(e.y,e.groupIndex)?-1*(p+g):g},{x:d-2,y:r.isHigherMiddle(e.y,e.groupIndex)?-1*p:0}];return h(t)});var x=y.selectAll(i.TooltipTriangle.selector).data(function(e){return[e]});x.enter().append("path").classed(i.TooltipTriangle.class,!0),x.style("fill",this.data.settings.popup.color).attr("d",function(e){var t=[{x:d/2-5-e.popupInfo.offsetX,y:r.isHigherMiddle(e.y,e.groupIndex)?-1*p:0},{x:d/2-e.popupInfo.offsetX,y:r.isHigherMiddle(e.y,e.groupIndex)?-1*(p-5):-5},{x:d/2+5-e.popupInfo.offsetX,y:r.isHigherMiddle(e.y,e.groupIndex)?-1*p:0}];return h(t)}).style("stroke-width","1px");var b=y.selectAll(i.TooltipLine.selector).data(function(e){return[e]});b.enter().append("path").classed(i.TooltipLine.class,!0),b.style("fill",this.data.settings.popup.color).style("stroke",this.data.settings.popup.color).style("stroke-width","1px").attr("d",function(e){var t=[{x:d/2-e.popupInfo.offsetX,y:r.isHigherMiddle(e.y,e.groupIndex)?o[e.groupIndex](e.y)+f(e.y,e.groupIndex)-e.eventSize:o[e.groupIndex](e.y)-f(e.y,e.groupIndex)+e.eventSize},{x:d/2-e.popupInfo.offsetX,y:r.isHigherMiddle(e.y,e.groupIndex)?-1*p:0}];return h(t)});var S=this.data.settings.popup.showTime,w=this.data.settings.popup.showTitle,C=y.selectAll(i.TooltipTimeRect.selector).data(function(e){return[e]}),P={display:S?void 0:"none"};C.enter().append("path").classed(i.TooltipTimeRect.class,!0),C.style("fill",this.data.settings.popup.timeFill).style(P).attr("d",function(e){var t=[{x:d-r.data.widthOfTooltipValueLabel-2,y:r.isHigherMiddle(e.y,e.groupIndex)?-1*(p+g):0},{x:d-r.data.widthOfTooltipValueLabel-2,y:r.isHigherMiddle(e.y,e.groupIndex)?-1*(p+g-i.DefaultTooltipSettings.timeHeight):i.DefaultTooltipSettings.timeHeight},{x:d-2,y:r.isHigherMiddle(e.y,e.groupIndex)?-1*(p+g-i.DefaultTooltipSettings.timeHeight):i.DefaultTooltipSettings.timeHeight},{x:d-2,y:r.isHigherMiddle(e.y,e.groupIndex)?-1*(p+g):0}];return h(t)});var A=y.selectAll(i.TooltipTime.selector).data(function(e){return[e]});A.enter().append("text").classed(i.TooltipTime.class,!0),A.style(i.ConvertTextPropertiesToStyle(i.GetPopupValueTextProperties())).style(P).style("fill",this.data.settings.popup.timeColor).attr("x",function(e){return d-r.data.widthOfTooltipValueLabel}).attr("y",function(e){return r.isHigherMiddle(e.y,e.groupIndex)?-1*(p+g-i.DefaultTooltipSettings.timeHeight+3):i.DefaultTooltipSettings.timeHeight-3}).text(function(e){return e.popupInfo.value});var T={display:w?void 0:"none"},D=y.selectAll(i.TooltipTitle.selector).data(function(e){return[e]});D.enter().append("text").classed(i.TooltipTitle.class,!0),D.style(T).style(i.ConvertTextPropertiesToStyle(i.GetPopupTitleTextProperties())).style("fill",this.data.settings.popup.fontColor).attr("x",function(e){return i.PopupTextPadding}).attr("y",function(e){return(r.isHigherMiddle(e.y,e.groupIndex)?-1*(p+g-12):12)+i.PopupTextPadding}).text(function(e){if(!e.popupInfo)return"";var t=d-2*i.PopupTextPadding-(S?r.data.widthOfTooltipValueLabel-i.PopupTextPadding:0)-10;return l.getTailoredTextOrDefault(i.GetPopupTitleTextProperties(e.popupInfo.title),t)});var V=function(e){var t=i.PopupTextPadding+r.data.settings.popup.fontSize,a=t+i.DefaultTooltipSettings.timeHeight;return e.popupInfo&&(t=w&&e.popupInfo.title||S&&e.popupInfo.value?a:t),{y:r.isHigherMiddle(e.y,e.groupIndex)?-1*(p+g-t):t,x:i.PopupTextPadding,width:d-2*i.PopupTextPadding,height:g-t}},N=y.selectAll(i.TooltipDescription.selector).data(function(e){return[e]});N.enter().append("text").classed(i.TooltipDescription.class,!0),N.style(i.ConvertTextPropertiesToStyle(i.GetPopupDescriptionTextProperties(null,this.data.settings.popup.fontSize))).style("fill",this.data.settings.popup.fontColor).text(function(e){return e.popupInfo&&e.popupInfo.description}).attr("y",function(e){var t=V(e),i=d3.select(this)[0][0];return l.wordBreak(i,t.width,t.height),0}).attr("transform",function(e){var i=V(e);return t.SVGUtil.translate(0,i.y)}),N.selectAll("tspan").attr("x",i.PopupTextPadding),y.exit().remove()},i.prototype.isHigherMiddle=function(e,t){if(this.data.settings.popup.alwaysOnTop)return!0;if(this.data.yScales.length>1)return 0===t;var i=this.data.commonYScale.domain(),a=d3.min(i),r=Math.abs((d3.max(i)-a)/2);return r=0===r?r:a+r,e>=r},i.getObjectsFromDataView=function(e){return e&&e.metadata&&e.metadata.columns&&e.metadata.objects?e.metadata.objects:null},i.parseSettings=function(e,t,a){var r={},s=i.getObjectsFromDataView(e);return r.xAxis=this.getAxisXSettings(s,t),r.yAxis=this.getAxisYSettings(s,t),r.popup=this.getPopupSettings(s,t),r.dots=this.getDotsSettings(s,t),r.series=this.getSeriesSettings(s,t),r.gaps=this.getGapsSettings(s),r.playback=this.getPlaybackSettings(s,t),r.runnerCounter=this.getRunnerCounterSettings(s,t,a),r},i.getPopupSettings=function(a,r){var s=e.DataViewObjects.getValue(a,i.Properties.popup.show,i.DefaultSettings.popup.show),o=e.DataViewObjects.getValue(a,i.Properties.popup.alwaysOnTop,i.DefaultSettings.popup.alwaysOnTop),n=Math.max(i.PopupMinWidth,Math.min(i.PopupMaxWidth,e.DataViewObjects.getValue(a,i.Properties.popup.width,i.DefaultSettings.popup.width))),l=Math.max(i.PopupMinHeight,Math.min(i.PopupMaxHeight,e.DataViewObjects.getValue(a,i.Properties.popup.height,i.DefaultSettings.popup.height))),c=new t.ColorHelper(r,i.Properties.popup.color,i.DefaultSettings.popup.color),u=c.getColorForMeasure(a,""),h=parseInt(e.DataViewObjects.getValue(a,i.Properties.popup.fontSize,i.DefaultSettings.popup.fontSize),10),p=new t.ColorHelper(r,i.Properties.popup.fontColor,i.DefaultSettings.popup.fontColor),d=p.getColorForMeasure(a,""),g=e.DataViewObjects.getValue(a,i.Properties.popup.showTime,i.DefaultSettings.popup.showTime),m=e.DataViewObjects.getValue(a,i.Properties.popup.showTitle,i.DefaultSettings.popup.showTitle),f=new t.ColorHelper(r,i.Properties.popup.timeColor,i.DefaultSettings.popup.timeColor),y=f.getColorForMeasure(a,""),v=new t.ColorHelper(r,i.Properties.popup.timeFill,i.DefaultSettings.popup.timeFill),x=v.getColorForMeasure(a,"");return{show:s,alwaysOnTop:o,width:n,height:l,color:u,fontSize:h,fontColor:d,showTime:g,showTitle:m,timeColor:y,timeFill:x}},i.getDotsSettings=function(a,r){var s=i.Properties.dots,o=i.DefaultSettings.dots,n=new t.ColorHelper(r,s.color,o.color),l=n.getColorForMeasure(a,""),c=Math.max(0,Math.min(9999,e.DataViewObjects.getValue(a,s.minSize,o.minSize))),u=Math.max(c,Math.min(9999,e.DataViewObjects.getValue(a,s.maxSize,o.maxSize))),h=Math.max(c,Math.min(u,e.DataViewObjects.getValue(a,s.size,o.size))),p=Math.max(0,Math.min(100,e.DataViewObjects.getValue(a,s.transparency,o.transparency)));return{color:l,size:h,minSize:c,maxSize:u,transparency:p}},i.getSeriesSettings=function(a,r){var s=Math.max(1,Math.min(100,e.DataViewObjects.getValue(a,i.Properties.series.width,i.DefaultSettings.series.width))),o=new t.ColorHelper(r,i.Properties.series.fill,i.DefaultSettings.series.fill),n=o.getColorForMeasure(a,"");return{width:s,fill:n}},i.getGapsSettings=function(t){var a=e.DataViewObjects.getValue(t,i.Properties.gaps.show,i.DefaultSettings.gaps.show),r=Math.max(1,Math.min(100,e.DataViewObjects.getValue(t,i.Properties.gaps.transparency,i.DefaultSettings.gaps.visibleGapsPercentage)));return{show:a,visibleGapsPercentage:r}},i.getAxisXSettings=function(a,r){var s=i.Properties.xAxis,o=i.DefaultSettings.xAxis,n=new t.ColorHelper(r,s.color,o.color).getColorForMeasure(a,""),l=new t.ColorHelper(r,s.fontColor,o.fontColor).getColorForMeasure(a,""),c=e.DataViewObjects.getValue(a,s.show,o.show),u=e.DataViewObjects.getValue(a,s.position,o.position),h=new t.ColorHelper(r,s.backgroundColor,o.backgroundColor).getColorForMeasure(a,"");return{show:c,position:u,color:n,fontColor:l,backgroundColor:h}},i.getAxisYSettings=function(a,r){var s=i.Properties.yAxis,o=i.DefaultSettings.yAxis,n=new t.ColorHelper(r,s.color,o.color),l=n.getColorForMeasure(a,""),c=new t.ColorHelper(r,s.fontColor,o.fontColor),u=c.getColorForMeasure(a,""),h=e.DataViewObjects.getValue(a,s.show,o.show);return{color:l,fontColor:u,show:h}},i.getPlaybackSettings=function(a,r){var s={},o=i.Properties.playback,n=i.DefaultSettings.playback;s.autoplay=e.DataViewObjects.getValue(a,o.autoplay,n.autoplay),s.playSpeed=Math.max(1,Math.min(99999,e.DataViewObjects.getValue(a,o.playSpeed,n.playSpeed))),s.pauseDuration=Math.max(0,Math.min(9999,e.DataViewObjects.getValue(a,o.pauseDuration,n.pauseDuration))),s.autoplayPauseDuration=Math.max(1,Math.min(9999,e.DataViewObjects.getValue(a,o.autoplayPauseDuration,n.autoplayPauseDuration)));var l=new t.ColorHelper(r,o.color,n.color);s.color=l.getColorForMeasure(a,"");var c=e.DataViewObjects.getValue(a,o.position,"");if(c.length>3)try{s.position=JSON.parse(c)}catch(e){}return s.position=s.position||n.position,s},i.getRunnerCounterSettings=function(a,r,s){var o=e.DataViewObjects.getValue(a,i.Properties.runnerCounter.show,i.DefaultSettings.runnerCounter.show),n=e.DataViewObjects.getValue(a,i.Properties.runnerCounter.label,s.RunnerCounter&&s.RunnerCounter.source&&s.RunnerCounter.source.displayName||i.DefaultSettings.runnerCounter.label),l=e.DataViewObjects.getValue(a,i.Properties.runnerCounter.position,i.DefaultSettings.runnerCounter.position),c=parseInt(e.DataViewObjects.getValue(a,i.Properties.runnerCounter.fontSize,i.DefaultSettings.runnerCounter.fontSize),10),u=new t.ColorHelper(r,i.Properties.runnerCounter.fontColor,i.DefaultSettings.runnerCounter.fontColor).getColorForMeasure(a,"");return{show:o,label:n,position:l,fontSize:c,fontColor:u}},i.prototype.clearAll=function(e){this.gaps.selectAll(i.Gap.selector).remove(),this.animationHandler&&(this.animationHandler.reset(),this.animationHandler.clear()),e&&this.svg.style("display","none"),this.clearChart()},i.prototype.clearChart=function(){this.clearSelection(),this.hideAnimationDot(),this.chart.selectAll(i.Line.selector).remove(),this.chart.selectAll(i.Dot.selector).remove()},i.prototype.clearRedundant=function(e){var t=this;if(this.data){var a=this.chart.selectAll(i.Tooltip.selector).filter(function(i){return i.seriesIndex<e.series||i.seriesIndex===e.series&&t.data.series[i.seriesIndex].data[e.index].value>=i.value}),r=a.data().map(function(e){return e.identity});if(this.clearSelection(),r.length){var s=r.map(function(e){return t.selectionManager.select(e,!0)});$.when.apply(null,s).then(function(e){return t.setSelection(e)})}this.chart.selectAll(i.Line.selector).remove(),this.chart.selectAll(i.Dot.selector).remove()}},i.prototype.enumerateObjectInstances=function(e){var i=new t.ObjectEnumerationBuilder;switch(e.objectName){case"general":this.readGeneralInstance(i);break;case"popup":this.readPopupInstance(i);break;case"dots":this.readDotsInstance(i);break;case"xAxis":this.xAxisInstance(i);break;case"yAxis":this.yAxisInstance(i);break;case"series":this.readSeriesInstance(i);break;case"gaps":this.readGapsInstance(i);break;case"playback":this.readPlaybackInstance(i);break;case"runnerCounter":this.readRunnerCounterInstance(i)}return i.complete()},i.prototype.getSettings=function(e){return this.data&&this.data.settings&&this.data.settings[e]?this.data.settings[e]:i.DefaultSettings[e]},i.prototype.readGeneralInstance=function(e){var t={objectName:"general",displayName:"general",selector:null,properties:{}};e.pushInstance(t)},i.prototype.readPopupInstance=function(e){var t=this.getSettings("popup"),i={objectName:"popup",displayName:"popup",selector:null,properties:{show:t.show,alwaysOnTop:t.alwaysOnTop,width:t.width,height:t.height,color:t.color,fontColor:t.fontColor,fontSize:t.fontSize,showTime:t.showTime,showTitle:t.showTitle,timeColor:t.timeColor,timeFill:t.timeFill}};e.pushInstance(i)},i.prototype.readDotsInstance=function(e){var t=this.getSettings("dots"),i={objectName:"dots",displayName:"Dots",selector:null,properties:{color:t.color,size:t.size,minSize:t.minSize,maxSize:t.maxSize,transparency:t.transparency}};e.pushInstance(i)},i.prototype.xAxisInstance=function(e){var t=this.getSettings("xAxis");e.pushInstance({objectName:"xAxis",displayName:"xAxis",selector:null,properties:{show:t.show,position:t.position,color:t.color,fontColor:t.fontColor,backgroundColor:t.backgroundColor}})},i.prototype.yAxisInstance=function(e){var t=this.getSettings("yAxis");e.pushInstance({objectName:"yAxis",displayName:"yAxis",selector:null,properties:{color:t.color,fontColor:t.fontColor,show:t.show}})},i.prototype.readSeriesInstance=function(e){var t=this.getSettings("series"),i={objectName:"series",displayName:"series",selector:null,properties:{fill:t.fill,width:t.width}};e.pushInstance(i)},i.prototype.readGapsInstance=function(e){var t=this.getSettings("gaps"),i={objectName:"gaps",selector:null,properties:{show:t.show,transparency:t.visibleGapsPercentage}};e.pushInstance(i)},i.prototype.readPlaybackInstance=function(e){var t=this.getSettings("playback");e.pushInstance({objectName:"playback",displayName:"playback",selector:null,properties:{autoplay:t.autoplay,playSpeed:t.playSpeed,pauseDuration:t.pauseDuration,autoplayPauseDuration:t.autoplayPauseDuration,color:t.color}})},i.prototype.readRunnerCounterInstance=function(e){var t=this.getSettings("runnerCounter"),i={objectName:"runnerCounter",selector:null,properties:{}};this.data&&this.data.columns&&this.data.columns.RunnerCounter&&(i.properties={show:t.show,label:t.label,position:t.position,fontSize:t.fontSize,fontColor:t.fontColor}),e.pushInstance(i)},i.prototype.destroy=function(){this.data=null,this.clearAll(!0)},i.RoleDisplayNames={Timestamp:"Timestamp",Category:"Category",Value:"Value",EventTitle:"Event Title",EventDescription:"Event Description",EventSize:"Event Size",RunnerCounter:"Runner Counter"},i.RoleNames=_.mapValues(i.RoleDisplayNames,function(e,t){return t}),i.capabilities={dataRoles:[{displayName:i.RoleDisplayNames.Timestamp,name:i.RoleNames.Timestamp,kind:e.VisualDataRoleKind.Grouping},{displayName:i.RoleDisplayNames.Value,name:i.RoleNames.Value,kind:e.VisualDataRoleKind.Measure},{displayName:i.RoleDisplayNames.EventTitle,name:i.RoleNames.EventTitle,kind:e.VisualDataRoleKind.GroupingOrMeasure},{displayName:i.RoleDisplayNames.EventDescription,name:i.RoleNames.EventDescription,kind:e.VisualDataRoleKind.GroupingOrMeasure},{displayName:i.RoleDisplayNames.EventSize,name:i.RoleNames.EventSize,kind:e.VisualDataRoleKind.GroupingOrMeasure},{displayName:i.RoleDisplayNames.RunnerCounter,name:i.RoleNames.RunnerCounter,kind:e.VisualDataRoleKind.GroupingOrMeasure}],dataViewMappings:[{conditions:[{Timestamp:{max:1},Value:{max:1},Category:{max:1},EventTitle:{max:1},EventDescription:{max:1},EventSize:{max:1},RunnerCounter:{max:1}}],categorical:{categories:{for:{in:i.RoleNames.Timestamp},dataReductionAlgorithm:{top:{count:1e4}}},values:{group:{by:i.RoleNames.Category,select:[{bind:{to:i.RoleNames.Value}},{bind:{to:i.RoleNames.EventTitle}},{bind:{to:i.RoleNames.EventDescription}},{bind:{to:i.RoleNames.EventSize}},{bind:{to:i.RoleNames.RunnerCounter}}],dataReductionAlgorithm:{top:{}}}}}}],objects:{series:{displayName:"Series",description:"Series",properties:{fill:{displayName:"Fill",type:{fill:{solid:{color:!0}}}},width:{displayName:"Width",type:{numeric:!0}}}},gaps:{displayName:"Gaps",description:"Gaps",properties:{show:{displayName:"Show",type:{bool:!0}},transparency:{displayName:"Visible gaps",type:{numeric:!0}}}},general:{displayName:"General",properties:{formatString:{type:{formatting:{formatString:!0}}},fill:{displayName:"Background color",type:{fill:{solid:{color:!0}}}}}},popup:{displayName:"Popup",properties:{show:{displayName:"Show",type:{bool:!0}},alwaysOnTop:{displayName:"Always on top",type:{bool:!0}},width:{displayName:"Width",type:{numeric:!0}},height:{displayName:"Height",type:{numeric:!0}},color:{displayName:"Fill",type:{fill:{solid:{color:!0}}}},fontSize:{displayName:"Text size",type:{formatting:{fontSize:!0}}},fontColor:{displayName:"Text color",type:{fill:{solid:{color:!0}}}},showTime:{displayName:"Show time",type:{bool:!0}},showTitle:{displayName:"Show title",type:{bool:!0}},timeColor:{displayName:"Time color",type:{fill:{solid:{color:!0}}}},timeFill:{displayName:"Time fill",type:{fill:{solid:{color:!0}}}}}},dots:{displayName:"Dots",properties:{color:{displayName:"Fill",type:{fill:{solid:{color:!0}}}},minSize:{displayName:"Min Size",type:{numeric:!0}},maxSize:{displayName:"Max Size",type:{numeric:!0}},size:{displayName:"Default Size",type:{numeric:!0}},transparency:{displayName:"Transparency",type:{numeric:!0}}}},xAxis:{displayName:"X Axis",properties:{show:{displayName:"Show",type:{bool:!0}},position:{displayName:"Position",type:{enumeration:r(g)}},fontColor:{displayName:"Font Color",type:{fill:{solid:{color:!0}}}},color:{displayName:"Axis Color",type:{fill:{solid:{color:!0}}}},backgroundColor:{displayName:"Background Color",type:{fill:{solid:{color:!0}}}}}},yAxis:{displayName:"Y Axis",properties:{show:{displayName:"Show",type:{bool:!0}},fontColor:{displayName:"Font Color",type:{fill:{solid:{color:!0}}}},color:{displayName:"Axis Color",type:{fill:{solid:{color:!0}}}}}},playback:{displayName:"Playback",properties:{autoplay:{displayName:"Autoplay",type:{bool:!0}},playSpeed:{displayName:"Speed (dots/sec)",type:{numeric:!0}},pauseDuration:{displayName:"Pause Duration",type:{numeric:!0}},autoplayPauseDuration:{displayName:"Start Delay",type:{numeric:!0}},color:{displayName:"Buttons Color",type:{fill:{solid:{color:!0}}}},position:{displayName:"Position",type:{text:!0}}}},runnerCounter:{displayName:"Runner Counter",properties:{show:{displayName:"Show",type:{bool:!0}},label:{displayName:"Label",type:{text:!0}},position:{displayName:"Position",type:{enumeration:r(m)}},fontSize:{displayName:"Text Size",type:{formatting:{fontSize:!0}}},fontColor:{displayName:"Font Color",type:{fill:{solid:{color:!0}}}}}}},sorting:{implicit:{clauses:[{role:i.RoleNames.Timestamp,direction:1}]}},supportsHighlight:!0},i.Properties=i.getProperties(i.capabilities),i.DefaultMargin={top:20,bottom:20,right:25,left:25},i.DefaultViewport={width:50,height:50},i.PlaybackButtonsHeight=26,i.PopupMinHeight=20,i.PopupMinWidth=20,i.PopupMaxHeight=200,i.PopupMaxWidth=2e3,i.MaxWidthOfYAxis=50,i.PopupTextPadding=3,i.XAxisTickSpace=15,i.XAxisTickHeight=16,i.MinimumTicksToRotate=3,i.AxisTickRotateAngle=-35,i.DefaultSettings={precision:0,popup:{show:!0,alwaysOnTop:!1,width:100,height:80,color:"#808181",fontSize:10,fontColor:"white",showTime:!0,showTitle:!0,timeColor:"white",timeFill:"#010101"},dots:{color:"#808181",size:5,minSize:5,maxSize:20,transparency:25},gaps:{show:!1,visibleGapsPercentage:1},series:{fill:"#3779B7",width:2},xAxis:{color:"#777777",fontColor:"#777777",position:g.Center,show:!0,dateFormat:d.TimeOnly,backgroundColor:"#E1F2F7"},yAxis:{color:"#777777",fontColor:"#777777",show:!0},playback:{autoplay:!1,playSpeed:5,pauseDuration:10,autoplayPauseDuration:0,color:"#777",position:null},runnerCounter:{show:!0,label:"",position:m.TopRight,fontSize:13,fontColor:"#777777"},formatStringProperty:i.Properties.general.formatString},i.DefaultTooltipSettings={dataPointColor:"#808181",marginTop:20,timeHeight:15},i.MaxGapCount=100,i.MinGapWidth=_.object([[d.DateOnly,144e4],[d.TimeOnly,6e4]],void 0),i.Chart=n("chart"),i.Line=n("line"),i.LineContainer=n("lineContainer"),i.LineNode=n("lineNode"),i.XAxisNode=n("xAxisNode"),i.Dot=n("dot"),i.DotsContainer=n("dotsContainer"),i.Tooltip=n("Tooltip"),i.TooltipRect=n("tooltipRect"),i.TooltipTriangle=n("tooltipTriangle"),i.Gaps=n("gaps"),i.Gap=n("gap"),i.GapNode=n("gapNode"),i.TooltipLine=n("tooltipLine"),i.TooltipTime=n("tooltipTime"),i.TooltipTimeRect=n("tooltipTimeRect"),i.TooltipTitle=n("tooltipTitle"),i.TooltipDescription=n("tooltipDescription"),i.TooltipContainer=n("tooltipContainer"),i.AnimationDot=n("animationDot"),i}();i.PulseChart=f;var y;!function(e){e[e.Ready=0]="Ready",e[e.Play=1]="Play",e[e.Paused=2]="Paused",e[e.Stopped=3]="Stopped"}(y||(y={}));var v=function(){function e(t,i){var a=this;this.animationPlayingIndex=0,this.runnerCounterTopLeftPosition=180,this.isAutoPlayed=!1,this.isPositionWasSaved=!1,this.chart=t,this.svg=i,this.setDefaultValues();var r=this.container=this.svg.append("g");
this.animationPlay=r.append("g").classed(e.AnimationPlay.class,!0),this.animationPlay.append("circle").attr("cx",12).attr("cy",12).attr("r",10).attr("fill","transparent"),this.animationPlay.call(f.AddOnTouchClick,function(){return a.play()}),this.animationPlay.append("path").attr("d","M12 2c5.514 0 10 4.486 10 10s-4.486 10-10 10-10-4.486-10-10 4.486-10 10-10zm0-2c-6.627 0-12 5.373-12 12s5.373 12 12 12 12-5.373 12-12-5.373-12-12-12zm-3 17v-10l9 5.146-9 4.854z"),this.animationPause=r.append("g").classed(e.AnimationPause.class,!0),this.animationPause.append("circle").attr("cx",12).attr("cy",12).attr("r",10).attr("fill","transparent"),this.animationPause.call(f.AddOnTouchClick,function(){return a.stop()}),this.animationPause.append("path").attr("d","M12 2c5.514 0 10 4.486 10 10s-4.486 10-10 10-10-4.486-10-10 4.486-10 10-10zm0-2c-6.627 0-12 5.373-12 12s5.373 12 12 12 12-5.373 12-12-5.373-12-12-12zm-1 17h-3v-10h3v10zm5-10h-3v10h3v-10z"),this.animationReset=r.append("g").classed(e.AnimationReset.class,!0),this.animationReset.append("circle").attr("cx",12).attr("cy",12).attr("r",10).attr("fill","transparent"),this.animationReset.call(f.AddOnTouchClick,function(){return a.reset()}),this.animationReset.append("path").attr("d","M22 12c0 5.514-4.486 10-10 10s-10-4.486-10-10 4.486-10 10-10 10 4.486 10 10zm-22 0c0 6.627 5.373 12 12 12s12-5.373 12-12-5.373-12-12-12-12 5.373-12 12zm13 0l5-4v8l-5-4zm-5 0l5-4v8l-5-4zm-2 4h2v-8h-2v8z"),this.animationPrev=r.append("g").classed(e.AnimationPrev.class,!0),this.animationPrev.append("circle").attr("cx",12).attr("cy",12).attr("r",10).attr("fill","transparent"),this.animationPrev.call(f.AddOnTouchClick,function(){return a.prev()}),this.animationPrev.append("path").attr("d","M9.5 12l7.5-4.5v9l-7.5-4.5zm-4.5 0l6.5 4v-1.634l-3.943-2.366 3.943-2.366v-1.634l-6.5 4zm17 0c0 5.514-4.486 10-10 10s-10-4.486-10-10 4.486-10 10-10 10 4.486 10 10zm-22 0c0 6.627 5.373 12 12 12s12-5.373 12-12-5.373-12-12-12-12 5.373-12 12z"),this.animationNext=r.append("g").classed(e.AnimationNext.class,!0),this.animationNext.append("circle").attr("cx",12).attr("cy",12).attr("r",10).attr("fill","transparent"),this.animationNext.call(f.AddOnTouchClick,function(){return a.next()}),this.animationNext.append("path").attr("d","M7 16.5v-9l7.5 4.5-7.5 4.5zm5.5-8.5v1.634l3.943 2.366-3.943 2.366v1.634l6.5-4-6.5-4zm-.5-6c5.514 0 10 4.486 10 10s-4.486 10-10 10-10-4.486-10-10 4.486-10 10-10zm0-2c-6.627 0-12 5.373-12 12s5.373 12 12 12 12-5.373 12-12-5.373-12-12-12z").attr("rotate",180),this.animationToEnd=r.append("g").classed(e.AnimationToEnd.class,!0),this.animationToEnd.append("circle").attr("cx",12).attr("cy",12).attr("r",10).attr("fill","transparent"),this.animationToEnd.call(f.AddOnTouchClick,function(){return a.toEnd()}),this.animationToEnd.append("path").attr("d","M12 2c5.514 0 10 4.486 10 10s-4.486 10-10 10-10-4.486-10-10 4.486-10 10-10zm0-2c-6.627 0-12 5.373-12 12s5.373 12 12 12 12-5.373 12-12-5.373-12-12-12zm-6 16v-8l5 4-5 4zm5 0v-8l5 4-5 4zm7-8h-2v8h2v-8z"),this.runnerCounter=r.append("g").classed(e.RunnerCounter.class,!0),this.runnerCounterText=this.runnerCounter.append("text"),this.setControlsColor(e.DefaultControlsColor)}return Object.defineProperty(e,"AnimationMinPosition",{get:function(){return{series:0,index:0}},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"runnerCounterPosition",{get:function(){return this.chart.data.settings.runnerCounter.position},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"maxTextWidthOfRunnerCounterValue",{get:function(){var e=this.runnerCounterPosition===m.TopLeft||this.runnerCounterPosition===m.TopRight;return this.chart.viewport.width-(e?this.runnerCounterTopLeftPosition:0)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isAnimated",{get:function(){return this.animatorState===y.Paused||this.animatorState===y.Play||this.animatorState===y.Stopped},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isPlaying",{get:function(){return this.animatorState===y.Play},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isPaused",{get:function(){return this.animatorState===y.Paused},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isStopped",{get:function(){return this.animatorState===y.Stopped},enumerable:!0,configurable:!0}),e.prototype.setDefaultValues=function(){this.position=e.AnimationMinPosition,this.animatorState=y.Ready,this.runnerCounterValue=null},e.prototype.render=function(){this.renderControls(),this.disableControls(),this.chart.isAutoPlay||(this.isAutoPlayed=!0,this.savedPosition&&(this.savedPosition=null)),this.chart.isAutoPlay&&this.isAutoPlayed&&this.animatorState===y.Play&&!this.isPositionWasSaved&&!_.isEqual(this.autoPlayPosition,this.savedPosition)&&(this.chart.stopAnimation(),this.isAutoPlayed=!1,this.isPositionWasSaved=!0,this.animatorState=y.Ready),this.animatorState===y.Play?this.play():this.chart.isAutoPlay&&!this.isAutoPlayed&&this.animatorState===y.Ready?(this.autoPlayPosition=this.savedPosition,this.isAutoPlayed=!0,this.savedPosition&&this.savedPosition.series<this.chart.data.series.length&&this.savedPosition.index<this.chart.data.series[this.savedPosition.series].data.length&&(this.position=this.savedPosition),this.play(this.chart.autoplayPauseDuration)):this.chart.renderChart()},e.prototype.setControlsColor=function(e){this.color=e},e.prototype.renderControls=function(){this.show(),this.animationPlay.attr("transform",t.SVGUtil.translate(0,0)).attr("fill",this.color),this.animationPause.attr("transform",t.SVGUtil.translate(30,0)).attr("fill",this.color),this.animationReset.attr("transform",t.SVGUtil.translate(60,0)).attr("fill",this.color),this.animationPrev.attr("transform",t.SVGUtil.translate(90,0)).attr("fill",this.color),this.animationNext.attr("transform",t.SVGUtil.translate(120,0)).attr("fill",this.color),this.animationToEnd.attr("transform",t.SVGUtil.translate(150,0)).attr("fill",this.color),this.runnerCounter.attr("fill",this.color).attr("transform",t.SVGUtil.translate(this.runnerCounterPosition===m.TopLeft?this.runnerCounterTopLeftPosition:this.chart.viewport.width-2,this.chart.data.runnerCounterHeight/2+7)),this.runnerCounterText.style("text-anchor",this.runnerCounterPosition===m.TopLeft?"start":"end"),this.chart.data&&this.chart.data.settings&&(this.runnerCounterText.style(f.ConvertTextPropertiesToStyle(f.GetRunnerCounterTextProperties(null,this.chart.data.settings.runnerCounter.fontSize))),this.runnerCounterText.style("fill",this.chart.data.settings.runnerCounter.fontColor)),this.drawCounterValue()},e.setControlVisiblity=function(t,i,a){void 0===a&&(a=!1),t.style("opacity",i?e.DefaultOpacity:e.DimmedOpacity),i?t.attr("display","inline"):a&&t.attr("display","none")},e.prototype.disableControls=function(){var t=this.chart.data&&this.chart.data.settings&&this.chart.data.settings.runnerCounter.show;switch(e.setControlVisiblity(this.animationReset,!0),e.setControlVisiblity(this.animationToEnd,!0),this.animatorState){case y.Play:e.setControlVisiblity(this.animationPlay,!1),e.setControlVisiblity(this.animationPrev,!0),e.setControlVisiblity(this.animationNext,!0),e.setControlVisiblity(this.animationPause,!0),e.setControlVisiblity(this.runnerCounter,t,!0);break;case y.Paused:e.setControlVisiblity(this.animationPlay,!0),e.setControlVisiblity(this.animationPause,!0),e.setControlVisiblity(this.animationPrev,!0),e.setControlVisiblity(this.animationNext,!0),e.setControlVisiblity(this.runnerCounter,t,!0);break;case y.Stopped:e.setControlVisiblity(this.animationPlay,!0),e.setControlVisiblity(this.animationPrev,!0),e.setControlVisiblity(this.animationNext,!0),e.setControlVisiblity(this.runnerCounter,t,!0),e.setControlVisiblity(this.animationPause,!1);break;case y.Ready:e.setControlVisiblity(this.animationPlay,!0),e.setControlVisiblity(this.animationPrev,!1),e.setControlVisiblity(this.animationNext,!1),e.setControlVisiblity(this.animationPause,!1),e.setControlVisiblity(this.runnerCounter,!1,!0);break;default:e.setControlVisiblity(this.animationPlay,!0),e.setControlVisiblity(this.animationPrev,!1),e.setControlVisiblity(this.animationNext,!1),e.setControlVisiblity(this.animationPause,!1),e.setControlVisiblity(this.runnerCounter,!1,!0)}},e.prototype.show=function(){this.container.style("display","inline")},e.prototype.setRunnerCounterValue=function(e){var i=this.chart.data&&this.chart.data.series&&this.chart.data.series[this.position.series]&&this.chart.data.series[this.position.series].data&&this.chart.data.series[this.position.series].data[$.isNumeric(e)?e:this.flooredPosition.index],a=i&&null!=i.runnerCounterValue?i.runnerCounterValue:"";if(i&&i.runnerCounterFormatString){var r=t.valueFormatter.create({format:i.runnerCounterFormatString});a=r.format(a)}this.runnerCounterValue=this.chart.data.settings.runnerCounter.label+" "+a,this.drawCounterValue()},e.prototype.drawCounterValue=function(){var e=""+this.runnerCounterValue;this.runnerCounterText.text(e),l.svgEllipsis(this.runnerCounterText.node(),this.maxTextWidthOfRunnerCounterValue)},e.prototype.play=function(e,t){if(void 0===e&&(e=0),void 0===t&&(t=!1),this.animatorState!==y.Play||t){if(this.animatorState===y.Ready&&(this.animationPlayingIndex++,this.chart.clearChart()),this.chart.isAnimationIndexLast(this.position))return void this.playNext();this.animatorState===y.Paused&&this.chart.clearSelection(),this.animatorState=y.Play,this.chart.renderChart(),this.chart.playAnimation(e),this.disableControls()}},e.prototype.playNext=function(){this.pause(),this.chart.isAnimationSeriesLast(this.position)?(this.setDefaultValues(),this.chart.clearSelection()):(this.position={series:this.position.series+1,index:e.AnimationMinPosition.index},this.play())},e.prototype.pause=function(){this.animatorState===y.Play&&(this.animatorState=y.Paused,this.chart.pauseAnimation()),this.disableControls()},e.prototype.reset=function(){this.clearTimeouts(),this.chart.stopAnimation(),this.chart.clearSelection(),this.chart.clearChart(),this.setDefaultValues(),this.animatorState=y.Stopped,this.disableControls(),this.savedPosition=null},e.prototype.next=function(){if(this.isAnimated){this.stop();var e=this.chart.findNextPoint(this.position);e?(this.position=e,this.chart.renderChart()):this.toEnd()}},e.prototype.prev=function(){if(this.isAnimated){this.stop();var e=this.chart.findPrevPoint(this.position);e?(this.chart.clearRedundant(e),this.position=e,this.chart.renderChart()):this.reset()}},e.prototype.toEnd=function(){this.savedPosition=null,this.chart.stopAnimation(),this.chart.clearSelection(),this.chart.clearChart(),this.setDefaultValues(),this.disableControls(),this.chart.renderChart()},e.prototype.stop=function(){this.isAnimated&&(this.drawCounterValue(),this.savedPosition=this.position,this.chart.stopAnimation(),this.animatorState=y.Stopped,this.disableControls())},Object.defineProperty(e.prototype,"position",{get:function(){return this.positionValue},set:function(e){this.positionValue=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"flooredPosition",{get:function(){return this.position&&{series:this.position.series,index:Math.floor(this.position.index)}},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"savedPosition",{get:function(){return this.chart.data&&this.chart.data.settings&&this.chart.data.settings.playback&&this.chart.data.settings.playback.position},set:function(e){this.chart.isAutoPlay||(e=null),this.chart.data&&this.chart.data.settings&&this.chart.data.settings.playback&&(this.isPositionWasSaved=!0,this.chart.data&&this.chart.data.settings&&this.chart.data.settings.playback&&(this.chart.data.settings.playback.position=e),this.chart.host.persistProperties({merge:[{objectName:"playback",selector:null,properties:{position:e&&JSON.stringify(e)||""}}]}))},enumerable:!0,configurable:!0}),e.prototype.clear=function(){this.isAnimated&&this.chart.stopAnimation(),this.setDefaultValues(),this.container.style("display","none")},e.prototype.clearTimeouts=function(){clearTimeout(this.chart.handleSelectionTimeout)},e.AnimationPlay=n("animationPlay"),e.AnimationPause=n("animationPause"),e.AnimationReset=n("animationReset"),e.AnimationToEnd=n("animationToEnd"),e.AnimationPrev=n("animationPrev"),e.AnimationNext=n("animationNext"),e.RunnerCounter=n("runnerCounter"),e.DimmedOpacity=.25,e.DefaultOpacity=1,e.DefaultControlsColor="#777",e}();i.PulseAnimator=v;var x;!function(e){function t(){return{show:!1,position:0,displayUnits:0,precision:c,labelColor:u,fontSize:h,labelDensity:p}}e.getDefaultPulseChartLabelSettings=t}(x=i.PulseChartDataLabelUtils||(i.PulseChartDataLabelUtils={}));var b;!function(e){function t(e,t){var i={};if(!e)return i;var a=e.objects;if(a){var r=a.categoryAxis;r&&(i={show:r.show,axisType:r.axisType,axisScale:r.axisScale,start:r.start,end:r.end,showAxisTitle:null==r.showAxisTitle?t:r.showAxisTitle,axisStyle:r.axisStyle,labelColor:r.labelColor,labelDisplayUnits:r.labelDisplayUnits,labelPrecision:r.labelPrecision,duration:r.duration})}return i}function i(e,t){var i={};if(!e)return i;var a=e.objects;if(a){var r=a.valueAxis;r&&(i={show:r.show,position:r.position,axisScale:r.axisScale,start:r.start,end:r.end,showAxisTitle:null==r.showAxisTitle?t:r.showAxisTitle,axisStyle:r.axisStyle,labelColor:r.labelColor,labelDisplayUnits:r.labelDisplayUnits,labelPrecision:r.labelPrecision,secShow:r.secShow,secPosition:r.secPosition,secAxisScale:r.secAxisScale,secStart:r.secStart,secEnd:r.secEnd,secShowAxisTitle:r.secShowAxisTitle,secAxisStyle:r.secAxisStyle,secLabelColor:r.secLabelColor,secLabelDisplayUnits:r.secLabelDisplayUnits,secLabelPrecision:r.secLabelPrecision})}return i}e.getCategoryAxisProperties=t,e.getValueAxisProperties=i}(b=i.PulseChartAxisPropertiesHelper||(i.PulseChartAxisPropertiesHelper={}))}(i=t.samples||(t.samples={}))}(t=e.visuals||(e.visuals={}))}(i||(i={}))},function(e,t){var i,i=(window.jsCommon,window.powerbi);window.powerbitests,window.InJs,window.debug,window.jasmine,window.Microsoft;!function(e){var t;!function(t){var i;!function(i){var a=t.utility.SelectionManager,r=function(){function i(){this.margin={top:10,right:30,bottom:10,left:10},this.LegendSize=50,this.AxisSize=30}return i.prototype.init=function(e){var r=this;this.hostServices=e.host,this.selectionManager=new a({hostServices:this.hostServices}),this.root=d3.select(e.element.get(0)).append("svg").classed(i.Identity.class,!0),this.root.on("click",function(e){r.clearSelection()}),this.main=this.root.append("g"),this.axes=this.main.append("g").classed(i.Axes.class,!0),this.axisX=this.axes.append("g").classed(i.Axis.class,!0),this.axisY=this.axes.append("g").classed(i.Axis.class,!0),this.axisY2=this.axes.append("g").classed(i.Axis.class,!0),this.legends=this.main.append("g").classed(i.Legends.class,!0),this.line=this.main.append("g").classed(i.Values.class,!0),this.colors=e.style&&e.style.colorPalette?e.style.colorPalette.dataColors:new t.DataColorPalette},i.prototype.update=function(e){if(e.dataViews&&e.dataViews[0]){var t=e.viewport,i=this.model=this.converter(e.dataViews[0],t);this.clearSelection(),this.resize(t),this.draw(i)}},i.prototype.destroy=function(){this.root=null},i.prototype.setIsStopped=function(e){var t={merge:[{objectName:"misc",selector:void 0,properties:{isstopped:e}}]};this.hostServices.persistProperties(t),this.hostServices.onSelect({visualObjects:[]})},i.prototype.enumerateObjectInstances=function(e){var t=[];if(!this.model||!this.model.settings)return t;var i=this.model.settings;switch(e.objectName){case"lineoptions":var a={objectName:"lineoptions",displayName:"lineoptions",selector:null,properties:{fill:i.lineFill,lineThickness:i.lineThickness}};t.push(a);break;case"dotoptions":var r={objectName:"dotoptions",displayName:"dotoptions",selector:null,properties:{color:i.dotFill,dotSizeMin:i.dotSizeMin,dotSizeMax:i.dotSizeMax}};t.push(r);break;case"counteroptions":var s={objectName:"counteroptions",displayName:"counteroptions",selector:null,properties:{counterTitle:i.counterTitle}};t.push(s);break;case"misc":var o={objectName:"misc",displayName:"misc",selector:null,properties:{isanimated:i.isanimated,isstopped:i.isstopped,duration:i.duration}};t.push(o)}return t},i.prototype.selectDot=function(e,t){var i=d3.select(e);i.classed("point_selected")?this.clearSelection():(t&&this.selectionManager.select(t),this.root.classed("filtered",!0),this.line.selectAll("circle.point").classed("point_selected",!1),d3.select(e).classed("point_selected",!0)),d3.event.stopPropagation()},i.prototype.clearSelection=function(){this.root.classed("filtered",!1),this.root.selectAll("circle.point").classed("point_selected",!1),this.selectionManager.clear()},i.prototype.converter=function(e,i){if(!(e.categorical&&e.categorical.categories&&e.categorical.categories[0]&&e.categorical.categories[0].values&&e.categorical.categories[0].values.length>0&&e.categorical&&e.categorical.values&&e.categorical.values[0]&&e.categorical.values[0].values&&e.categorical.values[0].values.length>0))return null;var a,r,s,o,n=[],l=this,c=t.AxisHelper.getCategoryValueType(e.categorical.categories[0].source,!0);this.isDateTime=t.AxisHelper.isDateTime(c);var u,h=!0,p=this.parseSettings(e),d=Math.max(0,i.width-this.margin.left-this.margin.right-this.LegendSize-this.AxisSize),g=Math.max(0,i.height-this.margin.top-this.margin.bottom-this.LegendSize),m="";n=e.categorical.categories[0].values,a=e.categorical.categories[0].source,r=d3.extent(n),this.isDateTime?(s=r[0].getTime(),o=r[1].getTime(),s=new Date(s),o=new Date(o+.05*(o-s)),m="MMM dd yyyy",u=t.valueFormatter.create({format:m})):(s=r[0],o=r[1],o+=.05*(o-s),u=t.valueFormatter.create({value:0}));var f=t.AxisHelper.createAxis({pixelSpan:d,dataDomain:[s,o],metaDataColumn:a,formatString:null,outerPadding:0,isCategoryAxis:!0,isScalar:h,isVertical:!1,forcedTickCount:void 0,useTickIntervalForDisplayUnits:!0,getValueFn:function(e,t){return l.isDateTime?u.format(new Date(e)):e}});f.formatter=u,a=e.categorical.values[0].source,n=e.categorical.values[0].values,r=d3.extent(n),s=r[0],o=r[1];for(var y,v=[],x=0,b=0,S=0,w=0;w<e.categorical.categories[0].values.length;w++)b=e.categorical.values[0].values[w],S=e.categorical.categories[0].values[w],x+=b,y=t.SelectionId.createWithId(e.categorical.categories[0].identity[w]),v.push({dot:(b-s)/(o-s),value:b,sum:x,time:S,selector:y});x+=.1*(x-s);var C=t.AxisHelper.createAxis({pixelSpan:g,dataDomain:[s,x],metaDataColumn:a,formatString:null,outerPadding:0,isCategoryAxis:!1,isScalar:!0,isVertical:!0,useTickIntervalForDisplayUnits:!0}),P=t.AxisHelper.createAxis({pixelSpan:g,dataDomain:[s,x],metaDataColumn:a,formatString:null,outerPadding:0,isCategoryAxis:!1,isScalar:!0,isVertical:!0,useTickIntervalForDisplayUnits:!0});return P.axis.orient("right"),{points:v,settings:p,xAxis:f,yAxis:C,yAxis2:P,legends:this.generateAxisLabels(i,p)}},i.prototype.parseSettings=function(a){if(!(a&&a.metadata&&a.metadata.columns&&a.metadata.columns[0]))return null;var r=a.metadata.objects,s=new t.ColorHelper(this.colors,i.Properties.lineoptions.fill,i.DefaultSettings.lineFill),o=new t.ColorHelper(this.colors,i.Properties.dotoptions.color,i.DefaultSettings.dotFill),n=i.DefaultSettings.xAxisTitle,l=i.DefaultSettings.yAxisTitle;a.categorical.categories[0]&&a.categorical.categories[0].source&&a.categorical.categories[0].source.displayName&&a.categorical.values[0]&&a.categorical.values[0].source&&a.categorical.values[0].source.displayName&&(n=a.categorical.categories[0].source.displayName,l=a.categorical.values[0].source.displayName);var c=i.DefaultSettings.lineThickness,u=i.DefaultSettings.dotSizeMin,h=i.DefaultSettings.dotSizeMax,p=i.DefaultSettings.counterTitle,d=i.DefaultSettings.isanimated,g=i.DefaultSettings.isstopped,m=i.DefaultSettings.duration;return r&&(c=e.DataViewObjects.getValue(r,i.Properties.lineoptions.lineThickness,i.DefaultSettings.lineThickness),u=e.DataViewObjects.getValue(r,i.Properties.dotoptions.dotSizeMin,i.DefaultSettings.dotSizeMin),h=e.DataViewObjects.getValue(r,i.Properties.dotoptions.dotSizeMax,i.DefaultSettings.dotSizeMax),p=e.DataViewObjects.getValue(r,i.Properties.counteroptions.counterTitle,i.DefaultSettings.counterTitle),d=e.DataViewObjects.getValue(r,i.Properties.misc.isanimated,i.DefaultSettings.isanimated),g=e.DataViewObjects.getValue(r,i.Properties.misc.isstopped,i.DefaultSettings.isstopped),m=e.DataViewObjects.getValue(r,i.Properties.misc.duration,i.DefaultSettings.duration)),{xAxisTitle:n,yAxisTitle:l,lineFill:s.getColorForMeasure(r,""),lineThickness:c,dotFill:o.getColorForMeasure(r,""),dotSizeMin:u,dotSizeMax:h,counterTitle:p,isstopped:g,isanimated:d,duration:m}},i.prototype.generateAxisLabels=function(e,i){return[{transform:t.SVGUtil.translate((e.width-this.margin.left-this.margin.right)/2,e.height-this.margin.top-this.margin.bottom),text:i.xAxisTitle,dx:"1em",dy:"-1em"},{transform:t.SVGUtil.translateAndRotate(0,(e.height-this.margin.top-this.margin.bottom)/2,0,0,270),text:i.yAxisTitle,dx:"3em"}]},i.prototype.resize=function(e){this.root.attr({height:Math.max(0,e.height),width:Math.max(0,e.width)}),this.main.attr("transform",t.SVGUtil.translate(this.margin.left,this.margin.top)),this.legends.attr("transform",t.SVGUtil.translate(this.margin.left,this.margin.top)),this.line.attr("transform",t.SVGUtil.translate(this.margin.left+this.LegendSize,0)),this.axes.attr("transform",t.SVGUtil.translate(this.margin.left+this.LegendSize,0)),this.axisX.attr("transform",t.SVGUtil.translate(0,e.height-this.margin.top-this.margin.bottom-this.LegendSize)),this.axisY2.attr("transform",t.SVGUtil.translate(e.width-this.margin.left-this.margin.right-this.LegendSize-this.AxisSize,0))},i.prototype.draw=function(e){var t=this,i=this;if(this.line.selectAll("*").remove(),this.legends.selectAll("*").remove(),this.axisX.selectAll("*").remove(),this.axisY.selectAll("*").remove(),this.axisY2.selectAll("*").remove(),e&&(this.renderLegends(e),e&&e.points&&e.points.length)){if(this.axisX.call(e.xAxis.axis),this.axisY.call(e.yAxis.axis),this.axisY2.call(e.yAxis2.axis),e.settings.isanimated){var a=this.line.append("g").classed("lineDotChart__playBtn",!0).attr("transform","translate(40, 20)");if(a.append("circle").attr("r",17),e.settings.isstopped)return a.append("path").attr("d","M0 2l10 6-10 6z").attr("transform","translate(-4,-8)"),void a.on("click.lineDotChart__playBt",function(){i.setIsStopped(!1)});a.append("path").attr("d","M0 2l10 6-10 6z").attr("transform-origin","center").attr("transform","translate(6, 8) rotate(180)"),a.append("rect").attr("width","2").attr("height","12").attr("transform","translate(-7,-6)"),a.on("click.lineDotChart__playBt",function(){i.setIsStopped(!0)})}var r=this.line.append("clipPath").attr("id","lineClip").append("rect").attr("x",0).attr("y",0).attr("width",1).attr("height",1e4),s=d3.svg.line().x(function(t){return e.xAxis.scale(t.time)}).y(function(t){return e.yAxis.scale(t.sum)}),o=this.line.selectAll("path.plot").data([e.points]);o.enter().append("path"),o.classed("plot",!0).attr("stroke",function(t,i){return e.settings.lineFill}).attr("stroke-width",e.settings.lineThickness).attr("d",s);var n=o.node().getTotalLength(),l=o.node().getPointAtLength(0).x,c=o.node().getPointAtLength(n).x;o.attr("clip-path","url("+location.href+"#lineClip)"),e.settings.isanimated?r.attr("x",l).interrupt().transition().ease("linear").duration(1e3*e.settings.duration).attr("width",c-l):r.interrupt().attr("x",l).attr("width",c-l),o.exit().remove();var u=300,h=0,p=this.line.selectAll("circle.point").data(e.points),i=this;p.enter().append("circle").attr("fill",e.settings.dotFill).attr("opacity",.77).attr("r",function(t){return e.settings.dotSizeMin+t.dot*(e.settings.dotSizeMax-e.settings.dotSizeMin)}).classed("point",!0).on("mouseover.point",this.showDataPoint).on("mouseout.point",this.hideDataPoint).on("click.point",function(e){i.selectDot(this,e.selector)}),e.settings.isanimated?p.interrupt().attr("transform",function(t){return"translate("+e.xAxis.scale(t.time)+" "+e.yAxis.scale(t.sum)+") scale(0.005)"}).transition().duration(u).delay(function(i,a){return t.pointDelay(e.points,a,e.settings.duration)}).ease("linear").attr("transform",function(t){return"translate("+e.xAxis.scale(t.time)+" "+e.yAxis.scale(t.sum)+") scale(3.4)"}).transition().duration(u).delay(function(i,a){return t.pointDelay(e.points,a,e.settings.duration)+u}).ease("elastic").attr("transform",function(t){return"translate("+e.xAxis.scale(t.time)+" "+e.yAxis.scale(t.sum)+") scale(1)"}):p.interrupt().attr("transform",function(t){return"translate("+e.xAxis.scale(t.time)+" "+e.yAxis.scale(t.sum)+") scale(1)"}),p.exit().remove();for(var d=0;d<p[0].length;d++)this.addTooltip(e,p[0][d]);var g=this.line.selectAll("text").data(e.points);g.enter().append("text").classed("text",!0).text(function(t,i){return e.settings.counterTitle+" "+(i+1)}).attr("x",c-260).attr("y",30),e.settings.isanimated?g.attr("opacity",0).interrupt().transition().duration(h).delay(function(i,a){return t.pointDelay(e.points,a,e.settings.duration)}).attr("transform","translate(0 0)").attr("opacity",1).transition().duration(h).delay(function(i,a){return e.points[a+1]?t.pointDelay(e.points,a+1,e.settings.duration):Number.POSITIVE_INFINITY}).attr("opacity",0):g.interrupt().attr("transform","translate(0 0)").attr("opacity",function(t,i){return Number(i===e.points.length-1)}),g.exit().remove()}},i.prototype.pointDelay=function(e,t,i){if(!e.length||!e[t]||0===t)return 0;if(this.isDateTime)var a=e[t].time,r=e[0].time.getTime(),s=e[e.length-1].time.getTime(),o=a.getTime();else var a=e[t].time,r=e[0].time,s=e[e.length-1].time,o=a;return 1e3*i*(o-r)/(s-r)},i.prototype.showDataPoint=function(e,t){d3.select(this).classed("show",!0)},i.prototype.hideDataPoint=function(e,t){d3.select(this).classed("show",!1)},i.prototype.addTooltip=function(e,i){var a=d3.select(i),r=a.datum();t.TooltipManager.addTooltip(a,function(t){return[{displayName:e.settings.xAxisTitle,value:e.xAxis.formatter.format(r.time)},{displayName:e.settings.yAxisTitle,value:r.value.toString()}]})},i.prototype.renderLegends=function(e){var t=this.legends.selectAll(i.Legend.selector).data(e.legends);t.enter().append("svg:text"),t.attr("x",0).attr("y",0).attr("dx",function(e){return e.dx}).attr("dy",function(e){return e.dy}).attr("transform",function(e){return e.transform}).text(function(e){return e.text}).classed(i.Legend.class,!0),t.exit().remove()},i.DefaultSettings={lineFill:"rgb(102, 212, 204)",lineThickness:3,dotFill:"#005c55",dotSizeMin:4,dotSizeMax:38,counterTitle:"Total features",xAxisTitle:"",yAxisTitle:"",duration:20,isanimated:!0,isstopped:!0},i.capabilities={dataRoles:[{name:"Date",kind:e.VisualDataRoleKind.Grouping,displayName:"Date"},{name:"Values",kind:e.VisualDataRoleKind.Measure,displayName:"Values"}],dataViewMappings:[{conditions:[{Date:{min:0,max:1},Values:{min:0,max:1},Labels:{min:0,max:1}}],categorical:{categories:{for:{in:"Date"},dataReductionAlgorithm:{sample:{}}},values:{for:{in:"Values"}}}}],objects:{general:{displayName:e.data.createDisplayNameGetter("Visual_General"),properties:{formatString:{type:{formatting:{formatString:!0}}}}},lineoptions:{displayName:"Line",properties:{fill:{displayName:e.data.createDisplayNameGetter("Visual_Fill"),type:{fill:{solid:{color:!0}}}},lineThickness:{displayName:"Thickness",type:{numeric:!0}}}},dotoptions:{displayName:"Dot",properties:{color:{displayName:e.data.createDisplayNameGetter("Visual_Fill"),type:{fill:{solid:{color:!0}}}},dotSizeMin:{displayName:"Min size",type:{numeric:!0}},dotSizeMax:{displayName:"Min size",type:{numeric:!0}}}},counteroptions:{displayName:"Counter",properties:{counterTitle:{displayName:"Title",type:{text:!0}}}},misc:{displayName:"Animation",properties:{isanimated:{displayName:"Animated",type:{bool:!0}},isstopped:{displayName:"Stop on load",type:{bool:!0}},duration:{displayName:"Time",type:{numeric:!0}}}}}},i.Identity={class:"lineDotChart",selector:".lineDotChart"},i.Axes={class:"axes",selector:".axes"},i.Axis={class:"axis",selector:".axis"},i.Legends={class:"legends",selector:".legends"},i.Legend={class:"legend",selector:".legend"},i.Values={class:"line",selector:".line"},i.Properties={general:{formatString:{objectName:"general",propertyName:"formatString"}},lineoptions:{fill:{objectName:"lineoptions",propertyName:"fill"},lineThickness:{objectName:"lineoptions",propertyName:"lineThickness"}},dotoptions:{color:{objectName:"dotoptions",propertyName:"color"},dotSizeMin:{objectName:"dotoptions",propertyName:"dotSizeMin"},dotSizeMax:{objectName:"dotoptions",propertyName:"dotSizeMax"}},counteroptions:{counterTitle:{objectName:"counteroptions",propertyName:"counterTitle"}},misc:{isanimated:{objectName:"misc",propertyName:"isanimated"},isstopped:{objectName:"misc",propertyName:"isstopped"},duration:{objectName:"misc",propertyName:"duration"}}},i}();i.LineDotChart=r}(i=t.samples||(t.samples={}))}(t=e.visuals||(e.visuals={}))}(i||(i={}))},function(e,t){var i,i=(window.jsCommon,window.powerbi);window.powerbitests,window.InJs,window.debug,window.jasmine,window.Microsoft;!function(e){var t;!function(t){var i;!function(i){var a=t.utility.SelectionManager;i.sunburstRoleNames={nodes:"Nodes",values:"Values"};var r=function(){function i(){this.total=0}return i.prototype.init=function(e){var t=this;this.arc=d3.svg.arc().startAngle(function(e){return e.x}).endAngle(function(e){return e.x+e.dx}).innerRadius(function(e){return Math.sqrt(e.y)}).outerRadius(function(e){return Math.sqrt(e.y+e.dy)}),this.colors=e.style.colorPalette.dataColors,this.selectionManager=new a({hostServices:e.host}),this.svg=d3.select(e.element.get(0)).append("svg"),this.svg.classed("mainDrawArea",!0),this.g=this.svg.append("g"),this.g.classed("container",!0),this.svg.append("text").classed("sunBurstPercentageFixed",!0),this.svg.on("mousedown",function(e){t.svg.selectAll("path").style("opacity",1),t.svg.select(".sunBurstPercentageFixed").style("opacity",0),t.selectionManager.clear()})},i.setAllUnhide=function(e){e.attr("setUnHide","true")},i.prototype.update=function(e){if(e.dataViews.length>0){var t=this.converter(e.dataViews[0],this.colors);this.viewport=e.viewport,this.updateInternal(t)}},i.prototype.updateInternal=function(e){var a=this;this.svg.attr({height:this.viewport.height,width:this.viewport.width}),this.g.attr("transform",t.SVGUtil.translate(this.viewport.width/2,this.viewport.height/2));var r=Math.min(this.viewport.width,this.viewport.height)/2,s=d3.layout.partition().size([2*Math.PI,r*r]).value(function(e){return e.value}),o=this.g.datum(e).selectAll("path").data(s.nodes);o.enter().append("path"),o.attr("display",function(e){return e.depth?null:"none"}).attr("d",this.arc).style("stroke","#fff").style("fill",function(e){return e.color}).style("fill-rule","evenodd").on("mousedown",function(e){e.selector&&a.selectionManager.select(e.selector),d3.selectAll("path").call(i.setAllUnhide).attr("setUnHide",null),a.highlightPath(e,a,!0);var t=a.svg.select(".sunBurstPercentageFixed"),r=0===a.total?0:(100*e.total/a.total).toPrecision(3);t.text(e?r+"%":""),t.style("fill",e.color),a.onResize(),event.stopPropagation()}),this.renderTooltip(o),o.exit().remove(),this.onResize()},i.getTreePath=function(e){for(var t=[],i=e;i.parent;)t.unshift(i),i=i.parent;return t},i.prototype.onResize=function(){var t=this.viewport.width,i=this.viewport.height,a=this.svg.select(".sunBurstPercentageFixed"),r=e.TextMeasurementService.measureSvgTextElementWidth(a[0][0]);a.style("opacity",1),a.attr("y",i/2+4),a.attr("x",t/2-r/2)},i.prototype.highlightPath=function(e,t,a){var r=e?i.getTreePath(e):[];t.svg.selectAll("path").each(function(){"true"!==d3.select(this).attr("setUnHide")&&d3.select(this).style("opacity",i.minOpacity)}),t.svg.selectAll("path").filter(function(e){return r.indexOf(e)>=0}).each(function(){d3.select(this).style("opacity",1),a===!0&&d3.select(this).attr("setUnHide","true")})},i.prototype.renderTooltip=function(e){t.TooltipManager.addTooltip(e,function(e){return e.data.tooltipInfo})},i.getTooltipData=function(e,t){return[{displayName:e,value:t<0?"":t.toString()}]},i.prototype.covertTreeNodeToSunBurstNode=function(e,a,r,s,o){
var n;e.identity&&(s=s.concat([e.identity]),n={data:s});var l=0===s.length?null:new t.SelectionId(n,(!1)),c=e.values?e.values[0].value:0,u={name:e.name,value:Math.max(c,0),selector:l,total:c};if(e.value&&(u.color=o?o:r.getColor(e.value).value),this.total+=u.value,e.children&&e.children.length>0){u.tooltipInfo=i.getTooltipData(e.value,-1),u.children=[];for(var h=0;h<e.children.length;h++){var p=this.covertTreeNodeToSunBurstNode(e.children[h],u,r,s,u.color);u.children.push(p),u.total+=p.total}}else u.tooltipInfo=i.getTooltipData(e.value,c);return a&&(u.parent=a),u},i.prototype.converter=function(e,t){var i=t.getNewColorScale();this.total=0;var a=this.covertTreeNodeToSunBurstNode(e.matrix.rows.root,null,i,[],void 0);return a},i.minOpacity=.2,i.roleNames={nodes:"Nodes",values:"Values"},i.capabilities={dataRoles:[{name:i.roleNames.nodes,kind:e.VisualDataRoleKind.Grouping,displayName:"Groups"},{name:i.roleNames.values,kind:e.VisualDataRoleKind.Measure,displayName:"Values"}],objects:{general:{displayName:e.data.createDisplayNameGetter("Visual_General"),properties:{formatString:{type:{formatting:{formatString:!0}}}}}},dataViewMappings:[{conditions:[{Groups:{min:0},Values:{max:1}}],matrix:{rows:{for:{in:i.roleNames.nodes}},values:{for:{in:i.roleNames.values}}}}]},i}();i.Sunburst=r}(i=t.samples||(t.samples={}))}(t=e.visuals||(e.visuals={}))}(i||(i={}))},function(e,t){var i,i=(window.jsCommon,window.powerbi);window.powerbitests,window.InJs,window.debug,window.jasmine,window.Microsoft;!function(e){var t;!function(e){var t;!function(t){t.sunburstCustom={name:"sunburstCustom",watermarkKey:"defaultWatermark",capabilities:e.samples.Sunburst.capabilities,create:function(){return new e.samples.Sunburst}},t.asterPlot={name:"asterPlot",capabilities:e.samples.AsterPlot.capabilities,create:function(){return new e.samples.AsterPlot}},t.tornadoChart={name:"tornadoChart",capabilities:e.samples.TornadoChart.capabilities,create:function(){return new e.samples.TornadoChart}},t.sankeyDiagram={name:"sankeyDiagram",capabilities:e.samples.SankeyDiagram.capabilities,create:function(){return new e.samples.SankeyDiagram}},t.mekkoChart={name:"mekkoChart",watermarkKey:"mekko",capabilities:e.samples.MekkoChart.capabilities,create:function(){return new e.samples.MekkoChart({chartType:e.samples.MekkoChartType.HundredPercentStackedColumn})},customizeQuery:e.ColumnChart.customizeQuery,getSortableRoles:function(t){return e.ColumnChart.getSortableRoles(t)}},t.bulletChart={name:"bulletChart",capabilities:e.samples.BulletChart.capabilities,create:function(){return new e.samples.BulletChart}},t.wordCloud={name:"wordCloud",capabilities:e.samples.WordCloud.capabilities,create:function(){return new e.samples.WordCloud}},t.chicletSlicer={name:"chicletSlicer",capabilities:e.samples.ChicletSlicer.capabilities,create:function(){return new e.samples.ChicletSlicer}},t.chordChart={name:"chordChart",capabilities:e.samples.ChordChart.capabilities,create:function(){return new e.samples.ChordChart}},t.enhancedScatterChart={name:"enhancedScatterChart",capabilities:e.samples.EnhancedScatterChart.capabilities,create:function(){return new e.samples.EnhancedScatterChart}},t.radarChart={name:"radarChart",capabilities:e.samples.RadarChart.capabilities,create:function(){return new e.samples.RadarChart}},t.dotPlot={name:"dotPlot",capabilities:e.samples.DotPlot.capabilities,create:function(){return new e.samples.DotPlot}},t.histogram={name:"histogram",capabilities:e.samples.Histogram.capabilities,create:function(){return new e.samples.Histogram}},t.timeline={name:"timeline",capabilities:e.samples.Timeline.capabilities,create:function(){return new e.samples.Timeline}},t.forceGraph={name:"forceGraph",capabilities:e.samples.ForceGraph.capabilities,create:function(){return new e.samples.ForceGraph}},t.gantt={name:"gantt",capabilities:e.samples.Gantt.capabilities,create:function(){return new e.samples.Gantt}},t.streamGraph={name:"streamGraph",capabilities:e.samples.StreamGraph.capabilities,create:function(){return new e.samples.StreamGraph}},t.pulseChart={name:"pulseChart",capabilities:e.samples.PulseChart.capabilities,create:function(){return new e.samples.PulseChart}},t.lineDotChart={name:"lineDotChart",capabilities:e.samples.LineDotChart.capabilities,create:function(){return new e.samples.LineDotChart}}}(t=e.plugins||(e.plugins={}))}(t=e.visuals||(e.visuals={}))}(i||(i={}))}]);